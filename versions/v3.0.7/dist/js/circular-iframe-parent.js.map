{"version":3,"file":"circular-iframe-parent.js","sources":["../../js/circular-iframe-parent.js"],"sourcesContent":["\"use strict\";\n(function(webstop){\n\n  // Embed an iframed Circular and manage dynamic height\n  // ===================================================\n  //\n  // The script does the following:\n  //\n  // - Creates a Circular iframe containing the circular inside the #webstop-circular div.\n  // - Creates a Modal with modal iframe within the body\n  // - Listens for a postMessage indicating the modal should be triggered and what URL to load into the iframe.\n  // - Listens for a postMessage indicating the height of the circular has changed, and updates the circular iframe height.\n  //\n  // Placement: This script is served from the parent website on the page containing the circular iframe.\n  //\n  // See https://guides.webstop.com/docs/3.0/products/circulars/circular-iframe/ for information about using this within\n  // core-customizations to serve on retailer websites.\n\n  const circularContainer = document.getElementById('webstop-circular');\n  let error = '';\n\n  if (webstop.hasCircularStoreLocator === '' || webstop.hasCircularStoreLocator === null || webstop.hasCircularStoreLocator === undefined) {\n    webstop.hasCircularStoreLocator = true;\n  }\n\n  // I. Variable Setting\n  // ----------------\n  // 1. If included from a retailer circular file set the variables from that.\n  // 2. Prefer attributes set on the #webstop-circular container\n  // 3. Fall back to attributes set on the document.body tag\n  // 4. Check for missing variables and post an error to the console if any are missing\n\n\n\n  // 2. If values are provided as attributes on the #webstop-circular container prefer those values\n  if (circularContainer.hasAttribute('data-retailer-id')) {\n    webstop.retailerID= circularContainer.getAttribute('data-retailer-id');\n  }\n  if (circularContainer.hasAttribute('data-api-host')) {\n    webstop.apiHost= circularContainer.getAttribute('data-api-host');\n  }\n  if (circularContainer.hasAttribute('data-web-host')) {\n    webstop.webHost= circularContainer.getAttribute('data-web-host');\n  }\n  if (circularContainer.hasAttribute('data-cdn-host')) {\n    webstop.cdnHost= circularContainer.getAttribute('data-cdn-host');\n  }\n  if (circularContainer.hasAttribute('data-store-id')) {\n    webstop.storeID= circularContainer.getAttribute('data-store-id');\n  }\n  if (circularContainer.hasAttribute('data-store-number')) {\n    webstop.storeNumber= circularContainer.getAttribute('data-store-number');\n  }\n\n  // 3. if a value is missing, check to see if it exists on the body tag, but only as a last resort\n  if ( (webstop.retailerID === '' || webstop.retailerID === null || webstop.retailerID === undefined) && document.body.hasAttribute('data-retailer-id')) {\n    webstop.retailerID= document.body.getAttribute('data-retailer-id');\n  }\n  if ( (webstop.apiHost === '' || webstop.apiHost === null || webstop.apiHost === undefined) && document.body.hasAttribute('data-api-host')) {\n    webstop.apiHost= document.body.getAttribute('data-api-host');\n  }\n  if ( (webstop.webHost === '' || webstop.webHost === null || webstop.webHost === undefined) && document.body.hasAttribute('data-web-host')) {\n    webstop.webHost= document.body.getAttribute('data-web-host');\n  }\n  if ( (webstop.cdnHost === '' || webstop.cdnHost === null || webstop.cdnHost === undefined) && document.body.hasAttribute('data-cdn-host')) {\n    webstop.cdnHost= document.body.getAttribute('data-cdn-host');\n  }\n  if ( (webstop.storeID === '' || webstop.storeID === null || webstop.storeID === undefined) && document.body.hasAttribute('data-retailer-id')) {\n    webstop.storeID= document.body.getAttribute('data-store-id');\n  }\n  if ( (webstop.storeNumber === '' || webstop.storeNumber === null || webstop.storeNumber === undefined) && document.body.hasAttribute('data-store-number')) {\n    webstop.storeNumber= document.body.getAttribute('data-store-number');\n  }\n\n  // 4. Notify us in the web browser's console if a required value is missing\n  if (webstop.retailerID === '' || webstop.retailerID === null || webstop.retailerID === undefined) {\n    error += 'Webstop circular unable find Retailer ID. ';\n  }\n  if (webstop.apiHost === '' || webstop.apiHost === null || webstop.apiHost === undefined) {\n    error += 'Webstop circular unable find API Host. ';\n  }\n  if (webstop.webHost === '' || webstop.webHost === null || webstop.webHost === undefined) {\n    error += 'Webstop circular unable find Web Host. ';\n  }\n  if (webstop.cdnHost === '' || webstop.cdnHost === null || webstop.cdnHost === undefined) {\n    error += 'Webstop circular unable find CDN Host. ';\n  }\n  if ( webstop.hasCircularStoreLocator === false && (webstop.storeID === '' || webstop.storeID === null || webstop.storeID === undefined) && (webstop.storeNumber === '' || webstop.storeNumber === null || webstop.storeNumber === undefined)) {\n    error += 'Webstop circular unable find Store ID and unable find Store Number. At least one must be present. ';\n  }\n  if (circularContainer === null || circularContainer === undefined) {\n    error += 'Webstop circular unable container div. ';\n  }\n\n  if (error !== '') {\n    console.warn(error);\n  }\n\n  // Create the main circular iframe\n  if (error === '') {\n    // Create the iframe element\n    const circularIframe = document.createElement('iframe');\n    circularIframe.id = 'webstop-circular-iframe';\n\n    // Set Default URL\n    circularIframe.src = `${webstop.webHost}/circulars/`;\n    // Use Store Number URL\n    if (webstop.storeNumber !== '' && webstop.storeNumber !== null && webstop.storeNumber !== undefined) {\n      circularIframe.src = `${webstop.apiHost}/retailers/${webstop.retailerID}/stores/by_store_number/${webstop.storeNumber}/choose_store?filter=circulars&url=${webstop.webHost}/circulars/`;\n    }\n    // Use Store ID URL\n    if (webstop.storeID !== '' && webstop.storeID !== null && webstop.storeID !== undefined) {\n      circularIframe.src = `${webstop.apiHost}/retailers/${webstop.retailerID}/stores/${webstop.storeID}/choose_store?filter=circulars&url=${webstop.webHost}/circulars/`;\n    }\n\n    circularIframe.style.width = '100%';\n    circularIframe.style.minHeightheight = '100vh';\n    circularIframe.style.border = '0';\n    circularIframe.style.padding = '0';\n    circularIframe.style.margin = '0';\n\n    // Add the iframe to the container\n    circularContainer.appendChild(circularIframe);\n\n\n    // Listen for Post Messages\n    window.addEventListener('message', function(event) {\n      //console.log(`Post Message Received: ${event.data}`);\n      // Process Resize Messages\n      if (event.data && event.data.type === 'resize-webstop-circular-iframe') {\n        console.log(`Resize Iframe Post Message Received. Height: ${event.data.height} Reason: ${event.data.reason}`);\n        //const iframe = document.getElementById('myIframe');\n        circularIframe.style.height = event.data.height + 'px';\n      }\n    });\n  }\n\n\n})( window.webstop = window.webstop || {} );\n\n\n\n\n"],"names":[],"mappings":"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"}