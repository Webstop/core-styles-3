!function(){"use strict";function load(target,url,infinite){fetch(url,{method:"GET",headers:{"X-Requested-With":"fetch"}}).then((function(response){return response.text()})).then((function(body){target.innerHTML=body})).then((function(){infinite&&(pagingObserver.observe(target.querySelector(".paging-trigger")),function(current){let targets=document.querySelectorAll("[data-load-on-view]"),foundCurrent=!1,foundNext=!1,loaded=!1;targets.forEach((target=>{if(loaded=target.classList.contains("is-loaded"),foundCurrent&&!foundNext||loaded){let display=target.getAttribute("data-display-as");display=display||"block",target.style.display=display,loaded||(foundNext=!0)}else target.style.display="none";target==current&&(foundCurrent=!0)}))}(target),initDataAttributes())}))}!function(webstop,ahoy){let retailerID=document.body.getAttribute("data-retailer-id"),apiHost=document.body.getAttribute("data-api-host"),webHost=document.body.getAttribute("data-web-host");webstop.retailerID=retailerID,webstop.apiHost=apiHost,webstop.webHost=webHost,ahoy.visitParams={retailer_id:retailerID},ahoy.visitsUrl=apiHost+"/api/v1/retailers/"+retailerID+"/aye/visit.json",ahoy.eventsUrl=apiHost+"/api/v1/retailers/"+retailerID+"/aye/event.json"}(window.webstop=window.webstop||{},window.ahoy=window.ahoy||{}),function(cs3){function getCookie(name){let nameEquals=name+"=",ca=document.cookie.split(";");for(let i=0;i<ca.length;i++){let c=ca[i];for(;" "==c.charAt(0);)c=c.substring(1,c.length);if(0==c.indexOf(nameEquals))return c.substring(nameEquals.length,c.length)}return null}cs3.setCookie=function(name,value,expireDays){const d=new Date;let expires="";expireDays&&(d.setTime(d.getTime()+24*expireDays*60*60*1e3),expires="expires="+d.toUTCString()+";"),document.cookie=name+"="+value+";"+expires+"path=/"},cs3.getCookie=getCookie,cs3.checkCookie=function(name){return!!getCookie(name)}}(window.cs3=window.cs3||{}),$((function(){$(document.body).on("submit","[data-ajax-form]",(function(event){event.preventDefault();let $this=$(this),url=$this.attr("action"),data=$this.serializeArray(),$target=$this;$this.is("[data-target]")?$target=$($this.data("target")):($this.parent().is(".ajax-form-container")||$this.wrap("<div class='ajax-form-container'></div>"),$target=$this.parent()),$this.is("[data-power-bar]")?$target.load(url,data,(function(){loadShoppingListPowerBar()})):$target.load(url,data)}))})),$((function(){$(document.body).on("click","[data-ajax-load]",(function(event){let $this=$(this),url=$this.data("load"),$target=$this;$this.is("[data-target]")?$target=$($this.data("target")):($this.parent().is(".ajax-form-container")||$this.wrap("<div class='ajax-form-container'></div>"),$target=$this.parent()),$this.is("[data-disable-loading-indicator]")||($this.is('input[type="submit"]')?$this.val("Loading..."):$this.text("Loading..."),($this.is("button")||$this.is('input[type="submit"]'))&&$this.prop("disabled",!0)),$target.load(url,(function(){$this.is("[data-power-bar]")&&loadShoppingListPowerBar(),$this.is("[data-load-on-callback]")&&$this.is("[data-target-on-callback]")&&function(){let callbackUrls=$this.data("load-on-callback").split(","),callbackTargets=$($this.data("target-on-callback"));callbackUrls.forEach((function(callbackUrl,index){$(callbackTargets[index]).load(callbackUrl)}))}()}))}))}));const pagingObserver=new IntersectionObserver((entries=>{if(0!==entries[0].intersectionRatio){!function(source){let maxPageNumber=source.getAttribute("data-max-page-number"),pageNumber=source.getAttribute("data-page-number"),selector="";source.hasAttribute("data-paging")&&(selector=source.getAttribute("data-paging"));selector||(selector=".paging");document.querySelectorAll(selector).forEach((target=>{let currentPage=target.querySelector(".paging-current-page"),pages=target.querySelectorAll(".paging-page"),html=`\n      <span class="d-none d-sm-inline">Page ${pageNumber} of ${maxPageNumber}</span>\n      <span class="d-inline d-sm-none">Pg. ${pageNumber}</span>\n    `;currentPage.innerHTML=html;let url=source.getAttribute("data-load-on-view");url||(url=source.getAttribute("data-url")),pages.forEach((page=>{page.getAttribute("href")==url?page.classList.add("active"):page.classList.contains("active")&&page.classList.remove("active")}))}))}(entries[0].target.closest("[data-page-number]"))}}));function initDataAttributes$1(){$('[data-toggle="popover"]').popover(),$('[data-toggle="tooltip"]').tooltip()}(()=>{let targets=document.querySelectorAll("[data-load-on-view]"),count=0;if(0!==targets.length){targets.forEach((target=>{let url=target.getAttribute("data-load-on-view"),infinite=target.hasAttribute("data-infinite-scroll"),display=target.getAttribute("data-display-as"),loaded=target.classList.contains("is-loaded");display=display||"block",0==count||loaded||(display="none"),target.style.display=display,function(target,url,infinite){new IntersectionObserver((entries=>{0===entries[0].intersectionRatio||entries[0].target.classList.contains("is-loaded")||(entries[0].target.classList.add("is-loaded"),load(target,url,infinite),entries[0].target.hasAttribute("data-skip-history")||history.pushState(null,"",url))})).observe(target)}(target,url,infinite),count++}));let pagingTrigger=document.querySelector(".paging-trigger");pagingTrigger&&pagingObserver.observe(pagingTrigger)}})(),$((function(){$(document.body).on("hidden.bs.modal","#site-modal",(function(){$("#site-modal-title").text(""),$("#site-modal-body").html(""),$("#site-modal-footer").removeClass("d-none")})),$(document.body).on("show.bs.modal","#site-modal",(function(event){let trigger=event.relatedTarget,$trigger=$(event.relatedTarget),title=$trigger.attr("data-title"),url=$trigger.attr("data-load"),content=$trigger.attr("data-content"),footer=$trigger.attr("data-footer"),storeFormPicker=$trigger.is("[data-store-form-picker]");"hide"==footer&&$("#site-modal-footer").addClass("d-none"),$("#site-modal-title").text(title),content&&$("#site-modal-body").html(content),url&&$("#site-modal-body").load(url,(function(){storeFormPicker&&webstop.stores.formPicker(trigger)}))}))})),$((function(){initDataAttributes$1()}));document.querySelectorAll("[data-disable-on-click]").forEach((btn=>{btn.addEventListener("click",(function(event){event.target.disabled=!0,event.target.innerHTML="Loading...",event.target.value="Loading..."}))}));document.querySelectorAll("[data-disable-on-submit]").forEach((btn=>{btn.addEventListener("submit",(function(event){event.target.disabled=!0,event.target.innerHTML="Loading...",event.target.value="Loading..."}))})),$((function(){function update_status(context){let group=$(context).attr("data-check-selector-group"),checked=0,unchecked=0;console.log("Checkbox Changed!"),$(`input[type="checkbox"][data-check-selector-group="${group}"]`).each((function(index){$(this).prop("checked")?checked+=1:unchecked+=1})),checked<=unchecked?select(group):unselect(group)}function select(group){console.log("Change button to select."),$(`[data-check-selector-for="${group}"]`).removeClass("is-unselect"),$(`[data-check-selector-for="${group}"]`).addClass("is-select"),$(`[data-check-selector-for="${group}"]`).attr("data-check-selector-state","select")}function unselect(group){console.log("Change button to unselect."),$(`[data-check-selector-for="${group}"]`).removeClass("is-select"),$(`[data-check-selector-for="${group}"]`).addClass("is-unselect"),$(`[data-check-selector-for="${group}"]`).attr("data-check-selector-state","unselect")}$('input[type="checkbox"][data-check-selector-group]').on("change",(function(){update_status(this)})),$('input[type="checkbox"][data-check-selector-group]').each((function(){update_status(this)})),$(document.body).on("click","[data-check-selector-for]",(function(event){event.preventDefault();let $button=$(this),group=$button.attr("data-check-selector-for");"select"==$button.attr("data-check-selector-state")?($(`input[type="checkbox"][data-check-selector-group="${group}"]`).prop("checked",!0),unselect(group)):($(`input[type="checkbox"][data-check-selector-group="${group}"]`).prop("checked",!1),select(group))}))})),function(){if(document.body.clientWidth<770){console.log("Setting circular cookie...");let name=window.webstop.retailerID+"_circular_format";cs3.setCookie(name,"online",7)}}(),window.addEventListener("load",(function(){let searchField=document.querySelector("input[data-filter-search]");searchField&&searchField.addEventListener("keyup",(function(){let search=this.value.toLowerCase(),selector=this.getAttribute("data-filter-selector"),items=document.querySelectorAll(selector);for(let i of items){-1==i.innerHTML.toLowerCase().indexOf(search)?i.classList.add("d-none"):i.classList.remove("d-none")}}))})),$((function(){$(document.body).on("change","[data-form-toggle-trigger]",(function(event){let $this=$(this),name=$this.attr("name"),tag=$this.prop("tagName"),control="";if("SELECT"==tag)control="select";else if("INPUT"==tag){let input_type=$this.attr("type");"CHECKBOX"==input_type||"checkbox"==input_type?control="checkbox":"RADIO"!=input_type&&"radio"!=input_type||(control="radio")}if("select"==control||"radio"==control){let value=this.value,show=!1;$(`[data-form-toggle*='${name}']`).each((function(){show="exact"==$(this).attr("data-form-toggle-match")?$(this).attr("data-form-toggle-show-for")==value:$(this).attr("data-form-toggle-show-for").includes(value),show?$(this).removeClass("d-none"):$(this).addClass("d-none")}))}else"checkbox"==control&&$(`[data-form-toggle='${name}']`).toggleClass("d-none")}))})),$((function(){function exitSearch(target,reveal=null,$clear=null){null!=$clear&&$clear.val("");let $target=$(target);$target.html(""),$target.hide(),null!=reveal&&$(reveal).show()}!function(){let delay=null;$('[data-search="live"]').find(".search-from-search-text").on("keyup",(function(event){clearTimeout(delay);let $form=$(this).parents('[data-search="live"]'),target=$form.data("target"),hide=$form.data("hide"),url=$form.attr("action");if(event.target.value.length<=2)exitSearch(target);else{let data=$form.serializeArray();delay=setTimeout((function(){!function(data,target,hide,url){let $target=$(target);$(hide).hide(),$target.show("fast",(function(){$target.load(url,data)}))}(data,target,hide,url)}),500)}})),$('[data-search="live"]').find(".search-form-clear").on("click",(function(event){event.preventDefault();let $form=$(this).parents('[data-search="live"]');exitSearch($form.data("target"),$form.data("hide"),$form.find(".search-from-search-text"))}))}()})),function(){function setTagging(searchThis,searchText){const $search=$(searchThis),searchId="#"+$search.attr("id"),targetId=$search.data("tag-search-target"),displayId=$search.data("tag-search-display"),resultsId=$search.data("tag-search-results"),tagging={searchText:searchText,searchId:searchId,targetId:targetId,displayId:displayId,resultsId:resultsId,$search:$search,$target:$(targetId),$display:$(displayId),$results:$(resultsId)};return console.log("Tagging Set"),console.log(`searchText: ${searchText}`),console.log(`searchId:   ${searchId}`),console.log(`targetId:   ${targetId}`),console.log(`displayId:  ${displayId}`),console.log(`resultsId:  ${resultsId}`),tagging}function displayTags(tagging){const tags=trimArray(tagging.$target.val().split(","));let items=[],html="";tags.forEach((function(tag){tag&&items.push(`<span class="tag bg-secondary"> ${tag} <span data-tag-search-remove-tag data-tag-text="${tag}"><i class="icon-cancel ml-1"></i></span></span>`)})),html=items.join(""),tagging.$display.html(html),function(tagging){tagging.$display.find("[data-tag-search-remove-tag]").on("click",(function(event){event.preventDefault();const tag=$(this).data("tag-text");let tags=uniqArraySort(trimArray(tagging.$target.val().split(",")));const index=tags.indexOf(tag);tags.splice(index,1),tagging.$target.val(removeLeadingComma(uniqArraySort(tags).join())),displayTags(tagging)}))}(tagging)}function exitTagSearch(tagging){tagging.$results.html("")}function trimArray(a){let trim_a=[];return a.forEach((function(i){trim_a.push(i.trim())})),trim_a}function uniqArraySort(a){return a.sort().filter((function(item,pos,ary){return!pos||item!=ary[pos-1]}))}function removeLeadingComma(text){return","==text[0]&&(text=text.substring(1)),text}$("[data-tag-search]").each((function(){displayTags(setTagging(this,""))})),function(){let delay=null;$(document.body).on("keyup","[data-tag-search]",(function(event){clearTimeout(delay);const searchText=event.target.value,tagging=setTagging(this,searchText);searchText.length<=2?exitTagSearch(tagging):delay=setTimeout((function(){!function(tagging){const url=window.webstop.apiHost+"/api/v1/tags/search";$.getJSON(`${url}?search=${tagging.searchText}`,(function(data){!function(data,tagging){let html,items=[];$.each(data,(function(position,record){$.each(record,(function(key,value){"name"==key&&items.push(`<button class="list-group-item list-group-item-action" data-tag-add data-tag-search-id="${tagging.searchId}" data-tag-search-value="${value}">${value}</button>`)}))})),items.push(`<button class="list-group-item list-group-item-secondary list-group-item-action" data-tag-add data-tag-add data-tag-search-id="${tagging.searchId}" data-tag-search-value="${tagging.searchText}"><em class="text-muted">Create New "</em>${tagging.searchText}<em class="text-muted">" Tag.</em></button>`),html='<div class="list-group">',html+=items.join(""),html+="</div>",tagging.$results.html(html),$(document.body).on("click","[data-tag-add]",(function(event){event.preventDefault();const tagging=setTagging($(this).data("tag-search-id"),"");let tags=trimArray(tagging.$target.val().split(","));const newTag=$(this).data("tag-search-value").trim();tags.push(newTag),tagging.$target.val(removeLeadingComma(uniqArraySort(tags).join())),displayTags(tagging),exitTagSearch(tagging)}))}(data,tagging)}))}(tagging)}),100)}))}()}()}();