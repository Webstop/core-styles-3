!function(node_crypto){"use strict";var n$2=(e=>(e.docTypeError="docTypeError",e.contextNotFound="contextNotFound",e.timerNotFound="timerNotFound",e.ctxCallOutOfScope="ctxCallOutOfScope",e.createNodeInParserFail="createNodeInParserFail",e.stackOverFlow="stackOverFlow",e.parserMatchError="parserMatchError",e.serializerMatchError="serializerMatchError",e.getAtomFromSchemaFail="getAtomFromSchemaFail",e.expectDomTypeError="expectDomTypeError",e.callCommandBeforeEditorView="callCommandBeforeEditorView",e.missingRootElement="missingRootElement",e.missingNodeInSchema="missingNodeInSchema",e.missingMarkInSchema="missingMarkInSchema",e.ctxNotBind="ctxNotBind",e.missingYjsDoc="missingYjsDoc",e))(n$2||{});class t extends Error{constructor(o,a){super(a),this.name="MilkdownError",this.code=o}}const u$2=(e,o)=>"function"==typeof o?"[Function]":o,i$1=e=>JSON.stringify(e,u$2);function l$2(e){return new t(n$2.docTypeError,`Doc type error, unsupported type: ${i$1(e)}`)}function p$2(){return new t(n$2.ctxCallOutOfScope,"Should not call a context out of the plugin.")}function g$3(...e){const o=e.reduce(((a,c)=>{if(!c)return a;const s=r=>Array.isArray(r)?r.map((m=>s(m))).join(", "):r.toJSON?i$1(r.toJSON()):r.spec?i$1(r.spec):r.toString();return`${a}, ${s(c)}`}),"Create prosemirror node from remark failed in parser");return new t(n$2.createNodeInParserFail,o)}function h$1(){return new t(n$2.stackOverFlow,"Stack over flow, cannot pop on an empty stack.")}function w$3(e){return new t(n$2.parserMatchError,`Cannot match target parser for node: ${i$1(e)}.`)}function F$2(e){return new t(n$2.serializerMatchError,`Cannot match target serializer for node: ${i$1(e)}.`)}function S$4(e){return new t(n$2.expectDomTypeError,`Expect to be a dom, but get: ${i$1(e)}.`)}function y$2(){return new t(n$2.callCommandBeforeEditorView,"You're trying to call a command before editor view initialized, make sure to get commandManager from ctx after editor view has been initialized")}function M$4(e){return new t(n$2.missingNodeInSchema,`Missing node in schema, milkdown cannot find "${e}" in schema.`)}function x$4(e){return new t(n$2.missingMarkInSchema,`Missing mark in schema, milkdown cannot find "${e}" in schema.`)}var P$2=(o,s,i)=>{if(!s.has(o))throw TypeError("Cannot "+i)},e=(o,s,i)=>(P$2(o,s,"read from private field"),i?i.call(o):s.get(o)),a=(o,s,i)=>{if(s.has(o))throw TypeError("Cannot add the same private member more than once");s instanceof WeakSet?s.add(o):s.set(o,i)},n$1=(o,s,i,r)=>(P$2(o,s,"write to private field"),r?r.call(o,i):s.set(o,i),i);let G$2=class{constructor(){this.sliceMap=new Map,this.get=s=>{const i="string"==typeof s?[...this.sliceMap.values()].find((r=>r.type.name===s)):this.sliceMap.get(s.id);if(!i){throw function(e){return new t(n$2.contextNotFound,`Context "${e}" not found, do you forget to inject it?`)}("string"==typeof s?s:s.name)}return i},this.remove=s=>{const i="string"==typeof s?[...this.sliceMap.values()].find((r=>r.type.name===s)):this.sliceMap.get(s.id);i&&this.sliceMap.delete(i.type.id)},this.has=s=>"string"==typeof s?[...this.sliceMap.values()].some((i=>i.type.name===s)):this.sliceMap.has(s.id)}};var u$1,m$1,y$1;let V$1=class{constructor(s,i,r){a(this,u$1,void 0),a(this,m$1,void 0),a(this,y$1,void 0),n$1(this,u$1,[]),n$1(this,y$1,(()=>{e(this,u$1).forEach((t=>t(e(this,m$1))))})),this.set=t=>{n$1(this,m$1,t),e(this,y$1).call(this)},this.get=()=>e(this,m$1),this.update=t=>{n$1(this,m$1,t(e(this,m$1))),e(this,y$1).call(this)},this.type=r,n$1(this,m$1,i),s.set(r.id,this)}on(s){return e(this,u$1).push(s),()=>{n$1(this,u$1,e(this,u$1).filter((i=>i!==s)))}}once(s){const i=this.on((r=>{s(r),i()}));return i}off(s){n$1(this,u$1,e(this,u$1).filter((i=>i!==s)))}offAll(){n$1(this,u$1,[])}};u$1=new WeakMap,m$1=new WeakMap,y$1=new WeakMap;let W$3=class{constructor(s,i){this.id=Symbol(`Context-${i}`),this.name=i,this._defaultValue=s,this._typeInfo=()=>{throw p$2()}}create(s,i=this._defaultValue){return new V$1(s,i,this)}};const H$3=(o,s)=>new W$3(o,s);var D$1,x$3,R$3,w$2,S$3,f,M$3,T$3,j$3;let _$1=class{constructor(s,i,r){a(this,D$1,void 0),a(this,x$3,void 0),a(this,R$3,void 0),a(this,w$2,void 0),a(this,S$3,void 0),a(this,f,void 0),a(this,M$3,void 0),a(this,T$3,void 0),a(this,j$3,void 0),n$1(this,w$2,new Set),n$1(this,S$3,new Set),n$1(this,f,new Map),n$1(this,M$3,new Map),this.read=()=>({metadata:e(this,D$1),injectedSlices:[...e(this,w$2)].map((t=>({name:"string"==typeof t?t:t.name,value:e(this,T$3).call(this,t)}))),consumedSlices:[...e(this,S$3)].map((t=>({name:"string"==typeof t?t:t.name,value:e(this,T$3).call(this,t)}))),recordedTimers:[...e(this,f)].map((([t,{duration:h}])=>({name:t.name,duration:h,status:e(this,j$3).call(this,t)}))),waitTimers:[...e(this,M$3)].map((([t,{duration:h}])=>({name:t.name,duration:h,status:e(this,j$3).call(this,t)})))}),this.onRecord=t=>{e(this,f).set(t,{start:Date.now(),duration:0})},this.onClear=t=>{e(this,f).delete(t)},this.onDone=t=>{const h=e(this,f).get(t);h&&(h.duration=Date.now()-h.start)},this.onWait=(t,h)=>{const v=Date.now();h.finally((()=>{e(this,M$3).set(t,{duration:Date.now()-v})}))},this.onInject=t=>{e(this,w$2).add(t)},this.onRemove=t=>{e(this,w$2).delete(t)},this.onUse=t=>{e(this,S$3).add(t)},n$1(this,T$3,(t=>e(this,x$3).get(t).get())),n$1(this,j$3,(t=>e(this,R$3).get(t).status)),n$1(this,x$3,s),n$1(this,R$3,i),n$1(this,D$1,r)}};var d$2,l$1,b$1,c$2;D$1=new WeakMap,x$3=new WeakMap,R$3=new WeakMap,w$2=new WeakMap,S$3=new WeakMap,f=new WeakMap,M$3=new WeakMap,T$3=new WeakMap,j$3=new WeakMap;d$2=new WeakMap,l$1=new WeakMap,b$1=new WeakMap,c$2=new WeakMap;let U$2=class L{constructor(s,i,r){a(this,d$2,void 0),a(this,l$1,void 0),a(this,b$1,void 0),a(this,c$2,void 0),this.produce=t=>t&&Object.keys(t).length?new L(e(this,d$2),e(this,l$1),{...t}):this,this.inject=(t,h)=>{var O;const v=t.create(e(this,d$2).sliceMap);return null!=h&&v.set(h),null==(O=e(this,c$2))||O.onInject(t),this},this.remove=t=>{var h;return e(this,d$2).remove(t),null==(h=e(this,c$2))||h.onRemove(t),this},this.record=t=>{var h;return t.create(e(this,l$1).store),null==(h=e(this,c$2))||h.onRecord(t),this},this.clearTimer=t=>{var h;return e(this,l$1).remove(t),null==(h=e(this,c$2))||h.onClear(t),this},this.isInjected=t=>e(this,d$2).has(t),this.isRecorded=t=>e(this,l$1).has(t),this.use=t=>{var h;return null==(h=e(this,c$2))||h.onUse(t),e(this,d$2).get(t)},this.get=t=>this.use(t).get(),this.set=(t,h)=>this.use(t).set(h),this.update=(t,h)=>this.use(t).update(h),this.timer=t=>e(this,l$1).get(t),this.done=t=>{var h;this.timer(t).done(),null==(h=e(this,c$2))||h.onDone(t)},this.wait=t=>{var v;const h=this.timer(t).start();return null==(v=e(this,c$2))||v.onWait(t,h),h},this.waitTimers=async t=>{await Promise.all(this.get(t).map((h=>this.wait(h))))},n$1(this,d$2,s),n$1(this,l$1,i),n$1(this,b$1,r),r&&n$1(this,c$2,new _$1(s,i,r))}get meta(){return e(this,b$1)}get inspector(){return e(this,c$2)}},J$2=class{constructor(){this.store=new Map,this.get=s=>{const i=this.store.get(s.id);if(!i)throw function(e){return new t(n$2.timerNotFound,`Timer "${e}" not found, do you forget to record it?`)}(s.name);return i},this.remove=s=>{this.store.delete(s.id)},this.has=s=>this.store.has(s.id)}};var C$2,g$2,E$2,p$1,I$1,k$2;let q$3=class{constructor(s,i){a(this,C$2,void 0),a(this,g$2,void 0),a(this,E$2,void 0),a(this,p$1,void 0),a(this,I$1,void 0),a(this,k$2,void 0),n$1(this,C$2,null),n$1(this,g$2,null),n$1(this,p$1,"pending"),this.start=()=>(e(this,C$2)??n$1(this,C$2,new Promise(((r,t)=>{n$1(this,g$2,(h=>{h instanceof CustomEvent&&h.detail.id===e(this,E$2)&&(n$1(this,p$1,"resolved"),e(this,I$1).call(this),h.stopImmediatePropagation(),r())})),e(this,k$2).call(this,(()=>{"pending"===e(this,p$1)&&n$1(this,p$1,"rejected"),e(this,I$1).call(this),t(new Error(`Timing ${this.type.name} timeout.`))})),n$1(this,p$1,"pending"),addEventListener(this.type.name,e(this,g$2))}))),e(this,C$2)),this.done=()=>{const r=new CustomEvent(this.type.name,{detail:{id:e(this,E$2)}});dispatchEvent(r)},n$1(this,I$1,(()=>{e(this,g$2)&&removeEventListener(this.type.name,e(this,g$2))})),n$1(this,k$2,(r=>{setTimeout((()=>{r()}),this.type.timeout)})),n$1(this,E$2,Symbol(i.name)),this.type=i,s.set(i.id,this)}get status(){return e(this,p$1)}};C$2=new WeakMap,g$2=new WeakMap,E$2=new WeakMap,p$1=new WeakMap,I$1=new WeakMap,k$2=new WeakMap;let A$3=class{constructor(s,i=3e3){this.create=r=>new q$3(r,this),this.id=Symbol(`Timer-${s}`),this.name=s,this.timeout=i}};const K$2=(o,s=3e3)=>new A$3(o,s);function OrderedMap(content){this.content=content}function findDiffStart(a,b,pos){for(let i=0;;i++){if(i==a.childCount||i==b.childCount)return a.childCount==b.childCount?null:pos;let childA=a.child(i),childB=b.child(i);if(childA!=childB){if(!childA.sameMarkup(childB))return pos;if(childA.isText&&childA.text!=childB.text){for(let j=0;childA.text[j]==childB.text[j];j++)pos++;return pos}if(childA.content.size||childB.content.size){let inner=findDiffStart(childA.content,childB.content,pos+1);if(null!=inner)return inner}pos+=childA.nodeSize}else pos+=childA.nodeSize}}function findDiffEnd(a,b,posA,posB){for(let iA=a.childCount,iB=b.childCount;;){if(0==iA||0==iB)return iA==iB?null:{a:posA,b:posB};let childA=a.child(--iA),childB=b.child(--iB),size=childA.nodeSize;if(childA!=childB){if(!childA.sameMarkup(childB))return{a:posA,b:posB};if(childA.isText&&childA.text!=childB.text){let same=0,minSize=Math.min(childA.text.length,childB.text.length);for(;same<minSize&&childA.text[childA.text.length-same-1]==childB.text[childB.text.length-same-1];)same++,posA--,posB--;return{a:posA,b:posB}}if(childA.content.size||childB.content.size){let inner=findDiffEnd(childA.content,childB.content,posA-1,posB-1);if(inner)return inner}posA-=size,posB-=size}else posA-=size,posB-=size}}OrderedMap.prototype={constructor:OrderedMap,find:function(key){for(var i=0;i<this.content.length;i+=2)if(this.content[i]===key)return i;return-1},get:function(key){var found=this.find(key);return-1==found?void 0:this.content[found+1]},update:function(key,value,newKey){var self=newKey&&newKey!=key?this.remove(newKey):this,found=self.find(key),content=self.content.slice();return-1==found?content.push(newKey||key,value):(content[found+1]=value,newKey&&(content[found]=newKey)),new OrderedMap(content)},remove:function(key){var found=this.find(key);if(-1==found)return this;var content=this.content.slice();return content.splice(found,2),new OrderedMap(content)},addToStart:function(key,value){return new OrderedMap([key,value].concat(this.remove(key).content))},addToEnd:function(key,value){var content=this.remove(key).content.slice();return content.push(key,value),new OrderedMap(content)},addBefore:function(place,key,value){var without=this.remove(key),content=without.content.slice(),found=without.find(place);return content.splice(-1==found?content.length:found,0,key,value),new OrderedMap(content)},forEach:function(f){for(var i=0;i<this.content.length;i+=2)f(this.content[i],this.content[i+1])},prepend:function(map){return(map=OrderedMap.from(map)).size?new OrderedMap(map.content.concat(this.subtract(map).content)):this},append:function(map){return(map=OrderedMap.from(map)).size?new OrderedMap(this.subtract(map).content.concat(map.content)):this},subtract:function(map){var result=this;map=OrderedMap.from(map);for(var i=0;i<map.content.length;i+=2)result=result.remove(map.content[i]);return result},toObject:function(){var result={};return this.forEach((function(key,value){result[key]=value})),result},get size(){return this.content.length>>1}},OrderedMap.from=function(value){if(value instanceof OrderedMap)return value;var content=[];if(value)for(var prop in value)content.push(prop,value[prop]);return new OrderedMap(content)};class Fragment{constructor(content,size){if(this.content=content,this.size=size||0,null==size)for(let i=0;i<content.length;i++)this.size+=content[i].nodeSize}nodesBetween(from,to,f,nodeStart=0,parent){for(let i=0,pos=0;pos<to;i++){let child=this.content[i],end=pos+child.nodeSize;if(end>from&&!1!==f(child,nodeStart+pos,parent||null,i)&&child.content.size){let start=pos+1;child.nodesBetween(Math.max(0,from-start),Math.min(child.content.size,to-start),f,nodeStart+start)}pos=end}}descendants(f){this.nodesBetween(0,this.size,f)}textBetween(from,to,blockSeparator,leafText){let text="",first=!0;return this.nodesBetween(from,to,((node,pos)=>{let nodeText=node.isText?node.text.slice(Math.max(from,pos)-pos,to-pos):node.isLeaf?leafText?"function"==typeof leafText?leafText(node):leafText:node.type.spec.leafText?node.type.spec.leafText(node):"":"";node.isBlock&&(node.isLeaf&&nodeText||node.isTextblock)&&blockSeparator&&(first?first=!1:text+=blockSeparator),text+=nodeText}),0),text}append(other){if(!other.size)return this;if(!this.size)return other;let last=this.lastChild,first=other.firstChild,content=this.content.slice(),i=0;for(last.isText&&last.sameMarkup(first)&&(content[content.length-1]=last.withText(last.text+first.text),i=1);i<other.content.length;i++)content.push(other.content[i]);return new Fragment(content,this.size+other.size)}cut(from,to=this.size){if(0==from&&to==this.size)return this;let result=[],size=0;if(to>from)for(let i=0,pos=0;pos<to;i++){let child=this.content[i],end=pos+child.nodeSize;end>from&&((pos<from||end>to)&&(child=child.isText?child.cut(Math.max(0,from-pos),Math.min(child.text.length,to-pos)):child.cut(Math.max(0,from-pos-1),Math.min(child.content.size,to-pos-1))),result.push(child),size+=child.nodeSize),pos=end}return new Fragment(result,size)}cutByIndex(from,to){return from==to?Fragment.empty:0==from&&to==this.content.length?this:new Fragment(this.content.slice(from,to))}replaceChild(index,node){let current=this.content[index];if(current==node)return this;let copy=this.content.slice(),size=this.size+node.nodeSize-current.nodeSize;return copy[index]=node,new Fragment(copy,size)}addToStart(node){return new Fragment([node].concat(this.content),this.size+node.nodeSize)}addToEnd(node){return new Fragment(this.content.concat(node),this.size+node.nodeSize)}eq(other){if(this.content.length!=other.content.length)return!1;for(let i=0;i<this.content.length;i++)if(!this.content[i].eq(other.content[i]))return!1;return!0}get firstChild(){return this.content.length?this.content[0]:null}get lastChild(){return this.content.length?this.content[this.content.length-1]:null}get childCount(){return this.content.length}child(index){let found=this.content[index];if(!found)throw new RangeError("Index "+index+" out of range for "+this);return found}maybeChild(index){return this.content[index]||null}forEach(f){for(let i=0,p=0;i<this.content.length;i++){let child=this.content[i];f(child,p,i),p+=child.nodeSize}}findDiffStart(other,pos=0){return findDiffStart(this,other,pos)}findDiffEnd(other,pos=this.size,otherPos=other.size){return findDiffEnd(this,other,pos,otherPos)}findIndex(pos,round=-1){if(0==pos)return retIndex(0,pos);if(pos==this.size)return retIndex(this.content.length,pos);if(pos>this.size||pos<0)throw new RangeError(`Position ${pos} outside of fragment (${this})`);for(let i=0,curPos=0;;i++){let end=curPos+this.child(i).nodeSize;if(end>=pos)return end==pos||round>0?retIndex(i+1,end):retIndex(i,curPos);curPos=end}}toString(){return"<"+this.toStringInner()+">"}toStringInner(){return this.content.join(", ")}toJSON(){return this.content.length?this.content.map((n=>n.toJSON())):null}static fromJSON(schema,value){if(!value)return Fragment.empty;if(!Array.isArray(value))throw new RangeError("Invalid input for Fragment.fromJSON");return new Fragment(value.map(schema.nodeFromJSON))}static fromArray(array){if(!array.length)return Fragment.empty;let joined,size=0;for(let i=0;i<array.length;i++){let node=array[i];size+=node.nodeSize,i&&node.isText&&array[i-1].sameMarkup(node)?(joined||(joined=array.slice(0,i)),joined[joined.length-1]=node.withText(joined[joined.length-1].text+node.text)):joined&&joined.push(node)}return new Fragment(joined||array,size)}static from(nodes){if(!nodes)return Fragment.empty;if(nodes instanceof Fragment)return nodes;if(Array.isArray(nodes))return this.fromArray(nodes);if(nodes.attrs)return new Fragment([nodes],nodes.nodeSize);throw new RangeError("Can not convert "+nodes+" to a Fragment"+(nodes.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))}}Fragment.empty=new Fragment([],0);const found={index:0,offset:0};function retIndex(index,offset){return found.index=index,found.offset=offset,found}function compareDeep(a,b){if(a===b)return!0;if(!a||"object"!=typeof a||!b||"object"!=typeof b)return!1;let array=Array.isArray(a);if(Array.isArray(b)!=array)return!1;if(array){if(a.length!=b.length)return!1;for(let i=0;i<a.length;i++)if(!compareDeep(a[i],b[i]))return!1}else{for(let p in a)if(!(p in b)||!compareDeep(a[p],b[p]))return!1;for(let p in b)if(!(p in a))return!1}return!0}class Mark{constructor(type,attrs){this.type=type,this.attrs=attrs}addToSet(set){let copy,placed=!1;for(let i=0;i<set.length;i++){let other=set[i];if(this.eq(other))return set;if(this.type.excludes(other.type))copy||(copy=set.slice(0,i));else{if(other.type.excludes(this.type))return set;!placed&&other.type.rank>this.type.rank&&(copy||(copy=set.slice(0,i)),copy.push(this),placed=!0),copy&&copy.push(other)}}return copy||(copy=set.slice()),placed||copy.push(this),copy}removeFromSet(set){for(let i=0;i<set.length;i++)if(this.eq(set[i]))return set.slice(0,i).concat(set.slice(i+1));return set}isInSet(set){for(let i=0;i<set.length;i++)if(this.eq(set[i]))return!0;return!1}eq(other){return this==other||this.type==other.type&&compareDeep(this.attrs,other.attrs)}toJSON(){let obj={type:this.type.name};for(let _ in this.attrs){obj.attrs=this.attrs;break}return obj}static fromJSON(schema,json){if(!json)throw new RangeError("Invalid input for Mark.fromJSON");let type=schema.marks[json.type];if(!type)throw new RangeError(`There is no mark type ${json.type} in this schema`);return type.create(json.attrs)}static sameSet(a,b){if(a==b)return!0;if(a.length!=b.length)return!1;for(let i=0;i<a.length;i++)if(!a[i].eq(b[i]))return!1;return!0}static setFrom(marks){if(!marks||Array.isArray(marks)&&0==marks.length)return Mark.none;if(marks instanceof Mark)return[marks];let copy=marks.slice();return copy.sort(((a,b)=>a.type.rank-b.type.rank)),copy}}Mark.none=[];class ReplaceError extends Error{}class Slice{constructor(content,openStart,openEnd){this.content=content,this.openStart=openStart,this.openEnd=openEnd}get size(){return this.content.size-this.openStart-this.openEnd}insertAt(pos,fragment){let content=insertInto(this.content,pos+this.openStart,fragment);return content&&new Slice(content,this.openStart,this.openEnd)}removeBetween(from,to){return new Slice(removeRange(this.content,from+this.openStart,to+this.openStart),this.openStart,this.openEnd)}eq(other){return this.content.eq(other.content)&&this.openStart==other.openStart&&this.openEnd==other.openEnd}toString(){return this.content+"("+this.openStart+","+this.openEnd+")"}toJSON(){if(!this.content.size)return null;let json={content:this.content.toJSON()};return this.openStart>0&&(json.openStart=this.openStart),this.openEnd>0&&(json.openEnd=this.openEnd),json}static fromJSON(schema,json){if(!json)return Slice.empty;let openStart=json.openStart||0,openEnd=json.openEnd||0;if("number"!=typeof openStart||"number"!=typeof openEnd)throw new RangeError("Invalid input for Slice.fromJSON");return new Slice(Fragment.fromJSON(schema,json.content),openStart,openEnd)}static maxOpen(fragment,openIsolating=!0){let openStart=0,openEnd=0;for(let n=fragment.firstChild;n&&!n.isLeaf&&(openIsolating||!n.type.spec.isolating);n=n.firstChild)openStart++;for(let n=fragment.lastChild;n&&!n.isLeaf&&(openIsolating||!n.type.spec.isolating);n=n.lastChild)openEnd++;return new Slice(fragment,openStart,openEnd)}}function removeRange(content,from,to){let{index:index,offset:offset}=content.findIndex(from),child=content.maybeChild(index),{index:indexTo,offset:offsetTo}=content.findIndex(to);if(offset==from||child.isText){if(offsetTo!=to&&!content.child(indexTo).isText)throw new RangeError("Removing non-flat range");return content.cut(0,from).append(content.cut(to))}if(index!=indexTo)throw new RangeError("Removing non-flat range");return content.replaceChild(index,child.copy(removeRange(child.content,from-offset-1,to-offset-1)))}function insertInto(content,dist,insert,parent){let{index:index,offset:offset}=content.findIndex(dist),child=content.maybeChild(index);if(offset==dist||child.isText)return parent&&!parent.canReplace(index,index,insert)?null:content.cut(0,dist).append(insert).append(content.cut(dist));let inner=insertInto(child.content,dist-offset-1,insert);return inner&&content.replaceChild(index,child.copy(inner))}function replace($from,$to,slice){if(slice.openStart>$from.depth)throw new ReplaceError("Inserted content deeper than insertion position");if($from.depth-slice.openStart!=$to.depth-slice.openEnd)throw new ReplaceError("Inconsistent open depths");return replaceOuter($from,$to,slice,0)}function replaceOuter($from,$to,slice,depth){let index=$from.index(depth),node=$from.node(depth);if(index==$to.index(depth)&&depth<$from.depth-slice.openStart){let inner=replaceOuter($from,$to,slice,depth+1);return node.copy(node.content.replaceChild(index,inner))}if(slice.content.size){if(slice.openStart||slice.openEnd||$from.depth!=depth||$to.depth!=depth){let{start:start,end:end}=function(slice,$along){let extra=$along.depth-slice.openStart,node=$along.node(extra).copy(slice.content);for(let i=extra-1;i>=0;i--)node=$along.node(i).copy(Fragment.from(node));return{start:node.resolveNoCache(slice.openStart+extra),end:node.resolveNoCache(node.content.size-slice.openEnd-extra)}}(slice,$from);return close(node,replaceThreeWay($from,start,end,$to,depth))}{let parent=$from.parent,content=parent.content;return close(parent,content.cut(0,$from.parentOffset).append(slice.content).append(content.cut($to.parentOffset)))}}return close(node,replaceTwoWay($from,$to,depth))}function checkJoin(main,sub){if(!sub.type.compatibleContent(main.type))throw new ReplaceError("Cannot join "+sub.type.name+" onto "+main.type.name)}function joinable$1($before,$after,depth){let node=$before.node(depth);return checkJoin(node,$after.node(depth)),node}function addNode(child,target){let last=target.length-1;last>=0&&child.isText&&child.sameMarkup(target[last])?target[last]=child.withText(target[last].text+child.text):target.push(child)}function addRange($start,$end,depth,target){let node=($end||$start).node(depth),startIndex=0,endIndex=$end?$end.index(depth):node.childCount;$start&&(startIndex=$start.index(depth),$start.depth>depth?startIndex++:$start.textOffset&&(addNode($start.nodeAfter,target),startIndex++));for(let i=startIndex;i<endIndex;i++)addNode(node.child(i),target);$end&&$end.depth==depth&&$end.textOffset&&addNode($end.nodeBefore,target)}function close(node,content){return node.type.checkContent(content),node.copy(content)}function replaceThreeWay($from,$start,$end,$to,depth){let openStart=$from.depth>depth&&joinable$1($from,$start,depth+1),openEnd=$to.depth>depth&&joinable$1($end,$to,depth+1),content=[];return addRange(null,$from,depth,content),openStart&&openEnd&&$start.index(depth)==$end.index(depth)?(checkJoin(openStart,openEnd),addNode(close(openStart,replaceThreeWay($from,$start,$end,$to,depth+1)),content)):(openStart&&addNode(close(openStart,replaceTwoWay($from,$start,depth+1)),content),addRange($start,$end,depth,content),openEnd&&addNode(close(openEnd,replaceTwoWay($end,$to,depth+1)),content)),addRange($to,null,depth,content),new Fragment(content)}function replaceTwoWay($from,$to,depth){let content=[];if(addRange(null,$from,depth,content),$from.depth>depth){addNode(close(joinable$1($from,$to,depth+1),replaceTwoWay($from,$to,depth+1)),content)}return addRange($to,null,depth,content),new Fragment(content)}Slice.empty=new Slice(Fragment.empty,0,0);class ResolvedPos{constructor(pos,path,parentOffset){this.pos=pos,this.path=path,this.parentOffset=parentOffset,this.depth=path.length/3-1}resolveDepth(val){return null==val?this.depth:val<0?this.depth+val:val}get parent(){return this.node(this.depth)}get doc(){return this.node(0)}node(depth){return this.path[3*this.resolveDepth(depth)]}index(depth){return this.path[3*this.resolveDepth(depth)+1]}indexAfter(depth){return depth=this.resolveDepth(depth),this.index(depth)+(depth!=this.depth||this.textOffset?1:0)}start(depth){return 0==(depth=this.resolveDepth(depth))?0:this.path[3*depth-1]+1}end(depth){return depth=this.resolveDepth(depth),this.start(depth)+this.node(depth).content.size}before(depth){if(!(depth=this.resolveDepth(depth)))throw new RangeError("There is no position before the top-level node");return depth==this.depth+1?this.pos:this.path[3*depth-1]}after(depth){if(!(depth=this.resolveDepth(depth)))throw new RangeError("There is no position after the top-level node");return depth==this.depth+1?this.pos:this.path[3*depth-1]+this.path[3*depth].nodeSize}get textOffset(){return this.pos-this.path[this.path.length-1]}get nodeAfter(){let parent=this.parent,index=this.index(this.depth);if(index==parent.childCount)return null;let dOff=this.pos-this.path[this.path.length-1],child=parent.child(index);return dOff?parent.child(index).cut(dOff):child}get nodeBefore(){let index=this.index(this.depth),dOff=this.pos-this.path[this.path.length-1];return dOff?this.parent.child(index).cut(0,dOff):0==index?null:this.parent.child(index-1)}posAtIndex(index,depth){depth=this.resolveDepth(depth);let node=this.path[3*depth],pos=0==depth?0:this.path[3*depth-1]+1;for(let i=0;i<index;i++)pos+=node.child(i).nodeSize;return pos}marks(){let parent=this.parent,index=this.index();if(0==parent.content.size)return Mark.none;if(this.textOffset)return parent.child(index).marks;let main=parent.maybeChild(index-1),other=parent.maybeChild(index);if(!main){let tmp=main;main=other,other=tmp}let marks=main.marks;for(var i=0;i<marks.length;i++)!1!==marks[i].type.spec.inclusive||other&&marks[i].isInSet(other.marks)||(marks=marks[i--].removeFromSet(marks));return marks}marksAcross($end){let after=this.parent.maybeChild(this.index());if(!after||!after.isInline)return null;let marks=after.marks,next=$end.parent.maybeChild($end.index());for(var i=0;i<marks.length;i++)!1!==marks[i].type.spec.inclusive||next&&marks[i].isInSet(next.marks)||(marks=marks[i--].removeFromSet(marks));return marks}sharedDepth(pos){for(let depth=this.depth;depth>0;depth--)if(this.start(depth)<=pos&&this.end(depth)>=pos)return depth;return 0}blockRange(other=this,pred){if(other.pos<this.pos)return other.blockRange(this);for(let d=this.depth-(this.parent.inlineContent||this.pos==other.pos?1:0);d>=0;d--)if(other.pos<=this.end(d)&&(!pred||pred(this.node(d))))return new NodeRange(this,other,d);return null}sameParent(other){return this.pos-this.parentOffset==other.pos-other.parentOffset}max(other){return other.pos>this.pos?other:this}min(other){return other.pos<this.pos?other:this}toString(){let str="";for(let i=1;i<=this.depth;i++)str+=(str?"/":"")+this.node(i).type.name+"_"+this.index(i-1);return str+":"+this.parentOffset}static resolve(doc,pos){if(!(pos>=0&&pos<=doc.content.size))throw new RangeError("Position "+pos+" out of range");let path=[],start=0,parentOffset=pos;for(let node=doc;;){let{index:index,offset:offset}=node.content.findIndex(parentOffset),rem=parentOffset-offset;if(path.push(node,index,start+offset),!rem)break;if(node=node.child(index),node.isText)break;parentOffset=rem-1,start+=offset+1}return new ResolvedPos(pos,path,parentOffset)}static resolveCached(doc,pos){for(let i=0;i<resolveCache.length;i++){let cached=resolveCache[i];if(cached.pos==pos&&cached.doc==doc)return cached}let result=resolveCache[resolveCachePos]=ResolvedPos.resolve(doc,pos);return resolveCachePos=(resolveCachePos+1)%resolveCacheSize,result}}let resolveCache=[],resolveCachePos=0,resolveCacheSize=12;class NodeRange{constructor($from,$to,depth){this.$from=$from,this.$to=$to,this.depth=depth}get start(){return this.$from.before(this.depth+1)}get end(){return this.$to.after(this.depth+1)}get parent(){return this.$from.node(this.depth)}get startIndex(){return this.$from.index(this.depth)}get endIndex(){return this.$to.indexAfter(this.depth)}}const emptyAttrs=Object.create(null);class Node{constructor(type,attrs,content,marks=Mark.none){this.type=type,this.attrs=attrs,this.marks=marks,this.content=content||Fragment.empty}get nodeSize(){return this.isLeaf?1:2+this.content.size}get childCount(){return this.content.childCount}child(index){return this.content.child(index)}maybeChild(index){return this.content.maybeChild(index)}forEach(f){this.content.forEach(f)}nodesBetween(from,to,f,startPos=0){this.content.nodesBetween(from,to,f,startPos,this)}descendants(f){this.nodesBetween(0,this.content.size,f)}get textContent(){return this.isLeaf&&this.type.spec.leafText?this.type.spec.leafText(this):this.textBetween(0,this.content.size,"")}textBetween(from,to,blockSeparator,leafText){return this.content.textBetween(from,to,blockSeparator,leafText)}get firstChild(){return this.content.firstChild}get lastChild(){return this.content.lastChild}eq(other){return this==other||this.sameMarkup(other)&&this.content.eq(other.content)}sameMarkup(other){return this.hasMarkup(other.type,other.attrs,other.marks)}hasMarkup(type,attrs,marks){return this.type==type&&compareDeep(this.attrs,attrs||type.defaultAttrs||emptyAttrs)&&Mark.sameSet(this.marks,marks||Mark.none)}copy(content=null){return content==this.content?this:new Node(this.type,this.attrs,content,this.marks)}mark(marks){return marks==this.marks?this:new Node(this.type,this.attrs,this.content,marks)}cut(from,to=this.content.size){return 0==from&&to==this.content.size?this:this.copy(this.content.cut(from,to))}slice(from,to=this.content.size,includeParents=!1){if(from==to)return Slice.empty;let $from=this.resolve(from),$to=this.resolve(to),depth=includeParents?0:$from.sharedDepth(to),start=$from.start(depth),content=$from.node(depth).content.cut($from.pos-start,$to.pos-start);return new Slice(content,$from.depth-depth,$to.depth-depth)}replace(from,to,slice){return replace(this.resolve(from),this.resolve(to),slice)}nodeAt(pos){for(let node=this;;){let{index:index,offset:offset}=node.content.findIndex(pos);if(node=node.maybeChild(index),!node)return null;if(offset==pos||node.isText)return node;pos-=offset+1}}childAfter(pos){let{index:index,offset:offset}=this.content.findIndex(pos);return{node:this.content.maybeChild(index),index:index,offset:offset}}childBefore(pos){if(0==pos)return{node:null,index:0,offset:0};let{index:index,offset:offset}=this.content.findIndex(pos);if(offset<pos)return{node:this.content.child(index),index:index,offset:offset};let node=this.content.child(index-1);return{node:node,index:index-1,offset:offset-node.nodeSize}}resolve(pos){return ResolvedPos.resolveCached(this,pos)}resolveNoCache(pos){return ResolvedPos.resolve(this,pos)}rangeHasMark(from,to,type){let found=!1;return to>from&&this.nodesBetween(from,to,(node=>(type.isInSet(node.marks)&&(found=!0),!found))),found}get isBlock(){return this.type.isBlock}get isTextblock(){return this.type.isTextblock}get inlineContent(){return this.type.inlineContent}get isInline(){return this.type.isInline}get isText(){return this.type.isText}get isLeaf(){return this.type.isLeaf}get isAtom(){return this.type.isAtom}toString(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);let name=this.type.name;return this.content.size&&(name+="("+this.content.toStringInner()+")"),wrapMarks(this.marks,name)}contentMatchAt(index){let match=this.type.contentMatch.matchFragment(this.content,0,index);if(!match)throw new Error("Called contentMatchAt on a node with invalid content");return match}canReplace(from,to,replacement=Fragment.empty,start=0,end=replacement.childCount){let one=this.contentMatchAt(from).matchFragment(replacement,start,end),two=one&&one.matchFragment(this.content,to);if(!two||!two.validEnd)return!1;for(let i=start;i<end;i++)if(!this.type.allowsMarks(replacement.child(i).marks))return!1;return!0}canReplaceWith(from,to,type,marks){if(marks&&!this.type.allowsMarks(marks))return!1;let start=this.contentMatchAt(from).matchType(type),end=start&&start.matchFragment(this.content,to);return!!end&&end.validEnd}canAppend(other){return other.content.size?this.canReplace(this.childCount,this.childCount,other.content):this.type.compatibleContent(other.type)}check(){this.type.checkContent(this.content);let copy=Mark.none;for(let i=0;i<this.marks.length;i++)copy=this.marks[i].addToSet(copy);if(!Mark.sameSet(copy,this.marks))throw new RangeError(`Invalid collection of marks for node ${this.type.name}: ${this.marks.map((m=>m.type.name))}`);this.content.forEach((node=>node.check()))}toJSON(){let obj={type:this.type.name};for(let _ in this.attrs){obj.attrs=this.attrs;break}return this.content.size&&(obj.content=this.content.toJSON()),this.marks.length&&(obj.marks=this.marks.map((n=>n.toJSON()))),obj}static fromJSON(schema,json){if(!json)throw new RangeError("Invalid input for Node.fromJSON");let marks=null;if(json.marks){if(!Array.isArray(json.marks))throw new RangeError("Invalid mark data for Node.fromJSON");marks=json.marks.map(schema.markFromJSON)}if("text"==json.type){if("string"!=typeof json.text)throw new RangeError("Invalid text node in JSON");return schema.text(json.text,marks)}let content=Fragment.fromJSON(schema,json.content);return schema.nodeType(json.type).create(json.attrs,content,marks)}}Node.prototype.text=void 0;class TextNode extends Node{constructor(type,attrs,content,marks){if(super(type,attrs,null,marks),!content)throw new RangeError("Empty text nodes are not allowed");this.text=content}toString(){return this.type.spec.toDebugString?this.type.spec.toDebugString(this):wrapMarks(this.marks,JSON.stringify(this.text))}get textContent(){return this.text}textBetween(from,to){return this.text.slice(from,to)}get nodeSize(){return this.text.length}mark(marks){return marks==this.marks?this:new TextNode(this.type,this.attrs,this.text,marks)}withText(text){return text==this.text?this:new TextNode(this.type,this.attrs,text,this.marks)}cut(from=0,to=this.text.length){return 0==from&&to==this.text.length?this:this.withText(this.text.slice(from,to))}eq(other){return this.sameMarkup(other)&&this.text==other.text}toJSON(){let base=super.toJSON();return base.text=this.text,base}}function wrapMarks(marks,str){for(let i=marks.length-1;i>=0;i--)str=marks[i].type.name+"("+str+")";return str}class ContentMatch{constructor(validEnd){this.validEnd=validEnd,this.next=[],this.wrapCache=[]}static parse(string,nodeTypes){let stream=new TokenStream(string,nodeTypes);if(null==stream.next)return ContentMatch.empty;let expr=parseExpr(stream);stream.next&&stream.err("Unexpected trailing text");let match=function(nfa){let labeled=Object.create(null);return explore(nullFrom(nfa,0));function explore(states){let out=[];states.forEach((node=>{nfa[node].forEach((({term:term,to:to})=>{if(!term)return;let set;for(let i=0;i<out.length;i++)out[i][0]==term&&(set=out[i][1]);nullFrom(nfa,to).forEach((node=>{set||out.push([term,set=[]]),-1==set.indexOf(node)&&set.push(node)}))}))}));let state=labeled[states.join(",")]=new ContentMatch(states.indexOf(nfa.length-1)>-1);for(let i=0;i<out.length;i++){let states=out[i][1].sort(cmp);state.next.push({type:out[i][0],next:labeled[states.join(",")]||explore(states)})}return state}}(function(expr){let nfa=[[]];return connect(compile(expr,0),node()),nfa;function node(){return nfa.push([])-1}function edge(from,to,term){let edge={term:term,to:to};return nfa[from].push(edge),edge}function connect(edges,to){edges.forEach((edge=>edge.to=to))}function compile(expr,from){if("choice"==expr.type)return expr.exprs.reduce(((out,expr)=>out.concat(compile(expr,from))),[]);if("seq"!=expr.type){if("star"==expr.type){let loop=node();return edge(from,loop),connect(compile(expr.expr,loop),loop),[edge(loop)]}if("plus"==expr.type){let loop=node();return connect(compile(expr.expr,from),loop),connect(compile(expr.expr,loop),loop),[edge(loop)]}if("opt"==expr.type)return[edge(from)].concat(compile(expr.expr,from));if("range"==expr.type){let cur=from;for(let i=0;i<expr.min;i++){let next=node();connect(compile(expr.expr,cur),next),cur=next}if(-1==expr.max)connect(compile(expr.expr,cur),cur);else for(let i=expr.min;i<expr.max;i++){let next=node();edge(cur,next),connect(compile(expr.expr,cur),next),cur=next}return[edge(cur)]}if("name"==expr.type)return[edge(from,void 0,expr.value)];throw new Error("Unknown expr type")}for(let i=0;;i++){let next=compile(expr.exprs[i],from);if(i==expr.exprs.length-1)return next;connect(next,from=node())}}}(expr));return function(match,stream){for(let i=0,work=[match];i<work.length;i++){let state=work[i],dead=!state.validEnd,nodes=[];for(let j=0;j<state.next.length;j++){let{type:type,next:next}=state.next[j];nodes.push(type.name),!dead||type.isText||type.hasRequiredAttrs()||(dead=!1),-1==work.indexOf(next)&&work.push(next)}dead&&stream.err("Only non-generatable nodes ("+nodes.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}(match,stream),match}matchType(type){for(let i=0;i<this.next.length;i++)if(this.next[i].type==type)return this.next[i].next;return null}matchFragment(frag,start=0,end=frag.childCount){let cur=this;for(let i=start;cur&&i<end;i++)cur=cur.matchType(frag.child(i).type);return cur}get inlineContent(){return 0!=this.next.length&&this.next[0].type.isInline}get defaultType(){for(let i=0;i<this.next.length;i++){let{type:type}=this.next[i];if(!type.isText&&!type.hasRequiredAttrs())return type}return null}compatible(other){for(let i=0;i<this.next.length;i++)for(let j=0;j<other.next.length;j++)if(this.next[i].type==other.next[j].type)return!0;return!1}fillBefore(after,toEnd=!1,startIndex=0){let seen=[this];return function search(match,types){let finished=match.matchFragment(after,startIndex);if(finished&&(!toEnd||finished.validEnd))return Fragment.from(types.map((tp=>tp.createAndFill())));for(let i=0;i<match.next.length;i++){let{type:type,next:next}=match.next[i];if(!type.isText&&!type.hasRequiredAttrs()&&-1==seen.indexOf(next)){seen.push(next);let found=search(next,types.concat(type));if(found)return found}}return null}(this,[])}findWrapping(target){for(let i=0;i<this.wrapCache.length;i+=2)if(this.wrapCache[i]==target)return this.wrapCache[i+1];let computed=this.computeWrapping(target);return this.wrapCache.push(target,computed),computed}computeWrapping(target){let seen=Object.create(null),active=[{match:this,type:null,via:null}];for(;active.length;){let current=active.shift(),match=current.match;if(match.matchType(target)){let result=[];for(let obj=current;obj.type;obj=obj.via)result.push(obj.type);return result.reverse()}for(let i=0;i<match.next.length;i++){let{type:type,next:next}=match.next[i];type.isLeaf||type.hasRequiredAttrs()||type.name in seen||current.type&&!next.validEnd||(active.push({match:type.contentMatch,type:type,via:current}),seen[type.name]=!0)}}return null}get edgeCount(){return this.next.length}edge(n){if(n>=this.next.length)throw new RangeError(`There's no ${n}th edge in this content match`);return this.next[n]}toString(){let seen=[];return function scan(m){seen.push(m);for(let i=0;i<m.next.length;i++)-1==seen.indexOf(m.next[i].next)&&scan(m.next[i].next)}(this),seen.map(((m,i)=>{let out=i+(m.validEnd?"*":" ")+" ";for(let i=0;i<m.next.length;i++)out+=(i?", ":"")+m.next[i].type.name+"->"+seen.indexOf(m.next[i].next);return out})).join("\n")}}ContentMatch.empty=new ContentMatch(!0);class TokenStream{constructor(string,nodeTypes){this.string=string,this.nodeTypes=nodeTypes,this.inline=null,this.pos=0,this.tokens=string.split(/\s*(?=\b|\W|$)/),""==this.tokens[this.tokens.length-1]&&this.tokens.pop(),""==this.tokens[0]&&this.tokens.shift()}get next(){return this.tokens[this.pos]}eat(tok){return this.next==tok&&(this.pos++||!0)}err(str){throw new SyntaxError(str+" (in content expression '"+this.string+"')")}}function parseExpr(stream){let exprs=[];do{exprs.push(parseExprSeq(stream))}while(stream.eat("|"));return 1==exprs.length?exprs[0]:{type:"choice",exprs:exprs}}function parseExprSeq(stream){let exprs=[];do{exprs.push(parseExprSubscript(stream))}while(stream.next&&")"!=stream.next&&"|"!=stream.next);return 1==exprs.length?exprs[0]:{type:"seq",exprs:exprs}}function parseExprSubscript(stream){let expr=function(stream){if(stream.eat("(")){let expr=parseExpr(stream);return stream.eat(")")||stream.err("Missing closing paren"),expr}if(!/\W/.test(stream.next)){let exprs=function(stream,name){let types=stream.nodeTypes,type=types[name];if(type)return[type];let result=[];for(let typeName in types){let type=types[typeName];type.groups.indexOf(name)>-1&&result.push(type)}0==result.length&&stream.err("No node type or group '"+name+"' found");return result}(stream,stream.next).map((type=>(null==stream.inline?stream.inline=type.isInline:stream.inline!=type.isInline&&stream.err("Mixing inline and block content"),{type:"name",value:type})));return stream.pos++,1==exprs.length?exprs[0]:{type:"choice",exprs:exprs}}stream.err("Unexpected token '"+stream.next+"'")}(stream);for(;;)if(stream.eat("+"))expr={type:"plus",expr:expr};else if(stream.eat("*"))expr={type:"star",expr:expr};else if(stream.eat("?"))expr={type:"opt",expr:expr};else{if(!stream.eat("{"))break;expr=parseExprRange(stream,expr)}return expr}function parseNum(stream){/\D/.test(stream.next)&&stream.err("Expected number, got '"+stream.next+"'");let result=Number(stream.next);return stream.pos++,result}function parseExprRange(stream,expr){let min=parseNum(stream),max=min;return stream.eat(",")&&(max="}"!=stream.next?parseNum(stream):-1),stream.eat("}")||stream.err("Unclosed braced range"),{type:"range",min:min,max:max,expr:expr}}function cmp(a,b){return b-a}function nullFrom(nfa,node){let result=[];return function scan(node){let edges=nfa[node];if(1==edges.length&&!edges[0].term)return scan(edges[0].to);result.push(node);for(let i=0;i<edges.length;i++){let{term:term,to:to}=edges[i];term||-1!=result.indexOf(to)||scan(to)}}(node),result.sort(cmp)}function defaultAttrs(attrs){let defaults=Object.create(null);for(let attrName in attrs){let attr=attrs[attrName];if(!attr.hasDefault)return null;defaults[attrName]=attr.default}return defaults}function computeAttrs(attrs,value){let built=Object.create(null);for(let name in attrs){let given=value&&value[name];if(void 0===given){let attr=attrs[name];if(!attr.hasDefault)throw new RangeError("No value supplied for attribute "+name);given=attr.default}built[name]=given}return built}function initAttrs(attrs){let result=Object.create(null);if(attrs)for(let name in attrs)result[name]=new Attribute(attrs[name]);return result}let NodeType$1=class NodeType{constructor(name,schema,spec){this.name=name,this.schema=schema,this.spec=spec,this.markSet=null,this.groups=spec.group?spec.group.split(" "):[],this.attrs=initAttrs(spec.attrs),this.defaultAttrs=defaultAttrs(this.attrs),this.contentMatch=null,this.inlineContent=null,this.isBlock=!(spec.inline||"text"==name),this.isText="text"==name}get isInline(){return!this.isBlock}get isTextblock(){return this.isBlock&&this.inlineContent}get isLeaf(){return this.contentMatch==ContentMatch.empty}get isAtom(){return this.isLeaf||!!this.spec.atom}get whitespace(){return this.spec.whitespace||(this.spec.code?"pre":"normal")}hasRequiredAttrs(){for(let n in this.attrs)if(this.attrs[n].isRequired)return!0;return!1}compatibleContent(other){return this==other||this.contentMatch.compatible(other.contentMatch)}computeAttrs(attrs){return!attrs&&this.defaultAttrs?this.defaultAttrs:computeAttrs(this.attrs,attrs)}create(attrs=null,content,marks){if(this.isText)throw new Error("NodeType.create can't construct text nodes");return new Node(this,this.computeAttrs(attrs),Fragment.from(content),Mark.setFrom(marks))}createChecked(attrs=null,content,marks){return content=Fragment.from(content),this.checkContent(content),new Node(this,this.computeAttrs(attrs),content,Mark.setFrom(marks))}createAndFill(attrs=null,content,marks){if(attrs=this.computeAttrs(attrs),(content=Fragment.from(content)).size){let before=this.contentMatch.fillBefore(content);if(!before)return null;content=before.append(content)}let matched=this.contentMatch.matchFragment(content),after=matched&&matched.fillBefore(Fragment.empty,!0);return after?new Node(this,attrs,content.append(after),Mark.setFrom(marks)):null}validContent(content){let result=this.contentMatch.matchFragment(content);if(!result||!result.validEnd)return!1;for(let i=0;i<content.childCount;i++)if(!this.allowsMarks(content.child(i).marks))return!1;return!0}checkContent(content){if(!this.validContent(content))throw new RangeError(`Invalid content for node ${this.name}: ${content.toString().slice(0,50)}`)}allowsMarkType(markType){return null==this.markSet||this.markSet.indexOf(markType)>-1}allowsMarks(marks){if(null==this.markSet)return!0;for(let i=0;i<marks.length;i++)if(!this.allowsMarkType(marks[i].type))return!1;return!0}allowedMarks(marks){if(null==this.markSet)return marks;let copy;for(let i=0;i<marks.length;i++)this.allowsMarkType(marks[i].type)?copy&&copy.push(marks[i]):copy||(copy=marks.slice(0,i));return copy?copy.length?copy:Mark.none:marks}static compile(nodes,schema){let result=Object.create(null);nodes.forEach(((name,spec)=>result[name]=new NodeType(name,schema,spec)));let topType=schema.spec.topNode||"doc";if(!result[topType])throw new RangeError("Schema is missing its top node type ('"+topType+"')");if(!result.text)throw new RangeError("Every schema needs a 'text' type");for(let _ in result.text.attrs)throw new RangeError("The text node type should not have attributes");return result}};class Attribute{constructor(options){this.hasDefault=Object.prototype.hasOwnProperty.call(options,"default"),this.default=options.default}get isRequired(){return!this.hasDefault}}class MarkType{constructor(name,rank,schema,spec){this.name=name,this.rank=rank,this.schema=schema,this.spec=spec,this.attrs=initAttrs(spec.attrs),this.excluded=null;let defaults=defaultAttrs(this.attrs);this.instance=defaults?new Mark(this,defaults):null}create(attrs=null){return!attrs&&this.instance?this.instance:new Mark(this,computeAttrs(this.attrs,attrs))}static compile(marks,schema){let result=Object.create(null),rank=0;return marks.forEach(((name,spec)=>result[name]=new MarkType(name,rank++,schema,spec))),result}removeFromSet(set){for(var i=0;i<set.length;i++)set[i].type==this&&(set=set.slice(0,i).concat(set.slice(i+1)),i--);return set}isInSet(set){for(let i=0;i<set.length;i++)if(set[i].type==this)return set[i]}excludes(other){return this.excluded.indexOf(other)>-1}}class Schema{constructor(spec){this.cached=Object.create(null);let instanceSpec=this.spec={};for(let prop in spec)instanceSpec[prop]=spec[prop];instanceSpec.nodes=OrderedMap.from(spec.nodes),instanceSpec.marks=OrderedMap.from(spec.marks||{}),this.nodes=NodeType$1.compile(this.spec.nodes,this),this.marks=MarkType.compile(this.spec.marks,this);let contentExprCache=Object.create(null);for(let prop in this.nodes){if(prop in this.marks)throw new RangeError(prop+" can not be both a node and a mark");let type=this.nodes[prop],contentExpr=type.spec.content||"",markExpr=type.spec.marks;type.contentMatch=contentExprCache[contentExpr]||(contentExprCache[contentExpr]=ContentMatch.parse(contentExpr,this.nodes)),type.inlineContent=type.contentMatch.inlineContent,type.markSet="_"==markExpr?null:markExpr?gatherMarks(this,markExpr.split(" ")):""!=markExpr&&type.inlineContent?null:[]}for(let prop in this.marks){let type=this.marks[prop],excl=type.spec.excludes;type.excluded=null==excl?[type]:""==excl?[]:gatherMarks(this,excl.split(" "))}this.nodeFromJSON=this.nodeFromJSON.bind(this),this.markFromJSON=this.markFromJSON.bind(this),this.topNodeType=this.nodes[this.spec.topNode||"doc"],this.cached.wrappings=Object.create(null)}node(type,attrs=null,content,marks){if("string"==typeof type)type=this.nodeType(type);else{if(!(type instanceof NodeType$1))throw new RangeError("Invalid node type: "+type);if(type.schema!=this)throw new RangeError("Node type from different schema used ("+type.name+")")}return type.createChecked(attrs,content,marks)}text(text,marks){let type=this.nodes.text;return new TextNode(type,type.defaultAttrs,text,Mark.setFrom(marks))}mark(type,attrs){return"string"==typeof type&&(type=this.marks[type]),type.create(attrs)}nodeFromJSON(json){return Node.fromJSON(this,json)}markFromJSON(json){return Mark.fromJSON(this,json)}nodeType(name){let found=this.nodes[name];if(!found)throw new RangeError("Unknown node type: "+name);return found}}function gatherMarks(schema,marks){let found=[];for(let i=0;i<marks.length;i++){let name=marks[i],mark=schema.marks[name],ok=mark;if(mark)found.push(mark);else for(let prop in schema.marks){let mark=schema.marks[prop];("_"==name||mark.spec.group&&mark.spec.group.split(" ").indexOf(name)>-1)&&found.push(ok=mark)}if(!ok)throw new SyntaxError("Unknown mark type: '"+marks[i]+"'")}return found}class DOMParser{constructor(schema,rules){this.schema=schema,this.rules=rules,this.tags=[],this.styles=[],rules.forEach((rule=>{rule.tag?this.tags.push(rule):rule.style&&this.styles.push(rule)})),this.normalizeLists=!this.tags.some((r=>{if(!/^(ul|ol)\b/.test(r.tag)||!r.node)return!1;let node=schema.nodes[r.node];return node.contentMatch.matchType(node)}))}parse(dom,options={}){let context=new ParseContext(this,options,!1);return context.addAll(dom,options.from,options.to),context.finish()}parseSlice(dom,options={}){let context=new ParseContext(this,options,!0);return context.addAll(dom,options.from,options.to),Slice.maxOpen(context.finish())}matchTag(dom,context,after){for(let i=after?this.tags.indexOf(after)+1:0;i<this.tags.length;i++){let rule=this.tags[i];if(matches(dom,rule.tag)&&(void 0===rule.namespace||dom.namespaceURI==rule.namespace)&&(!rule.context||context.matchesContext(rule.context))){if(rule.getAttrs){let result=rule.getAttrs(dom);if(!1===result)continue;rule.attrs=result||void 0}return rule}}}matchStyle(prop,value,context,after){for(let i=after?this.styles.indexOf(after)+1:0;i<this.styles.length;i++){let rule=this.styles[i],style=rule.style;if(!(0!=style.indexOf(prop)||rule.context&&!context.matchesContext(rule.context)||style.length>prop.length&&(61!=style.charCodeAt(prop.length)||style.slice(prop.length+1)!=value))){if(rule.getAttrs){let result=rule.getAttrs(value);if(!1===result)continue;rule.attrs=result||void 0}return rule}}}static schemaRules(schema){let result=[];function insert(rule){let priority=null==rule.priority?50:rule.priority,i=0;for(;i<result.length;i++){let next=result[i];if((null==next.priority?50:next.priority)<priority)break}result.splice(i,0,rule)}for(let name in schema.marks){let rules=schema.marks[name].spec.parseDOM;rules&&rules.forEach((rule=>{insert(rule=copy(rule)),rule.mark||rule.ignore||rule.clearMark||(rule.mark=name)}))}for(let name in schema.nodes){let rules=schema.nodes[name].spec.parseDOM;rules&&rules.forEach((rule=>{insert(rule=copy(rule)),rule.node||rule.ignore||rule.mark||(rule.node=name)}))}return result}static fromSchema(schema){return schema.cached.domParser||(schema.cached.domParser=new DOMParser(schema,DOMParser.schemaRules(schema)))}}const blockTags={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},ignoreTags={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},listTags={ol:!0,ul:!0};function wsOptionsFor(type,preserveWhitespace,base){return null!=preserveWhitespace?(preserveWhitespace?1:0)|("full"===preserveWhitespace?2:0):type&&"pre"==type.whitespace?3:-5&base}class NodeContext{constructor(type,attrs,marks,pendingMarks,solid,match,options){this.type=type,this.attrs=attrs,this.marks=marks,this.pendingMarks=pendingMarks,this.solid=solid,this.options=options,this.content=[],this.activeMarks=Mark.none,this.stashMarks=[],this.match=match||(4&options?null:type.contentMatch)}findWrapping(node){if(!this.match){if(!this.type)return[];let fill=this.type.contentMatch.fillBefore(Fragment.from(node));if(!fill){let wrap,start=this.type.contentMatch;return(wrap=start.findWrapping(node.type))?(this.match=start,wrap):null}this.match=this.type.contentMatch.matchFragment(fill)}return this.match.findWrapping(node.type)}finish(openEnd){if(!(1&this.options)){let m,last=this.content[this.content.length-1];if(last&&last.isText&&(m=/[ \t\r\n\u000c]+$/.exec(last.text))){let text=last;last.text.length==m[0].length?this.content.pop():this.content[this.content.length-1]=text.withText(text.text.slice(0,text.text.length-m[0].length))}}let content=Fragment.from(this.content);return!openEnd&&this.match&&(content=content.append(this.match.fillBefore(Fragment.empty,!0))),this.type?this.type.create(this.attrs,content,this.marks):content}popFromStashMark(mark){for(let i=this.stashMarks.length-1;i>=0;i--)if(mark.eq(this.stashMarks[i]))return this.stashMarks.splice(i,1)[0]}applyPending(nextType){for(let i=0,pending=this.pendingMarks;i<pending.length;i++){let mark=pending[i];(this.type?this.type.allowsMarkType(mark.type):markMayApply(mark.type,nextType))&&!mark.isInSet(this.activeMarks)&&(this.activeMarks=mark.addToSet(this.activeMarks),this.pendingMarks=mark.removeFromSet(this.pendingMarks))}}inlineContext(node){return this.type?this.type.inlineContent:this.content.length?this.content[0].isInline:node.parentNode&&!blockTags.hasOwnProperty(node.parentNode.nodeName.toLowerCase())}}class ParseContext{constructor(parser,options,isOpen){this.parser=parser,this.options=options,this.isOpen=isOpen,this.open=0;let topContext,topNode=options.topNode,topOptions=wsOptionsFor(null,options.preserveWhitespace,0)|(isOpen?4:0);topContext=topNode?new NodeContext(topNode.type,topNode.attrs,Mark.none,Mark.none,!0,options.topMatch||topNode.type.contentMatch,topOptions):new NodeContext(isOpen?null:parser.schema.topNodeType,null,Mark.none,Mark.none,!0,null,topOptions),this.nodes=[topContext],this.find=options.findPositions,this.needsBlock=!1}get top(){return this.nodes[this.open]}addDOM(dom){3==dom.nodeType?this.addTextNode(dom):1==dom.nodeType&&this.addElement(dom)}withStyleRules(dom,f){let style=dom.getAttribute("style");if(!style)return f();let marks=this.readStyles(function(style){let m,re=/\s*([\w-]+)\s*:\s*([^;]+)/g,result=[];for(;m=re.exec(style);)result.push(m[1],m[2].trim());return result}(style));if(!marks)return;let[addMarks,removeMarks]=marks,top=this.top;for(let i=0;i<removeMarks.length;i++)this.removePendingMark(removeMarks[i],top);for(let i=0;i<addMarks.length;i++)this.addPendingMark(addMarks[i]);f();for(let i=0;i<addMarks.length;i++)this.removePendingMark(addMarks[i],top);for(let i=0;i<removeMarks.length;i++)this.addPendingMark(removeMarks[i])}addTextNode(dom){let value=dom.nodeValue,top=this.top;if(2&top.options||top.inlineContext(dom)||/[^ \t\r\n\u000c]/.test(value)){if(1&top.options)value=2&top.options?value.replace(/\r\n?/g,"\n"):value.replace(/\r?\n|\r/g," ");else if(value=value.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(value)&&this.open==this.nodes.length-1){let nodeBefore=top.content[top.content.length-1],domNodeBefore=dom.previousSibling;(!nodeBefore||domNodeBefore&&"BR"==domNodeBefore.nodeName||nodeBefore.isText&&/[ \t\r\n\u000c]$/.test(nodeBefore.text))&&(value=value.slice(1))}value&&this.insertNode(this.parser.schema.text(value)),this.findInText(dom)}else this.findInside(dom)}addElement(dom,matchAfter){let ruleID,name=dom.nodeName.toLowerCase();listTags.hasOwnProperty(name)&&this.parser.normalizeLists&&function(dom){for(let child=dom.firstChild,prevItem=null;child;child=child.nextSibling){let name=1==child.nodeType?child.nodeName.toLowerCase():null;name&&listTags.hasOwnProperty(name)&&prevItem?(prevItem.appendChild(child),child=prevItem):"li"==name?prevItem=child:name&&(prevItem=null)}}(dom);let rule=this.options.ruleFromNode&&this.options.ruleFromNode(dom)||(ruleID=this.parser.matchTag(dom,this,matchAfter));if(rule?rule.ignore:ignoreTags.hasOwnProperty(name))this.findInside(dom),this.ignoreFallback(dom);else if(!rule||rule.skip||rule.closeParent){rule&&rule.closeParent?this.open=Math.max(0,this.open-1):rule&&rule.skip.nodeType&&(dom=rule.skip);let sync,top=this.top,oldNeedsBlock=this.needsBlock;if(blockTags.hasOwnProperty(name))top.content.length&&top.content[0].isInline&&this.open&&(this.open--,top=this.top),sync=!0,top.type||(this.needsBlock=!0);else if(!dom.firstChild)return void this.leafFallback(dom);rule&&rule.skip?this.addAll(dom):this.withStyleRules(dom,(()=>this.addAll(dom))),sync&&this.sync(top),this.needsBlock=oldNeedsBlock}else this.withStyleRules(dom,(()=>{this.addElementByRule(dom,rule,!1===rule.consuming?ruleID:void 0)}))}leafFallback(dom){"BR"==dom.nodeName&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(dom.ownerDocument.createTextNode("\n"))}ignoreFallback(dom){"BR"!=dom.nodeName||this.top.type&&this.top.type.inlineContent||this.findPlace(this.parser.schema.text("-"))}readStyles(styles){let add=Mark.none,remove=Mark.none;for(let i=0;i<styles.length;i+=2)for(let after;;){let rule=this.parser.matchStyle(styles[i],styles[i+1],this,after);if(!rule)break;if(rule.ignore)return null;if(rule.clearMark?this.top.pendingMarks.concat(this.top.activeMarks).forEach((m=>{rule.clearMark(m)&&(remove=m.addToSet(remove))})):add=this.parser.schema.marks[rule.mark].create(rule.attrs).addToSet(add),!1!==rule.consuming)break;after=rule}return[add,remove]}addElementByRule(dom,rule,continueAfter){let sync,nodeType,mark;if(rule.node)nodeType=this.parser.schema.nodes[rule.node],nodeType.isLeaf?this.insertNode(nodeType.create(rule.attrs))||this.leafFallback(dom):sync=this.enter(nodeType,rule.attrs||null,rule.preserveWhitespace);else{mark=this.parser.schema.marks[rule.mark].create(rule.attrs),this.addPendingMark(mark)}let startIn=this.top;if(nodeType&&nodeType.isLeaf)this.findInside(dom);else if(continueAfter)this.addElement(dom,continueAfter);else if(rule.getContent)this.findInside(dom),rule.getContent(dom,this.parser.schema).forEach((node=>this.insertNode(node)));else{let contentDOM=dom;"string"==typeof rule.contentElement?contentDOM=dom.querySelector(rule.contentElement):"function"==typeof rule.contentElement?contentDOM=rule.contentElement(dom):rule.contentElement&&(contentDOM=rule.contentElement),this.findAround(dom,contentDOM,!0),this.addAll(contentDOM)}sync&&this.sync(startIn)&&this.open--,mark&&this.removePendingMark(mark,startIn)}addAll(parent,startIndex,endIndex){let index=startIndex||0;for(let dom=startIndex?parent.childNodes[startIndex]:parent.firstChild,end=null==endIndex?null:parent.childNodes[endIndex];dom!=end;dom=dom.nextSibling,++index)this.findAtPoint(parent,index),this.addDOM(dom);this.findAtPoint(parent,index)}findPlace(node){let route,sync;for(let depth=this.open;depth>=0;depth--){let cx=this.nodes[depth],found=cx.findWrapping(node);if(found&&(!route||route.length>found.length)&&(route=found,sync=cx,!found.length))break;if(cx.solid)break}if(!route)return!1;this.sync(sync);for(let i=0;i<route.length;i++)this.enterInner(route[i],null,!1);return!0}insertNode(node){if(node.isInline&&this.needsBlock&&!this.top.type){let block=this.textblockFromContext();block&&this.enterInner(block)}if(this.findPlace(node)){this.closeExtra();let top=this.top;top.applyPending(node.type),top.match&&(top.match=top.match.matchType(node.type));let marks=top.activeMarks;for(let i=0;i<node.marks.length;i++)top.type&&!top.type.allowsMarkType(node.marks[i].type)||(marks=node.marks[i].addToSet(marks));return top.content.push(node.mark(marks)),!0}return!1}enter(type,attrs,preserveWS){let ok=this.findPlace(type.create(attrs));return ok&&this.enterInner(type,attrs,!0,preserveWS),ok}enterInner(type,attrs=null,solid=!1,preserveWS){this.closeExtra();let top=this.top;top.applyPending(type),top.match=top.match&&top.match.matchType(type);let options=wsOptionsFor(type,preserveWS,top.options);4&top.options&&0==top.content.length&&(options|=4),this.nodes.push(new NodeContext(type,attrs,top.activeMarks,top.pendingMarks,solid,null,options)),this.open++}closeExtra(openEnd=!1){let i=this.nodes.length-1;if(i>this.open){for(;i>this.open;i--)this.nodes[i-1].content.push(this.nodes[i].finish(openEnd));this.nodes.length=this.open+1}}finish(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(this.isOpen||this.options.topOpen)}sync(to){for(let i=this.open;i>=0;i--)if(this.nodes[i]==to)return this.open=i,!0;return!1}get currentPos(){this.closeExtra();let pos=0;for(let i=this.open;i>=0;i--){let content=this.nodes[i].content;for(let j=content.length-1;j>=0;j--)pos+=content[j].nodeSize;i&&pos++}return pos}findAtPoint(parent,offset){if(this.find)for(let i=0;i<this.find.length;i++)this.find[i].node==parent&&this.find[i].offset==offset&&(this.find[i].pos=this.currentPos)}findInside(parent){if(this.find)for(let i=0;i<this.find.length;i++)null==this.find[i].pos&&1==parent.nodeType&&parent.contains(this.find[i].node)&&(this.find[i].pos=this.currentPos)}findAround(parent,content,before){if(parent!=content&&this.find)for(let i=0;i<this.find.length;i++)if(null==this.find[i].pos&&1==parent.nodeType&&parent.contains(this.find[i].node)){content.compareDocumentPosition(this.find[i].node)&(before?2:4)&&(this.find[i].pos=this.currentPos)}}findInText(textNode){if(this.find)for(let i=0;i<this.find.length;i++)this.find[i].node==textNode&&(this.find[i].pos=this.currentPos-(textNode.nodeValue.length-this.find[i].offset))}matchesContext(context){if(context.indexOf("|")>-1)return context.split(/\s*\|\s*/).some(this.matchesContext,this);let parts=context.split("/"),option=this.options.context,useRoot=!(this.isOpen||option&&option.parent.type!=this.nodes[0].type),minDepth=-(option?option.depth+1:0)+(useRoot?0:1),match=(i,depth)=>{for(;i>=0;i--){let part=parts[i];if(""==part){if(i==parts.length-1||0==i)continue;for(;depth>=minDepth;depth--)if(match(i-1,depth))return!0;return!1}{let next=depth>0||0==depth&&useRoot?this.nodes[depth].type:option&&depth>=minDepth?option.node(depth-minDepth).type:null;if(!next||next.name!=part&&-1==next.groups.indexOf(part))return!1;depth--}}return!0};return match(parts.length-1,this.open)}textblockFromContext(){let $context=this.options.context;if($context)for(let d=$context.depth;d>=0;d--){let deflt=$context.node(d).contentMatchAt($context.indexAfter(d)).defaultType;if(deflt&&deflt.isTextblock&&deflt.defaultAttrs)return deflt}for(let name in this.parser.schema.nodes){let type=this.parser.schema.nodes[name];if(type.isTextblock&&type.defaultAttrs)return type}}addPendingMark(mark){let found=function(mark,set){for(let i=0;i<set.length;i++)if(mark.eq(set[i]))return set[i]}(mark,this.top.pendingMarks);found&&this.top.stashMarks.push(found),this.top.pendingMarks=mark.addToSet(this.top.pendingMarks)}removePendingMark(mark,upto){for(let depth=this.open;depth>=0;depth--){let level=this.nodes[depth];if(level.pendingMarks.lastIndexOf(mark)>-1)level.pendingMarks=mark.removeFromSet(level.pendingMarks);else{level.activeMarks=mark.removeFromSet(level.activeMarks);let stashMark=level.popFromStashMark(mark);stashMark&&level.type&&level.type.allowsMarkType(stashMark.type)&&(level.activeMarks=stashMark.addToSet(level.activeMarks))}if(level==upto)break}}}function matches(dom,selector){return(dom.matches||dom.msMatchesSelector||dom.webkitMatchesSelector||dom.mozMatchesSelector).call(dom,selector)}function copy(obj){let copy={};for(let prop in obj)copy[prop]=obj[prop];return copy}function markMayApply(markType,nodeType){let nodes=nodeType.schema.nodes;for(let name in nodes){let parent=nodes[name];if(!parent.allowsMarkType(markType))continue;let seen=[],scan=match=>{seen.push(match);for(let i=0;i<match.edgeCount;i++){let{type:type,next:next}=match.edge(i);if(type==nodeType)return!0;if(seen.indexOf(next)<0&&scan(next))return!0}};if(scan(parent.contentMatch))return!0}}class DOMSerializer{constructor(nodes,marks){this.nodes=nodes,this.marks=marks}serializeFragment(fragment,options={},target){target||(target=doc$2(options).createDocumentFragment());let top=target,active=[];return fragment.forEach((node=>{if(active.length||node.marks.length){let keep=0,rendered=0;for(;keep<active.length&&rendered<node.marks.length;){let next=node.marks[rendered];if(this.marks[next.type.name]){if(!next.eq(active[keep][0])||!1===next.type.spec.spanning)break;keep++,rendered++}else rendered++}for(;keep<active.length;)top=active.pop()[1];for(;rendered<node.marks.length;){let add=node.marks[rendered++],markDOM=this.serializeMark(add,node.isInline,options);markDOM&&(active.push([add,top]),top.appendChild(markDOM.dom),top=markDOM.contentDOM||markDOM.dom)}}top.appendChild(this.serializeNodeInner(node,options))})),target}serializeNodeInner(node,options){let{dom:dom,contentDOM:contentDOM}=DOMSerializer.renderSpec(doc$2(options),this.nodes[node.type.name](node));if(contentDOM){if(node.isLeaf)throw new RangeError("Content hole not allowed in a leaf node spec");this.serializeFragment(node.content,options,contentDOM)}return dom}serializeNode(node,options={}){let dom=this.serializeNodeInner(node,options);for(let i=node.marks.length-1;i>=0;i--){let wrap=this.serializeMark(node.marks[i],node.isInline,options);wrap&&((wrap.contentDOM||wrap.dom).appendChild(dom),dom=wrap.dom)}return dom}serializeMark(mark,inline,options={}){let toDOM=this.marks[mark.type.name];return toDOM&&DOMSerializer.renderSpec(doc$2(options),toDOM(mark,inline))}static renderSpec(doc,structure,xmlNS=null){if("string"==typeof structure)return{dom:doc.createTextNode(structure)};if(null!=structure.nodeType)return{dom:structure};if(structure.dom&&null!=structure.dom.nodeType)return structure;let contentDOM,tagName=structure[0],space=tagName.indexOf(" ");space>0&&(xmlNS=tagName.slice(0,space),tagName=tagName.slice(space+1));let dom=xmlNS?doc.createElementNS(xmlNS,tagName):doc.createElement(tagName),attrs=structure[1],start=1;if(attrs&&"object"==typeof attrs&&null==attrs.nodeType&&!Array.isArray(attrs)){start=2;for(let name in attrs)if(null!=attrs[name]){let space=name.indexOf(" ");space>0?dom.setAttributeNS(name.slice(0,space),name.slice(space+1),attrs[name]):dom.setAttribute(name,attrs[name])}}for(let i=start;i<structure.length;i++){let child=structure[i];if(0===child){if(i<structure.length-1||i>start)throw new RangeError("Content hole must be the only child of its parent node");return{dom:dom,contentDOM:dom}}{let{dom:inner,contentDOM:innerContent}=DOMSerializer.renderSpec(doc,child,xmlNS);if(dom.appendChild(inner),innerContent){if(contentDOM)throw new RangeError("Multiple content holes");contentDOM=innerContent}}}return{dom:dom,contentDOM:contentDOM}}static fromSchema(schema){return schema.cached.domSerializer||(schema.cached.domSerializer=new DOMSerializer(this.nodesFromSchema(schema),this.marksFromSchema(schema)))}static nodesFromSchema(schema){let result=gatherToDOM(schema.nodes);return result.text||(result.text=node=>node.text),result}static marksFromSchema(schema){return gatherToDOM(schema.marks)}}function gatherToDOM(obj){let result={};for(let name in obj){let toDOM=obj[name].spec.toDOM;toDOM&&(result[name]=toDOM)}return result}function doc$2(options){return options.document||window.document}const emptyOptions={};function toString(value,options){const settings=options||emptyOptions;return one(value,"boolean"!=typeof settings.includeImageAlt||settings.includeImageAlt,"boolean"!=typeof settings.includeHtml||settings.includeHtml)}function one(value,includeImageAlt,includeHtml){if(function(value){return Boolean(value&&"object"==typeof value)}(value)){if("value"in value)return"html"!==value.type||includeHtml?value.value:"";if(includeImageAlt&&"alt"in value&&value.alt)return value.alt;if("children"in value)return all(value.children,includeImageAlt,includeHtml)}return Array.isArray(value)?all(value,includeImageAlt,includeHtml):""}function all(values,includeImageAlt,includeHtml){const result=[];let index=-1;for(;++index<values.length;)result[index]=one(values[index],includeImageAlt,includeHtml);return result.join("")}const characterEntities={AElig:"",AMP:"&",Aacute:"",Abreve:"",Acirc:"",Acy:"",Afr:"",Agrave:"",Alpha:"",Amacr:"",And:"",Aogon:"",Aopf:"",ApplyFunction:"",Aring:"",Ascr:"",Assign:"",Atilde:"",Auml:"",Backslash:"",Barv:"",Barwed:"",Bcy:"",Because:"",Bernoullis:"",Beta:"",Bfr:"",Bopf:"",Breve:"",Bscr:"",Bumpeq:"",CHcy:"",COPY:"",Cacute:"",Cap:"",CapitalDifferentialD:"",Cayleys:"",Ccaron:"",Ccedil:"",Ccirc:"",Cconint:"",Cdot:"",Cedilla:"",CenterDot:"",Cfr:"",Chi:"",CircleDot:"",CircleMinus:"",CirclePlus:"",CircleTimes:"",ClockwiseContourIntegral:"",CloseCurlyDoubleQuote:"",CloseCurlyQuote:"",Colon:"",Colone:"",Congruent:"",Conint:"",ContourIntegral:"",Copf:"",Coproduct:"",CounterClockwiseContourIntegral:"",Cross:"",Cscr:"",Cup:"",CupCap:"",DD:"",DDotrahd:"",DJcy:"",DScy:"",DZcy:"",Dagger:"",Darr:"",Dashv:"",Dcaron:"",Dcy:"",Del:"",Delta:"",Dfr:"",DiacriticalAcute:"",DiacriticalDot:"",DiacriticalDoubleAcute:"",DiacriticalGrave:"`",DiacriticalTilde:"",Diamond:"",DifferentialD:"",Dopf:"",Dot:"",DotDot:"",DotEqual:"",DoubleContourIntegral:"",DoubleDot:"",DoubleDownArrow:"",DoubleLeftArrow:"",DoubleLeftRightArrow:"",DoubleLeftTee:"",DoubleLongLeftArrow:"",DoubleLongLeftRightArrow:"",DoubleLongRightArrow:"",DoubleRightArrow:"",DoubleRightTee:"",DoubleUpArrow:"",DoubleUpDownArrow:"",DoubleVerticalBar:"",DownArrow:"",DownArrowBar:"",DownArrowUpArrow:"",DownBreve:"",DownLeftRightVector:"",DownLeftTeeVector:"",DownLeftVector:"",DownLeftVectorBar:"",DownRightTeeVector:"",DownRightVector:"",DownRightVectorBar:"",DownTee:"",DownTeeArrow:"",Downarrow:"",Dscr:"",Dstrok:"",ENG:"",ETH:"",Eacute:"",Ecaron:"",Ecirc:"",Ecy:"",Edot:"",Efr:"",Egrave:"",Element:"",Emacr:"",EmptySmallSquare:"",EmptyVerySmallSquare:"",Eogon:"",Eopf:"",Epsilon:"",Equal:"",EqualTilde:"",Equilibrium:"",Escr:"",Esim:"",Eta:"",Euml:"",Exists:"",ExponentialE:"",Fcy:"",Ffr:"",FilledSmallSquare:"",FilledVerySmallSquare:"",Fopf:"",ForAll:"",Fouriertrf:"",Fscr:"",GJcy:"",GT:">",Gamma:"",Gammad:"",Gbreve:"",Gcedil:"",Gcirc:"",Gcy:"",Gdot:"",Gfr:"",Gg:"",Gopf:"",GreaterEqual:"",GreaterEqualLess:"",GreaterFullEqual:"",GreaterGreater:"",GreaterLess:"",GreaterSlantEqual:"",GreaterTilde:"",Gscr:"",Gt:"",HARDcy:"",Hacek:"",Hat:"^",Hcirc:"",Hfr:"",HilbertSpace:"",Hopf:"",HorizontalLine:"",Hscr:"",Hstrok:"",HumpDownHump:"",HumpEqual:"",IEcy:"",IJlig:"",IOcy:"",Iacute:"",Icirc:"",Icy:"",Idot:"",Ifr:"",Igrave:"",Im:"",Imacr:"",ImaginaryI:"",Implies:"",Int:"",Integral:"",Intersection:"",InvisibleComma:"",InvisibleTimes:"",Iogon:"",Iopf:"",Iota:"",Iscr:"",Itilde:"",Iukcy:"",Iuml:"",Jcirc:"",Jcy:"",Jfr:"",Jopf:"",Jscr:"",Jsercy:"",Jukcy:"",KHcy:"",KJcy:"",Kappa:"",Kcedil:"",Kcy:"",Kfr:"",Kopf:"",Kscr:"",LJcy:"",LT:"<",Lacute:"",Lambda:"",Lang:"",Laplacetrf:"",Larr:"",Lcaron:"",Lcedil:"",Lcy:"",LeftAngleBracket:"",LeftArrow:"",LeftArrowBar:"",LeftArrowRightArrow:"",LeftCeiling:"",LeftDoubleBracket:"",LeftDownTeeVector:"",LeftDownVector:"",LeftDownVectorBar:"",LeftFloor:"",LeftRightArrow:"",LeftRightVector:"",LeftTee:"",LeftTeeArrow:"",LeftTeeVector:"",LeftTriangle:"",LeftTriangleBar:"",LeftTriangleEqual:"",LeftUpDownVector:"",LeftUpTeeVector:"",LeftUpVector:"",LeftUpVectorBar:"",LeftVector:"",LeftVectorBar:"",Leftarrow:"",Leftrightarrow:"",LessEqualGreater:"",LessFullEqual:"",LessGreater:"",LessLess:"",LessSlantEqual:"",LessTilde:"",Lfr:"",Ll:"",Lleftarrow:"",Lmidot:"",LongLeftArrow:"",LongLeftRightArrow:"",LongRightArrow:"",Longleftarrow:"",Longleftrightarrow:"",Longrightarrow:"",Lopf:"",LowerLeftArrow:"",LowerRightArrow:"",Lscr:"",Lsh:"",Lstrok:"",Lt:"",Map:"",Mcy:"",MediumSpace:"",Mellintrf:"",Mfr:"",MinusPlus:"",Mopf:"",Mscr:"",Mu:"",NJcy:"",Nacute:"",Ncaron:"",Ncedil:"",Ncy:"",NegativeMediumSpace:"",NegativeThickSpace:"",NegativeThinSpace:"",NegativeVeryThinSpace:"",NestedGreaterGreater:"",NestedLessLess:"",NewLine:"\n",Nfr:"",NoBreak:"",NonBreakingSpace:"",Nopf:"",Not:"",NotCongruent:"",NotCupCap:"",NotDoubleVerticalBar:"",NotElement:"",NotEqual:"",NotEqualTilde:"",NotExists:"",NotGreater:"",NotGreaterEqual:"",NotGreaterFullEqual:"",NotGreaterGreater:"",NotGreaterLess:"",NotGreaterSlantEqual:"",NotGreaterTilde:"",NotHumpDownHump:"",NotHumpEqual:"",NotLeftTriangle:"",NotLeftTriangleBar:"",NotLeftTriangleEqual:"",NotLess:"",NotLessEqual:"",NotLessGreater:"",NotLessLess:"",NotLessSlantEqual:"",NotLessTilde:"",NotNestedGreaterGreater:"",NotNestedLessLess:"",NotPrecedes:"",NotPrecedesEqual:"",NotPrecedesSlantEqual:"",NotReverseElement:"",NotRightTriangle:"",NotRightTriangleBar:"",NotRightTriangleEqual:"",NotSquareSubset:"",NotSquareSubsetEqual:"",NotSquareSuperset:"",NotSquareSupersetEqual:"",NotSubset:"",NotSubsetEqual:"",NotSucceeds:"",NotSucceedsEqual:"",NotSucceedsSlantEqual:"",NotSucceedsTilde:"",NotSuperset:"",NotSupersetEqual:"",NotTilde:"",NotTildeEqual:"",NotTildeFullEqual:"",NotTildeTilde:"",NotVerticalBar:"",Nscr:"",Ntilde:"",Nu:"",OElig:"",Oacute:"",Ocirc:"",Ocy:"",Odblac:"",Ofr:"",Ograve:"",Omacr:"",Omega:"",Omicron:"",Oopf:"",OpenCurlyDoubleQuote:"",OpenCurlyQuote:"",Or:"",Oscr:"",Oslash:"",Otilde:"",Otimes:"",Ouml:"",OverBar:"",OverBrace:"",OverBracket:"",OverParenthesis:"",PartialD:"",Pcy:"",Pfr:"",Phi:"",Pi:"",PlusMinus:"",Poincareplane:"",Popf:"",Pr:"",Precedes:"",PrecedesEqual:"",PrecedesSlantEqual:"",PrecedesTilde:"",Prime:"",Product:"",Proportion:"",Proportional:"",Pscr:"",Psi:"",QUOT:'"',Qfr:"",Qopf:"",Qscr:"",RBarr:"",REG:"",Racute:"",Rang:"",Rarr:"",Rarrtl:"",Rcaron:"",Rcedil:"",Rcy:"",Re:"",ReverseElement:"",ReverseEquilibrium:"",ReverseUpEquilibrium:"",Rfr:"",Rho:"",RightAngleBracket:"",RightArrow:"",RightArrowBar:"",RightArrowLeftArrow:"",RightCeiling:"",RightDoubleBracket:"",RightDownTeeVector:"",RightDownVector:"",RightDownVectorBar:"",RightFloor:"",RightTee:"",RightTeeArrow:"",RightTeeVector:"",RightTriangle:"",RightTriangleBar:"",RightTriangleEqual:"",RightUpDownVector:"",RightUpTeeVector:"",RightUpVector:"",RightUpVectorBar:"",RightVector:"",RightVectorBar:"",Rightarrow:"",Ropf:"",RoundImplies:"",Rrightarrow:"",Rscr:"",Rsh:"",RuleDelayed:"",SHCHcy:"",SHcy:"",SOFTcy:"",Sacute:"",Sc:"",Scaron:"",Scedil:"",Scirc:"",Scy:"",Sfr:"",ShortDownArrow:"",ShortLeftArrow:"",ShortRightArrow:"",ShortUpArrow:"",Sigma:"",SmallCircle:"",Sopf:"",Sqrt:"",Square:"",SquareIntersection:"",SquareSubset:"",SquareSubsetEqual:"",SquareSuperset:"",SquareSupersetEqual:"",SquareUnion:"",Sscr:"",Star:"",Sub:"",Subset:"",SubsetEqual:"",Succeeds:"",SucceedsEqual:"",SucceedsSlantEqual:"",SucceedsTilde:"",SuchThat:"",Sum:"",Sup:"",Superset:"",SupersetEqual:"",Supset:"",THORN:"",TRADE:"",TSHcy:"",TScy:"",Tab:"\t",Tau:"",Tcaron:"",Tcedil:"",Tcy:"",Tfr:"",Therefore:"",Theta:"",ThickSpace:"",ThinSpace:"",Tilde:"",TildeEqual:"",TildeFullEqual:"",TildeTilde:"",Topf:"",TripleDot:"",Tscr:"",Tstrok:"",Uacute:"",Uarr:"",Uarrocir:"",Ubrcy:"",Ubreve:"",Ucirc:"",Ucy:"",Udblac:"",Ufr:"",Ugrave:"",Umacr:"",UnderBar:"_",UnderBrace:"",UnderBracket:"",UnderParenthesis:"",Union:"",UnionPlus:"",Uogon:"",Uopf:"",UpArrow:"",UpArrowBar:"",UpArrowDownArrow:"",UpDownArrow:"",UpEquilibrium:"",UpTee:"",UpTeeArrow:"",Uparrow:"",Updownarrow:"",UpperLeftArrow:"",UpperRightArrow:"",Upsi:"",Upsilon:"",Uring:"",Uscr:"",Utilde:"",Uuml:"",VDash:"",Vbar:"",Vcy:"",Vdash:"",Vdashl:"",Vee:"",Verbar:"",Vert:"",VerticalBar:"",VerticalLine:"|",VerticalSeparator:"",VerticalTilde:"",VeryThinSpace:"",Vfr:"",Vopf:"",Vscr:"",Vvdash:"",Wcirc:"",Wedge:"",Wfr:"",Wopf:"",Wscr:"",Xfr:"",Xi:"",Xopf:"",Xscr:"",YAcy:"",YIcy:"",YUcy:"",Yacute:"",Ycirc:"",Ycy:"",Yfr:"",Yopf:"",Yscr:"",Yuml:"",ZHcy:"",Zacute:"",Zcaron:"",Zcy:"",Zdot:"",ZeroWidthSpace:"",Zeta:"",Zfr:"",Zopf:"",Zscr:"",aacute:"",abreve:"",ac:"",acE:"",acd:"",acirc:"",acute:"",acy:"",aelig:"",af:"",afr:"",agrave:"",alefsym:"",aleph:"",alpha:"",amacr:"",amalg:"",amp:"&",and:"",andand:"",andd:"",andslope:"",andv:"",ang:"",ange:"",angle:"",angmsd:"",angmsdaa:"",angmsdab:"",angmsdac:"",angmsdad:"",angmsdae:"",angmsdaf:"",angmsdag:"",angmsdah:"",angrt:"",angrtvb:"",angrtvbd:"",angsph:"",angst:"",angzarr:"",aogon:"",aopf:"",ap:"",apE:"",apacir:"",ape:"",apid:"",apos:"'",approx:"",approxeq:"",aring:"",ascr:"",ast:"*",asymp:"",asympeq:"",atilde:"",auml:"",awconint:"",awint:"",bNot:"",backcong:"",backepsilon:"",backprime:"",backsim:"",backsimeq:"",barvee:"",barwed:"",barwedge:"",bbrk:"",bbrktbrk:"",bcong:"",bcy:"",bdquo:"",becaus:"",because:"",bemptyv:"",bepsi:"",bernou:"",beta:"",beth:"",between:"",bfr:"",bigcap:"",bigcirc:"",bigcup:"",bigodot:"",bigoplus:"",bigotimes:"",bigsqcup:"",bigstar:"",bigtriangledown:"",bigtriangleup:"",biguplus:"",bigvee:"",bigwedge:"",bkarow:"",blacklozenge:"",blacksquare:"",blacktriangle:"",blacktriangledown:"",blacktriangleleft:"",blacktriangleright:"",blank:"",blk12:"",blk14:"",blk34:"",block:"",bne:"=",bnequiv:"",bnot:"",bopf:"",bot:"",bottom:"",bowtie:"",boxDL:"",boxDR:"",boxDl:"",boxDr:"",boxH:"",boxHD:"",boxHU:"",boxHd:"",boxHu:"",boxUL:"",boxUR:"",boxUl:"",boxUr:"",boxV:"",boxVH:"",boxVL:"",boxVR:"",boxVh:"",boxVl:"",boxVr:"",boxbox:"",boxdL:"",boxdR:"",boxdl:"",boxdr:"",boxh:"",boxhD:"",boxhU:"",boxhd:"",boxhu:"",boxminus:"",boxplus:"",boxtimes:"",boxuL:"",boxuR:"",boxul:"",boxur:"",boxv:"",boxvH:"",boxvL:"",boxvR:"",boxvh:"",boxvl:"",boxvr:"",bprime:"",breve:"",brvbar:"",bscr:"",bsemi:"",bsim:"",bsime:"",bsol:"\\",bsolb:"",bsolhsub:"",bull:"",bullet:"",bump:"",bumpE:"",bumpe:"",bumpeq:"",cacute:"",cap:"",capand:"",capbrcup:"",capcap:"",capcup:"",capdot:"",caps:"",caret:"",caron:"",ccaps:"",ccaron:"",ccedil:"",ccirc:"",ccups:"",ccupssm:"",cdot:"",cedil:"",cemptyv:"",cent:"",centerdot:"",cfr:"",chcy:"",check:"",checkmark:"",chi:"",cir:"",cirE:"",circ:"",circeq:"",circlearrowleft:"",circlearrowright:"",circledR:"",circledS:"",circledast:"",circledcirc:"",circleddash:"",cire:"",cirfnint:"",cirmid:"",cirscir:"",clubs:"",clubsuit:"",colon:":",colone:"",coloneq:"",comma:",",commat:"@",comp:"",compfn:"",complement:"",complexes:"",cong:"",congdot:"",conint:"",copf:"",coprod:"",copy:"",copysr:"",crarr:"",cross:"",cscr:"",csub:"",csube:"",csup:"",csupe:"",ctdot:"",cudarrl:"",cudarrr:"",cuepr:"",cuesc:"",cularr:"",cularrp:"",cup:"",cupbrcap:"",cupcap:"",cupcup:"",cupdot:"",cupor:"",cups:"",curarr:"",curarrm:"",curlyeqprec:"",curlyeqsucc:"",curlyvee:"",curlywedge:"",curren:"",curvearrowleft:"",curvearrowright:"",cuvee:"",cuwed:"",cwconint:"",cwint:"",cylcty:"",dArr:"",dHar:"",dagger:"",daleth:"",darr:"",dash:"",dashv:"",dbkarow:"",dblac:"",dcaron:"",dcy:"",dd:"",ddagger:"",ddarr:"",ddotseq:"",deg:"",delta:"",demptyv:"",dfisht:"",dfr:"",dharl:"",dharr:"",diam:"",diamond:"",diamondsuit:"",diams:"",die:"",digamma:"",disin:"",div:"",divide:"",divideontimes:"",divonx:"",djcy:"",dlcorn:"",dlcrop:"",dollar:"$",dopf:"",dot:"",doteq:"",doteqdot:"",dotminus:"",dotplus:"",dotsquare:"",doublebarwedge:"",downarrow:"",downdownarrows:"",downharpoonleft:"",downharpoonright:"",drbkarow:"",drcorn:"",drcrop:"",dscr:"",dscy:"",dsol:"",dstrok:"",dtdot:"",dtri:"",dtrif:"",duarr:"",duhar:"",dwangle:"",dzcy:"",dzigrarr:"",eDDot:"",eDot:"",eacute:"",easter:"",ecaron:"",ecir:"",ecirc:"",ecolon:"",ecy:"",edot:"",ee:"",efDot:"",efr:"",eg:"",egrave:"",egs:"",egsdot:"",el:"",elinters:"",ell:"",els:"",elsdot:"",emacr:"",empty:"",emptyset:"",emptyv:"",emsp13:"",emsp14:"",emsp:"",eng:"",ensp:"",eogon:"",eopf:"",epar:"",eparsl:"",eplus:"",epsi:"",epsilon:"",epsiv:"",eqcirc:"",eqcolon:"",eqsim:"",eqslantgtr:"",eqslantless:"",equals:"=",equest:"",equiv:"",equivDD:"",eqvparsl:"",erDot:"",erarr:"",escr:"",esdot:"",esim:"",eta:"",eth:"",euml:"",euro:"",excl:"!",exist:"",expectation:"",exponentiale:"",fallingdotseq:"",fcy:"",female:"",ffilig:"",fflig:"",ffllig:"",ffr:"",filig:"",fjlig:"fj",flat:"",fllig:"",fltns:"",fnof:"",fopf:"",forall:"",fork:"",forkv:"",fpartint:"",frac12:"",frac13:"",frac14:"",frac15:"",frac16:"",frac18:"",frac23:"",frac25:"",frac34:"",frac35:"",frac38:"",frac45:"",frac56:"",frac58:"",frac78:"",frasl:"",frown:"",fscr:"",gE:"",gEl:"",gacute:"",gamma:"",gammad:"",gap:"",gbreve:"",gcirc:"",gcy:"",gdot:"",ge:"",gel:"",geq:"",geqq:"",geqslant:"",ges:"",gescc:"",gesdot:"",gesdoto:"",gesdotol:"",gesl:"",gesles:"",gfr:"",gg:"",ggg:"",gimel:"",gjcy:"",gl:"",glE:"",gla:"",glj:"",gnE:"",gnap:"",gnapprox:"",gne:"",gneq:"",gneqq:"",gnsim:"",gopf:"",grave:"`",gscr:"",gsim:"",gsime:"",gsiml:"",gt:">",gtcc:"",gtcir:"",gtdot:"",gtlPar:"",gtquest:"",gtrapprox:"",gtrarr:"",gtrdot:"",gtreqless:"",gtreqqless:"",gtrless:"",gtrsim:"",gvertneqq:"",gvnE:"",hArr:"",hairsp:"",half:"",hamilt:"",hardcy:"",harr:"",harrcir:"",harrw:"",hbar:"",hcirc:"",hearts:"",heartsuit:"",hellip:"",hercon:"",hfr:"",hksearow:"",hkswarow:"",hoarr:"",homtht:"",hookleftarrow:"",hookrightarrow:"",hopf:"",horbar:"",hscr:"",hslash:"",hstrok:"",hybull:"",hyphen:"",iacute:"",ic:"",icirc:"",icy:"",iecy:"",iexcl:"",iff:"",ifr:"",igrave:"",ii:"",iiiint:"",iiint:"",iinfin:"",iiota:"",ijlig:"",imacr:"",image:"",imagline:"",imagpart:"",imath:"",imof:"",imped:"",in:"",incare:"",infin:"",infintie:"",inodot:"",int:"",intcal:"",integers:"",intercal:"",intlarhk:"",intprod:"",iocy:"",iogon:"",iopf:"",iota:"",iprod:"",iquest:"",iscr:"",isin:"",isinE:"",isindot:"",isins:"",isinsv:"",isinv:"",it:"",itilde:"",iukcy:"",iuml:"",jcirc:"",jcy:"",jfr:"",jmath:"",jopf:"",jscr:"",jsercy:"",jukcy:"",kappa:"",kappav:"",kcedil:"",kcy:"",kfr:"",kgreen:"",khcy:"",kjcy:"",kopf:"",kscr:"",lAarr:"",lArr:"",lAtail:"",lBarr:"",lE:"",lEg:"",lHar:"",lacute:"",laemptyv:"",lagran:"",lambda:"",lang:"",langd:"",langle:"",lap:"",laquo:"",larr:"",larrb:"",larrbfs:"",larrfs:"",larrhk:"",larrlp:"",larrpl:"",larrsim:"",larrtl:"",lat:"",latail:"",late:"",lates:"",lbarr:"",lbbrk:"",lbrace:"{",lbrack:"[",lbrke:"",lbrksld:"",lbrkslu:"",lcaron:"",lcedil:"",lceil:"",lcub:"{",lcy:"",ldca:"",ldquo:"",ldquor:"",ldrdhar:"",ldrushar:"",ldsh:"",le:"",leftarrow:"",leftarrowtail:"",leftharpoondown:"",leftharpoonup:"",leftleftarrows:"",leftrightarrow:"",leftrightarrows:"",leftrightharpoons:"",leftrightsquigarrow:"",leftthreetimes:"",leg:"",leq:"",leqq:"",leqslant:"",les:"",lescc:"",lesdot:"",lesdoto:"",lesdotor:"",lesg:"",lesges:"",lessapprox:"",lessdot:"",lesseqgtr:"",lesseqqgtr:"",lessgtr:"",lesssim:"",lfisht:"",lfloor:"",lfr:"",lg:"",lgE:"",lhard:"",lharu:"",lharul:"",lhblk:"",ljcy:"",ll:"",llarr:"",llcorner:"",llhard:"",lltri:"",lmidot:"",lmoust:"",lmoustache:"",lnE:"",lnap:"",lnapprox:"",lne:"",lneq:"",lneqq:"",lnsim:"",loang:"",loarr:"",lobrk:"",longleftarrow:"",longleftrightarrow:"",longmapsto:"",longrightarrow:"",looparrowleft:"",looparrowright:"",lopar:"",lopf:"",loplus:"",lotimes:"",lowast:"",lowbar:"_",loz:"",lozenge:"",lozf:"",lpar:"(",lparlt:"",lrarr:"",lrcorner:"",lrhar:"",lrhard:"",lrm:"",lrtri:"",lsaquo:"",lscr:"",lsh:"",lsim:"",lsime:"",lsimg:"",lsqb:"[",lsquo:"",lsquor:"",lstrok:"",lt:"<",ltcc:"",ltcir:"",ltdot:"",lthree:"",ltimes:"",ltlarr:"",ltquest:"",ltrPar:"",ltri:"",ltrie:"",ltrif:"",lurdshar:"",luruhar:"",lvertneqq:"",lvnE:"",mDDot:"",macr:"",male:"",malt:"",maltese:"",map:"",mapsto:"",mapstodown:"",mapstoleft:"",mapstoup:"",marker:"",mcomma:"",mcy:"",mdash:"",measuredangle:"",mfr:"",mho:"",micro:"",mid:"",midast:"*",midcir:"",middot:"",minus:"",minusb:"",minusd:"",minusdu:"",mlcp:"",mldr:"",mnplus:"",models:"",mopf:"",mp:"",mscr:"",mstpos:"",mu:"",multimap:"",mumap:"",nGg:"",nGt:"",nGtv:"",nLeftarrow:"",nLeftrightarrow:"",nLl:"",nLt:"",nLtv:"",nRightarrow:"",nVDash:"",nVdash:"",nabla:"",nacute:"",nang:"",nap:"",napE:"",napid:"",napos:"",napprox:"",natur:"",natural:"",naturals:"",nbsp:"",nbump:"",nbumpe:"",ncap:"",ncaron:"",ncedil:"",ncong:"",ncongdot:"",ncup:"",ncy:"",ndash:"",ne:"",neArr:"",nearhk:"",nearr:"",nearrow:"",nedot:"",nequiv:"",nesear:"",nesim:"",nexist:"",nexists:"",nfr:"",ngE:"",nge:"",ngeq:"",ngeqq:"",ngeqslant:"",nges:"",ngsim:"",ngt:"",ngtr:"",nhArr:"",nharr:"",nhpar:"",ni:"",nis:"",nisd:"",niv:"",njcy:"",nlArr:"",nlE:"",nlarr:"",nldr:"",nle:"",nleftarrow:"",nleftrightarrow:"",nleq:"",nleqq:"",nleqslant:"",nles:"",nless:"",nlsim:"",nlt:"",nltri:"",nltrie:"",nmid:"",nopf:"",not:"",notin:"",notinE:"",notindot:"",notinva:"",notinvb:"",notinvc:"",notni:"",notniva:"",notnivb:"",notnivc:"",npar:"",nparallel:"",nparsl:"",npart:"",npolint:"",npr:"",nprcue:"",npre:"",nprec:"",npreceq:"",nrArr:"",nrarr:"",nrarrc:"",nrarrw:"",nrightarrow:"",nrtri:"",nrtrie:"",nsc:"",nsccue:"",nsce:"",nscr:"",nshortmid:"",nshortparallel:"",nsim:"",nsime:"",nsimeq:"",nsmid:"",nspar:"",nsqsube:"",nsqsupe:"",nsub:"",nsubE:"",nsube:"",nsubset:"",nsubseteq:"",nsubseteqq:"",nsucc:"",nsucceq:"",nsup:"",nsupE:"",nsupe:"",nsupset:"",nsupseteq:"",nsupseteqq:"",ntgl:"",ntilde:"",ntlg:"",ntriangleleft:"",ntrianglelefteq:"",ntriangleright:"",ntrianglerighteq:"",nu:"",num:"#",numero:"",numsp:"",nvDash:"",nvHarr:"",nvap:"",nvdash:"",nvge:"",nvgt:">",nvinfin:"",nvlArr:"",nvle:"",nvlt:"<",nvltrie:"",nvrArr:"",nvrtrie:"",nvsim:"",nwArr:"",nwarhk:"",nwarr:"",nwarrow:"",nwnear:"",oS:"",oacute:"",oast:"",ocir:"",ocirc:"",ocy:"",odash:"",odblac:"",odiv:"",odot:"",odsold:"",oelig:"",ofcir:"",ofr:"",ogon:"",ograve:"",ogt:"",ohbar:"",ohm:"",oint:"",olarr:"",olcir:"",olcross:"",oline:"",olt:"",omacr:"",omega:"",omicron:"",omid:"",ominus:"",oopf:"",opar:"",operp:"",oplus:"",or:"",orarr:"",ord:"",order:"",orderof:"",ordf:"",ordm:"",origof:"",oror:"",orslope:"",orv:"",oscr:"",oslash:"",osol:"",otilde:"",otimes:"",otimesas:"",ouml:"",ovbar:"",par:"",para:"",parallel:"",parsim:"",parsl:"",part:"",pcy:"",percnt:"%",period:".",permil:"",perp:"",pertenk:"",pfr:"",phi:"",phiv:"",phmmat:"",phone:"",pi:"",pitchfork:"",piv:"",planck:"",planckh:"",plankv:"",plus:"+",plusacir:"",plusb:"",pluscir:"",plusdo:"",plusdu:"",pluse:"",plusmn:"",plussim:"",plustwo:"",pm:"",pointint:"",popf:"",pound:"",pr:"",prE:"",prap:"",prcue:"",pre:"",prec:"",precapprox:"",preccurlyeq:"",preceq:"",precnapprox:"",precneqq:"",precnsim:"",precsim:"",prime:"",primes:"",prnE:"",prnap:"",prnsim:"",prod:"",profalar:"",profline:"",profsurf:"",prop:"",propto:"",prsim:"",prurel:"",pscr:"",psi:"",puncsp:"",qfr:"",qint:"",qopf:"",qprime:"",qscr:"",quaternions:"",quatint:"",quest:"?",questeq:"",quot:'"',rAarr:"",rArr:"",rAtail:"",rBarr:"",rHar:"",race:"",racute:"",radic:"",raemptyv:"",rang:"",rangd:"",range:"",rangle:"",raquo:"",rarr:"",rarrap:"",rarrb:"",rarrbfs:"",rarrc:"",rarrfs:"",rarrhk:"",rarrlp:"",rarrpl:"",rarrsim:"",rarrtl:"",rarrw:"",ratail:"",ratio:"",rationals:"",rbarr:"",rbbrk:"",rbrace:"}",rbrack:"]",rbrke:"",rbrksld:"",rbrkslu:"",rcaron:"",rcedil:"",rceil:"",rcub:"}",rcy:"",rdca:"",rdldhar:"",rdquo:"",rdquor:"",rdsh:"",real:"",realine:"",realpart:"",reals:"",rect:"",reg:"",rfisht:"",rfloor:"",rfr:"",rhard:"",rharu:"",rharul:"",rho:"",rhov:"",rightarrow:"",rightarrowtail:"",rightharpoondown:"",rightharpoonup:"",rightleftarrows:"",rightleftharpoons:"",rightrightarrows:"",rightsquigarrow:"",rightthreetimes:"",ring:"",risingdotseq:"",rlarr:"",rlhar:"",rlm:"",rmoust:"",rmoustache:"",rnmid:"",roang:"",roarr:"",robrk:"",ropar:"",ropf:"",roplus:"",rotimes:"",rpar:")",rpargt:"",rppolint:"",rrarr:"",rsaquo:"",rscr:"",rsh:"",rsqb:"]",rsquo:"",rsquor:"",rthree:"",rtimes:"",rtri:"",rtrie:"",rtrif:"",rtriltri:"",ruluhar:"",rx:"",sacute:"",sbquo:"",sc:"",scE:"",scap:"",scaron:"",sccue:"",sce:"",scedil:"",scirc:"",scnE:"",scnap:"",scnsim:"",scpolint:"",scsim:"",scy:"",sdot:"",sdotb:"",sdote:"",seArr:"",searhk:"",searr:"",searrow:"",sect:"",semi:";",seswar:"",setminus:"",setmn:"",sext:"",sfr:"",sfrown:"",sharp:"",shchcy:"",shcy:"",shortmid:"",shortparallel:"",shy:"",sigma:"",sigmaf:"",sigmav:"",sim:"",simdot:"",sime:"",simeq:"",simg:"",simgE:"",siml:"",simlE:"",simne:"",simplus:"",simrarr:"",slarr:"",smallsetminus:"",smashp:"",smeparsl:"",smid:"",smile:"",smt:"",smte:"",smtes:"",softcy:"",sol:"/",solb:"",solbar:"",sopf:"",spades:"",spadesuit:"",spar:"",sqcap:"",sqcaps:"",sqcup:"",sqcups:"",sqsub:"",sqsube:"",sqsubset:"",sqsubseteq:"",sqsup:"",sqsupe:"",sqsupset:"",sqsupseteq:"",squ:"",square:"",squarf:"",squf:"",srarr:"",sscr:"",ssetmn:"",ssmile:"",sstarf:"",star:"",starf:"",straightepsilon:"",straightphi:"",strns:"",sub:"",subE:"",subdot:"",sube:"",subedot:"",submult:"",subnE:"",subne:"",subplus:"",subrarr:"",subset:"",subseteq:"",subseteqq:"",subsetneq:"",subsetneqq:"",subsim:"",subsub:"",subsup:"",succ:"",succapprox:"",succcurlyeq:"",succeq:"",succnapprox:"",succneqq:"",succnsim:"",succsim:"",sum:"",sung:"",sup1:"",sup2:"",sup3:"",sup:"",supE:"",supdot:"",supdsub:"",supe:"",supedot:"",suphsol:"",suphsub:"",suplarr:"",supmult:"",supnE:"",supne:"",supplus:"",supset:"",supseteq:"",supseteqq:"",supsetneq:"",supsetneqq:"",supsim:"",supsub:"",supsup:"",swArr:"",swarhk:"",swarr:"",swarrow:"",swnwar:"",szlig:"",target:"",tau:"",tbrk:"",tcaron:"",tcedil:"",tcy:"",tdot:"",telrec:"",tfr:"",there4:"",therefore:"",theta:"",thetasym:"",thetav:"",thickapprox:"",thicksim:"",thinsp:"",thkap:"",thksim:"",thorn:"",tilde:"",times:"",timesb:"",timesbar:"",timesd:"",tint:"",toea:"",top:"",topbot:"",topcir:"",topf:"",topfork:"",tosa:"",tprime:"",trade:"",triangle:"",triangledown:"",triangleleft:"",trianglelefteq:"",triangleq:"",triangleright:"",trianglerighteq:"",tridot:"",trie:"",triminus:"",triplus:"",trisb:"",tritime:"",trpezium:"",tscr:"",tscy:"",tshcy:"",tstrok:"",twixt:"",twoheadleftarrow:"",twoheadrightarrow:"",uArr:"",uHar:"",uacute:"",uarr:"",ubrcy:"",ubreve:"",ucirc:"",ucy:"",udarr:"",udblac:"",udhar:"",ufisht:"",ufr:"",ugrave:"",uharl:"",uharr:"",uhblk:"",ulcorn:"",ulcorner:"",ulcrop:"",ultri:"",umacr:"",uml:"",uogon:"",uopf:"",uparrow:"",updownarrow:"",upharpoonleft:"",upharpoonright:"",uplus:"",upsi:"",upsih:"",upsilon:"",upuparrows:"",urcorn:"",urcorner:"",urcrop:"",uring:"",urtri:"",uscr:"",utdot:"",utilde:"",utri:"",utrif:"",uuarr:"",uuml:"",uwangle:"",vArr:"",vBar:"",vBarv:"",vDash:"",vangrt:"",varepsilon:"",varkappa:"",varnothing:"",varphi:"",varpi:"",varpropto:"",varr:"",varrho:"",varsigma:"",varsubsetneq:"",varsubsetneqq:"",varsupsetneq:"",varsupsetneqq:"",vartheta:"",vartriangleleft:"",vartriangleright:"",vcy:"",vdash:"",vee:"",veebar:"",veeeq:"",vellip:"",verbar:"|",vert:"|",vfr:"",vltri:"",vnsub:"",vnsup:"",vopf:"",vprop:"",vrtri:"",vscr:"",vsubnE:"",vsubne:"",vsupnE:"",vsupne:"",vzigzag:"",wcirc:"",wedbar:"",wedge:"",wedgeq:"",weierp:"",wfr:"",wopf:"",wp:"",wr:"",wreath:"",wscr:"",xcap:"",xcirc:"",xcup:"",xdtri:"",xfr:"",xhArr:"",xharr:"",xi:"",xlArr:"",xlarr:"",xmap:"",xnis:"",xodot:"",xopf:"",xoplus:"",xotime:"",xrArr:"",xrarr:"",xscr:"",xsqcup:"",xuplus:"",xutri:"",xvee:"",xwedge:"",yacute:"",yacy:"",ycirc:"",ycy:"",yen:"",yfr:"",yicy:"",yopf:"",yscr:"",yucy:"",yuml:"",zacute:"",zcaron:"",zcy:"",zdot:"",zeetrf:"",zeta:"",zfr:"",zhcy:"",zigrarr:"",zopf:"",zscr:"",zwj:"",zwnj:""},own$4={}.hasOwnProperty;function decodeNamedCharacterReference(value){return!!own$4.call(characterEntities,value)&&characterEntities[value]}function splice(list,start,remove,items){const end=list.length;let parameters,chunkStart=0;if(start=start<0?-start>end?0:end+start:start>end?end:start,remove=remove>0?remove:0,items.length<1e4)parameters=Array.from(items),parameters.unshift(start,remove),list.splice(...parameters);else for(remove&&list.splice(start,remove);chunkStart<items.length;)parameters=items.slice(chunkStart,chunkStart+1e4),parameters.unshift(start,0),list.splice(...parameters),chunkStart+=1e4,start+=1e4}function push(list,items){return list.length>0?(splice(list,list.length,0,items),list):items}const hasOwnProperty={}.hasOwnProperty;function syntaxExtension(all,extension){let hook;for(hook in extension){const left=(hasOwnProperty.call(all,hook)?all[hook]:void 0)||(all[hook]={}),right=extension[hook];let code;if(right)for(code in right){hasOwnProperty.call(left,code)||(left[code]=[]);const value=right[code];constructs(left[code],Array.isArray(value)?value:value?[value]:[])}}}function constructs(existing,list){let index=-1;const before=[];for(;++index<list.length;)("after"===list[index].add?existing:before).push(list[index]);splice(existing,0,0,before)}function decodeNumericCharacterReference(value,base){const code=Number.parseInt(value,base);return code<9||11===code||code>13&&code<32||code>126&&code<160||code>55295&&code<57344||code>64975&&code<65008||!(65535&~code)||65534==(65535&code)||code>1114111?"":String.fromCodePoint(code)}function normalizeIdentifier(value){return value.replace(/[\t\n\r ]+/g," ").replace(/^ | $/g,"").toLowerCase().toUpperCase()}const asciiAlpha=regexCheck(/[A-Za-z]/),asciiAlphanumeric=regexCheck(/[\dA-Za-z]/),asciiAtext=regexCheck(/[#-'*+\--9=?A-Z^-~]/);function asciiControl(code){return null!==code&&(code<32||127===code)}const asciiDigit=regexCheck(/\d/),asciiHexDigit=regexCheck(/[\dA-Fa-f]/),asciiPunctuation=regexCheck(/[!-/:-@[-`{-~]/);function markdownLineEnding(code){return null!==code&&code<-2}function markdownLineEndingOrSpace(code){return null!==code&&(code<0||32===code)}function markdownSpace(code){return-2===code||-1===code||32===code}const unicodePunctuation=regexCheck(/\p{P}|\p{S}/u),unicodeWhitespace=regexCheck(/\s/);function regexCheck(regex){return function(code){return null!==code&&code>-1&&regex.test(String.fromCharCode(code))}}function factorySpace(effects,ok,type,max){const limit=max?max-1:Number.POSITIVE_INFINITY;let size=0;return function(code){if(markdownSpace(code))return effects.enter(type),prefix(code);return ok(code)};function prefix(code){return markdownSpace(code)&&size++<limit?(effects.consume(code),prefix):(effects.exit(type),ok(code))}}const content$1={tokenize:function(effects){const contentStart=effects.attempt(this.parser.constructs.contentInitial,(function(code){if(null===code)return void effects.consume(code);return effects.enter("lineEnding"),effects.consume(code),effects.exit("lineEnding"),factorySpace(effects,contentStart,"linePrefix")}),(function(code){return effects.enter("paragraph"),lineStart(code)}));let previous;return contentStart;function lineStart(code){const token=effects.enter("chunkText",{contentType:"text",previous:previous});return previous&&(previous.next=token),previous=token,data(code)}function data(code){return null===code?(effects.exit("chunkText"),effects.exit("paragraph"),void effects.consume(code)):markdownLineEnding(code)?(effects.consume(code),effects.exit("chunkText"),lineStart):(effects.consume(code),data)}}};const document$2={tokenize:function(effects){const self=this,stack=[];let childFlow,childToken,lineStartOffset,continued=0;return start;function start(code){if(continued<stack.length){const item=stack[continued];return self.containerState=item[1],effects.attempt(item[0].continuation,documentContinue,checkNewContainers)(code)}return checkNewContainers(code)}function documentContinue(code){if(continued++,self.containerState._closeFlow){self.containerState._closeFlow=void 0,childFlow&&closeFlow();const indexBeforeExits=self.events.length;let point,indexBeforeFlow=indexBeforeExits;for(;indexBeforeFlow--;)if("exit"===self.events[indexBeforeFlow][0]&&"chunkFlow"===self.events[indexBeforeFlow][1].type){point=self.events[indexBeforeFlow][1].end;break}exitContainers(continued);let index=indexBeforeExits;for(;index<self.events.length;)self.events[index][1].end=Object.assign({},point),index++;return splice(self.events,indexBeforeFlow+1,0,self.events.slice(indexBeforeExits)),self.events.length=index,checkNewContainers(code)}return start(code)}function checkNewContainers(code){if(continued===stack.length){if(!childFlow)return documentContinued(code);if(childFlow.currentConstruct&&childFlow.currentConstruct.concrete)return flowStart(code);self.interrupt=Boolean(childFlow.currentConstruct&&!childFlow._gfmTableDynamicInterruptHack)}return self.containerState={},effects.check(containerConstruct,thereIsANewContainer,thereIsNoNewContainer)(code)}function thereIsANewContainer(code){return childFlow&&closeFlow(),exitContainers(continued),documentContinued(code)}function thereIsNoNewContainer(code){return self.parser.lazy[self.now().line]=continued!==stack.length,lineStartOffset=self.now().offset,flowStart(code)}function documentContinued(code){return self.containerState={},effects.attempt(containerConstruct,containerContinue,flowStart)(code)}function containerContinue(code){return continued++,stack.push([self.currentConstruct,self.containerState]),documentContinued(code)}function flowStart(code){return null===code?(childFlow&&closeFlow(),exitContainers(0),void effects.consume(code)):(childFlow=childFlow||self.parser.flow(self.now()),effects.enter("chunkFlow",{contentType:"flow",previous:childToken,_tokenizer:childFlow}),flowContinue(code))}function flowContinue(code){return null===code?(writeToChild(effects.exit("chunkFlow"),!0),exitContainers(0),void effects.consume(code)):markdownLineEnding(code)?(effects.consume(code),writeToChild(effects.exit("chunkFlow")),continued=0,self.interrupt=void 0,start):(effects.consume(code),flowContinue)}function writeToChild(token,eof){const stream=self.sliceStream(token);if(eof&&stream.push(null),token.previous=childToken,childToken&&(childToken.next=token),childToken=token,childFlow.defineSkip(token.start),childFlow.write(stream),self.parser.lazy[token.start.line]){let index=childFlow.events.length;for(;index--;)if(childFlow.events[index][1].start.offset<lineStartOffset&&(!childFlow.events[index][1].end||childFlow.events[index][1].end.offset>lineStartOffset))return;const indexBeforeExits=self.events.length;let seen,point,indexBeforeFlow=indexBeforeExits;for(;indexBeforeFlow--;)if("exit"===self.events[indexBeforeFlow][0]&&"chunkFlow"===self.events[indexBeforeFlow][1].type){if(seen){point=self.events[indexBeforeFlow][1].end;break}seen=!0}for(exitContainers(continued),index=indexBeforeExits;index<self.events.length;)self.events[index][1].end=Object.assign({},point),index++;splice(self.events,indexBeforeFlow+1,0,self.events.slice(indexBeforeExits)),self.events.length=index}}function exitContainers(size){let index=stack.length;for(;index-- >size;){const entry=stack[index];self.containerState=entry[1],entry[0].exit.call(self,effects)}stack.length=size}function closeFlow(){childFlow.write([null]),childToken=void 0,childFlow=void 0,self.containerState._closeFlow=void 0}}},containerConstruct={tokenize:function(effects,ok,nok){return factorySpace(effects,effects.attempt(this.parser.constructs.document,ok,nok),"linePrefix",this.parser.constructs.disable.null.includes("codeIndented")?void 0:4)}};function classifyCharacter(code){return null===code||markdownLineEndingOrSpace(code)||unicodeWhitespace(code)?1:unicodePunctuation(code)?2:void 0}function resolveAll(constructs,events,context){const called=[];let index=-1;for(;++index<constructs.length;){const resolve=constructs[index].resolveAll;resolve&&!called.includes(resolve)&&(events=resolve(events,context),called.push(resolve))}return events}const attention={name:"attention",tokenize:function(effects,ok){const attentionMarkers=this.parser.constructs.attentionMarkers.null,previous=this.previous,before=classifyCharacter(previous);let marker;return function(code){return marker=code,effects.enter("attentionSequence"),inside(code)};function inside(code){if(code===marker)return effects.consume(code),inside;const token=effects.exit("attentionSequence"),after=classifyCharacter(code),open=!after||2===after&&before||attentionMarkers.includes(code),close=!before||2===before&&after||attentionMarkers.includes(previous);return token._open=Boolean(42===marker?open:open&&(before||!close)),token._close=Boolean(42===marker?close:close&&(after||!open)),ok(code)}},resolveAll:function(events,context){let open,group,text,openingSequence,closingSequence,use,nextEvents,offset,index=-1;for(;++index<events.length;)if("enter"===events[index][0]&&"attentionSequence"===events[index][1].type&&events[index][1]._close)for(open=index;open--;)if("exit"===events[open][0]&&"attentionSequence"===events[open][1].type&&events[open][1]._open&&context.sliceSerialize(events[open][1]).charCodeAt(0)===context.sliceSerialize(events[index][1]).charCodeAt(0)){if((events[open][1]._close||events[index][1]._open)&&(events[index][1].end.offset-events[index][1].start.offset)%3&&!((events[open][1].end.offset-events[open][1].start.offset+events[index][1].end.offset-events[index][1].start.offset)%3))continue;use=events[open][1].end.offset-events[open][1].start.offset>1&&events[index][1].end.offset-events[index][1].start.offset>1?2:1;const start=Object.assign({},events[open][1].end),end=Object.assign({},events[index][1].start);movePoint(start,-use),movePoint(end,use),openingSequence={type:use>1?"strongSequence":"emphasisSequence",start:start,end:Object.assign({},events[open][1].end)},closingSequence={type:use>1?"strongSequence":"emphasisSequence",start:Object.assign({},events[index][1].start),end:end},text={type:use>1?"strongText":"emphasisText",start:Object.assign({},events[open][1].end),end:Object.assign({},events[index][1].start)},group={type:use>1?"strong":"emphasis",start:Object.assign({},openingSequence.start),end:Object.assign({},closingSequence.end)},events[open][1].end=Object.assign({},openingSequence.start),events[index][1].start=Object.assign({},closingSequence.end),nextEvents=[],events[open][1].end.offset-events[open][1].start.offset&&(nextEvents=push(nextEvents,[["enter",events[open][1],context],["exit",events[open][1],context]])),nextEvents=push(nextEvents,[["enter",group,context],["enter",openingSequence,context],["exit",openingSequence,context],["enter",text,context]]),nextEvents=push(nextEvents,resolveAll(context.parser.constructs.insideSpan.null,events.slice(open+1,index),context)),nextEvents=push(nextEvents,[["exit",text,context],["enter",closingSequence,context],["exit",closingSequence,context],["exit",group,context]]),events[index][1].end.offset-events[index][1].start.offset?(offset=2,nextEvents=push(nextEvents,[["enter",events[index][1],context],["exit",events[index][1],context]])):offset=0,splice(events,open-1,index-open+3,nextEvents),index=open+nextEvents.length-offset-2;break}index=-1;for(;++index<events.length;)"attentionSequence"===events[index][1].type&&(events[index][1].type="data");return events}};function movePoint(point,offset){point.column+=offset,point.offset+=offset,point._bufferIndex+=offset}const autolink={name:"autolink",tokenize:function(effects,ok,nok){let size=0;return function(code){return effects.enter("autolink"),effects.enter("autolinkMarker"),effects.consume(code),effects.exit("autolinkMarker"),effects.enter("autolinkProtocol"),open};function open(code){return asciiAlpha(code)?(effects.consume(code),schemeOrEmailAtext):emailAtext(code)}function schemeOrEmailAtext(code){return 43===code||45===code||46===code||asciiAlphanumeric(code)?(size=1,schemeInsideOrEmailAtext(code)):emailAtext(code)}function schemeInsideOrEmailAtext(code){return 58===code?(effects.consume(code),size=0,urlInside):(43===code||45===code||46===code||asciiAlphanumeric(code))&&size++<32?(effects.consume(code),schemeInsideOrEmailAtext):(size=0,emailAtext(code))}function urlInside(code){return 62===code?(effects.exit("autolinkProtocol"),effects.enter("autolinkMarker"),effects.consume(code),effects.exit("autolinkMarker"),effects.exit("autolink"),ok):null===code||32===code||60===code||asciiControl(code)?nok(code):(effects.consume(code),urlInside)}function emailAtext(code){return 64===code?(effects.consume(code),emailAtSignOrDot):asciiAtext(code)?(effects.consume(code),emailAtext):nok(code)}function emailAtSignOrDot(code){return asciiAlphanumeric(code)?emailLabel(code):nok(code)}function emailLabel(code){return 46===code?(effects.consume(code),size=0,emailAtSignOrDot):62===code?(effects.exit("autolinkProtocol").type="autolinkEmail",effects.enter("autolinkMarker"),effects.consume(code),effects.exit("autolinkMarker"),effects.exit("autolink"),ok):emailValue(code)}function emailValue(code){if((45===code||asciiAlphanumeric(code))&&size++<63){const next=45===code?emailValue:emailLabel;return effects.consume(code),next}return nok(code)}}};const blankLine={tokenize:function(effects,ok,nok){return function(code){return markdownSpace(code)?factorySpace(effects,after,"linePrefix")(code):after(code)};function after(code){return null===code||markdownLineEnding(code)?ok(code):nok(code)}},partial:!0};const blockQuote={name:"blockQuote",tokenize:function(effects,ok,nok){const self=this;return function(code){if(62===code){const state=self.containerState;return state.open||(effects.enter("blockQuote",{_container:!0}),state.open=!0),effects.enter("blockQuotePrefix"),effects.enter("blockQuoteMarker"),effects.consume(code),effects.exit("blockQuoteMarker"),after}return nok(code)};function after(code){return markdownSpace(code)?(effects.enter("blockQuotePrefixWhitespace"),effects.consume(code),effects.exit("blockQuotePrefixWhitespace"),effects.exit("blockQuotePrefix"),ok):(effects.exit("blockQuotePrefix"),ok(code))}},continuation:{tokenize:function(effects,ok,nok){const self=this;return function(code){if(markdownSpace(code))return factorySpace(effects,contBefore,"linePrefix",self.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(code);return contBefore(code)};function contBefore(code){return effects.attempt(blockQuote,ok,nok)(code)}}},exit:function(effects){effects.exit("blockQuote")}};const characterEscape={name:"characterEscape",tokenize:function(effects,ok,nok){return function(code){return effects.enter("characterEscape"),effects.enter("escapeMarker"),effects.consume(code),effects.exit("escapeMarker"),inside};function inside(code){return asciiPunctuation(code)?(effects.enter("characterEscapeValue"),effects.consume(code),effects.exit("characterEscapeValue"),effects.exit("characterEscape"),ok):nok(code)}}};const characterReference={name:"characterReference",tokenize:function(effects,ok,nok){const self=this;let max,test,size=0;return function(code){return effects.enter("characterReference"),effects.enter("characterReferenceMarker"),effects.consume(code),effects.exit("characterReferenceMarker"),open};function open(code){return 35===code?(effects.enter("characterReferenceMarkerNumeric"),effects.consume(code),effects.exit("characterReferenceMarkerNumeric"),numeric):(effects.enter("characterReferenceValue"),max=31,test=asciiAlphanumeric,value(code))}function numeric(code){return 88===code||120===code?(effects.enter("characterReferenceMarkerHexadecimal"),effects.consume(code),effects.exit("characterReferenceMarkerHexadecimal"),effects.enter("characterReferenceValue"),max=6,test=asciiHexDigit,value):(effects.enter("characterReferenceValue"),max=7,test=asciiDigit,value(code))}function value(code){if(59===code&&size){const token=effects.exit("characterReferenceValue");return test!==asciiAlphanumeric||decodeNamedCharacterReference(self.sliceSerialize(token))?(effects.enter("characterReferenceMarker"),effects.consume(code),effects.exit("characterReferenceMarker"),effects.exit("characterReference"),ok):nok(code)}return test(code)&&size++<max?(effects.consume(code),value):nok(code)}}};const nonLazyContinuation={tokenize:function(effects,ok,nok){const self=this;return function(code){if(null===code)return nok(code);return effects.enter("lineEnding"),effects.consume(code),effects.exit("lineEnding"),lineStart};function lineStart(code){return self.parser.lazy[self.now().line]?nok(code):ok(code)}},partial:!0},codeFenced={name:"codeFenced",tokenize:function(effects,ok,nok){const self=this,closeStart={tokenize:function(effects,ok,nok){let size=0;return startBefore;function startBefore(code){return effects.enter("lineEnding"),effects.consume(code),effects.exit("lineEnding"),start}function start(code){return effects.enter("codeFencedFence"),markdownSpace(code)?factorySpace(effects,beforeSequenceClose,"linePrefix",self.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(code):beforeSequenceClose(code)}function beforeSequenceClose(code){return code===marker?(effects.enter("codeFencedFenceSequence"),sequenceClose(code)):nok(code)}function sequenceClose(code){return code===marker?(size++,effects.consume(code),sequenceClose):size>=sizeOpen?(effects.exit("codeFencedFenceSequence"),markdownSpace(code)?factorySpace(effects,sequenceCloseAfter,"whitespace")(code):sequenceCloseAfter(code)):nok(code)}function sequenceCloseAfter(code){return null===code||markdownLineEnding(code)?(effects.exit("codeFencedFence"),ok(code)):nok(code)}},partial:!0};let marker,initialPrefix=0,sizeOpen=0;return function(code){return function(code){const tail=self.events[self.events.length-1];return initialPrefix=tail&&"linePrefix"===tail[1].type?tail[2].sliceSerialize(tail[1],!0).length:0,marker=code,effects.enter("codeFenced"),effects.enter("codeFencedFence"),effects.enter("codeFencedFenceSequence"),sequenceOpen(code)}(code)};function sequenceOpen(code){return code===marker?(sizeOpen++,effects.consume(code),sequenceOpen):sizeOpen<3?nok(code):(effects.exit("codeFencedFenceSequence"),markdownSpace(code)?factorySpace(effects,infoBefore,"whitespace")(code):infoBefore(code))}function infoBefore(code){return null===code||markdownLineEnding(code)?(effects.exit("codeFencedFence"),self.interrupt?ok(code):effects.check(nonLazyContinuation,atNonLazyBreak,after)(code)):(effects.enter("codeFencedFenceInfo"),effects.enter("chunkString",{contentType:"string"}),info(code))}function info(code){return null===code||markdownLineEnding(code)?(effects.exit("chunkString"),effects.exit("codeFencedFenceInfo"),infoBefore(code)):markdownSpace(code)?(effects.exit("chunkString"),effects.exit("codeFencedFenceInfo"),factorySpace(effects,metaBefore,"whitespace")(code)):96===code&&code===marker?nok(code):(effects.consume(code),info)}function metaBefore(code){return null===code||markdownLineEnding(code)?infoBefore(code):(effects.enter("codeFencedFenceMeta"),effects.enter("chunkString",{contentType:"string"}),meta(code))}function meta(code){return null===code||markdownLineEnding(code)?(effects.exit("chunkString"),effects.exit("codeFencedFenceMeta"),infoBefore(code)):96===code&&code===marker?nok(code):(effects.consume(code),meta)}function atNonLazyBreak(code){return effects.attempt(closeStart,after,contentBefore)(code)}function contentBefore(code){return effects.enter("lineEnding"),effects.consume(code),effects.exit("lineEnding"),contentStart}function contentStart(code){return initialPrefix>0&&markdownSpace(code)?factorySpace(effects,beforeContentChunk,"linePrefix",initialPrefix+1)(code):beforeContentChunk(code)}function beforeContentChunk(code){return null===code||markdownLineEnding(code)?effects.check(nonLazyContinuation,atNonLazyBreak,after)(code):(effects.enter("codeFlowValue"),contentChunk(code))}function contentChunk(code){return null===code||markdownLineEnding(code)?(effects.exit("codeFlowValue"),beforeContentChunk(code)):(effects.consume(code),contentChunk)}function after(code){return effects.exit("codeFenced"),ok(code)}},concrete:!0};const codeIndented={name:"codeIndented",tokenize:function(effects,ok,nok){const self=this;return function(code){return effects.enter("codeIndented"),factorySpace(effects,afterPrefix,"linePrefix",5)(code)};function afterPrefix(code){const tail=self.events[self.events.length-1];return tail&&"linePrefix"===tail[1].type&&tail[2].sliceSerialize(tail[1],!0).length>=4?atBreak(code):nok(code)}function atBreak(code){return null===code?after(code):markdownLineEnding(code)?effects.attempt(furtherStart,atBreak,after)(code):(effects.enter("codeFlowValue"),inside(code))}function inside(code){return null===code||markdownLineEnding(code)?(effects.exit("codeFlowValue"),atBreak(code)):(effects.consume(code),inside)}function after(code){return effects.exit("codeIndented"),ok(code)}}},furtherStart={tokenize:function(effects,ok,nok){const self=this;return furtherStart;function furtherStart(code){return self.parser.lazy[self.now().line]?nok(code):markdownLineEnding(code)?(effects.enter("lineEnding"),effects.consume(code),effects.exit("lineEnding"),furtherStart):factorySpace(effects,afterPrefix,"linePrefix",5)(code)}function afterPrefix(code){const tail=self.events[self.events.length-1];return tail&&"linePrefix"===tail[1].type&&tail[2].sliceSerialize(tail[1],!0).length>=4?ok(code):markdownLineEnding(code)?furtherStart(code):nok(code)}},partial:!0};const codeText={name:"codeText",tokenize:function(effects,ok,nok){let size,token,sizeOpen=0;return function(code){return effects.enter("codeText"),effects.enter("codeTextSequence"),sequenceOpen(code)};function sequenceOpen(code){return 96===code?(effects.consume(code),sizeOpen++,sequenceOpen):(effects.exit("codeTextSequence"),between(code))}function between(code){return null===code?nok(code):32===code?(effects.enter("space"),effects.consume(code),effects.exit("space"),between):96===code?(token=effects.enter("codeTextSequence"),size=0,sequenceClose(code)):markdownLineEnding(code)?(effects.enter("lineEnding"),effects.consume(code),effects.exit("lineEnding"),between):(effects.enter("codeTextData"),data(code))}function data(code){return null===code||32===code||96===code||markdownLineEnding(code)?(effects.exit("codeTextData"),between(code)):(effects.consume(code),data)}function sequenceClose(code){return 96===code?(effects.consume(code),size++,sequenceClose):size===sizeOpen?(effects.exit("codeTextSequence"),effects.exit("codeText"),ok(code)):(token.type="codeTextData",data(code))}},resolve:function(events){let index,enter,tailExitIndex=events.length-4,headEnterIndex=3;if(!("lineEnding"!==events[headEnterIndex][1].type&&"space"!==events[headEnterIndex][1].type||"lineEnding"!==events[tailExitIndex][1].type&&"space"!==events[tailExitIndex][1].type))for(index=headEnterIndex;++index<tailExitIndex;)if("codeTextData"===events[index][1].type){events[headEnterIndex][1].type="codeTextPadding",events[tailExitIndex][1].type="codeTextPadding",headEnterIndex+=2,tailExitIndex-=2;break}index=headEnterIndex-1,tailExitIndex++;for(;++index<=tailExitIndex;)void 0===enter?index!==tailExitIndex&&"lineEnding"!==events[index][1].type&&(enter=index):index!==tailExitIndex&&"lineEnding"!==events[index][1].type||(events[enter][1].type="codeTextData",index!==enter+2&&(events[enter][1].end=events[index-1][1].end,events.splice(enter+2,index-enter-2),tailExitIndex-=index-enter-2,index=enter+2),enter=void 0);return events},previous:function(code){return 96!==code||"characterEscape"===this.events[this.events.length-1][1].type}};function subtokenize(events){const jumps={};let event,lineIndex,otherIndex,otherEvent,parameters,subevents,more,index=-1;for(;++index<events.length;){for(;index in jumps;)index=jumps[index];if(event=events[index],index&&"chunkFlow"===event[1].type&&"listItemPrefix"===events[index-1][1].type&&(subevents=event[1]._tokenizer.events,otherIndex=0,otherIndex<subevents.length&&"lineEndingBlank"===subevents[otherIndex][1].type&&(otherIndex+=2),otherIndex<subevents.length&&"content"===subevents[otherIndex][1].type))for(;++otherIndex<subevents.length&&"content"!==subevents[otherIndex][1].type;)"chunkText"===subevents[otherIndex][1].type&&(subevents[otherIndex][1]._isInFirstContentOfListItem=!0,otherIndex++);if("enter"===event[0])event[1].contentType&&(Object.assign(jumps,subcontent(events,index)),index=jumps[index],more=!0);else if(event[1]._container){for(otherIndex=index,lineIndex=void 0;otherIndex--&&(otherEvent=events[otherIndex],"lineEnding"===otherEvent[1].type||"lineEndingBlank"===otherEvent[1].type);)"enter"===otherEvent[0]&&(lineIndex&&(events[lineIndex][1].type="lineEndingBlank"),otherEvent[1].type="lineEnding",lineIndex=otherIndex);lineIndex&&(event[1].end=Object.assign({},events[lineIndex][1].start),parameters=events.slice(lineIndex,index),parameters.unshift(event),splice(events,lineIndex,index-lineIndex+1,parameters))}}return!more}function subcontent(events,eventIndex){const token=events[eventIndex][1],context=events[eventIndex][2];let startPosition=eventIndex-1;const startPositions=[],tokenizer=token._tokenizer||context.parser[token.contentType](token.start),childEvents=tokenizer.events,jumps=[],gaps={};let stream,previous,index=-1,current=token,adjust=0,start=0;const breaks=[start];for(;current;){for(;events[++startPosition][1]!==current;);startPositions.push(startPosition),current._tokenizer||(stream=context.sliceStream(current),current.next||stream.push(null),previous&&tokenizer.defineSkip(current.start),current._isInFirstContentOfListItem&&(tokenizer._gfmTasklistFirstContentOfListItem=!0),tokenizer.write(stream),current._isInFirstContentOfListItem&&(tokenizer._gfmTasklistFirstContentOfListItem=void 0)),previous=current,current=current.next}for(current=token;++index<childEvents.length;)"exit"===childEvents[index][0]&&"enter"===childEvents[index-1][0]&&childEvents[index][1].type===childEvents[index-1][1].type&&childEvents[index][1].start.line!==childEvents[index][1].end.line&&(start=index+1,breaks.push(start),current._tokenizer=void 0,current.previous=void 0,current=current.next);for(tokenizer.events=[],current?(current._tokenizer=void 0,current.previous=void 0):breaks.pop(),index=breaks.length;index--;){const slice=childEvents.slice(breaks[index],breaks[index+1]),start=startPositions.pop();jumps.unshift([start,start+slice.length-1]),splice(events,start,2,slice)}for(index=-1;++index<jumps.length;)gaps[adjust+jumps[index][0]]=adjust+jumps[index][1],adjust+=jumps[index][1]-jumps[index][0]-1;return gaps}const content={tokenize:function(effects,ok){let previous;return function(code){return effects.enter("content"),previous=effects.enter("chunkContent",{contentType:"content"}),chunkInside(code)};function chunkInside(code){return null===code?contentEnd(code):markdownLineEnding(code)?effects.check(continuationConstruct,contentContinue,contentEnd)(code):(effects.consume(code),chunkInside)}function contentEnd(code){return effects.exit("chunkContent"),effects.exit("content"),ok(code)}function contentContinue(code){return effects.consume(code),effects.exit("chunkContent"),previous.next=effects.enter("chunkContent",{contentType:"content",previous:previous}),previous=previous.next,chunkInside}},resolve:function(events){return subtokenize(events),events}},continuationConstruct={tokenize:function(effects,ok,nok){const self=this;return function(code){return effects.exit("chunkContent"),effects.enter("lineEnding"),effects.consume(code),effects.exit("lineEnding"),factorySpace(effects,prefixed,"linePrefix")};function prefixed(code){if(null===code||markdownLineEnding(code))return nok(code);const tail=self.events[self.events.length-1];return!self.parser.constructs.disable.null.includes("codeIndented")&&tail&&"linePrefix"===tail[1].type&&tail[2].sliceSerialize(tail[1],!0).length>=4?ok(code):effects.interrupt(self.parser.constructs.flow,nok,ok)(code)}},partial:!0};function factoryDestination(effects,ok,nok,type,literalType,literalMarkerType,rawType,stringType,max){const limit=max||Number.POSITIVE_INFINITY;let balance=0;return function(code){if(60===code)return effects.enter(type),effects.enter(literalType),effects.enter(literalMarkerType),effects.consume(code),effects.exit(literalMarkerType),enclosedBefore;if(null===code||32===code||41===code||asciiControl(code))return nok(code);return effects.enter(type),effects.enter(rawType),effects.enter(stringType),effects.enter("chunkString",{contentType:"string"}),raw(code)};function enclosedBefore(code){return 62===code?(effects.enter(literalMarkerType),effects.consume(code),effects.exit(literalMarkerType),effects.exit(literalType),effects.exit(type),ok):(effects.enter(stringType),effects.enter("chunkString",{contentType:"string"}),enclosed(code))}function enclosed(code){return 62===code?(effects.exit("chunkString"),effects.exit(stringType),enclosedBefore(code)):null===code||60===code||markdownLineEnding(code)?nok(code):(effects.consume(code),92===code?enclosedEscape:enclosed)}function enclosedEscape(code){return 60===code||62===code||92===code?(effects.consume(code),enclosed):enclosed(code)}function raw(code){return balance||null!==code&&41!==code&&!markdownLineEndingOrSpace(code)?balance<limit&&40===code?(effects.consume(code),balance++,raw):41===code?(effects.consume(code),balance--,raw):null===code||32===code||40===code||asciiControl(code)?nok(code):(effects.consume(code),92===code?rawEscape:raw):(effects.exit("chunkString"),effects.exit(stringType),effects.exit(rawType),effects.exit(type),ok(code))}function rawEscape(code){return 40===code||41===code||92===code?(effects.consume(code),raw):raw(code)}}function factoryLabel(effects,ok,nok,type,markerType,stringType){const self=this;let seen,size=0;return function(code){return effects.enter(type),effects.enter(markerType),effects.consume(code),effects.exit(markerType),effects.enter(stringType),atBreak};function atBreak(code){return size>999||null===code||91===code||93===code&&!seen||94===code&&!size&&"_hiddenFootnoteSupport"in self.parser.constructs?nok(code):93===code?(effects.exit(stringType),effects.enter(markerType),effects.consume(code),effects.exit(markerType),effects.exit(type),ok):markdownLineEnding(code)?(effects.enter("lineEnding"),effects.consume(code),effects.exit("lineEnding"),atBreak):(effects.enter("chunkString",{contentType:"string"}),labelInside(code))}function labelInside(code){return null===code||91===code||93===code||markdownLineEnding(code)||size++>999?(effects.exit("chunkString"),atBreak(code)):(effects.consume(code),seen||(seen=!markdownSpace(code)),92===code?labelEscape:labelInside)}function labelEscape(code){return 91===code||92===code||93===code?(effects.consume(code),size++,labelInside):labelInside(code)}}function factoryTitle(effects,ok,nok,type,markerType,stringType){let marker;return function(code){if(34===code||39===code||40===code)return effects.enter(type),effects.enter(markerType),effects.consume(code),effects.exit(markerType),marker=40===code?41:code,begin;return nok(code)};function begin(code){return code===marker?(effects.enter(markerType),effects.consume(code),effects.exit(markerType),effects.exit(type),ok):(effects.enter(stringType),atBreak(code))}function atBreak(code){return code===marker?(effects.exit(stringType),begin(marker)):null===code?nok(code):markdownLineEnding(code)?(effects.enter("lineEnding"),effects.consume(code),effects.exit("lineEnding"),factorySpace(effects,atBreak,"linePrefix")):(effects.enter("chunkString",{contentType:"string"}),inside(code))}function inside(code){return code===marker||null===code||markdownLineEnding(code)?(effects.exit("chunkString"),atBreak(code)):(effects.consume(code),92===code?escape:inside)}function escape(code){return code===marker||92===code?(effects.consume(code),inside):inside(code)}}function factoryWhitespace(effects,ok){let seen;return function start(code){if(markdownLineEnding(code))return effects.enter("lineEnding"),effects.consume(code),effects.exit("lineEnding"),seen=!0,start;if(markdownSpace(code))return factorySpace(effects,start,seen?"linePrefix":"lineSuffix")(code);return ok(code)}}const definition$1={name:"definition",tokenize:function(effects,ok,nok){const self=this;let identifier;return function(code){return effects.enter("definition"),function(code){return factoryLabel.call(self,effects,labelAfter,nok,"definitionLabel","definitionLabelMarker","definitionLabelString")(code)}(code)};function labelAfter(code){return identifier=normalizeIdentifier(self.sliceSerialize(self.events[self.events.length-1][1]).slice(1,-1)),58===code?(effects.enter("definitionMarker"),effects.consume(code),effects.exit("definitionMarker"),markerAfter):nok(code)}function markerAfter(code){return markdownLineEndingOrSpace(code)?factoryWhitespace(effects,destinationBefore)(code):destinationBefore(code)}function destinationBefore(code){return factoryDestination(effects,destinationAfter,nok,"definitionDestination","definitionDestinationLiteral","definitionDestinationLiteralMarker","definitionDestinationRaw","definitionDestinationString")(code)}function destinationAfter(code){return effects.attempt(titleBefore,after,after)(code)}function after(code){return markdownSpace(code)?factorySpace(effects,afterWhitespace,"whitespace")(code):afterWhitespace(code)}function afterWhitespace(code){return null===code||markdownLineEnding(code)?(effects.exit("definition"),self.parser.defined.push(identifier),ok(code)):nok(code)}}},titleBefore={tokenize:function(effects,ok,nok){return function(code){return markdownLineEndingOrSpace(code)?factoryWhitespace(effects,beforeMarker)(code):nok(code)};function beforeMarker(code){return factoryTitle(effects,titleAfter,nok,"definitionTitle","definitionTitleMarker","definitionTitleString")(code)}function titleAfter(code){return markdownSpace(code)?factorySpace(effects,titleAfterOptionalWhitespace,"whitespace")(code):titleAfterOptionalWhitespace(code)}function titleAfterOptionalWhitespace(code){return null===code||markdownLineEnding(code)?ok(code):nok(code)}},partial:!0};const hardBreakEscape={name:"hardBreakEscape",tokenize:function(effects,ok,nok){return function(code){return effects.enter("hardBreakEscape"),effects.consume(code),after};function after(code){return markdownLineEnding(code)?(effects.exit("hardBreakEscape"),ok(code)):nok(code)}}};const headingAtx={name:"headingAtx",tokenize:function(effects,ok,nok){let size=0;return function(code){return effects.enter("atxHeading"),function(code){return effects.enter("atxHeadingSequence"),sequenceOpen(code)}(code)};function sequenceOpen(code){return 35===code&&size++<6?(effects.consume(code),sequenceOpen):null===code||markdownLineEndingOrSpace(code)?(effects.exit("atxHeadingSequence"),atBreak(code)):nok(code)}function atBreak(code){return 35===code?(effects.enter("atxHeadingSequence"),sequenceFurther(code)):null===code||markdownLineEnding(code)?(effects.exit("atxHeading"),ok(code)):markdownSpace(code)?factorySpace(effects,atBreak,"whitespace")(code):(effects.enter("atxHeadingText"),data(code))}function sequenceFurther(code){return 35===code?(effects.consume(code),sequenceFurther):(effects.exit("atxHeadingSequence"),atBreak(code))}function data(code){return null===code||35===code||markdownLineEndingOrSpace(code)?(effects.exit("atxHeadingText"),atBreak(code)):(effects.consume(code),data)}},resolve:function(events,context){let content,text,contentEnd=events.length-2,contentStart=3;"whitespace"===events[contentStart][1].type&&(contentStart+=2);contentEnd-2>contentStart&&"whitespace"===events[contentEnd][1].type&&(contentEnd-=2);"atxHeadingSequence"===events[contentEnd][1].type&&(contentStart===contentEnd-1||contentEnd-4>contentStart&&"whitespace"===events[contentEnd-2][1].type)&&(contentEnd-=contentStart+1===contentEnd?2:4);contentEnd>contentStart&&(content={type:"atxHeadingText",start:events[contentStart][1].start,end:events[contentEnd][1].end},text={type:"chunkText",start:events[contentStart][1].start,end:events[contentEnd][1].end,contentType:"text"},splice(events,contentStart,contentEnd-contentStart+1,[["enter",content,context],["enter",text,context],["exit",text,context],["exit",content,context]]));return events}};const htmlBlockNames=["address","article","aside","base","basefont","blockquote","body","caption","center","col","colgroup","dd","details","dialog","dir","div","dl","dt","fieldset","figcaption","figure","footer","form","frame","frameset","h1","h2","h3","h4","h5","h6","head","header","hr","html","iframe","legend","li","link","main","menu","menuitem","nav","noframes","ol","optgroup","option","p","param","search","section","summary","table","tbody","td","tfoot","th","thead","title","tr","track","ul"],htmlRawNames=["pre","script","style","textarea"],htmlFlow={name:"htmlFlow",tokenize:function(effects,ok,nok){const self=this;let marker,closingTag,buffer,index,markerB;return function(code){return function(code){return effects.enter("htmlFlow"),effects.enter("htmlFlowData"),effects.consume(code),open}(code)};function open(code){return 33===code?(effects.consume(code),declarationOpen):47===code?(effects.consume(code),closingTag=!0,tagCloseStart):63===code?(effects.consume(code),marker=3,self.interrupt?ok:continuationDeclarationInside):asciiAlpha(code)?(effects.consume(code),buffer=String.fromCharCode(code),tagName):nok(code)}function declarationOpen(code){return 45===code?(effects.consume(code),marker=2,commentOpenInside):91===code?(effects.consume(code),marker=5,index=0,cdataOpenInside):asciiAlpha(code)?(effects.consume(code),marker=4,self.interrupt?ok:continuationDeclarationInside):nok(code)}function commentOpenInside(code){return 45===code?(effects.consume(code),self.interrupt?ok:continuationDeclarationInside):nok(code)}function cdataOpenInside(code){return code==="CDATA[".charCodeAt(index++)?(effects.consume(code),6===index?self.interrupt?ok:continuation:cdataOpenInside):nok(code)}function tagCloseStart(code){return asciiAlpha(code)?(effects.consume(code),buffer=String.fromCharCode(code),tagName):nok(code)}function tagName(code){if(null===code||47===code||62===code||markdownLineEndingOrSpace(code)){const slash=47===code,name=buffer.toLowerCase();return slash||closingTag||!htmlRawNames.includes(name)?htmlBlockNames.includes(buffer.toLowerCase())?(marker=6,slash?(effects.consume(code),basicSelfClosing):self.interrupt?ok(code):continuation(code)):(marker=7,self.interrupt&&!self.parser.lazy[self.now().line]?nok(code):closingTag?completeClosingTagAfter(code):completeAttributeNameBefore(code)):(marker=1,self.interrupt?ok(code):continuation(code))}return 45===code||asciiAlphanumeric(code)?(effects.consume(code),buffer+=String.fromCharCode(code),tagName):nok(code)}function basicSelfClosing(code){return 62===code?(effects.consume(code),self.interrupt?ok:continuation):nok(code)}function completeClosingTagAfter(code){return markdownSpace(code)?(effects.consume(code),completeClosingTagAfter):completeEnd(code)}function completeAttributeNameBefore(code){return 47===code?(effects.consume(code),completeEnd):58===code||95===code||asciiAlpha(code)?(effects.consume(code),completeAttributeName):markdownSpace(code)?(effects.consume(code),completeAttributeNameBefore):completeEnd(code)}function completeAttributeName(code){return 45===code||46===code||58===code||95===code||asciiAlphanumeric(code)?(effects.consume(code),completeAttributeName):completeAttributeNameAfter(code)}function completeAttributeNameAfter(code){return 61===code?(effects.consume(code),completeAttributeValueBefore):markdownSpace(code)?(effects.consume(code),completeAttributeNameAfter):completeAttributeNameBefore(code)}function completeAttributeValueBefore(code){return null===code||60===code||61===code||62===code||96===code?nok(code):34===code||39===code?(effects.consume(code),markerB=code,completeAttributeValueQuoted):markdownSpace(code)?(effects.consume(code),completeAttributeValueBefore):completeAttributeValueUnquoted(code)}function completeAttributeValueQuoted(code){return code===markerB?(effects.consume(code),markerB=null,completeAttributeValueQuotedAfter):null===code||markdownLineEnding(code)?nok(code):(effects.consume(code),completeAttributeValueQuoted)}function completeAttributeValueUnquoted(code){return null===code||34===code||39===code||47===code||60===code||61===code||62===code||96===code||markdownLineEndingOrSpace(code)?completeAttributeNameAfter(code):(effects.consume(code),completeAttributeValueUnquoted)}function completeAttributeValueQuotedAfter(code){return 47===code||62===code||markdownSpace(code)?completeAttributeNameBefore(code):nok(code)}function completeEnd(code){return 62===code?(effects.consume(code),completeAfter):nok(code)}function completeAfter(code){return null===code||markdownLineEnding(code)?continuation(code):markdownSpace(code)?(effects.consume(code),completeAfter):nok(code)}function continuation(code){return 45===code&&2===marker?(effects.consume(code),continuationCommentInside):60===code&&1===marker?(effects.consume(code),continuationRawTagOpen):62===code&&4===marker?(effects.consume(code),continuationClose):63===code&&3===marker?(effects.consume(code),continuationDeclarationInside):93===code&&5===marker?(effects.consume(code),continuationCdataInside):!markdownLineEnding(code)||6!==marker&&7!==marker?null===code||markdownLineEnding(code)?(effects.exit("htmlFlowData"),continuationStart(code)):(effects.consume(code),continuation):(effects.exit("htmlFlowData"),effects.check(blankLineBefore,continuationAfter,continuationStart)(code))}function continuationStart(code){return effects.check(nonLazyContinuationStart,continuationStartNonLazy,continuationAfter)(code)}function continuationStartNonLazy(code){return effects.enter("lineEnding"),effects.consume(code),effects.exit("lineEnding"),continuationBefore}function continuationBefore(code){return null===code||markdownLineEnding(code)?continuationStart(code):(effects.enter("htmlFlowData"),continuation(code))}function continuationCommentInside(code){return 45===code?(effects.consume(code),continuationDeclarationInside):continuation(code)}function continuationRawTagOpen(code){return 47===code?(effects.consume(code),buffer="",continuationRawEndTag):continuation(code)}function continuationRawEndTag(code){if(62===code){const name=buffer.toLowerCase();return htmlRawNames.includes(name)?(effects.consume(code),continuationClose):continuation(code)}return asciiAlpha(code)&&buffer.length<8?(effects.consume(code),buffer+=String.fromCharCode(code),continuationRawEndTag):continuation(code)}function continuationCdataInside(code){return 93===code?(effects.consume(code),continuationDeclarationInside):continuation(code)}function continuationDeclarationInside(code){return 62===code?(effects.consume(code),continuationClose):45===code&&2===marker?(effects.consume(code),continuationDeclarationInside):continuation(code)}function continuationClose(code){return null===code||markdownLineEnding(code)?(effects.exit("htmlFlowData"),continuationAfter(code)):(effects.consume(code),continuationClose)}function continuationAfter(code){return effects.exit("htmlFlow"),ok(code)}},resolveTo:function(events){let index=events.length;for(;index--&&("enter"!==events[index][0]||"htmlFlow"!==events[index][1].type););index>1&&"linePrefix"===events[index-2][1].type&&(events[index][1].start=events[index-2][1].start,events[index+1][1].start=events[index-2][1].start,events.splice(index-2,2));return events},concrete:!0},blankLineBefore={tokenize:function(effects,ok,nok){return function(code){return effects.enter("lineEnding"),effects.consume(code),effects.exit("lineEnding"),effects.attempt(blankLine,ok,nok)}},partial:!0},nonLazyContinuationStart={tokenize:function(effects,ok,nok){const self=this;return function(code){if(markdownLineEnding(code))return effects.enter("lineEnding"),effects.consume(code),effects.exit("lineEnding"),after;return nok(code)};function after(code){return self.parser.lazy[self.now().line]?nok(code):ok(code)}},partial:!0};const htmlText={name:"htmlText",tokenize:function(effects,ok,nok){const self=this;let marker,index,returnState;return function(code){return effects.enter("htmlText"),effects.enter("htmlTextData"),effects.consume(code),open};function open(code){return 33===code?(effects.consume(code),declarationOpen):47===code?(effects.consume(code),tagCloseStart):63===code?(effects.consume(code),instruction):asciiAlpha(code)?(effects.consume(code),tagOpen):nok(code)}function declarationOpen(code){return 45===code?(effects.consume(code),commentOpenInside):91===code?(effects.consume(code),index=0,cdataOpenInside):asciiAlpha(code)?(effects.consume(code),declaration):nok(code)}function commentOpenInside(code){return 45===code?(effects.consume(code),commentEnd):nok(code)}function comment(code){return null===code?nok(code):45===code?(effects.consume(code),commentClose):markdownLineEnding(code)?(returnState=comment,lineEndingBefore(code)):(effects.consume(code),comment)}function commentClose(code){return 45===code?(effects.consume(code),commentEnd):comment(code)}function commentEnd(code){return 62===code?end(code):45===code?commentClose(code):comment(code)}function cdataOpenInside(code){return code==="CDATA[".charCodeAt(index++)?(effects.consume(code),6===index?cdata:cdataOpenInside):nok(code)}function cdata(code){return null===code?nok(code):93===code?(effects.consume(code),cdataClose):markdownLineEnding(code)?(returnState=cdata,lineEndingBefore(code)):(effects.consume(code),cdata)}function cdataClose(code){return 93===code?(effects.consume(code),cdataEnd):cdata(code)}function cdataEnd(code){return 62===code?end(code):93===code?(effects.consume(code),cdataEnd):cdata(code)}function declaration(code){return null===code||62===code?end(code):markdownLineEnding(code)?(returnState=declaration,lineEndingBefore(code)):(effects.consume(code),declaration)}function instruction(code){return null===code?nok(code):63===code?(effects.consume(code),instructionClose):markdownLineEnding(code)?(returnState=instruction,lineEndingBefore(code)):(effects.consume(code),instruction)}function instructionClose(code){return 62===code?end(code):instruction(code)}function tagCloseStart(code){return asciiAlpha(code)?(effects.consume(code),tagClose):nok(code)}function tagClose(code){return 45===code||asciiAlphanumeric(code)?(effects.consume(code),tagClose):tagCloseBetween(code)}function tagCloseBetween(code){return markdownLineEnding(code)?(returnState=tagCloseBetween,lineEndingBefore(code)):markdownSpace(code)?(effects.consume(code),tagCloseBetween):end(code)}function tagOpen(code){return 45===code||asciiAlphanumeric(code)?(effects.consume(code),tagOpen):47===code||62===code||markdownLineEndingOrSpace(code)?tagOpenBetween(code):nok(code)}function tagOpenBetween(code){return 47===code?(effects.consume(code),end):58===code||95===code||asciiAlpha(code)?(effects.consume(code),tagOpenAttributeName):markdownLineEnding(code)?(returnState=tagOpenBetween,lineEndingBefore(code)):markdownSpace(code)?(effects.consume(code),tagOpenBetween):end(code)}function tagOpenAttributeName(code){return 45===code||46===code||58===code||95===code||asciiAlphanumeric(code)?(effects.consume(code),tagOpenAttributeName):tagOpenAttributeNameAfter(code)}function tagOpenAttributeNameAfter(code){return 61===code?(effects.consume(code),tagOpenAttributeValueBefore):markdownLineEnding(code)?(returnState=tagOpenAttributeNameAfter,lineEndingBefore(code)):markdownSpace(code)?(effects.consume(code),tagOpenAttributeNameAfter):tagOpenBetween(code)}function tagOpenAttributeValueBefore(code){return null===code||60===code||61===code||62===code||96===code?nok(code):34===code||39===code?(effects.consume(code),marker=code,tagOpenAttributeValueQuoted):markdownLineEnding(code)?(returnState=tagOpenAttributeValueBefore,lineEndingBefore(code)):markdownSpace(code)?(effects.consume(code),tagOpenAttributeValueBefore):(effects.consume(code),tagOpenAttributeValueUnquoted)}function tagOpenAttributeValueQuoted(code){return code===marker?(effects.consume(code),marker=void 0,tagOpenAttributeValueQuotedAfter):null===code?nok(code):markdownLineEnding(code)?(returnState=tagOpenAttributeValueQuoted,lineEndingBefore(code)):(effects.consume(code),tagOpenAttributeValueQuoted)}function tagOpenAttributeValueUnquoted(code){return null===code||34===code||39===code||60===code||61===code||96===code?nok(code):47===code||62===code||markdownLineEndingOrSpace(code)?tagOpenBetween(code):(effects.consume(code),tagOpenAttributeValueUnquoted)}function tagOpenAttributeValueQuotedAfter(code){return 47===code||62===code||markdownLineEndingOrSpace(code)?tagOpenBetween(code):nok(code)}function end(code){return 62===code?(effects.consume(code),effects.exit("htmlTextData"),effects.exit("htmlText"),ok):nok(code)}function lineEndingBefore(code){return effects.exit("htmlTextData"),effects.enter("lineEnding"),effects.consume(code),effects.exit("lineEnding"),lineEndingAfter}function lineEndingAfter(code){return markdownSpace(code)?factorySpace(effects,lineEndingAfterPrefix,"linePrefix",self.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(code):lineEndingAfterPrefix(code)}function lineEndingAfterPrefix(code){return effects.enter("htmlTextData"),returnState(code)}}};const labelEnd={name:"labelEnd",tokenize:function(effects,ok,nok){const self=this;let labelStart,defined,index=self.events.length;for(;index--;)if(("labelImage"===self.events[index][1].type||"labelLink"===self.events[index][1].type)&&!self.events[index][1]._balanced){labelStart=self.events[index][1];break}return function(code){if(!labelStart)return nok(code);if(labelStart._inactive)return labelEndNok(code);return defined=self.parser.defined.includes(normalizeIdentifier(self.sliceSerialize({start:labelStart.end,end:self.now()}))),effects.enter("labelEnd"),effects.enter("labelMarker"),effects.consume(code),effects.exit("labelMarker"),effects.exit("labelEnd"),after};function after(code){return 40===code?effects.attempt(resourceConstruct,labelEndOk,defined?labelEndOk:labelEndNok)(code):91===code?effects.attempt(referenceFullConstruct,labelEndOk,defined?referenceNotFull:labelEndNok)(code):defined?labelEndOk(code):labelEndNok(code)}function referenceNotFull(code){return effects.attempt(referenceCollapsedConstruct,labelEndOk,labelEndNok)(code)}function labelEndOk(code){return ok(code)}function labelEndNok(code){return labelStart._balanced=!0,nok(code)}},resolveTo:function(events,context){let token,open,close,media,index=events.length,offset=0;for(;index--;)if(token=events[index][1],open){if("link"===token.type||"labelLink"===token.type&&token._inactive)break;"enter"===events[index][0]&&"labelLink"===token.type&&(token._inactive=!0)}else if(close){if("enter"===events[index][0]&&("labelImage"===token.type||"labelLink"===token.type)&&!token._balanced&&(open=index,"labelLink"!==token.type)){offset=2;break}}else"labelEnd"===token.type&&(close=index);const group={type:"labelLink"===events[open][1].type?"link":"image",start:Object.assign({},events[open][1].start),end:Object.assign({},events[events.length-1][1].end)},label={type:"label",start:Object.assign({},events[open][1].start),end:Object.assign({},events[close][1].end)},text={type:"labelText",start:Object.assign({},events[open+offset+2][1].end),end:Object.assign({},events[close-2][1].start)};return media=[["enter",group,context],["enter",label,context]],media=push(media,events.slice(open+1,open+offset+3)),media=push(media,[["enter",text,context]]),media=push(media,resolveAll(context.parser.constructs.insideSpan.null,events.slice(open+offset+4,close-3),context)),media=push(media,[["exit",text,context],events[close-2],events[close-1],["exit",label,context]]),media=push(media,events.slice(close+1)),media=push(media,[["exit",group,context]]),splice(events,open,events.length,media),events},resolveAll:function(events){let index=-1;for(;++index<events.length;){const token=events[index][1];"labelImage"!==token.type&&"labelLink"!==token.type&&"labelEnd"!==token.type||(events.splice(index+1,"labelImage"===token.type?4:2),token.type="data",index++)}return events}},resourceConstruct={tokenize:function(effects,ok,nok){return function(code){return effects.enter("resource"),effects.enter("resourceMarker"),effects.consume(code),effects.exit("resourceMarker"),resourceBefore};function resourceBefore(code){return markdownLineEndingOrSpace(code)?factoryWhitespace(effects,resourceOpen)(code):resourceOpen(code)}function resourceOpen(code){return 41===code?resourceEnd(code):factoryDestination(effects,resourceDestinationAfter,resourceDestinationMissing,"resourceDestination","resourceDestinationLiteral","resourceDestinationLiteralMarker","resourceDestinationRaw","resourceDestinationString",32)(code)}function resourceDestinationAfter(code){return markdownLineEndingOrSpace(code)?factoryWhitespace(effects,resourceBetween)(code):resourceEnd(code)}function resourceDestinationMissing(code){return nok(code)}function resourceBetween(code){return 34===code||39===code||40===code?factoryTitle(effects,resourceTitleAfter,nok,"resourceTitle","resourceTitleMarker","resourceTitleString")(code):resourceEnd(code)}function resourceTitleAfter(code){return markdownLineEndingOrSpace(code)?factoryWhitespace(effects,resourceEnd)(code):resourceEnd(code)}function resourceEnd(code){return 41===code?(effects.enter("resourceMarker"),effects.consume(code),effects.exit("resourceMarker"),effects.exit("resource"),ok):nok(code)}}},referenceFullConstruct={tokenize:function(effects,ok,nok){const self=this;return function(code){return factoryLabel.call(self,effects,referenceFullAfter,referenceFullMissing,"reference","referenceMarker","referenceString")(code)};function referenceFullAfter(code){return self.parser.defined.includes(normalizeIdentifier(self.sliceSerialize(self.events[self.events.length-1][1]).slice(1,-1)))?ok(code):nok(code)}function referenceFullMissing(code){return nok(code)}}},referenceCollapsedConstruct={tokenize:function(effects,ok,nok){return function(code){return effects.enter("reference"),effects.enter("referenceMarker"),effects.consume(code),effects.exit("referenceMarker"),referenceCollapsedOpen};function referenceCollapsedOpen(code){return 93===code?(effects.enter("referenceMarker"),effects.consume(code),effects.exit("referenceMarker"),effects.exit("reference"),ok):nok(code)}}};const labelStartImage={name:"labelStartImage",tokenize:function(effects,ok,nok){const self=this;return function(code){return effects.enter("labelImage"),effects.enter("labelImageMarker"),effects.consume(code),effects.exit("labelImageMarker"),open};function open(code){return 91===code?(effects.enter("labelMarker"),effects.consume(code),effects.exit("labelMarker"),effects.exit("labelImage"),after):nok(code)}function after(code){return 94===code&&"_hiddenFootnoteSupport"in self.parser.constructs?nok(code):ok(code)}},resolveAll:labelEnd.resolveAll};const labelStartLink={name:"labelStartLink",tokenize:function(effects,ok,nok){const self=this;return function(code){return effects.enter("labelLink"),effects.enter("labelMarker"),effects.consume(code),effects.exit("labelMarker"),effects.exit("labelLink"),after};function after(code){return 94===code&&"_hiddenFootnoteSupport"in self.parser.constructs?nok(code):ok(code)}},resolveAll:labelEnd.resolveAll};const lineEnding={name:"lineEnding",tokenize:function(effects,ok){return function(code){return effects.enter("lineEnding"),effects.consume(code),effects.exit("lineEnding"),factorySpace(effects,ok,"linePrefix")}}};const thematicBreak$1={name:"thematicBreak",tokenize:function(effects,ok,nok){let marker,size=0;return function(code){return effects.enter("thematicBreak"),function(code){return marker=code,atBreak(code)}(code)};function atBreak(code){return code===marker?(effects.enter("thematicBreakSequence"),sequence(code)):size>=3&&(null===code||markdownLineEnding(code))?(effects.exit("thematicBreak"),ok(code)):nok(code)}function sequence(code){return code===marker?(effects.consume(code),size++,sequence):(effects.exit("thematicBreakSequence"),markdownSpace(code)?factorySpace(effects,atBreak,"whitespace")(code):atBreak(code))}}};const list$2={name:"list",tokenize:function(effects,ok,nok){const self=this,tail=self.events[self.events.length-1];let initialSize=tail&&"linePrefix"===tail[1].type?tail[2].sliceSerialize(tail[1],!0).length:0,size=0;return function(code){const kind=self.containerState.type||(42===code||43===code||45===code?"listUnordered":"listOrdered");if("listUnordered"===kind?!self.containerState.marker||code===self.containerState.marker:asciiDigit(code)){if(self.containerState.type||(self.containerState.type=kind,effects.enter(kind,{_container:!0})),"listUnordered"===kind)return effects.enter("listItemPrefix"),42===code||45===code?effects.check(thematicBreak$1,nok,atMarker)(code):atMarker(code);if(!self.interrupt||49===code)return effects.enter("listItemPrefix"),effects.enter("listItemValue"),inside(code)}return nok(code)};function inside(code){return asciiDigit(code)&&++size<10?(effects.consume(code),inside):(!self.interrupt||size<2)&&(self.containerState.marker?code===self.containerState.marker:41===code||46===code)?(effects.exit("listItemValue"),atMarker(code)):nok(code)}function atMarker(code){return effects.enter("listItemMarker"),effects.consume(code),effects.exit("listItemMarker"),self.containerState.marker=self.containerState.marker||code,effects.check(blankLine,self.interrupt?nok:onBlank,effects.attempt(listItemPrefixWhitespaceConstruct,endOfPrefix,otherPrefix))}function onBlank(code){return self.containerState.initialBlankLine=!0,initialSize++,endOfPrefix(code)}function otherPrefix(code){return markdownSpace(code)?(effects.enter("listItemPrefixWhitespace"),effects.consume(code),effects.exit("listItemPrefixWhitespace"),endOfPrefix):nok(code)}function endOfPrefix(code){return self.containerState.size=initialSize+self.sliceSerialize(effects.exit("listItemPrefix"),!0).length,ok(code)}},continuation:{tokenize:function(effects,ok,nok){const self=this;return self.containerState._closeFlow=void 0,effects.check(blankLine,onBlank,notBlank);function onBlank(code){return self.containerState.furtherBlankLines=self.containerState.furtherBlankLines||self.containerState.initialBlankLine,factorySpace(effects,ok,"listItemIndent",self.containerState.size+1)(code)}function notBlank(code){return self.containerState.furtherBlankLines||!markdownSpace(code)?(self.containerState.furtherBlankLines=void 0,self.containerState.initialBlankLine=void 0,notInCurrentItem(code)):(self.containerState.furtherBlankLines=void 0,self.containerState.initialBlankLine=void 0,effects.attempt(indentConstruct,ok,notInCurrentItem)(code))}function notInCurrentItem(code){return self.containerState._closeFlow=!0,self.interrupt=void 0,factorySpace(effects,effects.attempt(list$2,ok,nok),"linePrefix",self.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(code)}}},exit:function(effects){effects.exit(this.containerState.type)}},listItemPrefixWhitespaceConstruct={tokenize:function(effects,ok,nok){const self=this;return factorySpace(effects,(function(code){const tail=self.events[self.events.length-1];return!markdownSpace(code)&&tail&&"listItemPrefixWhitespace"===tail[1].type?ok(code):nok(code)}),"listItemPrefixWhitespace",self.parser.constructs.disable.null.includes("codeIndented")?void 0:5)},partial:!0},indentConstruct={tokenize:function(effects,ok,nok){const self=this;return factorySpace(effects,(function(code){const tail=self.events[self.events.length-1];return tail&&"listItemIndent"===tail[1].type&&tail[2].sliceSerialize(tail[1],!0).length===self.containerState.size?ok(code):nok(code)}),"listItemIndent",self.containerState.size+1)},partial:!0};const setextUnderline={name:"setextUnderline",tokenize:function(effects,ok,nok){const self=this;let marker;return function(code){let paragraph,index=self.events.length;for(;index--;)if("lineEnding"!==self.events[index][1].type&&"linePrefix"!==self.events[index][1].type&&"content"!==self.events[index][1].type){paragraph="paragraph"===self.events[index][1].type;break}if(!self.parser.lazy[self.now().line]&&(self.interrupt||paragraph))return effects.enter("setextHeadingLine"),marker=code,function(code){return effects.enter("setextHeadingLineSequence"),inside(code)}(code);return nok(code)};function inside(code){return code===marker?(effects.consume(code),inside):(effects.exit("setextHeadingLineSequence"),markdownSpace(code)?factorySpace(effects,after,"lineSuffix")(code):after(code))}function after(code){return null===code||markdownLineEnding(code)?(effects.exit("setextHeadingLine"),ok(code)):nok(code)}},resolveTo:function(events,context){let content,text,definition,index=events.length;for(;index--;)if("enter"===events[index][0]){if("content"===events[index][1].type){content=index;break}"paragraph"===events[index][1].type&&(text=index)}else"content"===events[index][1].type&&events.splice(index,1),definition||"definition"!==events[index][1].type||(definition=index);const heading={type:"setextHeading",start:Object.assign({},events[text][1].start),end:Object.assign({},events[events.length-1][1].end)};events[text][1].type="setextHeadingText",definition?(events.splice(text,0,["enter",heading,context]),events.splice(definition+1,0,["exit",events[content][1],context]),events[content][1].end=Object.assign({},events[definition][1].end)):events[content][1]=heading;return events.push(["exit",heading,context]),events}};const flow$1={tokenize:function(effects){const self=this,initial=effects.attempt(blankLine,(function(code){if(null===code)return void effects.consume(code);return effects.enter("lineEndingBlank"),effects.consume(code),effects.exit("lineEndingBlank"),self.currentConstruct=void 0,initial}),effects.attempt(this.parser.constructs.flowInitial,afterConstruct,factorySpace(effects,effects.attempt(this.parser.constructs.flow,afterConstruct,effects.attempt(content,afterConstruct)),"linePrefix")));return initial;function afterConstruct(code){if(null!==code)return effects.enter("lineEnding"),effects.consume(code),effects.exit("lineEnding"),self.currentConstruct=void 0,initial;effects.consume(code)}}};const resolver={resolveAll:createResolver()},string$1=initializeFactory("string"),text$2=initializeFactory("text");function initializeFactory(field){return{tokenize:function(effects){const self=this,constructs=this.parser.constructs[field],text=effects.attempt(constructs,start,notText);return start;function start(code){return atBreak(code)?text(code):notText(code)}function notText(code){if(null!==code)return effects.enter("data"),effects.consume(code),data;effects.consume(code)}function data(code){return atBreak(code)?(effects.exit("data"),text(code)):(effects.consume(code),data)}function atBreak(code){if(null===code)return!0;const list=constructs[code];let index=-1;if(list)for(;++index<list.length;){const item=list[index];if(!item.previous||item.previous.call(self,self.previous))return!0}return!1}},resolveAll:createResolver("text"===field?resolveAllLineSuffixes:void 0)}}function createResolver(extraResolver){return function(events,context){let enter,index=-1;for(;++index<=events.length;)void 0===enter?events[index]&&"data"===events[index][1].type&&(enter=index,index++):events[index]&&"data"===events[index][1].type||(index!==enter+2&&(events[enter][1].end=events[index-1][1].end,events.splice(enter+2,index-enter-2),index=enter+2),enter=void 0);return extraResolver?extraResolver(events,context):events}}function resolveAllLineSuffixes(events,context){let eventIndex=0;for(;++eventIndex<=events.length;)if((eventIndex===events.length||"lineEnding"===events[eventIndex][1].type)&&"data"===events[eventIndex-1][1].type){const data=events[eventIndex-1][1],chunks=context.sliceStream(data);let tabs,index=chunks.length,bufferIndex=-1,size=0;for(;index--;){const chunk=chunks[index];if("string"==typeof chunk){for(bufferIndex=chunk.length;32===chunk.charCodeAt(bufferIndex-1);)size++,bufferIndex--;if(bufferIndex)break;bufferIndex=-1}else if(-2===chunk)tabs=!0,size++;else if(-1!==chunk){index++;break}}if(size){const token={type:eventIndex===events.length||tabs||size<2?"lineSuffix":"hardBreakTrailing",start:{line:data.end.line,column:data.end.column-size,offset:data.end.offset-size,_index:data.start._index+index,_bufferIndex:index?bufferIndex:data.start._bufferIndex+bufferIndex},end:Object.assign({},data.end)};data.end=Object.assign({},token.start),data.start.offset===data.end.offset?Object.assign(data,token):(events.splice(eventIndex,0,["enter",token,context],["exit",token,context]),eventIndex+=2)}eventIndex++}return events}function createTokenizer(parser,initialize,from){let point=Object.assign(from?Object.assign({},from):{line:1,column:1,offset:0},{_index:0,_bufferIndex:-1});const columnStart={},resolveAllConstructs=[];let chunks=[],stack=[];const effects={consume:function(code){markdownLineEnding(code)?(point.line++,point.column=1,point.offset+=-3===code?2:1,accountForPotentialSkip()):-1!==code&&(point.column++,point.offset++);point._bufferIndex<0?point._index++:(point._bufferIndex++,point._bufferIndex===chunks[point._index].length&&(point._bufferIndex=-1,point._index++));context.previous=code},enter:function(type,fields){const token=fields||{};return token.type=type,token.start=now(),context.events.push(["enter",token,context]),stack.push(token),token},exit:function(type){const token=stack.pop();return token.end=now(),context.events.push(["exit",token,context]),token},attempt:constructFactory((function(construct,info){addResult(construct,info.from)})),check:constructFactory(onsuccessfulcheck),interrupt:constructFactory(onsuccessfulcheck,{interrupt:!0})},context={previous:null,code:null,containerState:{},events:[],parser:parser,sliceStream:sliceStream,sliceSerialize:function(token,expandTabs){return function(chunks,expandTabs){let index=-1;const result=[];let atTab;for(;++index<chunks.length;){const chunk=chunks[index];let value;if("string"==typeof chunk)value=chunk;else switch(chunk){case-5:value="\r";break;case-4:value="\n";break;case-3:value="\r\n";break;case-2:value=expandTabs?" ":"\t";break;case-1:if(!expandTabs&&atTab)continue;value=" ";break;default:value=String.fromCharCode(chunk)}atTab=-2===chunk,result.push(value)}return result.join("")}(sliceStream(token),expandTabs)},now:now,defineSkip:function(value){columnStart[value.line]=value.column,accountForPotentialSkip()},write:function(slice){if(chunks=push(chunks,slice),main(),null!==chunks[chunks.length-1])return[];return addResult(initialize,0),context.events=resolveAll(resolveAllConstructs,context.events,context),context.events}};let state=initialize.tokenize.call(context,effects);return initialize.resolveAll&&resolveAllConstructs.push(initialize),context;function sliceStream(token){return function(chunks,token){const startIndex=token.start._index,startBufferIndex=token.start._bufferIndex,endIndex=token.end._index,endBufferIndex=token.end._bufferIndex;let view;if(startIndex===endIndex)view=[chunks[startIndex].slice(startBufferIndex,endBufferIndex)];else{if(view=chunks.slice(startIndex,endIndex),startBufferIndex>-1){const head=view[0];"string"==typeof head?view[0]=head.slice(startBufferIndex):view.shift()}endBufferIndex>0&&view.push(chunks[endIndex].slice(0,endBufferIndex))}return view}(chunks,token)}function now(){const{line:line,column:column,offset:offset,_index:_index,_bufferIndex:_bufferIndex}=point;return{line:line,column:column,offset:offset,_index:_index,_bufferIndex:_bufferIndex}}function main(){let chunkIndex;for(;point._index<chunks.length;){const chunk=chunks[point._index];if("string"==typeof chunk)for(chunkIndex=point._index,point._bufferIndex<0&&(point._bufferIndex=0);point._index===chunkIndex&&point._bufferIndex<chunk.length;)go(chunk.charCodeAt(point._bufferIndex));else go(chunk)}}function go(code){state=state(code)}function onsuccessfulcheck(_,info){info.restore()}function constructFactory(onreturn,fields){return function(constructs,returnState,bogusState){let listOfConstructs,constructIndex,currentConstruct,info;return Array.isArray(constructs)?handleListOfConstructs(constructs):"tokenize"in constructs?handleListOfConstructs([constructs]):function(map){return start;function start(code){const def=null!==code&&map[code],all=null!==code&&map.null;return handleListOfConstructs([...Array.isArray(def)?def:def?[def]:[],...Array.isArray(all)?all:all?[all]:[]])(code)}}(constructs);function handleListOfConstructs(list){return listOfConstructs=list,constructIndex=0,0===list.length?bogusState:handleConstruct(list[constructIndex])}function handleConstruct(construct){return function(code){info=function(){const startPoint=now(),startPrevious=context.previous,startCurrentConstruct=context.currentConstruct,startEventsIndex=context.events.length,startStack=Array.from(stack);return{restore:restore,from:startEventsIndex};function restore(){point=startPoint,context.previous=startPrevious,context.currentConstruct=startCurrentConstruct,context.events.length=startEventsIndex,stack=startStack,accountForPotentialSkip()}}(),currentConstruct=construct,construct.partial||(context.currentConstruct=construct);if(construct.name&&context.parser.constructs.disable.null.includes(construct.name))return nok();return construct.tokenize.call(fields?Object.assign(Object.create(context),fields):context,effects,ok,nok)(code)}}function ok(code){return onreturn(currentConstruct,info),returnState}function nok(code){return info.restore(),++constructIndex<listOfConstructs.length?handleConstruct(listOfConstructs[constructIndex]):bogusState}}}function addResult(construct,from){construct.resolveAll&&!resolveAllConstructs.includes(construct)&&resolveAllConstructs.push(construct),construct.resolve&&splice(context.events,from,context.events.length-from,construct.resolve(context.events.slice(from),context)),construct.resolveTo&&(context.events=construct.resolveTo(context.events,context))}function accountForPotentialSkip(){point.line in columnStart&&point.column<2&&(point.column=columnStart[point.line],point.offset+=columnStart[point.line]-1)}}const document$1={42:list$2,43:list$2,45:list$2,48:list$2,49:list$2,50:list$2,51:list$2,52:list$2,53:list$2,54:list$2,55:list$2,56:list$2,57:list$2,62:blockQuote},contentInitial={91:definition$1},flowInitial={[-2]:codeIndented,[-1]:codeIndented,32:codeIndented},flow={35:headingAtx,42:thematicBreak$1,45:[setextUnderline,thematicBreak$1],60:htmlFlow,61:setextUnderline,95:thematicBreak$1,96:codeFenced,126:codeFenced},string={38:characterReference,92:characterEscape},text$1={[-5]:lineEnding,[-4]:lineEnding,[-3]:lineEnding,33:labelStartImage,38:characterReference,42:attention,60:[autolink,htmlText],91:labelStartLink,92:[hardBreakEscape,characterEscape],93:labelEnd,95:attention,96:codeText},insideSpan={null:[attention,resolver]};var defaultConstructs=Object.freeze({__proto__:null,attentionMarkers:{null:[42,95]},contentInitial:contentInitial,disable:{null:[]},document:document$1,flow:flow,flowInitial:flowInitial,insideSpan:insideSpan,string:string,text:text$1});function parse(options){const constructs=function(extensions){const all={};let index=-1;for(;++index<extensions.length;)syntaxExtension(all,extensions[index]);return all}([defaultConstructs,...(options||{}).extensions||[]]),parser={defined:[],lazy:{},constructs:constructs,content:create(content$1),document:create(document$2),flow:create(flow$1),string:create(string$1),text:create(text$2)};return parser;function create(initial){return function(from){return createTokenizer(parser,initial,from)}}}const search=/[\0\t\n\r]/g;const characterEscapeOrReference=/\\([!-/:-@[-`{-~])|&(#(?:\d{1,7}|x[\da-f]{1,6})|[\da-z]{1,31});/gi;function decodeString(value){return value.replace(characterEscapeOrReference,decode)}function decode($0,$1,$2){if($1)return $1;if(35===$2.charCodeAt(0)){const head=$2.charCodeAt(1),hex=120===head||88===head;return decodeNumericCharacterReference($2.slice(hex?2:1),hex?16:10)}return decodeNamedCharacterReference($2)||$0}function stringifyPosition(value){return value&&"object"==typeof value?"position"in value||"type"in value?position(value.position):"start"in value||"end"in value?position(value):"line"in value||"column"in value?point$1(value):"":""}function point$1(point){return index(point&&point.line)+":"+index(point&&point.column)}function position(pos){return point$1(pos&&pos.start)+"-"+point$1(pos&&pos.end)}function index(value){return value&&"number"==typeof value?value:1}const own$3={}.hasOwnProperty;function fromMarkdown(value,encoding,options){return"string"!=typeof encoding&&(options=encoding,encoding=void 0),function(options){const config={transforms:[],canContainEols:["emphasis","fragment","heading","paragraph","strong"],enter:{autolink:opener(link),autolinkProtocol:onenterdata,autolinkEmail:onenterdata,atxHeading:opener(heading),blockQuote:opener(blockQuote),characterEscape:onenterdata,characterReference:onenterdata,codeFenced:opener(codeFlow),codeFencedFenceInfo:buffer,codeFencedFenceMeta:buffer,codeIndented:opener(codeFlow,buffer),codeText:opener(codeText,buffer),codeTextData:onenterdata,data:onenterdata,codeFlowValue:onenterdata,definition:opener(definition),definitionDestinationString:buffer,definitionLabelString:buffer,definitionTitleString:buffer,emphasis:opener(emphasis),hardBreakEscape:opener(hardBreak),hardBreakTrailing:opener(hardBreak),htmlFlow:opener(html,buffer),htmlFlowData:onenterdata,htmlText:opener(html,buffer),htmlTextData:onenterdata,image:opener(image),label:buffer,link:opener(link),listItem:opener(listItem),listItemValue:onenterlistitemvalue,listOrdered:opener(list,onenterlistordered),listUnordered:opener(list),paragraph:opener(paragraph),reference:onenterreference,referenceString:buffer,resourceDestinationString:buffer,resourceTitleString:buffer,setextHeading:opener(heading),strong:opener(strong),thematicBreak:opener(thematicBreak)},exit:{atxHeading:closer(),atxHeadingSequence:onexitatxheadingsequence,autolink:closer(),autolinkEmail:onexitautolinkemail,autolinkProtocol:onexitautolinkprotocol,blockQuote:closer(),characterEscapeValue:onexitdata,characterReferenceMarkerHexadecimal:onexitcharacterreferencemarker,characterReferenceMarkerNumeric:onexitcharacterreferencemarker,characterReferenceValue:onexitcharacterreferencevalue,codeFenced:closer(onexitcodefenced),codeFencedFence:onexitcodefencedfence,codeFencedFenceInfo:onexitcodefencedfenceinfo,codeFencedFenceMeta:onexitcodefencedfencemeta,codeFlowValue:onexitdata,codeIndented:closer(onexitcodeindented),codeText:closer(onexitcodetext),codeTextData:onexitdata,data:onexitdata,definition:closer(),definitionDestinationString:onexitdefinitiondestinationstring,definitionLabelString:onexitdefinitionlabelstring,definitionTitleString:onexitdefinitiontitlestring,emphasis:closer(),hardBreakEscape:closer(onexithardbreak),hardBreakTrailing:closer(onexithardbreak),htmlFlow:closer(onexithtmlflow),htmlFlowData:onexitdata,htmlText:closer(onexithtmltext),htmlTextData:onexitdata,image:closer(onexitimage),label:onexitlabel,labelText:onexitlabeltext,lineEnding:onexitlineending,link:closer(onexitlink),listItem:closer(),listOrdered:closer(),listUnordered:closer(),paragraph:closer(),referenceString:onexitreferencestring,resourceDestinationString:onexitresourcedestinationstring,resourceTitleString:onexitresourcetitlestring,resource:onexitresource,setextHeading:closer(onexitsetextheading),setextHeadingLineSequence:onexitsetextheadinglinesequence,setextHeadingText:onexitsetextheadingtext,strong:closer(),thematicBreak:closer()}};configure$1(config,(options||{}).mdastExtensions||[]);const data={};return compile;function compile(events){let tree={type:"root",children:[]};const context={stack:[tree],tokenStack:[],config:config,enter:enter,exit:exit,buffer:buffer,resume:resume,data:data},listStack=[];let index=-1;for(;++index<events.length;)if("listOrdered"===events[index][1].type||"listUnordered"===events[index][1].type)if("enter"===events[index][0])listStack.push(index);else{index=prepareList(events,listStack.pop(),index)}for(index=-1;++index<events.length;){const handler=config[events[index][0]];own$3.call(handler,events[index][1].type)&&handler[events[index][1].type].call(Object.assign({sliceSerialize:events[index][2].sliceSerialize},context),events[index][1])}if(context.tokenStack.length>0){const tail=context.tokenStack[context.tokenStack.length-1];(tail[1]||defaultOnError).call(context,void 0,tail[0])}for(tree.position={start:point(events.length>0?events[0][1].start:{line:1,column:1,offset:0}),end:point(events.length>0?events[events.length-2][1].end:{line:1,column:1,offset:0})},index=-1;++index<config.transforms.length;)tree=config.transforms[index](tree)||tree;return tree}function prepareList(events,start,length){let listItem,lineIndex,firstBlankLineIndex,atMarker,index=start-1,containerBalance=-1,listSpread=!1;for(;++index<=length;){const event=events[index];switch(event[1].type){case"listUnordered":case"listOrdered":case"blockQuote":"enter"===event[0]?containerBalance++:containerBalance--,atMarker=void 0;break;case"lineEndingBlank":"enter"===event[0]&&(!listItem||atMarker||containerBalance||firstBlankLineIndex||(firstBlankLineIndex=index),atMarker=void 0);break;case"linePrefix":case"listItemValue":case"listItemMarker":case"listItemPrefix":case"listItemPrefixWhitespace":break;default:atMarker=void 0}if(!containerBalance&&"enter"===event[0]&&"listItemPrefix"===event[1].type||-1===containerBalance&&"exit"===event[0]&&("listUnordered"===event[1].type||"listOrdered"===event[1].type)){if(listItem){let tailIndex=index;for(lineIndex=void 0;tailIndex--;){const tailEvent=events[tailIndex];if("lineEnding"===tailEvent[1].type||"lineEndingBlank"===tailEvent[1].type){if("exit"===tailEvent[0])continue;lineIndex&&(events[lineIndex][1].type="lineEndingBlank",listSpread=!0),tailEvent[1].type="lineEnding",lineIndex=tailIndex}else if("linePrefix"!==tailEvent[1].type&&"blockQuotePrefix"!==tailEvent[1].type&&"blockQuotePrefixWhitespace"!==tailEvent[1].type&&"blockQuoteMarker"!==tailEvent[1].type&&"listItemIndent"!==tailEvent[1].type)break}firstBlankLineIndex&&(!lineIndex||firstBlankLineIndex<lineIndex)&&(listItem._spread=!0),listItem.end=Object.assign({},lineIndex?events[lineIndex][1].start:event[1].end),events.splice(lineIndex||index,0,["exit",listItem,event[2]]),index++,length++}if("listItemPrefix"===event[1].type){const item={type:"listItem",_spread:!1,start:Object.assign({},event[1].start),end:void 0};listItem=item,events.splice(index,0,["enter",item,event[2]]),index++,length++,firstBlankLineIndex=void 0,atMarker=!0}}}return events[start][1]._spread=listSpread,length}function opener(create,and){return open;function open(token){enter.call(this,create(token),token),and&&and.call(this,token)}}function buffer(){this.stack.push({type:"fragment",children:[]})}function enter(node,token,errorHandler){this.stack[this.stack.length-1].children.push(node),this.stack.push(node),this.tokenStack.push([token,errorHandler]),node.position={start:point(token.start),end:void 0}}function closer(and){return close;function close(token){and&&and.call(this,token),exit.call(this,token)}}function exit(token,onExitError){const node=this.stack.pop(),open=this.tokenStack.pop();if(!open)throw new Error("Cannot close `"+token.type+"` ("+stringifyPosition({start:token.start,end:token.end})+"): its not open");if(open[0].type!==token.type)if(onExitError)onExitError.call(this,token,open[0]);else{(open[1]||defaultOnError).call(this,token,open[0])}node.position.end=point(token.end)}function resume(){return toString(this.stack.pop())}function onenterlistordered(){this.data.expectingFirstListItemValue=!0}function onenterlistitemvalue(token){if(this.data.expectingFirstListItemValue){this.stack[this.stack.length-2].start=Number.parseInt(this.sliceSerialize(token),10),this.data.expectingFirstListItemValue=void 0}}function onexitcodefencedfenceinfo(){const data=this.resume();this.stack[this.stack.length-1].lang=data}function onexitcodefencedfencemeta(){const data=this.resume();this.stack[this.stack.length-1].meta=data}function onexitcodefencedfence(){this.data.flowCodeInside||(this.buffer(),this.data.flowCodeInside=!0)}function onexitcodefenced(){const data=this.resume();this.stack[this.stack.length-1].value=data.replace(/^(\r?\n|\r)|(\r?\n|\r)$/g,""),this.data.flowCodeInside=void 0}function onexitcodeindented(){const data=this.resume();this.stack[this.stack.length-1].value=data.replace(/(\r?\n|\r)$/g,"")}function onexitdefinitionlabelstring(token){const label=this.resume(),node=this.stack[this.stack.length-1];node.label=label,node.identifier=normalizeIdentifier(this.sliceSerialize(token)).toLowerCase()}function onexitdefinitiontitlestring(){const data=this.resume();this.stack[this.stack.length-1].title=data}function onexitdefinitiondestinationstring(){const data=this.resume();this.stack[this.stack.length-1].url=data}function onexitatxheadingsequence(token){const node=this.stack[this.stack.length-1];if(!node.depth){const depth=this.sliceSerialize(token).length;node.depth=depth}}function onexitsetextheadingtext(){this.data.setextHeadingSlurpLineEnding=!0}function onexitsetextheadinglinesequence(token){this.stack[this.stack.length-1].depth=61===this.sliceSerialize(token).codePointAt(0)?1:2}function onexitsetextheading(){this.data.setextHeadingSlurpLineEnding=void 0}function onenterdata(token){const siblings=this.stack[this.stack.length-1].children;let tail=siblings[siblings.length-1];tail&&"text"===tail.type||(tail=text(),tail.position={start:point(token.start),end:void 0},siblings.push(tail)),this.stack.push(tail)}function onexitdata(token){const tail=this.stack.pop();tail.value+=this.sliceSerialize(token),tail.position.end=point(token.end)}function onexitlineending(token){const context=this.stack[this.stack.length-1];if(this.data.atHardBreak){return context.children[context.children.length-1].position.end=point(token.end),void(this.data.atHardBreak=void 0)}!this.data.setextHeadingSlurpLineEnding&&config.canContainEols.includes(context.type)&&(onenterdata.call(this,token),onexitdata.call(this,token))}function onexithardbreak(){this.data.atHardBreak=!0}function onexithtmlflow(){const data=this.resume();this.stack[this.stack.length-1].value=data}function onexithtmltext(){const data=this.resume();this.stack[this.stack.length-1].value=data}function onexitcodetext(){const data=this.resume();this.stack[this.stack.length-1].value=data}function onexitlink(){const node=this.stack[this.stack.length-1];if(this.data.inReference){const referenceType=this.data.referenceType||"shortcut";node.type+="Reference",node.referenceType=referenceType,delete node.url,delete node.title}else delete node.identifier,delete node.label;this.data.referenceType=void 0}function onexitimage(){const node=this.stack[this.stack.length-1];if(this.data.inReference){const referenceType=this.data.referenceType||"shortcut";node.type+="Reference",node.referenceType=referenceType,delete node.url,delete node.title}else delete node.identifier,delete node.label;this.data.referenceType=void 0}function onexitlabeltext(token){const string=this.sliceSerialize(token),ancestor=this.stack[this.stack.length-2];ancestor.label=decodeString(string),ancestor.identifier=normalizeIdentifier(string).toLowerCase()}function onexitlabel(){const fragment=this.stack[this.stack.length-1],value=this.resume(),node=this.stack[this.stack.length-1];if(this.data.inReference=!0,"link"===node.type){const children=fragment.children;node.children=children}else node.alt=value}function onexitresourcedestinationstring(){const data=this.resume();this.stack[this.stack.length-1].url=data}function onexitresourcetitlestring(){const data=this.resume();this.stack[this.stack.length-1].title=data}function onexitresource(){this.data.inReference=void 0}function onenterreference(){this.data.referenceType="collapsed"}function onexitreferencestring(token){const label=this.resume(),node=this.stack[this.stack.length-1];node.label=label,node.identifier=normalizeIdentifier(this.sliceSerialize(token)).toLowerCase(),this.data.referenceType="full"}function onexitcharacterreferencemarker(token){this.data.characterReferenceType=token.type}function onexitcharacterreferencevalue(token){const data=this.sliceSerialize(token),type=this.data.characterReferenceType;let value;if(type)value=decodeNumericCharacterReference(data,"characterReferenceMarkerNumeric"===type?10:16),this.data.characterReferenceType=void 0;else{value=decodeNamedCharacterReference(data)}const tail=this.stack.pop();tail.value+=value,tail.position.end=point(token.end)}function onexitautolinkprotocol(token){onexitdata.call(this,token);this.stack[this.stack.length-1].url=this.sliceSerialize(token)}function onexitautolinkemail(token){onexitdata.call(this,token);this.stack[this.stack.length-1].url="mailto:"+this.sliceSerialize(token)}function blockQuote(){return{type:"blockquote",children:[]}}function codeFlow(){return{type:"code",lang:null,meta:null,value:""}}function codeText(){return{type:"inlineCode",value:""}}function definition(){return{type:"definition",identifier:"",label:null,title:null,url:""}}function emphasis(){return{type:"emphasis",children:[]}}function heading(){return{type:"heading",depth:0,children:[]}}function hardBreak(){return{type:"break"}}function html(){return{type:"html",value:""}}function image(){return{type:"image",title:null,url:"",alt:null}}function link(){return{type:"link",title:null,url:"",children:[]}}function list(token){return{type:"list",ordered:"listOrdered"===token.type,start:null,spread:token._spread,children:[]}}function listItem(token){return{type:"listItem",spread:token._spread,checked:null,children:[]}}function paragraph(){return{type:"paragraph",children:[]}}function strong(){return{type:"strong",children:[]}}function text(){return{type:"text",value:""}}function thematicBreak(){return{type:"thematicBreak"}}}(options)(function(events){for(;!subtokenize(events););return events}(parse(options).document().write(function(){let atCarriageReturn,column=1,buffer="",start=!0;return function(value,encoding,end){const chunks=[];let match,next,startPosition,endPosition,code;for(value=buffer+("string"==typeof value?value.toString():new TextDecoder(encoding||void 0).decode(value)),startPosition=0,buffer="",start&&(65279===value.charCodeAt(0)&&startPosition++,start=void 0);startPosition<value.length;){if(search.lastIndex=startPosition,match=search.exec(value),endPosition=match&&void 0!==match.index?match.index:value.length,code=value.charCodeAt(endPosition),!match){buffer=value.slice(startPosition);break}if(10===code&&startPosition===endPosition&&atCarriageReturn)chunks.push(-3),atCarriageReturn=void 0;else switch(atCarriageReturn&&(chunks.push(-5),atCarriageReturn=void 0),startPosition<endPosition&&(chunks.push(value.slice(startPosition,endPosition)),column+=endPosition-startPosition),code){case 0:chunks.push(65533),column++;break;case 9:for(next=4*Math.ceil(column/4),chunks.push(-2);column++<next;)chunks.push(-1);break;case 10:chunks.push(-4),column=1;break;default:atCarriageReturn=!0,column=1}startPosition=endPosition+1}return end&&(atCarriageReturn&&chunks.push(-5),buffer&&chunks.push(buffer),chunks.push(null)),chunks}}()(value,encoding,!0))))}function point(d){return{line:d.line,column:d.column,offset:d.offset}}function configure$1(combined,extensions){let index=-1;for(;++index<extensions.length;){const value=extensions[index];Array.isArray(value)?configure$1(combined,value):extension(combined,value)}}function extension(combined,extension){let key;for(key in extension)if(own$3.call(extension,key))switch(key){case"canContainEols":{const right=extension[key];right&&combined[key].push(...right);break}case"transforms":{const right=extension[key];right&&combined[key].push(...right);break}case"enter":case"exit":{const right=extension[key];right&&Object.assign(combined[key],right);break}}}function defaultOnError(left,right){throw left?new Error("Cannot close `"+left.type+"` ("+stringifyPosition({start:left.start,end:left.end})+"): a different token (`"+right.type+"`, "+stringifyPosition({start:right.start,end:right.end})+") is open"):new Error("Cannot close document, a token (`"+right.type+"`, "+stringifyPosition({start:right.start,end:right.end})+") is still open")}function remarkParse(options){const self=this;self.parser=function(doc){return fromMarkdown(doc,{...self.data("settings"),...options,extensions:self.data("micromarkExtensions")||[],mdastExtensions:self.data("fromMarkdownExtensions")||[]})}}const own$2={}.hasOwnProperty;const own$1={}.hasOwnProperty;function configure(base,extension){let key,index=-1;if(extension.extensions)for(;++index<extension.extensions.length;)configure(base,extension.extensions[index]);for(key in extension)if(own$1.call(extension,key))switch(key){case"extensions":break;case"unsafe":case"join":list$1(base[key],extension[key]);break;case"handlers":map$2(base[key],extension[key]);break;default:base.options[key]=extension[key]}return base}function list$1(left,right){right&&left.push(...right)}function map$2(left,right){right&&Object.assign(left,right)}function map$1(line,_,blank){return">"+(blank?"":" ")+line}function patternInScope(stack,pattern){return listInScope(stack,pattern.inConstruct,!0)&&!listInScope(stack,pattern.notInConstruct,!1)}function listInScope(stack,list,none){if("string"==typeof list&&(list=[list]),!list||0===list.length)return none;let index=-1;for(;++index<list.length;)if(stack.includes(list[index]))return!0;return!1}function hardBreak(_,_1,state,info){let index=-1;for(;++index<state.unsafe.length;)if("\n"===state.unsafe[index].character&&patternInScope(state.stack,state.unsafe[index]))return/[ \t]/.test(info.before)?"":" ";return"\\\n"}function formatCodeAsIndented(node,state){return Boolean(!1===state.options.fences&&node.value&&!node.lang&&/[^ \r\n]/.test(node.value)&&!/^[\t ]*(?:[\r\n]|$)|(?:^|[\r\n])[\t ]*$/.test(node.value))}function map(line,_,blank){return(blank?"":"    ")+line}function checkQuote(state){const marker=state.options.quote||'"';if('"'!==marker&&"'"!==marker)throw new Error("Cannot serialize title with `"+marker+"` for `options.quote`, expected `\"`, or `'`");return marker}function emphasis(node,_,state,info){const marker=function(state){const marker=state.options.emphasis||"*";if("*"!==marker&&"_"!==marker)throw new Error("Cannot serialize emphasis with `"+marker+"` for `options.emphasis`, expected `*`, or `_`");return marker}(state),exit=state.enter("emphasis"),tracker=state.createTracker(info);let value=tracker.move(marker);return value+=tracker.move(state.containerPhrasing(node,{before:value,after:marker,...tracker.current()})),value+=tracker.move(marker),exit(),value}emphasis.peek=function(_,_1,state){return state.options.emphasis||"*"};const convert=function(test){if(null==test)return ok;if("function"==typeof test)return castFactory(test);if("object"==typeof test)return Array.isArray(test)?function(tests){const checks=[];let index=-1;for(;++index<tests.length;)checks[index]=convert(tests[index]);return castFactory(any);function any(...parameters){let index=-1;for(;++index<checks.length;)if(checks[index].apply(this,parameters))return!0;return!1}}(test):function(check){const checkAsRecord=check;return castFactory(all);function all(node){const nodeAsRecord=node;let key;for(key in check)if(nodeAsRecord[key]!==checkAsRecord[key])return!1;return!0}}(test);if("string"==typeof test)return function(check){return castFactory(type);function type(node){return node&&node.type===check}}(test);throw new Error("Expected function, string, or object as test")};function castFactory(testFunction){return function(value,index,parent){return Boolean(function(value){return null!==value&&"object"==typeof value&&"type"in value}(value)&&testFunction.call(this,value,"number"==typeof index?index:void 0,parent||void 0))}}function ok(){return!0}const empty$1=[],CONTINUE=!0,EXIT=!1,SKIP="skip";function visitParents(tree,test,visitor,reverse){let check;"function"==typeof test&&"function"!=typeof visitor?(reverse=visitor,visitor=test):check=test;const is=convert(check),step=reverse?-1:1;!function factory(node,index,parents){const value=node&&"object"==typeof node?node:{};if("string"==typeof value.type){const name="string"==typeof value.tagName?value.tagName:"string"==typeof value.name?value.name:void 0;Object.defineProperty(visit,"name",{value:"node ("+node.type+(name?"<"+name+">":"")+")"})}return visit;function visit(){let subresult,offset,grandparents,result=empty$1;if((!test||is(node,index,parents[parents.length-1]||void 0))&&(result=function(value){if(Array.isArray(value))return value;if("number"==typeof value)return[CONTINUE,value];return null==value?empty$1:[value]}(visitor(node,parents)),result[0]===EXIT))return result;if("children"in node&&node.children){const nodeAsParent=node;if(nodeAsParent.children&&result[0]!==SKIP)for(offset=(reverse?nodeAsParent.children.length:-1)+step,grandparents=parents.concat(nodeAsParent);offset>-1&&offset<nodeAsParent.children.length;){const child=nodeAsParent.children[offset];if(subresult=factory(child,offset,grandparents)(),subresult[0]===EXIT)return subresult;offset="number"==typeof subresult[1]?subresult[1]:offset+step}}return result}}(tree,void 0,[])()}function visit(tree,testOrVisitor,visitorOrReverse,maybeReverse){let reverse,test,visitor;"function"==typeof testOrVisitor&&"function"!=typeof visitorOrReverse?(test=void 0,visitor=testOrVisitor,reverse=visitorOrReverse):(test=testOrVisitor,visitor=visitorOrReverse,reverse=maybeReverse),visitParents(tree,test,(function(node,parents){const parent=parents[parents.length-1],index=parent?parent.children.indexOf(node):void 0;return visitor(node,index,parent)}),reverse)}function formatHeadingAsSetext(node,state){let literalWithBreak=!1;return visit(node,(function(node){if("value"in node&&/\r?\n|\r/.test(node.value)||"break"===node.type)return literalWithBreak=!0,EXIT})),Boolean((!node.depth||node.depth<3)&&toString(node)&&(state.options.setext||literalWithBreak))}function html(node){return node.value||""}function image(node,_,state,info){const quote=checkQuote(state),suffix='"'===quote?"Quote":"Apostrophe",exit=state.enter("image");let subexit=state.enter("label");const tracker=state.createTracker(info);let value=tracker.move("![");return value+=tracker.move(state.safe(node.alt,{before:value,after:"]",...tracker.current()})),value+=tracker.move("]("),subexit(),!node.url&&node.title||/[\0- \u007F]/.test(node.url)?(subexit=state.enter("destinationLiteral"),value+=tracker.move("<"),value+=tracker.move(state.safe(node.url,{before:value,after:">",...tracker.current()})),value+=tracker.move(">")):(subexit=state.enter("destinationRaw"),value+=tracker.move(state.safe(node.url,{before:value,after:node.title?" ":")",...tracker.current()}))),subexit(),node.title&&(subexit=state.enter(`title${suffix}`),value+=tracker.move(" "+quote),value+=tracker.move(state.safe(node.title,{before:value,after:quote,...tracker.current()})),value+=tracker.move(quote),subexit()),value+=tracker.move(")"),exit(),value}function imageReference(node,_,state,info){const type=node.referenceType,exit=state.enter("imageReference");let subexit=state.enter("label");const tracker=state.createTracker(info);let value=tracker.move("![");const alt=state.safe(node.alt,{before:value,after:"]",...tracker.current()});value+=tracker.move(alt+"]["),subexit();const stack=state.stack;state.stack=[],subexit=state.enter("reference");const reference=state.safe(state.associationId(node),{before:value,after:"]",...tracker.current()});return subexit(),state.stack=stack,exit(),"full"!==type&&alt&&alt===reference?"shortcut"===type?value=value.slice(0,-1):value+=tracker.move("]"):value+=tracker.move(reference+"]"),value}function inlineCode(node,_,state){let value=node.value||"",sequence="`",index=-1;for(;new RegExp("(^|[^`])"+sequence+"([^`]|$)").test(value);)sequence+="`";for(/[^ \r\n]/.test(value)&&(/^[ \r\n]/.test(value)&&/[ \r\n]$/.test(value)||/^`|`$/.test(value))&&(value=" "+value+" ");++index<state.unsafe.length;){const pattern=state.unsafe[index],expression=state.compilePattern(pattern);let match;if(pattern.atBreak)for(;match=expression.exec(value);){let position=match.index;10===value.charCodeAt(position)&&13===value.charCodeAt(position-1)&&position--,value=value.slice(0,position)+" "+value.slice(match.index+1)}}return sequence+value+sequence}function formatLinkAsAutolink(node,state){const raw=toString(node);return Boolean(!state.options.resourceLink&&node.url&&!node.title&&node.children&&1===node.children.length&&"text"===node.children[0].type&&(raw===node.url||"mailto:"+raw===node.url)&&/^[a-z][a-z+.-]+:/i.test(node.url)&&!/[\0- <>\u007F]/.test(node.url))}function link(node,_,state,info){const quote=checkQuote(state),suffix='"'===quote?"Quote":"Apostrophe",tracker=state.createTracker(info);let exit,subexit;if(formatLinkAsAutolink(node,state)){const stack=state.stack;state.stack=[],exit=state.enter("autolink");let value=tracker.move("<");return value+=tracker.move(state.containerPhrasing(node,{before:value,after:">",...tracker.current()})),value+=tracker.move(">"),exit(),state.stack=stack,value}exit=state.enter("link"),subexit=state.enter("label");let value=tracker.move("[");return value+=tracker.move(state.containerPhrasing(node,{before:value,after:"](",...tracker.current()})),value+=tracker.move("]("),subexit(),!node.url&&node.title||/[\0- \u007F]/.test(node.url)?(subexit=state.enter("destinationLiteral"),value+=tracker.move("<"),value+=tracker.move(state.safe(node.url,{before:value,after:">",...tracker.current()})),value+=tracker.move(">")):(subexit=state.enter("destinationRaw"),value+=tracker.move(state.safe(node.url,{before:value,after:node.title?" ":")",...tracker.current()}))),subexit(),node.title&&(subexit=state.enter(`title${suffix}`),value+=tracker.move(" "+quote),value+=tracker.move(state.safe(node.title,{before:value,after:quote,...tracker.current()})),value+=tracker.move(quote),subexit()),value+=tracker.move(")"),exit(),value}function linkReference(node,_,state,info){const type=node.referenceType,exit=state.enter("linkReference");let subexit=state.enter("label");const tracker=state.createTracker(info);let value=tracker.move("[");const text=state.containerPhrasing(node,{before:value,after:"]",...tracker.current()});value+=tracker.move(text+"]["),subexit();const stack=state.stack;state.stack=[],subexit=state.enter("reference");const reference=state.safe(state.associationId(node),{before:value,after:"]",...tracker.current()});return subexit(),state.stack=stack,exit(),"full"!==type&&text&&text===reference?"shortcut"===type?value=value.slice(0,-1):value+=tracker.move("]"):value+=tracker.move(reference+"]"),value}function checkBullet(state){const marker=state.options.bullet||"*";if("*"!==marker&&"+"!==marker&&"-"!==marker)throw new Error("Cannot serialize items with `"+marker+"` for `options.bullet`, expected `*`, `+`, or `-`");return marker}function checkRule(state){const marker=state.options.rule||"*";if("*"!==marker&&"-"!==marker&&"_"!==marker)throw new Error("Cannot serialize rules with `"+marker+"` for `options.rule`, expected `*`, `-`, or `_`");return marker}html.peek=function(){return"<"},image.peek=function(){return"!"},imageReference.peek=function(){return"!"},inlineCode.peek=function(){return"`"},link.peek=function(node,_,state){return formatLinkAsAutolink(node,state)?"<":"["},linkReference.peek=function(){return"["};const phrasing=convert(["break","delete","emphasis","footnote","footnoteReference","image","imageReference","inlineCode","inlineMath","link","linkReference","mdxJsxTextElement","mdxTextExpression","strong","text","textDirective"]);function strong(node,_,state,info){const marker=function(state){const marker=state.options.strong||"*";if("*"!==marker&&"_"!==marker)throw new Error("Cannot serialize strong with `"+marker+"` for `options.strong`, expected `*`, or `_`");return marker}(state),exit=state.enter("strong"),tracker=state.createTracker(info);let value=tracker.move(marker+marker);return value+=tracker.move(state.containerPhrasing(node,{before:value,after:marker,...tracker.current()})),value+=tracker.move(marker+marker),exit(),value}strong.peek=function(_,_1,state){return state.options.strong||"*"};const handle={blockquote:function(node,_,state,info){const exit=state.enter("blockquote"),tracker=state.createTracker(info);tracker.move("> "),tracker.shift(2);const value=state.indentLines(state.containerFlow(node,tracker.current()),map$1);return exit(),value},break:hardBreak,code:function(node,_,state,info){const marker=function(state){const marker=state.options.fence||"`";if("`"!==marker&&"~"!==marker)throw new Error("Cannot serialize code with `"+marker+"` for `options.fence`, expected `` ` `` or `~`");return marker}(state),raw=node.value||"",suffix="`"===marker?"GraveAccent":"Tilde";if(formatCodeAsIndented(node,state)){const exit=state.enter("codeIndented"),value=state.indentLines(raw,map);return exit(),value}const tracker=state.createTracker(info),sequence=marker.repeat(Math.max(function(value,substring){const source=String(value);let index=source.indexOf(substring),expected=index,count=0,max=0;if("string"!=typeof substring)throw new TypeError("Expected substring");for(;-1!==index;)index===expected?++count>max&&(max=count):count=1,expected=index+substring.length,index=source.indexOf(substring,expected);return max}(raw,marker)+1,3)),exit=state.enter("codeFenced");let value=tracker.move(sequence);if(node.lang){const subexit=state.enter(`codeFencedLang${suffix}`);value+=tracker.move(state.safe(node.lang,{before:value,after:" ",encode:["`"],...tracker.current()})),subexit()}if(node.lang&&node.meta){const subexit=state.enter(`codeFencedMeta${suffix}`);value+=tracker.move(" "),value+=tracker.move(state.safe(node.meta,{before:value,after:"\n",encode:["`"],...tracker.current()})),subexit()}return value+=tracker.move("\n"),raw&&(value+=tracker.move(raw+"\n")),value+=tracker.move(sequence),exit(),value},definition:function(node,_,state,info){const quote=checkQuote(state),suffix='"'===quote?"Quote":"Apostrophe",exit=state.enter("definition");let subexit=state.enter("label");const tracker=state.createTracker(info);let value=tracker.move("[");return value+=tracker.move(state.safe(state.associationId(node),{before:value,after:"]",...tracker.current()})),value+=tracker.move("]: "),subexit(),!node.url||/[\0- \u007F]/.test(node.url)?(subexit=state.enter("destinationLiteral"),value+=tracker.move("<"),value+=tracker.move(state.safe(node.url,{before:value,after:">",...tracker.current()})),value+=tracker.move(">")):(subexit=state.enter("destinationRaw"),value+=tracker.move(state.safe(node.url,{before:value,after:node.title?" ":"\n",...tracker.current()}))),subexit(),node.title&&(subexit=state.enter(`title${suffix}`),value+=tracker.move(" "+quote),value+=tracker.move(state.safe(node.title,{before:value,after:quote,...tracker.current()})),value+=tracker.move(quote),subexit()),exit(),value},emphasis:emphasis,hardBreak:hardBreak,heading:function(node,_,state,info){const rank=Math.max(Math.min(6,node.depth||1),1),tracker=state.createTracker(info);if(formatHeadingAsSetext(node,state)){const exit=state.enter("headingSetext"),subexit=state.enter("phrasing"),value=state.containerPhrasing(node,{...tracker.current(),before:"\n",after:"\n"});return subexit(),exit(),value+"\n"+(1===rank?"=":"-").repeat(value.length-(Math.max(value.lastIndexOf("\r"),value.lastIndexOf("\n"))+1))}const sequence="#".repeat(rank),exit=state.enter("headingAtx"),subexit=state.enter("phrasing");tracker.move(sequence+" ");let value=state.containerPhrasing(node,{before:"# ",after:"\n",...tracker.current()});return/^[\t ]/.test(value)&&(value="&#x"+value.charCodeAt(0).toString(16).toUpperCase()+";"+value.slice(1)),value=value?sequence+" "+value:sequence,state.options.closeAtx&&(value+=" "+sequence),subexit(),exit(),value},html:html,image:image,imageReference:imageReference,inlineCode:inlineCode,link:link,linkReference:linkReference,list:function(node,parent,state,info){const exit=state.enter("list"),bulletCurrent=state.bulletCurrent;let bullet=node.ordered?function(state){const marker=state.options.bulletOrdered||".";if("."!==marker&&")"!==marker)throw new Error("Cannot serialize items with `"+marker+"` for `options.bulletOrdered`, expected `.` or `)`");return marker}(state):checkBullet(state);const bulletOther=node.ordered?"."===bullet?")":".":function(state){const bullet=checkBullet(state),bulletOther=state.options.bulletOther;if(!bulletOther)return"*"===bullet?"-":"*";if("*"!==bulletOther&&"+"!==bulletOther&&"-"!==bulletOther)throw new Error("Cannot serialize items with `"+bulletOther+"` for `options.bulletOther`, expected `*`, `+`, or `-`");if(bulletOther===bullet)throw new Error("Expected `bullet` (`"+bullet+"`) and `bulletOther` (`"+bulletOther+"`) to be different");return bulletOther}(state);let useDifferentMarker=!(!parent||!state.bulletLastUsed)&&bullet===state.bulletLastUsed;if(!node.ordered){const firstListItem=node.children?node.children[0]:void 0;if("*"!==bullet&&"-"!==bullet||!firstListItem||firstListItem.children&&firstListItem.children[0]||"list"!==state.stack[state.stack.length-1]||"listItem"!==state.stack[state.stack.length-2]||"list"!==state.stack[state.stack.length-3]||"listItem"!==state.stack[state.stack.length-4]||0!==state.indexStack[state.indexStack.length-1]||0!==state.indexStack[state.indexStack.length-2]||0!==state.indexStack[state.indexStack.length-3]||(useDifferentMarker=!0),checkRule(state)===bullet&&firstListItem){let index=-1;for(;++index<node.children.length;){const item=node.children[index];if(item&&"listItem"===item.type&&item.children&&item.children[0]&&"thematicBreak"===item.children[0].type){useDifferentMarker=!0;break}}}}useDifferentMarker&&(bullet=bulletOther),state.bulletCurrent=bullet;const value=state.containerFlow(node,info);return state.bulletLastUsed=bullet,state.bulletCurrent=bulletCurrent,exit(),value},listItem:function(node,parent,state,info){const listItemIndent=function(state){const style=state.options.listItemIndent||"one";if("tab"!==style&&"one"!==style&&"mixed"!==style)throw new Error("Cannot serialize items with `"+style+"` for `options.listItemIndent`, expected `tab`, `one`, or `mixed`");return style}(state);let bullet=state.bulletCurrent||checkBullet(state);parent&&"list"===parent.type&&parent.ordered&&(bullet=("number"==typeof parent.start&&parent.start>-1?parent.start:1)+(!1===state.options.incrementListMarker?0:parent.children.indexOf(node))+bullet);let size=bullet.length+1;("tab"===listItemIndent||"mixed"===listItemIndent&&(parent&&"list"===parent.type&&parent.spread||node.spread))&&(size=4*Math.ceil(size/4));const tracker=state.createTracker(info);tracker.move(bullet+" ".repeat(size-bullet.length)),tracker.shift(size);const exit=state.enter("listItem"),value=state.indentLines(state.containerFlow(node,tracker.current()),(function(line,index,blank){if(index)return(blank?"":" ".repeat(size))+line;return(blank?bullet:bullet+" ".repeat(size-bullet.length))+line}));return exit(),value},paragraph:function(node,_,state,info){const exit=state.enter("paragraph"),subexit=state.enter("phrasing"),value=state.containerPhrasing(node,info);return subexit(),exit(),value},root:function(node,_,state,info){const hasPhrasing=node.children.some((function(d){return phrasing(d)}));return(hasPhrasing?state.containerPhrasing:state.containerFlow).call(state,node,info)},strong:strong,text:function(node,_,state,info){return state.safe(node.value,info)},thematicBreak:function(_,_1,state){const value=(checkRule(state)+(state.options.ruleSpaces?" ":"")).repeat(function(state){const repetition=state.options.ruleRepetition||3;if(repetition<3)throw new Error("Cannot serialize rules with repetition `"+repetition+"` for `options.ruleRepetition`, expected `3` or more");return repetition}(state));return state.options.ruleSpaces?value.slice(0,-1):value}},join$2=[function(left,right,parent,state){if("code"===right.type&&formatCodeAsIndented(right,state)&&("list"===left.type||left.type===right.type&&formatCodeAsIndented(left,state)))return!1;if("spread"in parent&&"boolean"==typeof parent.spread){if("paragraph"===left.type&&(left.type===right.type||"definition"===right.type||"heading"===right.type&&formatHeadingAsSetext(right,state)))return;return parent.spread?1:0}}];const fullPhrasingSpans=["autolink","destinationLiteral","destinationRaw","reference","titleQuote","titleApostrophe"],unsafe=[{character:"\t",after:"[\\r\\n]",inConstruct:"phrasing"},{character:"\t",before:"[\\r\\n]",inConstruct:"phrasing"},{character:"\t",inConstruct:["codeFencedLangGraveAccent","codeFencedLangTilde"]},{character:"\r",inConstruct:["codeFencedLangGraveAccent","codeFencedLangTilde","codeFencedMetaGraveAccent","codeFencedMetaTilde","destinationLiteral","headingAtx"]},{character:"\n",inConstruct:["codeFencedLangGraveAccent","codeFencedLangTilde","codeFencedMetaGraveAccent","codeFencedMetaTilde","destinationLiteral","headingAtx"]},{character:" ",after:"[\\r\\n]",inConstruct:"phrasing"},{character:" ",before:"[\\r\\n]",inConstruct:"phrasing"},{character:" ",inConstruct:["codeFencedLangGraveAccent","codeFencedLangTilde"]},{character:"!",after:"\\[",inConstruct:"phrasing",notInConstruct:fullPhrasingSpans},{character:'"',inConstruct:"titleQuote"},{atBreak:!0,character:"#"},{character:"#",inConstruct:"headingAtx",after:"(?:[\r\n]|$)"},{character:"&",after:"[#A-Za-z]",inConstruct:"phrasing"},{character:"'",inConstruct:"titleApostrophe"},{character:"(",inConstruct:"destinationRaw"},{before:"\\]",character:"(",inConstruct:"phrasing",notInConstruct:fullPhrasingSpans},{atBreak:!0,before:"\\d+",character:")"},{character:")",inConstruct:"destinationRaw"},{atBreak:!0,character:"*",after:"(?:[ \t\r\n*])"},{character:"*",inConstruct:"phrasing",notInConstruct:fullPhrasingSpans},{atBreak:!0,character:"+",after:"(?:[ \t\r\n])"},{atBreak:!0,character:"-",after:"(?:[ \t\r\n-])"},{atBreak:!0,before:"\\d+",character:".",after:"(?:[ \t\r\n]|$)"},{atBreak:!0,character:"<",after:"[!/?A-Za-z]"},{character:"<",after:"[!/?A-Za-z]",inConstruct:"phrasing",notInConstruct:fullPhrasingSpans},{character:"<",inConstruct:"destinationLiteral"},{atBreak:!0,character:"="},{atBreak:!0,character:">"},{character:">",inConstruct:"destinationLiteral"},{atBreak:!0,character:"["},{character:"[",inConstruct:"phrasing",notInConstruct:fullPhrasingSpans},{character:"[",inConstruct:["label","reference"]},{character:"\\",after:"[\\r\\n]",inConstruct:"phrasing"},{character:"]",inConstruct:["label","reference"]},{atBreak:!0,character:"_"},{character:"_",inConstruct:"phrasing",notInConstruct:fullPhrasingSpans},{atBreak:!0,character:"`"},{character:"`",inConstruct:["codeFencedLangGraveAccent","codeFencedMetaGraveAccent"]},{character:"`",inConstruct:"phrasing",notInConstruct:fullPhrasingSpans},{atBreak:!0,character:"~"}];function association(node){return node.label||!node.identifier?node.label||"":decodeString(node.identifier)}function compilePattern(pattern){if(!pattern._compiled){const before=(pattern.atBreak?"[\\r\\n][\\t ]*":"")+(pattern.before?"(?:"+pattern.before+")":"");pattern._compiled=new RegExp((before?"("+before+")":"")+(/[|\\{}()[\]^$+*?.-]/.test(pattern.character)?"\\":"")+pattern.character+(pattern.after?"(?:"+pattern.after+")":""),"g")}return pattern._compiled}function between(left,right,parent,state){let index=state.join.length;for(;index--;){const result=state.join[index](left,right,parent,state);if(!0===result||1===result)break;if("number"==typeof result)return"\n".repeat(1+result);if(!1===result)return"\n\n\x3c!----\x3e\n\n"}return"\n\n"}const eol=/\r?\n|\r/g;function indentLines(value,map){const result=[];let match,start=0,line=0;for(;match=eol.exec(value);)one(value.slice(start,match.index)),result.push(match[0]),start=match.index+match[0].length,line++;return one(value.slice(start)),result.join("");function one(value){result.push(map(value,line,!value))}}function numerical(a,b){return a-b}function escapeBackslashes(value,after){const expression=/\\(?=[!-/:-@[-`{-~])/g,positions=[],results=[],whole=value+after;let match,index=-1,start=0;for(;match=expression.exec(whole);)positions.push(match.index);for(;++index<positions.length;)start!==positions[index]&&results.push(value.slice(start,positions[index])),results.push("\\"),start=positions[index];return results.push(value.slice(start)),results.join("")}function track(config){const options=config||{},now=options.now||{};let lineShift=options.lineShift||0,line=now.line||1,column=now.column||1;return{move:function(input){const value=input||"",chunks=value.split(/\r?\n|\r/g),tail=chunks[chunks.length-1];return line+=chunks.length-1,column=1===chunks.length?column+tail.length:1+tail.length+lineShift,value},current:function(){return{now:{line:line,column:column},lineShift:lineShift}},shift:function(value){lineShift+=value}}}function toMarkdown(tree,options={}){const state={enter:function(name){return state.stack.push(name),function(){state.stack.pop()}},indentLines:indentLines,associationId:association,containerPhrasing:containerPhrasingBound,containerFlow:containerFlowBound,createTracker:track,compilePattern:compilePattern,safe:safeBound,stack:[],unsafe:[...unsafe],join:[...join$2],handlers:{...handle},options:{},indexStack:[],handle:void 0};configure(state,options),state.options.tightDefinitions&&state.join.push(joinDefinition),state.handle=function(key,options){const settings=options||{};function one(value,...parameters){let fn=one.invalid;const handlers=one.handlers;if(value&&own$2.call(value,key)){const id=String(value[key]);fn=own$2.call(handlers,id)?handlers[id]:one.unknown}if(fn)return fn.call(this,value,...parameters)}return one.handlers=settings.handlers||{},one.invalid=settings.invalid,one.unknown=settings.unknown,one}("type",{invalid:invalid,unknown:unknown,handlers:state.handlers});let result=state.handle(tree,void 0,state,{before:"\n",after:"\n",now:{line:1,column:1},lineShift:0});return result&&10!==result.charCodeAt(result.length-1)&&13!==result.charCodeAt(result.length-1)&&(result+="\n"),result}function invalid(value){throw new Error("Cannot handle value `"+value+"`, expected node")}function unknown(value){throw new Error("Cannot handle unknown node `"+value.type+"`")}function joinDefinition(left,right){if("definition"===left.type&&left.type===right.type)return 0}function containerPhrasingBound(parent,info){return function(parent,state,info){const indexStack=state.indexStack,children=parent.children||[],results=[];let index=-1,before=info.before;indexStack.push(-1);let tracker=state.createTracker(info);for(;++index<children.length;){const child=children[index];let after;if(indexStack[indexStack.length-1]=index,index+1<children.length){let handle=state.handle.handlers[children[index+1].type];handle&&handle.peek&&(handle=handle.peek),after=handle?handle(children[index+1],parent,state,{before:"",after:"",...tracker.current()}).charAt(0):""}else after=info.after;results.length>0&&("\r"===before||"\n"===before)&&"html"===child.type&&(results[results.length-1]=results[results.length-1].replace(/(\r?\n|\r)$/," "),before=" ",tracker=state.createTracker(info),tracker.move(results.join(""))),results.push(tracker.move(state.handle(child,parent,state,{...tracker.current(),before:before,after:after}))),before=results[results.length-1].slice(-1)}return indexStack.pop(),results.join("")}(parent,this,info)}function containerFlowBound(parent,info){return function(parent,state,info){const indexStack=state.indexStack,children=parent.children||[],tracker=state.createTracker(info),results=[];let index=-1;for(indexStack.push(-1);++index<children.length;){const child=children[index];indexStack[indexStack.length-1]=index,results.push(tracker.move(state.handle(child,parent,state,{before:"\n",after:"\n",...tracker.current()}))),"list"!==child.type&&(state.bulletLastUsed=void 0),index<children.length-1&&results.push(tracker.move(between(child,children[index+1],parent,state)))}return indexStack.pop(),results.join("")}(parent,this,info)}function safeBound(value,config){return function(state,input,config){const value=(config.before||"")+(input||"")+(config.after||""),positions=[],result=[],infos={};let index=-1;for(;++index<state.unsafe.length;){const pattern=state.unsafe[index];if(!patternInScope(state.stack,pattern))continue;const expression=state.compilePattern(pattern);let match;for(;match=expression.exec(value);){const before="before"in pattern||Boolean(pattern.atBreak),after="after"in pattern,position=match.index+(before?match[1].length:0);positions.includes(position)?(infos[position].before&&!before&&(infos[position].before=!1),infos[position].after&&!after&&(infos[position].after=!1)):(positions.push(position),infos[position]={before:before,after:after})}}positions.sort(numerical);let start=config.before?config.before.length:0;const end=value.length-(config.after?config.after.length:0);for(index=-1;++index<positions.length;){const position=positions[index];position<start||position>=end||position+1<end&&positions[index+1]===position+1&&infos[position].after&&!infos[position+1].before&&!infos[position+1].after||positions[index-1]===position-1&&infos[position].before&&!infos[position-1].before&&!infos[position-1].after||(start!==position&&result.push(escapeBackslashes(value.slice(start,position),"\\")),start=position,!/[!-/:-@[-`{-~]/.test(value.charAt(position))||config.encode&&config.encode.includes(value.charAt(position))?(result.push("&#x"+value.charCodeAt(position).toString(16).toUpperCase()+";"),start++):result.push("\\"))}return result.push(escapeBackslashes(value.slice(start,end),config.after)),result.join("")}(this,value,config)}function remarkStringify(options){const self=this;self.compiler=function(tree){return toMarkdown(tree,{...self.data("settings"),...options,extensions:self.data("toMarkdownExtensions")||[]})}}function bail(error){if(error)throw error}function getDefaultExportFromCjs(x){return x&&x.__esModule&&Object.prototype.hasOwnProperty.call(x,"default")?x.default:x}var hasOwn=Object.prototype.hasOwnProperty,toStr=Object.prototype.toString,defineProperty=Object.defineProperty,gOPD=Object.getOwnPropertyDescriptor,isArray=function(arr){return"function"==typeof Array.isArray?Array.isArray(arr):"[object Array]"===toStr.call(arr)},isPlainObject$1=function(obj){if(!obj||"[object Object]"!==toStr.call(obj))return!1;var key,hasOwnConstructor=hasOwn.call(obj,"constructor"),hasIsPrototypeOf=obj.constructor&&obj.constructor.prototype&&hasOwn.call(obj.constructor.prototype,"isPrototypeOf");if(obj.constructor&&!hasOwnConstructor&&!hasIsPrototypeOf)return!1;for(key in obj);return void 0===key||hasOwn.call(obj,key)},setProperty=function(target,options){defineProperty&&"__proto__"===options.name?defineProperty(target,options.name,{enumerable:!0,configurable:!0,value:options.newValue,writable:!0}):target[options.name]=options.newValue},getProperty=function(obj,name){if("__proto__"===name){if(!hasOwn.call(obj,name))return;if(gOPD)return gOPD(obj,name).value}return obj[name]},extend=function extend(){var options,name,src,copy,copyIsArray,clone,target=arguments[0],i=1,length=arguments.length,deep=!1;for("boolean"==typeof target&&(deep=target,target=arguments[1]||{},i=2),(null==target||"object"!=typeof target&&"function"!=typeof target)&&(target={});i<length;++i)if(null!=(options=arguments[i]))for(name in options)src=getProperty(target,name),target!==(copy=getProperty(options,name))&&(deep&&copy&&(isPlainObject$1(copy)||(copyIsArray=isArray(copy)))?(copyIsArray?(copyIsArray=!1,clone=src&&isArray(src)?src:[]):clone=src&&isPlainObject$1(src)?src:{},setProperty(target,{name:name,newValue:extend(deep,clone,copy)})):void 0!==copy&&setProperty(target,{name:name,newValue:copy}));return target},extend$1=getDefaultExportFromCjs(extend);function isPlainObject(value){if("object"!=typeof value||null===value)return!1;const prototype=Object.getPrototypeOf(value);return!(null!==prototype&&prototype!==Object.prototype&&null!==Object.getPrototypeOf(prototype)||Symbol.toStringTag in value||Symbol.iterator in value)}function trough(){const fns=[],pipeline={run:function(...values){let middlewareIndex=-1;const callback=values.pop();if("function"!=typeof callback)throw new TypeError("Expected function as last argument, not "+callback);!function next(error,...output){const fn=fns[++middlewareIndex];let index=-1;if(error)callback(error);else{for(;++index<values.length;)null!==output[index]&&void 0!==output[index]||(output[index]=values[index]);values=output,fn?function(middleware,callback){let called;return wrapped;function wrapped(...parameters){const fnExpectsCallback=middleware.length>parameters.length;let result;fnExpectsCallback&&parameters.push(done);try{result=middleware.apply(this,parameters)}catch(error){if(fnExpectsCallback&&called)throw error;return done(error)}fnExpectsCallback||(result&&result.then&&"function"==typeof result.then?result.then(then,done):result instanceof Error?done(result):then(result))}function done(error,...output){called||(called=!0,callback(error,...output))}function then(value){done(null,value)}}(fn,next)(...output):callback(null,...output)}}(null,...values)},use:function(middelware){if("function"!=typeof middelware)throw new TypeError("Expected `middelware` to be a function, not "+middelware);return fns.push(middelware),pipeline}};return pipeline}class VFileMessage extends Error{constructor(causeOrReason,optionsOrParentOrPlace,origin){super(),"string"==typeof optionsOrParentOrPlace&&(origin=optionsOrParentOrPlace,optionsOrParentOrPlace=void 0);let reason="",options={},legacyCause=!1;if(optionsOrParentOrPlace&&(options="line"in optionsOrParentOrPlace&&"column"in optionsOrParentOrPlace||"start"in optionsOrParentOrPlace&&"end"in optionsOrParentOrPlace?{place:optionsOrParentOrPlace}:"type"in optionsOrParentOrPlace?{ancestors:[optionsOrParentOrPlace],place:optionsOrParentOrPlace.position}:{...optionsOrParentOrPlace}),"string"==typeof causeOrReason?reason=causeOrReason:!options.cause&&causeOrReason&&(legacyCause=!0,reason=causeOrReason.message,options.cause=causeOrReason),!options.ruleId&&!options.source&&"string"==typeof origin){const index=origin.indexOf(":");-1===index?options.ruleId=origin:(options.source=origin.slice(0,index),options.ruleId=origin.slice(index+1))}if(!options.place&&options.ancestors&&options.ancestors){const parent=options.ancestors[options.ancestors.length-1];parent&&(options.place=parent.position)}const start=options.place&&"start"in options.place?options.place.start:options.place;this.ancestors=options.ancestors||void 0,this.cause=options.cause||void 0,this.column=start?start.column:void 0,this.fatal=void 0,this.file,this.message=reason,this.line=start?start.line:void 0,this.name=stringifyPosition(options.place)||"1:1",this.place=options.place||void 0,this.reason=this.message,this.ruleId=options.ruleId||void 0,this.source=options.source||void 0,this.stack=legacyCause&&options.cause&&"string"==typeof options.cause.stack?options.cause.stack:"",this.actual,this.expected,this.note,this.url}}VFileMessage.prototype.file="",VFileMessage.prototype.name="",VFileMessage.prototype.reason="",VFileMessage.prototype.message="",VFileMessage.prototype.stack="",VFileMessage.prototype.column=void 0,VFileMessage.prototype.line=void 0,VFileMessage.prototype.ancestors=void 0,VFileMessage.prototype.cause=void 0,VFileMessage.prototype.fatal=void 0,VFileMessage.prototype.place=void 0,VFileMessage.prototype.ruleId=void 0,VFileMessage.prototype.source=void 0;const path={basename:function(path,ext){if(void 0!==ext&&"string"!=typeof ext)throw new TypeError('"ext" argument must be a string');assertPath$1(path);let seenNonSlash,start=0,end=-1,index=path.length;if(void 0===ext||0===ext.length||ext.length>path.length){for(;index--;)if(47===path.codePointAt(index)){if(seenNonSlash){start=index+1;break}}else end<0&&(seenNonSlash=!0,end=index+1);return end<0?"":path.slice(start,end)}if(ext===path)return"";let firstNonSlashEnd=-1,extIndex=ext.length-1;for(;index--;)if(47===path.codePointAt(index)){if(seenNonSlash){start=index+1;break}}else firstNonSlashEnd<0&&(seenNonSlash=!0,firstNonSlashEnd=index+1),extIndex>-1&&(path.codePointAt(index)===ext.codePointAt(extIndex--)?extIndex<0&&(end=index):(extIndex=-1,end=firstNonSlashEnd));start===end?end=firstNonSlashEnd:end<0&&(end=path.length);return path.slice(start,end)},dirname:function(path){if(assertPath$1(path),0===path.length)return".";let unmatchedSlash,end=-1,index=path.length;for(;--index;)if(47===path.codePointAt(index)){if(unmatchedSlash){end=index;break}}else unmatchedSlash||(unmatchedSlash=!0);return end<0?47===path.codePointAt(0)?"/":".":1===end&&47===path.codePointAt(0)?"//":path.slice(0,end)},extname:function(path){assertPath$1(path);let unmatchedSlash,index=path.length,end=-1,startPart=0,startDot=-1,preDotState=0;for(;index--;){const code=path.codePointAt(index);if(47!==code)end<0&&(unmatchedSlash=!0,end=index+1),46===code?startDot<0?startDot=index:1!==preDotState&&(preDotState=1):startDot>-1&&(preDotState=-1);else if(unmatchedSlash){startPart=index+1;break}}if(startDot<0||end<0||0===preDotState||1===preDotState&&startDot===end-1&&startDot===startPart+1)return"";return path.slice(startDot,end)},join:function(...segments){let joined,index=-1;for(;++index<segments.length;)assertPath$1(segments[index]),segments[index]&&(joined=void 0===joined?segments[index]:joined+"/"+segments[index]);return void 0===joined?".":function(path){assertPath$1(path);const absolute=47===path.codePointAt(0);let value=function(path,allowAboveRoot){let code,lastSlashIndex,result="",lastSegmentLength=0,lastSlash=-1,dots=0,index=-1;for(;++index<=path.length;){if(index<path.length)code=path.codePointAt(index);else{if(47===code)break;code=47}if(47===code){if(lastSlash===index-1||1===dots);else if(lastSlash!==index-1&&2===dots){if(result.length<2||2!==lastSegmentLength||46!==result.codePointAt(result.length-1)||46!==result.codePointAt(result.length-2))if(result.length>2){if(lastSlashIndex=result.lastIndexOf("/"),lastSlashIndex!==result.length-1){lastSlashIndex<0?(result="",lastSegmentLength=0):(result=result.slice(0,lastSlashIndex),lastSegmentLength=result.length-1-result.lastIndexOf("/")),lastSlash=index,dots=0;continue}}else if(result.length>0){result="",lastSegmentLength=0,lastSlash=index,dots=0;continue}allowAboveRoot&&(result=result.length>0?result+"/..":"..",lastSegmentLength=2)}else result.length>0?result+="/"+path.slice(lastSlash+1,index):result=path.slice(lastSlash+1,index),lastSegmentLength=index-lastSlash-1;lastSlash=index,dots=0}else 46===code&&dots>-1?dots++:dots=-1}return result}(path,!absolute);0!==value.length||absolute||(value=".");value.length>0&&47===path.codePointAt(path.length-1)&&(value+="/");return absolute?"/"+value:value}(joined)},sep:"/"};function assertPath$1(path){if("string"!=typeof path)throw new TypeError("Path must be a string. Received "+JSON.stringify(path))}const proc={cwd:function(){return"/"}};function isUrl(fileUrlOrPath){return Boolean(null!==fileUrlOrPath&&"object"==typeof fileUrlOrPath&&"href"in fileUrlOrPath&&fileUrlOrPath.href&&"protocol"in fileUrlOrPath&&fileUrlOrPath.protocol&&void 0===fileUrlOrPath.auth)}function urlToPath(path){if("string"==typeof path)path=new URL(path);else if(!isUrl(path)){const error=new TypeError('The "path" argument must be of type string or an instance of URL. Received `'+path+"`");throw error.code="ERR_INVALID_ARG_TYPE",error}if("file:"!==path.protocol){const error=new TypeError("The URL must be of scheme file");throw error.code="ERR_INVALID_URL_SCHEME",error}return function(url){if(""!==url.hostname){const error=new TypeError('File URL host must be "localhost" or empty on darwin');throw error.code="ERR_INVALID_FILE_URL_HOST",error}const pathname=url.pathname;let index=-1;for(;++index<pathname.length;)if(37===pathname.codePointAt(index)&&50===pathname.codePointAt(index+1)){const third=pathname.codePointAt(index+2);if(70===third||102===third){const error=new TypeError("File URL path must not include encoded / characters");throw error.code="ERR_INVALID_FILE_URL_PATH",error}}return decodeURIComponent(pathname)}(path)}const order=["history","path","basename","stem","extname","dirname"];class VFile{constructor(value){let options;options=value?isUrl(value)?{path:value}:"string"==typeof value||function(value){return Boolean(value&&"object"==typeof value&&"byteLength"in value&&"byteOffset"in value)}(value)?{value:value}:value:{},this.cwd=proc.cwd(),this.data={},this.history=[],this.messages=[],this.value,this.map,this.result,this.stored;let prop,index=-1;for(;++index<order.length;){const prop=order[index];prop in options&&void 0!==options[prop]&&null!==options[prop]&&(this[prop]="history"===prop?[...options[prop]]:options[prop])}for(prop in options)order.includes(prop)||(this[prop]=options[prop])}get basename(){return"string"==typeof this.path?path.basename(this.path):void 0}set basename(basename){assertNonEmpty(basename,"basename"),assertPart(basename,"basename"),this.path=path.join(this.dirname||"",basename)}get dirname(){return"string"==typeof this.path?path.dirname(this.path):void 0}set dirname(dirname){assertPath(this.basename,"dirname"),this.path=path.join(dirname||"",this.basename)}get extname(){return"string"==typeof this.path?path.extname(this.path):void 0}set extname(extname){if(assertPart(extname,"extname"),assertPath(this.dirname,"extname"),extname){if(46!==extname.codePointAt(0))throw new Error("`extname` must start with `.`");if(extname.includes(".",1))throw new Error("`extname` cannot contain multiple dots")}this.path=path.join(this.dirname,this.stem+(extname||""))}get path(){return this.history[this.history.length-1]}set path(path){isUrl(path)&&(path=urlToPath(path)),assertNonEmpty(path,"path"),this.path!==path&&this.history.push(path)}get stem(){return"string"==typeof this.path?path.basename(this.path,this.extname):void 0}set stem(stem){assertNonEmpty(stem,"stem"),assertPart(stem,"stem"),this.path=path.join(this.dirname||"",stem+(this.extname||""))}fail(causeOrReason,optionsOrParentOrPlace,origin){const message=this.message(causeOrReason,optionsOrParentOrPlace,origin);throw message.fatal=!0,message}info(causeOrReason,optionsOrParentOrPlace,origin){const message=this.message(causeOrReason,optionsOrParentOrPlace,origin);return message.fatal=void 0,message}message(causeOrReason,optionsOrParentOrPlace,origin){const message=new VFileMessage(causeOrReason,optionsOrParentOrPlace,origin);return this.path&&(message.name=this.path+":"+message.name,message.file=this.path),message.fatal=!1,this.messages.push(message),message}toString(encoding){if(void 0===this.value)return"";if("string"==typeof this.value)return this.value;return new TextDecoder(encoding||void 0).decode(this.value)}}function assertPart(part,name){if(part&&part.includes(path.sep))throw new Error("`"+name+"` cannot be a path: did not expect `"+path.sep+"`")}function assertNonEmpty(part,name){if(!part)throw new Error("`"+name+"` cannot be empty")}function assertPath(path,name){if(!path)throw new Error("Setting `"+name+"` requires `path` to be set too")}const CallableInstance=function(property){const proto=this.constructor.prototype,func=proto[property],apply=function(){return func.apply(apply,arguments)};Object.setPrototypeOf(apply,proto);const names=Object.getOwnPropertyNames(func);for(const p of names){const descriptor=Object.getOwnPropertyDescriptor(func,p);descriptor&&Object.defineProperty(apply,p,descriptor)}return apply},own={}.hasOwnProperty;class Processor extends CallableInstance{constructor(){super("copy"),this.Compiler=void 0,this.Parser=void 0,this.attachers=[],this.compiler=void 0,this.freezeIndex=-1,this.frozen=void 0,this.namespace={},this.parser=void 0,this.transformers=trough()}copy(){const destination=new Processor;let index=-1;for(;++index<this.attachers.length;){const attacher=this.attachers[index];destination.use(...attacher)}return destination.data(extend$1(!0,{},this.namespace)),destination}data(key,value){return"string"==typeof key?2===arguments.length?(assertUnfrozen("data",this.frozen),this.namespace[key]=value,this):own.call(this.namespace,key)&&this.namespace[key]||void 0:key?(assertUnfrozen("data",this.frozen),this.namespace=key,this):this.namespace}freeze(){if(this.frozen)return this;const self=this;for(;++this.freezeIndex<this.attachers.length;){const[attacher,...options]=this.attachers[this.freezeIndex];if(!1===options[0])continue;!0===options[0]&&(options[0]=void 0);const transformer=attacher.call(self,...options);"function"==typeof transformer&&this.transformers.use(transformer)}return this.frozen=!0,this.freezeIndex=Number.POSITIVE_INFINITY,this}parse(file){this.freeze();const realFile=vfile(file),parser=this.parser||this.Parser;return assertParser("parse",parser),parser(String(realFile),realFile)}process(file,done){const self=this;return this.freeze(),assertParser("process",this.parser||this.Parser),assertCompiler("process",this.compiler||this.Compiler),done?executor(void 0,done):new Promise(executor);function executor(resolve,reject){const realFile=vfile(file),parseTree=self.parse(realFile);function realDone(error,file){error||!file?reject(error):resolve?resolve(file):done(void 0,file)}self.run(parseTree,realFile,(function(error,tree,file){if(error||!tree||!file)return realDone(error);const compileTree=tree,compileResult=self.stringify(compileTree,file);var value;"string"==typeof(value=compileResult)||function(value){return Boolean(value&&"object"==typeof value&&"byteLength"in value&&"byteOffset"in value)}(value)?file.value=compileResult:file.result=compileResult,realDone(error,file)}))}}processSync(file){let result,complete=!1;return this.freeze(),assertParser("processSync",this.parser||this.Parser),assertCompiler("processSync",this.compiler||this.Compiler),this.process(file,(function(error,file){complete=!0,bail(error),result=file})),assertDone("processSync","process",complete),result}run(tree,file,done){assertNode(tree),this.freeze();const transformers=this.transformers;return done||"function"!=typeof file||(done=file,file=void 0),done?executor(void 0,done):new Promise(executor);function executor(resolve,reject){const realFile=vfile(file);transformers.run(tree,realFile,(function(error,outputTree,file){const resultingTree=outputTree||tree;error?reject(error):resolve?resolve(resultingTree):done(void 0,resultingTree,file)}))}}runSync(tree,file){let result,complete=!1;return this.run(tree,file,(function(error,tree){bail(error),result=tree,complete=!0})),assertDone("runSync","run",complete),result}stringify(tree,file){this.freeze();const realFile=vfile(file),compiler=this.compiler||this.Compiler;return assertCompiler("stringify",compiler),assertNode(tree),compiler(tree,realFile)}use(value,...parameters){const attachers=this.attachers,namespace=this.namespace;if(assertUnfrozen("use",this.frozen),null==value);else if("function"==typeof value)addPlugin(value,parameters);else{if("object"!=typeof value)throw new TypeError("Expected usable value, not `"+value+"`");Array.isArray(value)?addList(value):addPreset(value)}return this;function add(value){if("function"==typeof value)addPlugin(value,[]);else{if("object"!=typeof value)throw new TypeError("Expected usable value, not `"+value+"`");if(Array.isArray(value)){const[plugin,...parameters]=value;addPlugin(plugin,parameters)}else addPreset(value)}}function addPreset(result){if(!("plugins"in result)&&!("settings"in result))throw new Error("Expected usable value but received an empty preset, which is probably a mistake: presets typically come with `plugins` and sometimes with `settings`, but this has neither");addList(result.plugins),result.settings&&(namespace.settings=extend$1(!0,namespace.settings,result.settings))}function addList(plugins){let index=-1;if(null==plugins);else{if(!Array.isArray(plugins))throw new TypeError("Expected a list of plugins, not `"+plugins+"`");for(;++index<plugins.length;){add(plugins[index])}}}function addPlugin(plugin,parameters){let index=-1,entryIndex=-1;for(;++index<attachers.length;)if(attachers[index][0]===plugin){entryIndex=index;break}if(-1===entryIndex)attachers.push([plugin,...parameters]);else if(parameters.length>0){let[primary,...rest]=parameters;const currentPrimary=attachers[entryIndex][1];isPlainObject(currentPrimary)&&isPlainObject(primary)&&(primary=extend$1(!0,currentPrimary,primary)),attachers[entryIndex]=[plugin,primary,...rest]}}}}const unified=(new Processor).freeze();function assertParser(name,value){if("function"!=typeof value)throw new TypeError("Cannot `"+name+"` without `parser`")}function assertCompiler(name,value){if("function"!=typeof value)throw new TypeError("Cannot `"+name+"` without `compiler`")}function assertUnfrozen(name,frozen){if(frozen)throw new Error("Cannot call `"+name+"` on a frozen processor.\nCreate a new processor first, by calling it: use `processor()` instead of `processor`.")}function assertNode(node){if(!isPlainObject(node)||"string"!=typeof node.type)throw new TypeError("Expected node, got `"+node+"`")}function assertDone(name,asyncName,complete){if(!complete)throw new Error("`"+name+"` finished async. Use `"+asyncName+"` instead")}function vfile(value){return function(value){return Boolean(value&&"object"==typeof value&&"message"in value&&"messages"in value)}(value)?value:new VFile(value)}var G$1=(p,h,n)=>{if(!h.has(p))throw TypeError("Cannot "+n)},r=(p,h,n)=>(G$1(p,h,"read from private field"),n?n.call(p):h.get(p)),c$1=(p,h,n)=>{if(h.has(p))throw TypeError("Cannot add the same private member more than once");h instanceof WeakSet?h.add(p):h.set(p,n)},o=(p,h,n,t)=>(G$1(p,h,"write to private field"),t?t.call(p,n):h.set(p,n),n);let Q$2=class{},U$1=class{constructor(){this.elements=[],this.size=()=>this.elements.length,this.top=()=>this.elements.at(-1),this.push=h=>{var n;null==(n=this.top())||n.push(h)},this.open=h=>{this.elements.push(h)},this.close=()=>{const h=this.elements.pop();if(!h)throw h$1();return h}}},B$1=class B extends Q$2{constructor(h,n,t){super(),this.type=h,this.content=n,this.attrs=t}push(h,...n){this.content.push(h,...n)}pop(){return this.content.pop()}static create(h,n,t){return new B(h,n,t)}};var d$1,N$1,O$2,T$2,F$1,k$1,M$2;const S$2=class extends U$1{constructor(n){super(),c$1(this,d$1,void 0),c$1(this,N$1,void 0),c$1(this,O$2,void 0),c$1(this,T$2,void 0),c$1(this,F$1,void 0),c$1(this,k$1,void 0),c$1(this,M$2,void 0),o(this,d$1,Mark.none),o(this,N$1,(t=>t.isText)),o(this,O$2,((t,s)=>{if(r(this,N$1).call(this,t)&&r(this,N$1).call(this,s)&&Mark.sameSet(t.marks,s.marks))return this.schema.text(t.text+s.text,t.marks)})),o(this,T$2,(t=>{const s=Object.values({...this.schema.nodes,...this.schema.marks}).find((e=>e.spec.parseMarkdown.match(t)));if(!s)throw w$3(t);return s})),o(this,F$1,(t=>{const s=r(this,T$2).call(this,t);s.spec.parseMarkdown.runner(this,t,s)})),this.injectRoot=(t,s,e)=>(this.openNode(s,e),this.next(t.children),this),this.openNode=(t,s)=>(this.open(B$1.create(t,[],s)),this),o(this,k$1,(()=>{o(this,d$1,Mark.none);const t=this.close();return r(this,M$2).call(this,t.type,t.attrs,t.content)})),this.closeNode=()=>(r(this,k$1).call(this),this),o(this,M$2,((t,s,e)=>{const i=t.createAndFill(s,e,r(this,d$1));if(!i)throw g$3(t,s,e);return this.push(i),i})),this.addNode=(t,s,e)=>(r(this,M$2).call(this,t,s,e),this),this.openMark=(t,s)=>{const e=t.create(s);return o(this,d$1,e.addToSet(r(this,d$1))),this},this.closeMark=t=>(o(this,d$1,t.removeFromSet(r(this,d$1))),this),this.addText=t=>{const s=this.top();if(!s)throw h$1();const e=s.pop(),i=this.schema.text(t,r(this,d$1));if(!e)return s.push(i),this;const a=r(this,O$2).call(this,e,i);return a?(s.push(a),this):(s.push(e,i),this)},this.build=()=>{let t;do{t=r(this,k$1).call(this)}while(this.size());return t},this.next=(t=[])=>([t].flat().forEach((s=>r(this,F$1).call(this,s))),this),this.toDoc=()=>this.build(),this.run=(t,s)=>{const e=t.runSync(t.parse(s),s);return this.next(e),this},this.schema=n}};d$1=new WeakMap,N$1=new WeakMap,O$2=new WeakMap,T$2=new WeakMap,F$1=new WeakMap,k$1=new WeakMap,M$2=new WeakMap,S$2.create=(n,t)=>{const s=new S$2(n);return e=>(s.run(t,e),s.toDoc())};let H$2=S$2;const q$2=class extends Q$2{constructor(h,n,t,s={}){super(),this.type=h,this.children=n,this.value=t,this.props=s,this.push=(e,...i)=>{this.children||(this.children=[]),this.children.push(e,...i)},this.pop=()=>{var e;return null==(e=this.children)?void 0:e.pop()}}};q$2.create=(h,n,t,s={})=>new q$2(h,n,t,s);let J$1=q$2;var l,v$1,A$2,E$1,w$1,j$2,x$2,R$2,m,g$1,C$1,P$1;const z$1=class extends U$1{constructor(n){super(),c$1(this,l,void 0),c$1(this,v$1,void 0),c$1(this,A$2,void 0),c$1(this,E$1,void 0),c$1(this,w$1,void 0),c$1(this,j$2,void 0),c$1(this,x$2,void 0),c$1(this,R$2,void 0),c$1(this,m,void 0),c$1(this,g$1,void 0),c$1(this,C$1,void 0),c$1(this,P$1,void 0),o(this,l,Mark.none),o(this,v$1,(t=>{const s=Object.values({...this.schema.nodes,...this.schema.marks}).find((e=>e.spec.toMarkdown.match(t)));if(!s)throw F$2(t.type);return s})),o(this,A$2,(t=>r(this,v$1).call(this,t).spec.toMarkdown.runner(this,t))),o(this,E$1,((t,s)=>r(this,v$1).call(this,t).spec.toMarkdown.runner(this,t,s))),o(this,w$1,(t=>{const{marks:s}=t,e=u=>u.type.spec.priority??50;[...s].sort(((u,f)=>e(u)-e(f))).every((u=>!r(this,E$1).call(this,u,t)))&&r(this,A$2).call(this,t),s.forEach((u=>r(this,P$1).call(this,u)))})),o(this,j$2,((t,s)=>{var f;if(t.type===s||1!==(null==(f=t.children)?void 0:f.length))return t;const e=y=>{var I;if(y.type===s)return y;if(1!==(null==(I=y.children)?void 0:I.length))return null;const[b]=y.children;return b?e(b):null},i=e(t);if(!i)return t;const a=i.children?[...i.children]:void 0,u={...t,children:a};return u.children=a,i.children=[u],i})),o(this,x$2,(t=>{const{children:s}=t;return s&&(t.children=s.reduce(((e,i,a)=>{if(0===a)return[i];const u=e.at(-1);if(u&&u.isMark&&i.isMark){i=r(this,j$2).call(this,i,u.type);const{children:f,...y}=i,{children:b,...I}=u;if(i.type===u.type&&f&&b&&JSON.stringify(y)===JSON.stringify(I)){const V={...I,children:[...b,...f]};return e.slice(0,-1).concat(r(this,x$2).call(this,V))}}return e.concat(i)}),[])),t})),o(this,R$2,(t=>{const s={...t.props,type:t.type};return t.children&&(s.children=t.children),t.value&&(s.value=t.value),s})),this.openNode=(t,s,e)=>(this.open(J$1.create(t,void 0,s,e)),this),o(this,m,(()=>{const t=this.close();return r(this,g$1).call(this,t.type,t.children,t.value,t.props)})),this.closeNode=()=>(r(this,m).call(this),this),o(this,g$1,((t,s,e,i)=>{const a=J$1.create(t,s,e,i),u=r(this,x$2).call(this,r(this,R$2).call(this,a));return this.push(u),u})),this.addNode=(t,s,e,i)=>(r(this,g$1).call(this,t,s,e,i),this),o(this,C$1,((t,s,e,i)=>t.isInSet(r(this,l))?this:(o(this,l,t.addToSet(r(this,l))),this.openNode(s,e,{...i,isMark:!0})))),o(this,P$1,(t=>{t.isInSet(r(this,l))&&(o(this,l,t.type.removeFromSet(r(this,l))),r(this,m).call(this))})),this.withMark=(t,s,e,i)=>(r(this,C$1).call(this,t,s,e,i),this),this.closeMark=t=>(r(this,P$1).call(this,t),this),this.build=()=>{let t=null;do{t=r(this,m).call(this)}while(this.size());return t},this.next=t=>(p=>Object.prototype.hasOwnProperty.call(p,"size"))(t)?(t.forEach((s=>{r(this,w$1).call(this,s)})),this):(r(this,w$1).call(this,t),this),this.toString=t=>t.stringify(this.build()),this.run=t=>(this.next(t),this),this.schema=n}};l=new WeakMap,v$1=new WeakMap,A$2=new WeakMap,E$1=new WeakMap,w$1=new WeakMap,j$2=new WeakMap,x$2=new WeakMap,R$2=new WeakMap,m=new WeakMap,g$1=new WeakMap,C$1=new WeakMap,P$1=new WeakMap,z$1.create=(n,t)=>{const s=new z$1(n);return e=>(s.run(e),s.toString(t))};let K$1=z$1;const factor16=Math.pow(2,16);function makeRecover(index,offset){return index+offset*factor16}function recoverIndex(value){return 65535&value}class MapResult{constructor(pos,delInfo,recover){this.pos=pos,this.delInfo=delInfo,this.recover=recover}get deleted(){return(8&this.delInfo)>0}get deletedBefore(){return(5&this.delInfo)>0}get deletedAfter(){return(6&this.delInfo)>0}get deletedAcross(){return(4&this.delInfo)>0}}class StepMap{constructor(ranges,inverted=!1){if(this.ranges=ranges,this.inverted=inverted,!ranges.length&&StepMap.empty)return StepMap.empty}recover(value){let diff=0,index=recoverIndex(value);if(!this.inverted)for(let i=0;i<index;i++)diff+=this.ranges[3*i+2]-this.ranges[3*i+1];return this.ranges[3*index]+diff+function(value){return(value-(65535&value))/factor16}(value)}mapResult(pos,assoc=1){return this._map(pos,assoc,!1)}map(pos,assoc=1){return this._map(pos,assoc,!0)}_map(pos,assoc,simple){let diff=0,oldIndex=this.inverted?2:1,newIndex=this.inverted?1:2;for(let i=0;i<this.ranges.length;i+=3){let start=this.ranges[i]-(this.inverted?diff:0);if(start>pos)break;let oldSize=this.ranges[i+oldIndex],newSize=this.ranges[i+newIndex],end=start+oldSize;if(pos<=end){let result=start+diff+((oldSize?pos==start?-1:pos==end?1:assoc:assoc)<0?0:newSize);if(simple)return result;let recover=pos==(assoc<0?start:end)?null:makeRecover(i/3,pos-start),del=pos==start?2:pos==end?1:4;return(assoc<0?pos!=start:pos!=end)&&(del|=8),new MapResult(result,del,recover)}diff+=newSize-oldSize}return simple?pos+diff:new MapResult(pos+diff,0,null)}touches(pos,recover){let diff=0,index=recoverIndex(recover),oldIndex=this.inverted?2:1,newIndex=this.inverted?1:2;for(let i=0;i<this.ranges.length;i+=3){let start=this.ranges[i]-(this.inverted?diff:0);if(start>pos)break;let oldSize=this.ranges[i+oldIndex];if(pos<=start+oldSize&&i==3*index)return!0;diff+=this.ranges[i+newIndex]-oldSize}return!1}forEach(f){let oldIndex=this.inverted?2:1,newIndex=this.inverted?1:2;for(let i=0,diff=0;i<this.ranges.length;i+=3){let start=this.ranges[i],oldStart=start-(this.inverted?diff:0),newStart=start+(this.inverted?0:diff),oldSize=this.ranges[i+oldIndex],newSize=this.ranges[i+newIndex];f(oldStart,oldStart+oldSize,newStart,newStart+newSize),diff+=newSize-oldSize}}invert(){return new StepMap(this.ranges,!this.inverted)}toString(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)}static offset(n){return 0==n?StepMap.empty:new StepMap(n<0?[0,-n,0]:[0,0,n])}}StepMap.empty=new StepMap([]);class Mapping{constructor(maps=[],mirror,from=0,to=maps.length){this.maps=maps,this.mirror=mirror,this.from=from,this.to=to}slice(from=0,to=this.maps.length){return new Mapping(this.maps,this.mirror,from,to)}copy(){return new Mapping(this.maps.slice(),this.mirror&&this.mirror.slice(),this.from,this.to)}appendMap(map,mirrors){this.to=this.maps.push(map),null!=mirrors&&this.setMirror(this.maps.length-1,mirrors)}appendMapping(mapping){for(let i=0,startSize=this.maps.length;i<mapping.maps.length;i++){let mirr=mapping.getMirror(i);this.appendMap(mapping.maps[i],null!=mirr&&mirr<i?startSize+mirr:void 0)}}getMirror(n){if(this.mirror)for(let i=0;i<this.mirror.length;i++)if(this.mirror[i]==n)return this.mirror[i+(i%2?-1:1)]}setMirror(n,m){this.mirror||(this.mirror=[]),this.mirror.push(n,m)}appendMappingInverted(mapping){for(let i=mapping.maps.length-1,totalSize=this.maps.length+mapping.maps.length;i>=0;i--){let mirr=mapping.getMirror(i);this.appendMap(mapping.maps[i].invert(),null!=mirr&&mirr>i?totalSize-mirr-1:void 0)}}invert(){let inverse=new Mapping;return inverse.appendMappingInverted(this),inverse}map(pos,assoc=1){if(this.mirror)return this._map(pos,assoc,!0);for(let i=this.from;i<this.to;i++)pos=this.maps[i].map(pos,assoc);return pos}mapResult(pos,assoc=1){return this._map(pos,assoc,!1)}_map(pos,assoc,simple){let delInfo=0;for(let i=this.from;i<this.to;i++){let result=this.maps[i].mapResult(pos,assoc);if(null!=result.recover){let corr=this.getMirror(i);if(null!=corr&&corr>i&&corr<this.to){i=corr,pos=this.maps[corr].recover(result.recover);continue}}delInfo|=result.delInfo,pos=result.pos}return simple?pos:new MapResult(pos,delInfo,null)}}const stepsByID=Object.create(null);class Step{getMap(){return StepMap.empty}merge(other){return null}static fromJSON(schema,json){if(!json||!json.stepType)throw new RangeError("Invalid input for Step.fromJSON");let type=stepsByID[json.stepType];if(!type)throw new RangeError(`No step type ${json.stepType} defined`);return type.fromJSON(schema,json)}static jsonID(id,stepClass){if(id in stepsByID)throw new RangeError("Duplicate use of step JSON ID "+id);return stepsByID[id]=stepClass,stepClass.prototype.jsonID=id,stepClass}}class StepResult{constructor(doc,failed){this.doc=doc,this.failed=failed}static ok(doc){return new StepResult(doc,null)}static fail(message){return new StepResult(null,message)}static fromReplace(doc,from,to,slice){try{return StepResult.ok(doc.replace(from,to,slice))}catch(e){if(e instanceof ReplaceError)return StepResult.fail(e.message);throw e}}}function mapFragment(fragment,f,parent){let mapped=[];for(let i=0;i<fragment.childCount;i++){let child=fragment.child(i);child.content.size&&(child=child.copy(mapFragment(child.content,f,child))),child.isInline&&(child=f(child,parent,i)),mapped.push(child)}return Fragment.fromArray(mapped)}class AddMarkStep extends Step{constructor(from,to,mark){super(),this.from=from,this.to=to,this.mark=mark}apply(doc){let oldSlice=doc.slice(this.from,this.to),$from=doc.resolve(this.from),parent=$from.node($from.sharedDepth(this.to)),slice=new Slice(mapFragment(oldSlice.content,((node,parent)=>node.isAtom&&parent.type.allowsMarkType(this.mark.type)?node.mark(this.mark.addToSet(node.marks)):node),parent),oldSlice.openStart,oldSlice.openEnd);return StepResult.fromReplace(doc,this.from,this.to,slice)}invert(){return new RemoveMarkStep(this.from,this.to,this.mark)}map(mapping){let from=mapping.mapResult(this.from,1),to=mapping.mapResult(this.to,-1);return from.deleted&&to.deleted||from.pos>=to.pos?null:new AddMarkStep(from.pos,to.pos,this.mark)}merge(other){return other instanceof AddMarkStep&&other.mark.eq(this.mark)&&this.from<=other.to&&this.to>=other.from?new AddMarkStep(Math.min(this.from,other.from),Math.max(this.to,other.to),this.mark):null}toJSON(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(schema,json){if("number"!=typeof json.from||"number"!=typeof json.to)throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new AddMarkStep(json.from,json.to,schema.markFromJSON(json.mark))}}Step.jsonID("addMark",AddMarkStep);class RemoveMarkStep extends Step{constructor(from,to,mark){super(),this.from=from,this.to=to,this.mark=mark}apply(doc){let oldSlice=doc.slice(this.from,this.to),slice=new Slice(mapFragment(oldSlice.content,(node=>node.mark(this.mark.removeFromSet(node.marks))),doc),oldSlice.openStart,oldSlice.openEnd);return StepResult.fromReplace(doc,this.from,this.to,slice)}invert(){return new AddMarkStep(this.from,this.to,this.mark)}map(mapping){let from=mapping.mapResult(this.from,1),to=mapping.mapResult(this.to,-1);return from.deleted&&to.deleted||from.pos>=to.pos?null:new RemoveMarkStep(from.pos,to.pos,this.mark)}merge(other){return other instanceof RemoveMarkStep&&other.mark.eq(this.mark)&&this.from<=other.to&&this.to>=other.from?new RemoveMarkStep(Math.min(this.from,other.from),Math.max(this.to,other.to),this.mark):null}toJSON(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(schema,json){if("number"!=typeof json.from||"number"!=typeof json.to)throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new RemoveMarkStep(json.from,json.to,schema.markFromJSON(json.mark))}}Step.jsonID("removeMark",RemoveMarkStep);class AddNodeMarkStep extends Step{constructor(pos,mark){super(),this.pos=pos,this.mark=mark}apply(doc){let node=doc.nodeAt(this.pos);if(!node)return StepResult.fail("No node at mark step's position");let updated=node.type.create(node.attrs,null,this.mark.addToSet(node.marks));return StepResult.fromReplace(doc,this.pos,this.pos+1,new Slice(Fragment.from(updated),0,node.isLeaf?0:1))}invert(doc){let node=doc.nodeAt(this.pos);if(node){let newSet=this.mark.addToSet(node.marks);if(newSet.length==node.marks.length){for(let i=0;i<node.marks.length;i++)if(!node.marks[i].isInSet(newSet))return new AddNodeMarkStep(this.pos,node.marks[i]);return new AddNodeMarkStep(this.pos,this.mark)}}return new RemoveNodeMarkStep(this.pos,this.mark)}map(mapping){let pos=mapping.mapResult(this.pos,1);return pos.deletedAfter?null:new AddNodeMarkStep(pos.pos,this.mark)}toJSON(){return{stepType:"addNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(schema,json){if("number"!=typeof json.pos)throw new RangeError("Invalid input for AddNodeMarkStep.fromJSON");return new AddNodeMarkStep(json.pos,schema.markFromJSON(json.mark))}}Step.jsonID("addNodeMark",AddNodeMarkStep);class RemoveNodeMarkStep extends Step{constructor(pos,mark){super(),this.pos=pos,this.mark=mark}apply(doc){let node=doc.nodeAt(this.pos);if(!node)return StepResult.fail("No node at mark step's position");let updated=node.type.create(node.attrs,null,this.mark.removeFromSet(node.marks));return StepResult.fromReplace(doc,this.pos,this.pos+1,new Slice(Fragment.from(updated),0,node.isLeaf?0:1))}invert(doc){let node=doc.nodeAt(this.pos);return node&&this.mark.isInSet(node.marks)?new AddNodeMarkStep(this.pos,this.mark):this}map(mapping){let pos=mapping.mapResult(this.pos,1);return pos.deletedAfter?null:new RemoveNodeMarkStep(pos.pos,this.mark)}toJSON(){return{stepType:"removeNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(schema,json){if("number"!=typeof json.pos)throw new RangeError("Invalid input for RemoveNodeMarkStep.fromJSON");return new RemoveNodeMarkStep(json.pos,schema.markFromJSON(json.mark))}}Step.jsonID("removeNodeMark",RemoveNodeMarkStep);class ReplaceStep extends Step{constructor(from,to,slice,structure=!1){super(),this.from=from,this.to=to,this.slice=slice,this.structure=structure}apply(doc){return this.structure&&contentBetween(doc,this.from,this.to)?StepResult.fail("Structure replace would overwrite content"):StepResult.fromReplace(doc,this.from,this.to,this.slice)}getMap(){return new StepMap([this.from,this.to-this.from,this.slice.size])}invert(doc){return new ReplaceStep(this.from,this.from+this.slice.size,doc.slice(this.from,this.to))}map(mapping){let from=mapping.mapResult(this.from,1),to=mapping.mapResult(this.to,-1);return from.deletedAcross&&to.deletedAcross?null:new ReplaceStep(from.pos,Math.max(from.pos,to.pos),this.slice)}merge(other){if(!(other instanceof ReplaceStep)||other.structure||this.structure)return null;if(this.from+this.slice.size!=other.from||this.slice.openEnd||other.slice.openStart){if(other.to!=this.from||this.slice.openStart||other.slice.openEnd)return null;{let slice=this.slice.size+other.slice.size==0?Slice.empty:new Slice(other.slice.content.append(this.slice.content),other.slice.openStart,this.slice.openEnd);return new ReplaceStep(other.from,this.to,slice,this.structure)}}{let slice=this.slice.size+other.slice.size==0?Slice.empty:new Slice(this.slice.content.append(other.slice.content),this.slice.openStart,other.slice.openEnd);return new ReplaceStep(this.from,this.to+(other.to-other.from),slice,this.structure)}}toJSON(){let json={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(json.slice=this.slice.toJSON()),this.structure&&(json.structure=!0),json}static fromJSON(schema,json){if("number"!=typeof json.from||"number"!=typeof json.to)throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new ReplaceStep(json.from,json.to,Slice.fromJSON(schema,json.slice),!!json.structure)}}Step.jsonID("replace",ReplaceStep);class ReplaceAroundStep extends Step{constructor(from,to,gapFrom,gapTo,slice,insert,structure=!1){super(),this.from=from,this.to=to,this.gapFrom=gapFrom,this.gapTo=gapTo,this.slice=slice,this.insert=insert,this.structure=structure}apply(doc){if(this.structure&&(contentBetween(doc,this.from,this.gapFrom)||contentBetween(doc,this.gapTo,this.to)))return StepResult.fail("Structure gap-replace would overwrite content");let gap=doc.slice(this.gapFrom,this.gapTo);if(gap.openStart||gap.openEnd)return StepResult.fail("Gap is not a flat range");let inserted=this.slice.insertAt(this.insert,gap.content);return inserted?StepResult.fromReplace(doc,this.from,this.to,inserted):StepResult.fail("Content does not fit in gap")}getMap(){return new StepMap([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])}invert(doc){let gap=this.gapTo-this.gapFrom;return new ReplaceAroundStep(this.from,this.from+this.slice.size+gap,this.from+this.insert,this.from+this.insert+gap,doc.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)}map(mapping){let from=mapping.mapResult(this.from,1),to=mapping.mapResult(this.to,-1),gapFrom=mapping.map(this.gapFrom,-1),gapTo=mapping.map(this.gapTo,1);return from.deletedAcross&&to.deletedAcross||gapFrom<from.pos||gapTo>to.pos?null:new ReplaceAroundStep(from.pos,to.pos,gapFrom,gapTo,this.slice,this.insert,this.structure)}toJSON(){let json={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(json.slice=this.slice.toJSON()),this.structure&&(json.structure=!0),json}static fromJSON(schema,json){if("number"!=typeof json.from||"number"!=typeof json.to||"number"!=typeof json.gapFrom||"number"!=typeof json.gapTo||"number"!=typeof json.insert)throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new ReplaceAroundStep(json.from,json.to,json.gapFrom,json.gapTo,Slice.fromJSON(schema,json.slice),json.insert,!!json.structure)}}function contentBetween(doc,from,to){let $from=doc.resolve(from),dist=to-from,depth=$from.depth;for(;dist>0&&depth>0&&$from.indexAfter(depth)==$from.node(depth).childCount;)depth--,dist--;if(dist>0){let next=$from.node(depth).maybeChild($from.indexAfter(depth));for(;dist>0;){if(!next||next.isLeaf)return!0;next=next.firstChild,dist--}}return!1}function canCut(node,start,end){return(0==start||node.canReplace(start,node.childCount))&&(end==node.childCount||node.canReplace(0,end))}function liftTarget(range){let content=range.parent.content.cutByIndex(range.startIndex,range.endIndex);for(let depth=range.depth;;--depth){let node=range.$from.node(depth),index=range.$from.index(depth),endIndex=range.$to.indexAfter(depth);if(depth<range.depth&&node.canReplace(index,endIndex,content))return depth;if(0==depth||node.type.spec.isolating||!canCut(node,index,endIndex))break}return null}function findWrapping(range,nodeType,attrs=null,innerRange=range){let around=function(range,type){let{parent:parent,startIndex:startIndex,endIndex:endIndex}=range,around=parent.contentMatchAt(startIndex).findWrapping(type);if(!around)return null;let outer=around.length?around[0]:type;return parent.canReplaceWith(startIndex,endIndex,outer)?around:null}(range,nodeType),inner=around&&function(range,type){let{parent:parent,startIndex:startIndex,endIndex:endIndex}=range,inner=parent.child(startIndex),inside=type.contentMatch.findWrapping(inner.type);if(!inside)return null;let innerMatch=(inside.length?inside[inside.length-1]:type).contentMatch;for(let i=startIndex;innerMatch&&i<endIndex;i++)innerMatch=innerMatch.matchType(parent.child(i).type);return innerMatch&&innerMatch.validEnd?inside:null}(innerRange,nodeType);return inner?around.map(withAttrs).concat({type:nodeType,attrs:attrs}).concat(inner.map(withAttrs)):null}function withAttrs(type){return{type:type,attrs:null}}function canSplit(doc,pos,depth=1,typesAfter){let $pos=doc.resolve(pos),base=$pos.depth-depth,innerType=typesAfter&&typesAfter[typesAfter.length-1]||$pos.parent;if(base<0||$pos.parent.type.spec.isolating||!$pos.parent.canReplace($pos.index(),$pos.parent.childCount)||!innerType.type.validContent($pos.parent.content.cutByIndex($pos.index(),$pos.parent.childCount)))return!1;for(let d=$pos.depth-1,i=depth-2;d>base;d--,i--){let node=$pos.node(d),index=$pos.index(d);if(node.type.spec.isolating)return!1;let rest=node.content.cutByIndex(index,node.childCount),overrideChild=typesAfter&&typesAfter[i+1];overrideChild&&(rest=rest.replaceChild(0,overrideChild.type.create(overrideChild.attrs)));let after=typesAfter&&typesAfter[i]||node;if(!node.canReplace(index+1,node.childCount)||!after.type.validContent(rest))return!1}let index=$pos.indexAfter(base),baseType=typesAfter&&typesAfter[0];return $pos.node(base).canReplaceWith(index,index,baseType?baseType.type:$pos.node(base+1).type)}function canJoin(doc,pos){let $pos=doc.resolve(pos),index=$pos.index();return function(a,b){return!(!a||!b||a.isLeaf||!a.canAppend(b))}($pos.nodeBefore,$pos.nodeAfter)&&$pos.parent.canReplace(index,index+1)}function replaceStep(doc,from,to=from,slice=Slice.empty){if(from==to&&!slice.size)return null;let $from=doc.resolve(from),$to=doc.resolve(to);return fitsTrivially($from,$to,slice)?new ReplaceStep(from,to,slice):new Fitter($from,$to,slice).fit()}function fitsTrivially($from,$to,slice){return!slice.openStart&&!slice.openEnd&&$from.start()==$to.start()&&$from.parent.canReplace($from.index(),$to.index(),slice.content)}Step.jsonID("replaceAround",ReplaceAroundStep);class Fitter{constructor($from,$to,unplaced){this.$from=$from,this.$to=$to,this.unplaced=unplaced,this.frontier=[],this.placed=Fragment.empty;for(let i=0;i<=$from.depth;i++){let node=$from.node(i);this.frontier.push({type:node.type,match:node.contentMatchAt($from.indexAfter(i))})}for(let i=$from.depth;i>0;i--)this.placed=Fragment.from($from.node(i).copy(this.placed))}get depth(){return this.frontier.length-1}fit(){for(;this.unplaced.size;){let fit=this.findFittable();fit?this.placeNodes(fit):this.openMore()||this.dropNode()}let moveInline=this.mustMoveInline(),placedSize=this.placed.size-this.depth-this.$from.depth,$from=this.$from,$to=this.close(moveInline<0?this.$to:$from.doc.resolve(moveInline));if(!$to)return null;let content=this.placed,openStart=$from.depth,openEnd=$to.depth;for(;openStart&&openEnd&&1==content.childCount;)content=content.firstChild.content,openStart--,openEnd--;let slice=new Slice(content,openStart,openEnd);return moveInline>-1?new ReplaceAroundStep($from.pos,moveInline,this.$to.pos,this.$to.end(),slice,placedSize):slice.size||$from.pos!=this.$to.pos?new ReplaceStep($from.pos,$to.pos,slice):null}findFittable(){let startDepth=this.unplaced.openStart;for(let cur=this.unplaced.content,d=0,openEnd=this.unplaced.openEnd;d<startDepth;d++){let node=cur.firstChild;if(cur.childCount>1&&(openEnd=0),node.type.spec.isolating&&openEnd<=d){startDepth=d;break}cur=node.content}for(let pass=1;pass<=2;pass++)for(let sliceDepth=1==pass?startDepth:this.unplaced.openStart;sliceDepth>=0;sliceDepth--){let fragment,parent=null;sliceDepth?(parent=contentAt(this.unplaced.content,sliceDepth-1).firstChild,fragment=parent.content):fragment=this.unplaced.content;let first=fragment.firstChild;for(let frontierDepth=this.depth;frontierDepth>=0;frontierDepth--){let wrap,{type:type,match:match}=this.frontier[frontierDepth],inject=null;if(1==pass&&(first?match.matchType(first.type)||(inject=match.fillBefore(Fragment.from(first),!1)):parent&&type.compatibleContent(parent.type)))return{sliceDepth:sliceDepth,frontierDepth:frontierDepth,parent:parent,inject:inject};if(2==pass&&first&&(wrap=match.findWrapping(first.type)))return{sliceDepth:sliceDepth,frontierDepth:frontierDepth,parent:parent,wrap:wrap};if(parent&&match.matchType(parent.type))break}}}openMore(){let{content:content,openStart:openStart,openEnd:openEnd}=this.unplaced,inner=contentAt(content,openStart);return!(!inner.childCount||inner.firstChild.isLeaf)&&(this.unplaced=new Slice(content,openStart+1,Math.max(openEnd,inner.size+openStart>=content.size-openEnd?openStart+1:0)),!0)}dropNode(){let{content:content,openStart:openStart,openEnd:openEnd}=this.unplaced,inner=contentAt(content,openStart);if(inner.childCount<=1&&openStart>0){let openAtEnd=content.size-openStart<=openStart+inner.size;this.unplaced=new Slice(dropFromFragment(content,openStart-1,1),openStart-1,openAtEnd?openStart-1:openEnd)}else this.unplaced=new Slice(dropFromFragment(content,openStart,1),openStart,openEnd)}placeNodes({sliceDepth:sliceDepth,frontierDepth:frontierDepth,parent:parent,inject:inject,wrap:wrap}){for(;this.depth>frontierDepth;)this.closeFrontierNode();if(wrap)for(let i=0;i<wrap.length;i++)this.openFrontierNode(wrap[i]);let slice=this.unplaced,fragment=parent?parent.content:slice.content,openStart=slice.openStart-sliceDepth,taken=0,add=[],{match:match,type:type}=this.frontier[frontierDepth];if(inject){for(let i=0;i<inject.childCount;i++)add.push(inject.child(i));match=match.matchFragment(inject)}let openEndCount=fragment.size+sliceDepth-(slice.content.size-slice.openEnd);for(;taken<fragment.childCount;){let next=fragment.child(taken),matches=match.matchType(next.type);if(!matches)break;taken++,(taken>1||0==openStart||next.content.size)&&(match=matches,add.push(closeNodeStart(next.mark(type.allowedMarks(next.marks)),1==taken?openStart:0,taken==fragment.childCount?openEndCount:-1)))}let toEnd=taken==fragment.childCount;toEnd||(openEndCount=-1),this.placed=addToFragment(this.placed,frontierDepth,Fragment.from(add)),this.frontier[frontierDepth].match=match,toEnd&&openEndCount<0&&parent&&parent.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(let i=0,cur=fragment;i<openEndCount;i++){let node=cur.lastChild;this.frontier.push({type:node.type,match:node.contentMatchAt(node.childCount)}),cur=node.content}this.unplaced=toEnd?0==sliceDepth?Slice.empty:new Slice(dropFromFragment(slice.content,sliceDepth-1,1),sliceDepth-1,openEndCount<0?slice.openEnd:sliceDepth-1):new Slice(dropFromFragment(slice.content,sliceDepth,taken),slice.openStart,slice.openEnd)}mustMoveInline(){if(!this.$to.parent.isTextblock)return-1;let level,top=this.frontier[this.depth];if(!top.type.isTextblock||!contentAfterFits(this.$to,this.$to.depth,top.type,top.match,!1)||this.$to.depth==this.depth&&(level=this.findCloseLevel(this.$to))&&level.depth==this.depth)return-1;let{depth:depth}=this.$to,after=this.$to.after(depth);for(;depth>1&&after==this.$to.end(--depth);)++after;return after}findCloseLevel($to){scan:for(let i=Math.min(this.depth,$to.depth);i>=0;i--){let{match:match,type:type}=this.frontier[i],dropInner=i<$to.depth&&$to.end(i+1)==$to.pos+($to.depth-(i+1)),fit=contentAfterFits($to,i,type,match,dropInner);if(fit){for(let d=i-1;d>=0;d--){let{match:match,type:type}=this.frontier[d],matches=contentAfterFits($to,d,type,match,!0);if(!matches||matches.childCount)continue scan}return{depth:i,fit:fit,move:dropInner?$to.doc.resolve($to.after(i+1)):$to}}}}close($to){let close=this.findCloseLevel($to);if(!close)return null;for(;this.depth>close.depth;)this.closeFrontierNode();close.fit.childCount&&(this.placed=addToFragment(this.placed,close.depth,close.fit)),$to=close.move;for(let d=close.depth+1;d<=$to.depth;d++){let node=$to.node(d),add=node.type.contentMatch.fillBefore(node.content,!0,$to.index(d));this.openFrontierNode(node.type,node.attrs,add)}return $to}openFrontierNode(type,attrs=null,content){let top=this.frontier[this.depth];top.match=top.match.matchType(type),this.placed=addToFragment(this.placed,this.depth,Fragment.from(type.create(attrs,content))),this.frontier.push({type:type,match:type.contentMatch})}closeFrontierNode(){let add=this.frontier.pop().match.fillBefore(Fragment.empty,!0);add.childCount&&(this.placed=addToFragment(this.placed,this.frontier.length,add))}}function dropFromFragment(fragment,depth,count){return 0==depth?fragment.cutByIndex(count,fragment.childCount):fragment.replaceChild(0,fragment.firstChild.copy(dropFromFragment(fragment.firstChild.content,depth-1,count)))}function addToFragment(fragment,depth,content){return 0==depth?fragment.append(content):fragment.replaceChild(fragment.childCount-1,fragment.lastChild.copy(addToFragment(fragment.lastChild.content,depth-1,content)))}function contentAt(fragment,depth){for(let i=0;i<depth;i++)fragment=fragment.firstChild.content;return fragment}function closeNodeStart(node,openStart,openEnd){if(openStart<=0)return node;let frag=node.content;return openStart>1&&(frag=frag.replaceChild(0,closeNodeStart(frag.firstChild,openStart-1,1==frag.childCount?openEnd-1:0))),openStart>0&&(frag=node.type.contentMatch.fillBefore(frag).append(frag),openEnd<=0&&(frag=frag.append(node.type.contentMatch.matchFragment(frag).fillBefore(Fragment.empty,!0)))),node.copy(frag)}function contentAfterFits($to,depth,type,match,open){let node=$to.node(depth),index=open?$to.indexAfter(depth):$to.index(depth);if(index==node.childCount&&!type.compatibleContent(node.type))return null;let fit=match.fillBefore(node.content,!0,index);return fit&&!function(type,fragment,start){for(let i=start;i<fragment.childCount;i++)if(!type.allowsMarks(fragment.child(i).marks))return!0;return!1}(type,node.content,index)?fit:null}function closeFragment(fragment,depth,oldOpen,newOpen,parent){if(depth<oldOpen){let first=fragment.firstChild;fragment=fragment.replaceChild(0,first.copy(closeFragment(first.content,depth+1,oldOpen,newOpen,first)))}if(depth>newOpen){let match=parent.contentMatchAt(0),start=match.fillBefore(fragment).append(fragment);fragment=start.append(match.matchFragment(start).fillBefore(Fragment.empty,!0))}return fragment}function coveredDepths($from,$to){let result=[];for(let d=Math.min($from.depth,$to.depth);d>=0;d--){let start=$from.start(d);if(start<$from.pos-($from.depth-d)||$to.end(d)>$to.pos+($to.depth-d)||$from.node(d).type.spec.isolating||$to.node(d).type.spec.isolating)break;(start==$to.start(d)||d==$from.depth&&d==$to.depth&&$from.parent.inlineContent&&$to.parent.inlineContent&&d&&$to.start(d-1)==start-1)&&result.push(d)}return result}class AttrStep extends Step{constructor(pos,attr,value){super(),this.pos=pos,this.attr=attr,this.value=value}apply(doc){let node=doc.nodeAt(this.pos);if(!node)return StepResult.fail("No node at attribute step's position");let attrs=Object.create(null);for(let name in node.attrs)attrs[name]=node.attrs[name];attrs[this.attr]=this.value;let updated=node.type.create(attrs,null,node.marks);return StepResult.fromReplace(doc,this.pos,this.pos+1,new Slice(Fragment.from(updated),0,node.isLeaf?0:1))}getMap(){return StepMap.empty}invert(doc){return new AttrStep(this.pos,this.attr,doc.nodeAt(this.pos).attrs[this.attr])}map(mapping){let pos=mapping.mapResult(this.pos,1);return pos.deletedAfter?null:new AttrStep(pos.pos,this.attr,this.value)}toJSON(){return{stepType:"attr",pos:this.pos,attr:this.attr,value:this.value}}static fromJSON(schema,json){if("number"!=typeof json.pos||"string"!=typeof json.attr)throw new RangeError("Invalid input for AttrStep.fromJSON");return new AttrStep(json.pos,json.attr,json.value)}}Step.jsonID("attr",AttrStep);class DocAttrStep extends Step{constructor(attr,value){super(),this.attr=attr,this.value=value}apply(doc){let attrs=Object.create(null);for(let name in doc.attrs)attrs[name]=doc.attrs[name];attrs[this.attr]=this.value;let updated=doc.type.create(attrs,doc.content,doc.marks);return StepResult.ok(updated)}getMap(){return StepMap.empty}invert(doc){return new DocAttrStep(this.attr,doc.attrs[this.attr])}map(mapping){return this}toJSON(){return{stepType:"docAttr",attr:this.attr,value:this.value}}static fromJSON(schema,json){if("string"!=typeof json.attr)throw new RangeError("Invalid input for DocAttrStep.fromJSON");return new DocAttrStep(json.attr,json.value)}}Step.jsonID("docAttr",DocAttrStep);let TransformError=class extends Error{};TransformError=function TransformError(message){let err=Error.call(this,message);return err.__proto__=TransformError.prototype,err},(TransformError.prototype=Object.create(Error.prototype)).constructor=TransformError,TransformError.prototype.name="TransformError";class Transform{constructor(doc){this.doc=doc,this.steps=[],this.docs=[],this.mapping=new Mapping}get before(){return this.docs.length?this.docs[0]:this.doc}step(step){let result=this.maybeStep(step);if(result.failed)throw new TransformError(result.failed);return this}maybeStep(step){let result=step.apply(this.doc);return result.failed||this.addStep(step,result.doc),result}get docChanged(){return this.steps.length>0}addStep(step,doc){this.docs.push(this.doc),this.steps.push(step),this.mapping.appendMap(step.getMap()),this.doc=doc}replace(from,to=from,slice=Slice.empty){let step=replaceStep(this.doc,from,to,slice);return step&&this.step(step),this}replaceWith(from,to,content){return this.replace(from,to,new Slice(Fragment.from(content),0,0))}delete(from,to){return this.replace(from,to,Slice.empty)}insert(pos,content){return this.replaceWith(pos,pos,content)}replaceRange(from,to,slice){return function(tr,from,to,slice){if(!slice.size)return tr.deleteRange(from,to);let $from=tr.doc.resolve(from),$to=tr.doc.resolve(to);if(fitsTrivially($from,$to,slice))return tr.step(new ReplaceStep(from,to,slice));let targetDepths=coveredDepths($from,tr.doc.resolve(to));0==targetDepths[targetDepths.length-1]&&targetDepths.pop();let preferredTarget=-($from.depth+1);targetDepths.unshift(preferredTarget);for(let d=$from.depth,pos=$from.pos-1;d>0;d--,pos--){let spec=$from.node(d).type.spec;if(spec.defining||spec.definingAsContext||spec.isolating)break;targetDepths.indexOf(d)>-1?preferredTarget=d:$from.before(d)==pos&&targetDepths.splice(1,0,-d)}let preferredTargetIndex=targetDepths.indexOf(preferredTarget),leftNodes=[],preferredDepth=slice.openStart;for(let content=slice.content,i=0;;i++){let node=content.firstChild;if(leftNodes.push(node),i==slice.openStart)break;content=node.content}for(let d=preferredDepth-1;d>=0;d--){let leftNode=leftNodes[d],def=(type=leftNode.type).spec.defining||type.spec.definingForContent;if(def&&!leftNode.sameMarkup($from.node(Math.abs(preferredTarget)-1)))preferredDepth=d;else if(def||!leftNode.type.isTextblock)break}var type;for(let j=slice.openStart;j>=0;j--){let openDepth=(j+preferredDepth+1)%(slice.openStart+1),insert=leftNodes[openDepth];if(insert)for(let i=0;i<targetDepths.length;i++){let targetDepth=targetDepths[(i+preferredTargetIndex)%targetDepths.length],expand=!0;targetDepth<0&&(expand=!1,targetDepth=-targetDepth);let parent=$from.node(targetDepth-1),index=$from.index(targetDepth-1);if(parent.canReplaceWith(index,index,insert.type,insert.marks))return tr.replace($from.before(targetDepth),expand?$to.after(targetDepth):to,new Slice(closeFragment(slice.content,0,slice.openStart,openDepth),openDepth,slice.openEnd))}}let startSteps=tr.steps.length;for(let i=targetDepths.length-1;i>=0&&(tr.replace(from,to,slice),!(tr.steps.length>startSteps));i--){let depth=targetDepths[i];depth<0||(from=$from.before(depth),to=$to.after(depth))}}(this,from,to,slice),this}replaceRangeWith(from,to,node){return function(tr,from,to,node){if(!node.isInline&&from==to&&tr.doc.resolve(from).parent.content.size){let point=function(doc,pos,nodeType){let $pos=doc.resolve(pos);if($pos.parent.canReplaceWith($pos.index(),$pos.index(),nodeType))return pos;if(0==$pos.parentOffset)for(let d=$pos.depth-1;d>=0;d--){let index=$pos.index(d);if($pos.node(d).canReplaceWith(index,index,nodeType))return $pos.before(d+1);if(index>0)return null}if($pos.parentOffset==$pos.parent.content.size)for(let d=$pos.depth-1;d>=0;d--){let index=$pos.indexAfter(d);if($pos.node(d).canReplaceWith(index,index,nodeType))return $pos.after(d+1);if(index<$pos.node(d).childCount)return null}return null}(tr.doc,from,node.type);null!=point&&(from=to=point)}tr.replaceRange(from,to,new Slice(Fragment.from(node),0,0))}(this,from,to,node),this}deleteRange(from,to){return function(tr,from,to){let $from=tr.doc.resolve(from),$to=tr.doc.resolve(to),covered=coveredDepths($from,$to);for(let i=0;i<covered.length;i++){let depth=covered[i],last=i==covered.length-1;if(last&&0==depth||$from.node(depth).type.contentMatch.validEnd)return tr.delete($from.start(depth),$to.end(depth));if(depth>0&&(last||$from.node(depth-1).canReplace($from.index(depth-1),$to.indexAfter(depth-1))))return tr.delete($from.before(depth),$to.after(depth))}for(let d=1;d<=$from.depth&&d<=$to.depth;d++)if(from-$from.start(d)==$from.depth-d&&to>$from.end(d)&&$to.end(d)-to!=$to.depth-d)return tr.delete($from.before(d),to);tr.delete(from,to)}(this,from,to),this}lift(range,target){return function(tr,range,target){let{$from:$from,$to:$to,depth:depth}=range,gapStart=$from.before(depth+1),gapEnd=$to.after(depth+1),start=gapStart,end=gapEnd,before=Fragment.empty,openStart=0;for(let d=depth,splitting=!1;d>target;d--)splitting||$from.index(d)>0?(splitting=!0,before=Fragment.from($from.node(d).copy(before)),openStart++):start--;let after=Fragment.empty,openEnd=0;for(let d=depth,splitting=!1;d>target;d--)splitting||$to.after(d+1)<$to.end(d)?(splitting=!0,after=Fragment.from($to.node(d).copy(after)),openEnd++):end++;tr.step(new ReplaceAroundStep(start,end,gapStart,gapEnd,new Slice(before.append(after),openStart,openEnd),before.size-openStart,!0))}(this,range,target),this}join(pos,depth=1){return function(tr,pos,depth){let step=new ReplaceStep(pos-depth,pos+depth,Slice.empty,!0);tr.step(step)}(this,pos,depth),this}wrap(range,wrappers){return function(tr,range,wrappers){let content=Fragment.empty;for(let i=wrappers.length-1;i>=0;i--){if(content.size){let match=wrappers[i].type.contentMatch.matchFragment(content);if(!match||!match.validEnd)throw new RangeError("Wrapper type given to Transform.wrap does not form valid content of its parent wrapper")}content=Fragment.from(wrappers[i].type.create(wrappers[i].attrs,content))}let start=range.start,end=range.end;tr.step(new ReplaceAroundStep(start,end,start,end,new Slice(content,0,0),wrappers.length,!0))}(this,range,wrappers),this}setBlockType(from,to=from,type,attrs=null){return function(tr,from,to,type,attrs){if(!type.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");let mapFrom=tr.steps.length;tr.doc.nodesBetween(from,to,((node,pos)=>{if(node.isTextblock&&!node.hasMarkup(type,attrs)&&function(doc,pos,type){let $pos=doc.resolve(pos),index=$pos.index();return $pos.parent.canReplaceWith(index,index+1,type)}(tr.doc,tr.mapping.slice(mapFrom).map(pos),type)){tr.clearIncompatible(tr.mapping.slice(mapFrom).map(pos,1),type);let mapping=tr.mapping.slice(mapFrom),startM=mapping.map(pos,1),endM=mapping.map(pos+node.nodeSize,1);return tr.step(new ReplaceAroundStep(startM,endM,startM+1,endM-1,new Slice(Fragment.from(type.create(attrs,null,node.marks)),0,0),1,!0)),!1}}))}(this,from,to,type,attrs),this}setNodeMarkup(pos,type,attrs=null,marks){return function(tr,pos,type,attrs,marks){let node=tr.doc.nodeAt(pos);if(!node)throw new RangeError("No node at given position");type||(type=node.type);let newNode=type.create(attrs,null,marks||node.marks);if(node.isLeaf)return tr.replaceWith(pos,pos+node.nodeSize,newNode);if(!type.validContent(node.content))throw new RangeError("Invalid content for node type "+type.name);tr.step(new ReplaceAroundStep(pos,pos+node.nodeSize,pos+1,pos+node.nodeSize-1,new Slice(Fragment.from(newNode),0,0),1,!0))}(this,pos,type,attrs,marks),this}setNodeAttribute(pos,attr,value){return this.step(new AttrStep(pos,attr,value)),this}setDocAttribute(attr,value){return this.step(new DocAttrStep(attr,value)),this}addNodeMark(pos,mark){return this.step(new AddNodeMarkStep(pos,mark)),this}removeNodeMark(pos,mark){if(!(mark instanceof Mark)){let node=this.doc.nodeAt(pos);if(!node)throw new RangeError("No node at position "+pos);if(!(mark=mark.isInSet(node.marks)))return this}return this.step(new RemoveNodeMarkStep(pos,mark)),this}split(pos,depth=1,typesAfter){return function(tr,pos,depth=1,typesAfter){let $pos=tr.doc.resolve(pos),before=Fragment.empty,after=Fragment.empty;for(let d=$pos.depth,e=$pos.depth-depth,i=depth-1;d>e;d--,i--){before=Fragment.from($pos.node(d).copy(before));let typeAfter=typesAfter&&typesAfter[i];after=Fragment.from(typeAfter?typeAfter.type.create(typeAfter.attrs,after):$pos.node(d).copy(after))}tr.step(new ReplaceStep(pos,pos,new Slice(before.append(after),depth,depth),!0))}(this,pos,depth,typesAfter),this}addMark(from,to,mark){return function(tr,from,to,mark){let removing,adding,removed=[],added=[];tr.doc.nodesBetween(from,to,((node,pos,parent)=>{if(!node.isInline)return;let marks=node.marks;if(!mark.isInSet(marks)&&parent.type.allowsMarkType(mark.type)){let start=Math.max(pos,from),end=Math.min(pos+node.nodeSize,to),newSet=mark.addToSet(marks);for(let i=0;i<marks.length;i++)marks[i].isInSet(newSet)||(removing&&removing.to==start&&removing.mark.eq(marks[i])?removing.to=end:removed.push(removing=new RemoveMarkStep(start,end,marks[i])));adding&&adding.to==start?adding.to=end:added.push(adding=new AddMarkStep(start,end,mark))}})),removed.forEach((s=>tr.step(s))),added.forEach((s=>tr.step(s)))}(this,from,to,mark),this}removeMark(from,to,mark){return function(tr,from,to,mark){let matched=[],step=0;tr.doc.nodesBetween(from,to,((node,pos)=>{if(!node.isInline)return;step++;let toRemove=null;if(mark instanceof MarkType){let found,set=node.marks;for(;found=mark.isInSet(set);)(toRemove||(toRemove=[])).push(found),set=found.removeFromSet(set)}else mark?mark.isInSet(node.marks)&&(toRemove=[mark]):toRemove=node.marks;if(toRemove&&toRemove.length){let end=Math.min(pos+node.nodeSize,to);for(let i=0;i<toRemove.length;i++){let found,style=toRemove[i];for(let j=0;j<matched.length;j++){let m=matched[j];m.step==step-1&&style.eq(matched[j].style)&&(found=m)}found?(found.to=end,found.step=step):matched.push({style:style,from:Math.max(pos,from),to:end,step:step})}}})),matched.forEach((m=>tr.step(new RemoveMarkStep(m.from,m.to,m.style))))}(this,from,to,mark),this}clearIncompatible(pos,parentType,match){return function(tr,pos,parentType,match=parentType.contentMatch){let node=tr.doc.nodeAt(pos),replSteps=[],cur=pos+1;for(let i=0;i<node.childCount;i++){let child=node.child(i),end=cur+child.nodeSize,allowed=match.matchType(child.type);if(allowed){match=allowed;for(let j=0;j<child.marks.length;j++)parentType.allowsMarkType(child.marks[j].type)||tr.step(new RemoveMarkStep(cur,end,child.marks[j]));if(child.isText&&!parentType.spec.code){let m,slice,newline=/\r?\n|\r/g;for(;m=newline.exec(child.text);)slice||(slice=new Slice(Fragment.from(parentType.schema.text(" ",parentType.allowedMarks(child.marks))),0,0)),replSteps.push(new ReplaceStep(cur+m.index,cur+m.index+m[0].length,slice))}}else replSteps.push(new ReplaceStep(cur,end,Slice.empty));cur=end}if(!match.validEnd){let fill=match.fillBefore(Fragment.empty,!0);tr.replace(cur,cur,new Slice(fill,0,0))}for(let i=replSteps.length-1;i>=0;i--)tr.step(replSteps[i])}(this,pos,parentType,match),this}}const classesById=Object.create(null);class Selection{constructor($anchor,$head,ranges){this.$anchor=$anchor,this.$head=$head,this.ranges=ranges||[new SelectionRange($anchor.min($head),$anchor.max($head))]}get anchor(){return this.$anchor.pos}get head(){return this.$head.pos}get from(){return this.$from.pos}get to(){return this.$to.pos}get $from(){return this.ranges[0].$from}get $to(){return this.ranges[0].$to}get empty(){let ranges=this.ranges;for(let i=0;i<ranges.length;i++)if(ranges[i].$from.pos!=ranges[i].$to.pos)return!1;return!0}content(){return this.$from.doc.slice(this.from,this.to,!0)}replace(tr,content=Slice.empty){let lastNode=content.content.lastChild,lastParent=null;for(let i=0;i<content.openEnd;i++)lastParent=lastNode,lastNode=lastNode.lastChild;let mapFrom=tr.steps.length,ranges=this.ranges;for(let i=0;i<ranges.length;i++){let{$from:$from,$to:$to}=ranges[i],mapping=tr.mapping.slice(mapFrom);tr.replaceRange(mapping.map($from.pos),mapping.map($to.pos),i?Slice.empty:content),0==i&&selectionToInsertionEnd(tr,mapFrom,(lastNode?lastNode.isInline:lastParent&&lastParent.isTextblock)?-1:1)}}replaceWith(tr,node){let mapFrom=tr.steps.length,ranges=this.ranges;for(let i=0;i<ranges.length;i++){let{$from:$from,$to:$to}=ranges[i],mapping=tr.mapping.slice(mapFrom),from=mapping.map($from.pos),to=mapping.map($to.pos);i?tr.deleteRange(from,to):(tr.replaceRangeWith(from,to,node),selectionToInsertionEnd(tr,mapFrom,node.isInline?-1:1))}}static findFrom($pos,dir,textOnly=!1){let inner=$pos.parent.inlineContent?new TextSelection($pos):findSelectionIn($pos.node(0),$pos.parent,$pos.pos,$pos.index(),dir,textOnly);if(inner)return inner;for(let depth=$pos.depth-1;depth>=0;depth--){let found=dir<0?findSelectionIn($pos.node(0),$pos.node(depth),$pos.before(depth+1),$pos.index(depth),dir,textOnly):findSelectionIn($pos.node(0),$pos.node(depth),$pos.after(depth+1),$pos.index(depth)+1,dir,textOnly);if(found)return found}return null}static near($pos,bias=1){return this.findFrom($pos,bias)||this.findFrom($pos,-bias)||new AllSelection($pos.node(0))}static atStart(doc){return findSelectionIn(doc,doc,0,0,1)||new AllSelection(doc)}static atEnd(doc){return findSelectionIn(doc,doc,doc.content.size,doc.childCount,-1)||new AllSelection(doc)}static fromJSON(doc,json){if(!json||!json.type)throw new RangeError("Invalid input for Selection.fromJSON");let cls=classesById[json.type];if(!cls)throw new RangeError(`No selection type ${json.type} defined`);return cls.fromJSON(doc,json)}static jsonID(id,selectionClass){if(id in classesById)throw new RangeError("Duplicate use of selection JSON ID "+id);return classesById[id]=selectionClass,selectionClass.prototype.jsonID=id,selectionClass}getBookmark(){return TextSelection.between(this.$anchor,this.$head).getBookmark()}}Selection.prototype.visible=!0;class SelectionRange{constructor($from,$to){this.$from=$from,this.$to=$to}}let warnedAboutTextSelection=!1;function checkTextSelection($pos){warnedAboutTextSelection||$pos.parent.inlineContent||(warnedAboutTextSelection=!0,console.warn("TextSelection endpoint not pointing into a node with inline content ("+$pos.parent.type.name+")"))}class TextSelection extends Selection{constructor($anchor,$head=$anchor){checkTextSelection($anchor),checkTextSelection($head),super($anchor,$head)}get $cursor(){return this.$anchor.pos==this.$head.pos?this.$head:null}map(doc,mapping){let $head=doc.resolve(mapping.map(this.head));if(!$head.parent.inlineContent)return Selection.near($head);let $anchor=doc.resolve(mapping.map(this.anchor));return new TextSelection($anchor.parent.inlineContent?$anchor:$head,$head)}replace(tr,content=Slice.empty){if(super.replace(tr,content),content==Slice.empty){let marks=this.$from.marksAcross(this.$to);marks&&tr.ensureMarks(marks)}}eq(other){return other instanceof TextSelection&&other.anchor==this.anchor&&other.head==this.head}getBookmark(){return new TextBookmark(this.anchor,this.head)}toJSON(){return{type:"text",anchor:this.anchor,head:this.head}}static fromJSON(doc,json){if("number"!=typeof json.anchor||"number"!=typeof json.head)throw new RangeError("Invalid input for TextSelection.fromJSON");return new TextSelection(doc.resolve(json.anchor),doc.resolve(json.head))}static create(doc,anchor,head=anchor){let $anchor=doc.resolve(anchor);return new this($anchor,head==anchor?$anchor:doc.resolve(head))}static between($anchor,$head,bias){let dPos=$anchor.pos-$head.pos;if(bias&&!dPos||(bias=dPos>=0?1:-1),!$head.parent.inlineContent){let found=Selection.findFrom($head,bias,!0)||Selection.findFrom($head,-bias,!0);if(!found)return Selection.near($head,bias);$head=found.$head}return $anchor.parent.inlineContent||(0==dPos||($anchor=(Selection.findFrom($anchor,-bias,!0)||Selection.findFrom($anchor,bias,!0)).$anchor).pos<$head.pos!=dPos<0)&&($anchor=$head),new TextSelection($anchor,$head)}}Selection.jsonID("text",TextSelection);class TextBookmark{constructor(anchor,head){this.anchor=anchor,this.head=head}map(mapping){return new TextBookmark(mapping.map(this.anchor),mapping.map(this.head))}resolve(doc){return TextSelection.between(doc.resolve(this.anchor),doc.resolve(this.head))}}class NodeSelection extends Selection{constructor($pos){let node=$pos.nodeAfter,$end=$pos.node(0).resolve($pos.pos+node.nodeSize);super($pos,$end),this.node=node}map(doc,mapping){let{deleted:deleted,pos:pos}=mapping.mapResult(this.anchor),$pos=doc.resolve(pos);return deleted?Selection.near($pos):new NodeSelection($pos)}content(){return new Slice(Fragment.from(this.node),0,0)}eq(other){return other instanceof NodeSelection&&other.anchor==this.anchor}toJSON(){return{type:"node",anchor:this.anchor}}getBookmark(){return new NodeBookmark(this.anchor)}static fromJSON(doc,json){if("number"!=typeof json.anchor)throw new RangeError("Invalid input for NodeSelection.fromJSON");return new NodeSelection(doc.resolve(json.anchor))}static create(doc,from){return new NodeSelection(doc.resolve(from))}static isSelectable(node){return!node.isText&&!1!==node.type.spec.selectable}}NodeSelection.prototype.visible=!1,Selection.jsonID("node",NodeSelection);class NodeBookmark{constructor(anchor){this.anchor=anchor}map(mapping){let{deleted:deleted,pos:pos}=mapping.mapResult(this.anchor);return deleted?new TextBookmark(pos,pos):new NodeBookmark(pos)}resolve(doc){let $pos=doc.resolve(this.anchor),node=$pos.nodeAfter;return node&&NodeSelection.isSelectable(node)?new NodeSelection($pos):Selection.near($pos)}}class AllSelection extends Selection{constructor(doc){super(doc.resolve(0),doc.resolve(doc.content.size))}replace(tr,content=Slice.empty){if(content==Slice.empty){tr.delete(0,tr.doc.content.size);let sel=Selection.atStart(tr.doc);sel.eq(tr.selection)||tr.setSelection(sel)}else super.replace(tr,content)}toJSON(){return{type:"all"}}static fromJSON(doc){return new AllSelection(doc)}map(doc){return new AllSelection(doc)}eq(other){return other instanceof AllSelection}getBookmark(){return AllBookmark}}Selection.jsonID("all",AllSelection);const AllBookmark={map(){return this},resolve:doc=>new AllSelection(doc)};function findSelectionIn(doc,node,pos,index,dir,text=!1){if(node.inlineContent)return TextSelection.create(doc,pos);for(let i=index-(dir>0?0:1);dir>0?i<node.childCount:i>=0;i+=dir){let child=node.child(i);if(child.isAtom){if(!text&&NodeSelection.isSelectable(child))return NodeSelection.create(doc,pos-(dir<0?child.nodeSize:0))}else{let inner=findSelectionIn(doc,child,pos+dir,dir<0?child.childCount:0,dir,text);if(inner)return inner}pos+=child.nodeSize*dir}return null}function selectionToInsertionEnd(tr,startLen,bias){let last=tr.steps.length-1;if(last<startLen)return;let end,step=tr.steps[last];(step instanceof ReplaceStep||step instanceof ReplaceAroundStep)&&(tr.mapping.maps[last].forEach(((_from,_to,_newFrom,newTo)=>{null==end&&(end=newTo)})),tr.setSelection(Selection.near(tr.doc.resolve(end),bias)))}class Transaction extends Transform{constructor(state){super(state.doc),this.curSelectionFor=0,this.updated=0,this.meta=Object.create(null),this.time=Date.now(),this.curSelection=state.selection,this.storedMarks=state.storedMarks}get selection(){return this.curSelectionFor<this.steps.length&&(this.curSelection=this.curSelection.map(this.doc,this.mapping.slice(this.curSelectionFor)),this.curSelectionFor=this.steps.length),this.curSelection}setSelection(selection){if(selection.$from.doc!=this.doc)throw new RangeError("Selection passed to setSelection must point at the current document");return this.curSelection=selection,this.curSelectionFor=this.steps.length,this.updated=-3&this.updated|1,this.storedMarks=null,this}get selectionSet(){return(1&this.updated)>0}setStoredMarks(marks){return this.storedMarks=marks,this.updated|=2,this}ensureMarks(marks){return Mark.sameSet(this.storedMarks||this.selection.$from.marks(),marks)||this.setStoredMarks(marks),this}addStoredMark(mark){return this.ensureMarks(mark.addToSet(this.storedMarks||this.selection.$head.marks()))}removeStoredMark(mark){return this.ensureMarks(mark.removeFromSet(this.storedMarks||this.selection.$head.marks()))}get storedMarksSet(){return(2&this.updated)>0}addStep(step,doc){super.addStep(step,doc),this.updated=-3&this.updated,this.storedMarks=null}setTime(time){return this.time=time,this}replaceSelection(slice){return this.selection.replace(this,slice),this}replaceSelectionWith(node,inheritMarks=!0){let selection=this.selection;return inheritMarks&&(node=node.mark(this.storedMarks||(selection.empty?selection.$from.marks():selection.$from.marksAcross(selection.$to)||Mark.none))),selection.replaceWith(this,node),this}deleteSelection(){return this.selection.replace(this),this}insertText(text,from,to){let schema=this.doc.type.schema;if(null==from)return text?this.replaceSelectionWith(schema.text(text),!0):this.deleteSelection();{if(null==to&&(to=from),to=null==to?from:to,!text)return this.deleteRange(from,to);let marks=this.storedMarks;if(!marks){let $from=this.doc.resolve(from);marks=to==from?$from.marks():$from.marksAcross(this.doc.resolve(to))}return this.replaceRangeWith(from,to,schema.text(text,marks)),this.selection.empty||this.setSelection(Selection.near(this.selection.$to)),this}}setMeta(key,value){return this.meta["string"==typeof key?key:key.key]=value,this}getMeta(key){return this.meta["string"==typeof key?key:key.key]}get isGeneric(){for(let _ in this.meta)return!1;return!0}scrollIntoView(){return this.updated|=4,this}get scrolledIntoView(){return(4&this.updated)>0}}function bind(f,self){return self&&f?f.bind(self):f}class FieldDesc{constructor(name,desc,self){this.name=name,this.init=bind(desc.init,self),this.apply=bind(desc.apply,self)}}const baseFields=[new FieldDesc("doc",{init:config=>config.doc||config.schema.topNodeType.createAndFill(),apply:tr=>tr.doc}),new FieldDesc("selection",{init:(config,instance)=>config.selection||Selection.atStart(instance.doc),apply:tr=>tr.selection}),new FieldDesc("storedMarks",{init:config=>config.storedMarks||null,apply:(tr,_marks,_old,state)=>state.selection.$cursor?tr.storedMarks:null}),new FieldDesc("scrollToSelection",{init:()=>0,apply:(tr,prev)=>tr.scrolledIntoView?prev+1:prev})];class Configuration{constructor(schema,plugins){this.schema=schema,this.plugins=[],this.pluginsByKey=Object.create(null),this.fields=baseFields.slice(),plugins&&plugins.forEach((plugin=>{if(this.pluginsByKey[plugin.key])throw new RangeError("Adding different instances of a keyed plugin ("+plugin.key+")");this.plugins.push(plugin),this.pluginsByKey[plugin.key]=plugin,plugin.spec.state&&this.fields.push(new FieldDesc(plugin.key,plugin.spec.state,plugin))}))}}class EditorState{constructor(config){this.config=config}get schema(){return this.config.schema}get plugins(){return this.config.plugins}apply(tr){return this.applyTransaction(tr).state}filterTransaction(tr,ignore=-1){for(let i=0;i<this.config.plugins.length;i++)if(i!=ignore){let plugin=this.config.plugins[i];if(plugin.spec.filterTransaction&&!plugin.spec.filterTransaction.call(plugin,tr,this))return!1}return!0}applyTransaction(rootTr){if(!this.filterTransaction(rootTr))return{state:this,transactions:[]};let trs=[rootTr],newState=this.applyInner(rootTr),seen=null;for(;;){let haveNew=!1;for(let i=0;i<this.config.plugins.length;i++){let plugin=this.config.plugins[i];if(plugin.spec.appendTransaction){let n=seen?seen[i].n:0,oldState=seen?seen[i].state:this,tr=n<trs.length&&plugin.spec.appendTransaction.call(plugin,n?trs.slice(n):trs,oldState,newState);if(tr&&newState.filterTransaction(tr,i)){if(tr.setMeta("appendedTransaction",rootTr),!seen){seen=[];for(let j=0;j<this.config.plugins.length;j++)seen.push(j<i?{state:newState,n:trs.length}:{state:this,n:0})}trs.push(tr),newState=newState.applyInner(tr),haveNew=!0}seen&&(seen[i]={state:newState,n:trs.length})}}if(!haveNew)return{state:newState,transactions:trs}}}applyInner(tr){if(!tr.before.eq(this.doc))throw new RangeError("Applying a mismatched transaction");let newInstance=new EditorState(this.config),fields=this.config.fields;for(let i=0;i<fields.length;i++){let field=fields[i];newInstance[field.name]=field.apply(tr,this[field.name],this,newInstance)}return newInstance}get tr(){return new Transaction(this)}static create(config){let $config=new Configuration(config.doc?config.doc.type.schema:config.schema,config.plugins),instance=new EditorState($config);for(let i=0;i<$config.fields.length;i++)instance[$config.fields[i].name]=$config.fields[i].init(config,instance);return instance}reconfigure(config){let $config=new Configuration(this.schema,config.plugins),fields=$config.fields,instance=new EditorState($config);for(let i=0;i<fields.length;i++){let name=fields[i].name;instance[name]=this.hasOwnProperty(name)?this[name]:fields[i].init(config,instance)}return instance}toJSON(pluginFields){let result={doc:this.doc.toJSON(),selection:this.selection.toJSON()};if(this.storedMarks&&(result.storedMarks=this.storedMarks.map((m=>m.toJSON()))),pluginFields&&"object"==typeof pluginFields)for(let prop in pluginFields){if("doc"==prop||"selection"==prop)throw new RangeError("The JSON fields `doc` and `selection` are reserved");let plugin=pluginFields[prop],state=plugin.spec.state;state&&state.toJSON&&(result[prop]=state.toJSON.call(plugin,this[plugin.key]))}return result}static fromJSON(config,json,pluginFields){if(!json)throw new RangeError("Invalid input for EditorState.fromJSON");if(!config.schema)throw new RangeError("Required config field 'schema' missing");let $config=new Configuration(config.schema,config.plugins),instance=new EditorState($config);return $config.fields.forEach((field=>{if("doc"==field.name)instance.doc=Node.fromJSON(config.schema,json.doc);else if("selection"==field.name)instance.selection=Selection.fromJSON(instance.doc,json.selection);else if("storedMarks"==field.name)json.storedMarks&&(instance.storedMarks=json.storedMarks.map(config.schema.markFromJSON));else{if(pluginFields)for(let prop in pluginFields){let plugin=pluginFields[prop],state=plugin.spec.state;if(plugin.key==field.name&&state&&state.fromJSON&&Object.prototype.hasOwnProperty.call(json,prop))return void(instance[field.name]=state.fromJSON.call(plugin,config,json[prop],instance))}instance[field.name]=field.init(config,instance)}})),instance}}function bindProps(obj,self,target){for(let prop in obj){let val=obj[prop];val instanceof Function?val=val.bind(self):"handleDOMEvents"==prop&&(val=bindProps(val,self,{})),target[prop]=val}return target}class Plugin{constructor(spec){this.spec=spec,this.props={},spec.props&&bindProps(spec.props,this,this.props),this.key=spec.key?spec.key.key:createKey("plugin")}getState(state){return state[this.key]}}const keys=Object.create(null);function createKey(name){return name in keys?name+"$"+ ++keys[name]:(keys[name]=0,name+"$")}class PluginKey{constructor(name="key"){this.key=createKey(name)}get(state){return state.config.pluginsByKey[this.key]}getState(state){return state[this.key]}}const domIndex=function(node){for(var index=0;;index++)if(!(node=node.previousSibling))return index},parentNode=function(node){let parent=node.assignedSlot||node.parentNode;return parent&&11==parent.nodeType?parent.host:parent};let reusedRange=null;const textRange=function(node,from,to){let range=reusedRange||(reusedRange=document.createRange());return range.setEnd(node,null==to?node.nodeValue.length:to),range.setStart(node,from||0),range},isEquivalentPosition=function(node,off,targetNode,targetOff){return targetNode&&(scanFor(node,off,targetNode,targetOff,-1)||scanFor(node,off,targetNode,targetOff,1))},atomElements=/^(img|br|input|textarea|hr)$/i;function scanFor(node,off,targetNode,targetOff,dir){for(;;){if(node==targetNode&&off==targetOff)return!0;if(off==(dir<0?0:nodeSize(node))){let parent=node.parentNode;if(!parent||1!=parent.nodeType||hasBlockDesc(node)||atomElements.test(node.nodeName)||"false"==node.contentEditable)return!1;off=domIndex(node)+(dir<0?0:1),node=parent}else{if(1!=node.nodeType)return!1;if("false"==(node=node.childNodes[off+(dir<0?-1:0)]).contentEditable)return!1;off=dir<0?nodeSize(node):0}}}function nodeSize(node){return 3==node.nodeType?node.nodeValue.length:node.childNodes.length}function hasBlockDesc(dom){let desc;for(let cur=dom;cur&&!(desc=cur.pmViewDesc);cur=cur.parentNode);return desc&&desc.node&&desc.node.isBlock&&(desc.dom==dom||desc.contentDOM==dom)}const selectionCollapsed=function(domSel){return domSel.focusNode&&isEquivalentPosition(domSel.focusNode,domSel.focusOffset,domSel.anchorNode,domSel.anchorOffset)};function keyEvent(keyCode,key){let event=document.createEvent("Event");return event.initEvent("keydown",!0,!0),event.keyCode=keyCode,event.key=event.code=key,event}const nav$1="undefined"!=typeof navigator?navigator:null,doc$1="undefined"!=typeof document?document:null,agent$1=nav$1&&nav$1.userAgent||"",ie_edge$1=/Edge\/(\d+)/.exec(agent$1),ie_upto10$1=/MSIE \d/.exec(agent$1),ie_11up$1=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(agent$1),ie$4=!!(ie_upto10$1||ie_11up$1||ie_edge$1),ie_version=ie_upto10$1?document.documentMode:ie_11up$1?+ie_11up$1[1]:ie_edge$1?+ie_edge$1[1]:0,gecko$1=!ie$4&&/gecko\/(\d+)/i.test(agent$1);gecko$1&&(/Firefox\/(\d+)/.exec(agent$1)||[0,0])[1];const _chrome$1=!ie$4&&/Chrome\/(\d+)/.exec(agent$1),chrome=!!_chrome$1,chrome_version=_chrome$1?+_chrome$1[1]:0,safari$1=!ie$4&&!!nav$1&&/Apple Computer/.test(nav$1.vendor),ios$1=safari$1&&(/Mobile\/\w+/.test(agent$1)||!!nav$1&&nav$1.maxTouchPoints>2),mac$3=ios$1||!!nav$1&&/Mac/.test(nav$1.platform),windows=!!nav$1&&/Win/.test(nav$1.platform),android=/Android \d/.test(agent$1),webkit$1=!!doc$1&&"webkitFontSmoothing"in doc$1.documentElement.style,webkit_version=webkit$1?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0;function windowRect(doc){let vp=doc.defaultView&&doc.defaultView.visualViewport;return vp?{left:0,right:vp.width,top:0,bottom:vp.height}:{left:0,right:doc.documentElement.clientWidth,top:0,bottom:doc.documentElement.clientHeight}}function getSide(value,side){return"number"==typeof value?value:value[side]}function clientRect(node){let rect=node.getBoundingClientRect(),scaleX=rect.width/node.offsetWidth||1,scaleY=rect.height/node.offsetHeight||1;return{left:rect.left,right:rect.left+node.clientWidth*scaleX,top:rect.top,bottom:rect.top+node.clientHeight*scaleY}}function scrollRectIntoView(view,rect,startDOM){let scrollThreshold=view.someProp("scrollThreshold")||0,scrollMargin=view.someProp("scrollMargin")||5,doc=view.dom.ownerDocument;for(let parent=startDOM||view.dom;parent;parent=parentNode(parent)){if(1!=parent.nodeType)continue;let elt=parent,atTop=elt==doc.body,bounding=atTop?windowRect(doc):clientRect(elt),moveX=0,moveY=0;if(rect.top<bounding.top+getSide(scrollThreshold,"top")?moveY=-(bounding.top-rect.top+getSide(scrollMargin,"top")):rect.bottom>bounding.bottom-getSide(scrollThreshold,"bottom")&&(moveY=rect.bottom-rect.top>bounding.bottom-bounding.top?rect.top+getSide(scrollMargin,"top")-bounding.top:rect.bottom-bounding.bottom+getSide(scrollMargin,"bottom")),rect.left<bounding.left+getSide(scrollThreshold,"left")?moveX=-(bounding.left-rect.left+getSide(scrollMargin,"left")):rect.right>bounding.right-getSide(scrollThreshold,"right")&&(moveX=rect.right-bounding.right+getSide(scrollMargin,"right")),moveX||moveY)if(atTop)doc.defaultView.scrollBy(moveX,moveY);else{let startX=elt.scrollLeft,startY=elt.scrollTop;moveY&&(elt.scrollTop+=moveY),moveX&&(elt.scrollLeft+=moveX);let dX=elt.scrollLeft-startX,dY=elt.scrollTop-startY;rect={left:rect.left-dX,top:rect.top-dY,right:rect.right-dX,bottom:rect.bottom-dY}}if(atTop||/^(fixed|sticky)$/.test(getComputedStyle(parent).position))break}}function scrollStack(dom){let stack=[],doc=dom.ownerDocument;for(let cur=dom;cur&&(stack.push({dom:cur,top:cur.scrollTop,left:cur.scrollLeft}),dom!=doc);cur=parentNode(cur));return stack}function restoreScrollStack(stack,dTop){for(let i=0;i<stack.length;i++){let{dom:dom,top:top,left:left}=stack[i];dom.scrollTop!=top+dTop&&(dom.scrollTop=top+dTop),dom.scrollLeft!=left&&(dom.scrollLeft=left)}}let preventScrollSupported=null;function findOffsetInNode(node,coords){let closest,coordsClosest,firstBelow,coordsBelow,dxClosest=2e8,offset=0,rowBot=coords.top,rowTop=coords.top;for(let child=node.firstChild,childIndex=0;child;child=child.nextSibling,childIndex++){let rects;if(1==child.nodeType)rects=child.getClientRects();else{if(3!=child.nodeType)continue;rects=textRange(child).getClientRects()}for(let i=0;i<rects.length;i++){let rect=rects[i];if(rect.top<=rowBot&&rect.bottom>=rowTop){rowBot=Math.max(rect.bottom,rowBot),rowTop=Math.min(rect.top,rowTop);let dx=rect.left>coords.left?rect.left-coords.left:rect.right<coords.left?coords.left-rect.right:0;if(dx<dxClosest){closest=child,dxClosest=dx,coordsClosest=dx&&3==closest.nodeType?{left:rect.right<coords.left?rect.right:rect.left,top:coords.top}:coords,1==child.nodeType&&dx&&(offset=childIndex+(coords.left>=(rect.left+rect.right)/2?1:0));continue}}else rect.top>coords.top&&!firstBelow&&rect.left<=coords.left&&rect.right>=coords.left&&(firstBelow=child,coordsBelow={left:Math.max(rect.left,Math.min(rect.right,coords.left)),top:rect.top});!closest&&(coords.left>=rect.right&&coords.top>=rect.top||coords.left>=rect.left&&coords.top>=rect.bottom)&&(offset=childIndex+1)}}return!closest&&firstBelow&&(closest=firstBelow,coordsClosest=coordsBelow,dxClosest=0),closest&&3==closest.nodeType?function(node,coords){let len=node.nodeValue.length,range=document.createRange();for(let i=0;i<len;i++){range.setEnd(node,i+1),range.setStart(node,i);let rect=singleRect(range,1);if(rect.top!=rect.bottom&&inRect(coords,rect))return{node:node,offset:i+(coords.left>=(rect.left+rect.right)/2?1:0)}}return{node:node,offset:0}}(closest,coordsClosest):!closest||dxClosest&&1==closest.nodeType?{node:node,offset:offset}:findOffsetInNode(closest,coordsClosest)}function inRect(coords,rect){return coords.left>=rect.left-1&&coords.left<=rect.right+1&&coords.top>=rect.top-1&&coords.top<=rect.bottom+1}function elementFromPoint(element,coords,box){let len=element.childNodes.length;if(len&&box.top<box.bottom)for(let startI=Math.max(0,Math.min(len-1,Math.floor(len*(coords.top-box.top)/(box.bottom-box.top))-2)),i=startI;;){let child=element.childNodes[i];if(1==child.nodeType){let rects=child.getClientRects();for(let j=0;j<rects.length;j++){let rect=rects[j];if(inRect(coords,rect))return elementFromPoint(child,coords,rect)}}if((i=(i+1)%len)==startI)break}return element}function posAtCoords(view,coords){let node,doc=view.dom.ownerDocument,offset=0,caret=function(doc,x,y){if(doc.caretPositionFromPoint)try{let pos=doc.caretPositionFromPoint(x,y);if(pos)return{node:pos.offsetNode,offset:pos.offset}}catch(_){}if(doc.caretRangeFromPoint){let range=doc.caretRangeFromPoint(x,y);if(range)return{node:range.startContainer,offset:range.startOffset}}}(doc,coords.left,coords.top);caret&&({node:node,offset:offset}=caret);let pos,elt=(view.root.elementFromPoint?view.root:doc).elementFromPoint(coords.left,coords.top);if(!elt||!view.dom.contains(1!=elt.nodeType?elt.parentNode:elt)){let box=view.dom.getBoundingClientRect();if(!inRect(coords,box))return null;if(elt=elementFromPoint(view.dom,coords,box),!elt)return null}if(safari$1)for(let p=elt;node&&p;p=parentNode(p))p.draggable&&(node=void 0);if(elt=function(dom,coords){let parent=dom.parentNode;return parent&&/^li$/i.test(parent.nodeName)&&coords.left<dom.getBoundingClientRect().left?parent:dom}(elt,coords),node){if(gecko$1&&1==node.nodeType&&(offset=Math.min(offset,node.childNodes.length),offset<node.childNodes.length)){let box,next=node.childNodes[offset];"IMG"==next.nodeName&&(box=next.getBoundingClientRect()).right<=coords.left&&box.bottom>coords.top&&offset++}let prev;webkit$1&&offset&&1==node.nodeType&&1==(prev=node.childNodes[offset-1]).nodeType&&"false"==prev.contentEditable&&prev.getBoundingClientRect().top>=coords.top&&offset--,node==view.dom&&offset==node.childNodes.length-1&&1==node.lastChild.nodeType&&coords.top>node.lastChild.getBoundingClientRect().bottom?pos=view.state.doc.content.size:0!=offset&&1==node.nodeType&&"BR"==node.childNodes[offset-1].nodeName||(pos=function(view,node,offset,coords){let outsideBlock=-1;for(let cur=node,sawBlock=!1;cur!=view.dom;){let desc=view.docView.nearestDesc(cur,!0);if(!desc)return null;if(1==desc.dom.nodeType&&(desc.node.isBlock&&desc.parent&&!sawBlock||!desc.contentDOM)){let rect=desc.dom.getBoundingClientRect();if(desc.node.isBlock&&desc.parent&&!sawBlock&&(sawBlock=!0,rect.left>coords.left||rect.top>coords.top?outsideBlock=desc.posBefore:(rect.right<coords.left||rect.bottom<coords.top)&&(outsideBlock=desc.posAfter)),!desc.contentDOM&&outsideBlock<0&&!desc.node.isText)return(desc.node.isBlock?coords.top<(rect.top+rect.bottom)/2:coords.left<(rect.left+rect.right)/2)?desc.posBefore:desc.posAfter}cur=desc.dom.parentNode}return outsideBlock>-1?outsideBlock:view.docView.posFromDOM(node,offset,-1)}(view,node,offset,coords))}null==pos&&(pos=function(view,elt,coords){let{node:node,offset:offset}=findOffsetInNode(elt,coords),bias=-1;if(1==node.nodeType&&!node.firstChild){let rect=node.getBoundingClientRect();bias=rect.left!=rect.right&&coords.left>(rect.left+rect.right)/2?1:-1}return view.docView.posFromDOM(node,offset,bias)}(view,elt,coords));let desc=view.docView.nearestDesc(elt,!0);return{pos:pos,inside:desc?desc.posAtStart-desc.border:-1}}function nonZero(rect){return rect.top<rect.bottom||rect.left<rect.right}function singleRect(target,bias){let rects=target.getClientRects();if(rects.length){let first=rects[bias<0?0:rects.length-1];if(nonZero(first))return first}return Array.prototype.find.call(rects,nonZero)||target.getBoundingClientRect()}const BIDI=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;function coordsAtPos(view,pos,side){let{node:node,offset:offset,atom:atom}=view.docView.domFromPos(pos,side<0?-1:1),supportEmptyRange=webkit$1||gecko$1;if(3==node.nodeType){if(!supportEmptyRange||!BIDI.test(node.nodeValue)&&(side<0?offset:offset!=node.nodeValue.length)){let from=offset,to=offset,takeSide=side<0?1:-1;return side<0&&!offset?(to++,takeSide=-1):side>=0&&offset==node.nodeValue.length?(from--,takeSide=1):side<0?from--:to++,flattenV(singleRect(textRange(node,from,to),takeSide),takeSide<0)}{let rect=singleRect(textRange(node,offset,offset),side);if(gecko$1&&offset&&/\s/.test(node.nodeValue[offset-1])&&offset<node.nodeValue.length){let rectBefore=singleRect(textRange(node,offset-1,offset-1),-1);if(rectBefore.top==rect.top){let rectAfter=singleRect(textRange(node,offset,offset+1),-1);if(rectAfter.top!=rect.top)return flattenV(rectAfter,rectAfter.left<rectBefore.left)}}return rect}}if(!view.state.doc.resolve(pos-(atom||0)).parent.inlineContent){if(null==atom&&offset&&(side<0||offset==nodeSize(node))){let before=node.childNodes[offset-1];if(1==before.nodeType)return flattenH(before.getBoundingClientRect(),!1)}if(null==atom&&offset<nodeSize(node)){let after=node.childNodes[offset];if(1==after.nodeType)return flattenH(after.getBoundingClientRect(),!0)}return flattenH(node.getBoundingClientRect(),side>=0)}if(null==atom&&offset&&(side<0||offset==nodeSize(node))){let before=node.childNodes[offset-1],target=3==before.nodeType?textRange(before,nodeSize(before)-(supportEmptyRange?0:1)):1!=before.nodeType||"BR"==before.nodeName&&before.nextSibling?null:before;if(target)return flattenV(singleRect(target,1),!1)}if(null==atom&&offset<nodeSize(node)){let after=node.childNodes[offset];for(;after.pmViewDesc&&after.pmViewDesc.ignoreForCoords;)after=after.nextSibling;let target=after?3==after.nodeType?textRange(after,0,supportEmptyRange?0:1):1==after.nodeType?after:null:null;if(target)return flattenV(singleRect(target,-1),!0)}return flattenV(singleRect(3==node.nodeType?textRange(node):node,-side),side>=0)}function flattenV(rect,left){if(0==rect.width)return rect;let x=left?rect.left:rect.right;return{top:rect.top,bottom:rect.bottom,left:x,right:x}}function flattenH(rect,top){if(0==rect.height)return rect;let y=top?rect.top:rect.bottom;return{top:y,bottom:y,left:rect.left,right:rect.right}}function withFlushedState(view,state,f){let viewState=view.state,active=view.root.activeElement;viewState!=state&&view.updateState(state),active!=view.dom&&view.focus();try{return f()}finally{viewState!=state&&view.updateState(viewState),active!=view.dom&&active&&active.focus()}}const maybeRTL=/[\u0590-\u08ac]/;let cachedState=null,cachedDir=null,cachedResult=!1;function endOfTextblock(view,state,dir){return cachedState==state&&cachedDir==dir?cachedResult:(cachedState=state,cachedDir=dir,cachedResult="up"==dir||"down"==dir?function(view,state,dir){let sel=state.selection,$pos="up"==dir?sel.$from:sel.$to;return withFlushedState(view,state,(()=>{let{node:dom}=view.docView.domFromPos($pos.pos,"up"==dir?-1:1);for(;;){let nearest=view.docView.nearestDesc(dom,!0);if(!nearest)break;if(nearest.node.isBlock){dom=nearest.contentDOM||nearest.dom;break}dom=nearest.dom.parentNode}let coords=coordsAtPos(view,$pos.pos,1);for(let child=dom.firstChild;child;child=child.nextSibling){let boxes;if(1==child.nodeType)boxes=child.getClientRects();else{if(3!=child.nodeType)continue;boxes=textRange(child,0,child.nodeValue.length).getClientRects()}for(let i=0;i<boxes.length;i++){let box=boxes[i];if(box.bottom>box.top+1&&("up"==dir?coords.top-box.top>2*(box.bottom-coords.top):box.bottom-coords.bottom>2*(coords.bottom-box.top)))return!1}}return!0}))}(view,state,dir):function(view,state,dir){let{$head:$head}=state.selection;if(!$head.parent.isTextblock)return!1;let offset=$head.parentOffset,atStart=!offset,atEnd=offset==$head.parent.content.size,sel=view.domSelection();return maybeRTL.test($head.parent.textContent)&&sel.modify?withFlushedState(view,state,(()=>{let{focusNode:oldNode,focusOffset:oldOff,anchorNode:anchorNode,anchorOffset:anchorOffset}=view.domSelectionRange(),oldBidiLevel=sel.caretBidiLevel;sel.modify("move",dir,"character");let parentDOM=$head.depth?view.docView.domAfterPos($head.before()):view.dom,{focusNode:newNode,focusOffset:newOff}=view.domSelectionRange(),result=newNode&&!parentDOM.contains(1==newNode.nodeType?newNode:newNode.parentNode)||oldNode==newNode&&oldOff==newOff;try{sel.collapse(anchorNode,anchorOffset),oldNode&&(oldNode!=anchorNode||oldOff!=anchorOffset)&&sel.extend&&sel.extend(oldNode,oldOff)}catch(_){}return null!=oldBidiLevel&&(sel.caretBidiLevel=oldBidiLevel),result})):"left"==dir||"backward"==dir?atStart:atEnd}(view,state,dir))}class ViewDesc{constructor(parent,children,dom,contentDOM){this.parent=parent,this.children=children,this.dom=dom,this.contentDOM=contentDOM,this.dirty=0,dom.pmViewDesc=this}matchesWidget(widget){return!1}matchesMark(mark){return!1}matchesNode(node,outerDeco,innerDeco){return!1}matchesHack(nodeName){return!1}parseRule(){return null}stopEvent(event){return!1}get size(){let size=0;for(let i=0;i<this.children.length;i++)size+=this.children[i].size;return size}get border(){return 0}destroy(){this.parent=void 0,this.dom.pmViewDesc==this&&(this.dom.pmViewDesc=void 0);for(let i=0;i<this.children.length;i++)this.children[i].destroy()}posBeforeChild(child){for(let i=0,pos=this.posAtStart;;i++){let cur=this.children[i];if(cur==child)return pos;pos+=cur.size}}get posBefore(){return this.parent.posBeforeChild(this)}get posAtStart(){return this.parent?this.parent.posBeforeChild(this)+this.border:0}get posAfter(){return this.posBefore+this.size}get posAtEnd(){return this.posAtStart+this.size-2*this.border}localPosFromDOM(dom,offset,bias){if(this.contentDOM&&this.contentDOM.contains(1==dom.nodeType?dom:dom.parentNode)){if(bias<0){let domBefore,desc;if(dom==this.contentDOM)domBefore=dom.childNodes[offset-1];else{for(;dom.parentNode!=this.contentDOM;)dom=dom.parentNode;domBefore=dom.previousSibling}for(;domBefore&&(!(desc=domBefore.pmViewDesc)||desc.parent!=this);)domBefore=domBefore.previousSibling;return domBefore?this.posBeforeChild(desc)+desc.size:this.posAtStart}{let domAfter,desc;if(dom==this.contentDOM)domAfter=dom.childNodes[offset];else{for(;dom.parentNode!=this.contentDOM;)dom=dom.parentNode;domAfter=dom.nextSibling}for(;domAfter&&(!(desc=domAfter.pmViewDesc)||desc.parent!=this);)domAfter=domAfter.nextSibling;return domAfter?this.posBeforeChild(desc):this.posAtEnd}}let atEnd;if(dom==this.dom&&this.contentDOM)atEnd=offset>domIndex(this.contentDOM);else if(this.contentDOM&&this.contentDOM!=this.dom&&this.dom.contains(this.contentDOM))atEnd=2&dom.compareDocumentPosition(this.contentDOM);else if(this.dom.firstChild){if(0==offset)for(let search=dom;;search=search.parentNode){if(search==this.dom){atEnd=!1;break}if(search.previousSibling)break}if(null==atEnd&&offset==dom.childNodes.length)for(let search=dom;;search=search.parentNode){if(search==this.dom){atEnd=!0;break}if(search.nextSibling)break}}return(null==atEnd?bias>0:atEnd)?this.posAtEnd:this.posAtStart}nearestDesc(dom,onlyNodes=!1){for(let first=!0,cur=dom;cur;cur=cur.parentNode){let nodeDOM,desc=this.getDesc(cur);if(desc&&(!onlyNodes||desc.node)){if(!first||!(nodeDOM=desc.nodeDOM)||(1==nodeDOM.nodeType?nodeDOM.contains(1==dom.nodeType?dom:dom.parentNode):nodeDOM==dom))return desc;first=!1}}}getDesc(dom){let desc=dom.pmViewDesc;for(let cur=desc;cur;cur=cur.parent)if(cur==this)return desc}posFromDOM(dom,offset,bias){for(let scan=dom;scan;scan=scan.parentNode){let desc=this.getDesc(scan);if(desc)return desc.localPosFromDOM(dom,offset,bias)}return-1}descAt(pos){for(let i=0,offset=0;i<this.children.length;i++){let child=this.children[i],end=offset+child.size;if(offset==pos&&end!=offset){for(;!child.border&&child.children.length;)child=child.children[0];return child}if(pos<end)return child.descAt(pos-offset-child.border);offset=end}}domFromPos(pos,side){if(!this.contentDOM)return{node:this.dom,offset:0,atom:pos+1};let i=0,offset=0;for(let curPos=0;i<this.children.length;i++){let child=this.children[i],end=curPos+child.size;if(end>pos||child instanceof TrailingHackViewDesc){offset=pos-curPos;break}curPos=end}if(offset)return this.children[i].domFromPos(offset-this.children[i].border,side);for(let prev;i&&!(prev=this.children[i-1]).size&&prev instanceof WidgetViewDesc&&prev.side>=0;i--);if(side<=0){let prev,enter=!0;for(;prev=i?this.children[i-1]:null,prev&&prev.dom.parentNode!=this.contentDOM;i--,enter=!1);return prev&&side&&enter&&!prev.border&&!prev.domAtom?prev.domFromPos(prev.size,side):{node:this.contentDOM,offset:prev?domIndex(prev.dom)+1:0}}{let next,enter=!0;for(;next=i<this.children.length?this.children[i]:null,next&&next.dom.parentNode!=this.contentDOM;i++,enter=!1);return next&&enter&&!next.border&&!next.domAtom?next.domFromPos(0,side):{node:this.contentDOM,offset:next?domIndex(next.dom):this.contentDOM.childNodes.length}}}parseRange(from,to,base=0){if(0==this.children.length)return{node:this.contentDOM,from:from,to:to,fromOffset:0,toOffset:this.contentDOM.childNodes.length};let fromOffset=-1,toOffset=-1;for(let offset=base,i=0;;i++){let child=this.children[i],end=offset+child.size;if(-1==fromOffset&&from<=end){let childBase=offset+child.border;if(from>=childBase&&to<=end-child.border&&child.node&&child.contentDOM&&this.contentDOM.contains(child.contentDOM))return child.parseRange(from,to,childBase);from=offset;for(let j=i;j>0;j--){let prev=this.children[j-1];if(prev.size&&prev.dom.parentNode==this.contentDOM&&!prev.emptyChildAt(1)){fromOffset=domIndex(prev.dom)+1;break}from-=prev.size}-1==fromOffset&&(fromOffset=0)}if(fromOffset>-1&&(end>to||i==this.children.length-1)){to=end;for(let j=i+1;j<this.children.length;j++){let next=this.children[j];if(next.size&&next.dom.parentNode==this.contentDOM&&!next.emptyChildAt(-1)){toOffset=domIndex(next.dom);break}to+=next.size}-1==toOffset&&(toOffset=this.contentDOM.childNodes.length);break}offset=end}return{node:this.contentDOM,from:from,to:to,fromOffset:fromOffset,toOffset:toOffset}}emptyChildAt(side){if(this.border||!this.contentDOM||!this.children.length)return!1;let child=this.children[side<0?0:this.children.length-1];return 0==child.size||child.emptyChildAt(side)}domAfterPos(pos){let{node:node,offset:offset}=this.domFromPos(pos,0);if(1!=node.nodeType||offset==node.childNodes.length)throw new RangeError("No node after pos "+pos);return node.childNodes[offset]}setSelection(anchor,head,root,force=!1){let from=Math.min(anchor,head),to=Math.max(anchor,head);for(let i=0,offset=0;i<this.children.length;i++){let child=this.children[i],end=offset+child.size;if(from>offset&&to<end)return child.setSelection(anchor-offset-child.border,head-offset-child.border,root,force);offset=end}let anchorDOM=this.domFromPos(anchor,anchor?-1:1),headDOM=head==anchor?anchorDOM:this.domFromPos(head,head?-1:1),domSel=root.getSelection(),brKludge=!1;if((gecko$1||safari$1)&&anchor==head){let{node:node,offset:offset}=anchorDOM;if(3==node.nodeType){if(brKludge=!(!offset||"\n"!=node.nodeValue[offset-1]),brKludge&&offset==node.nodeValue.length)for(let after,scan=node;scan;scan=scan.parentNode){if(after=scan.nextSibling){"BR"==after.nodeName&&(anchorDOM=headDOM={node:after.parentNode,offset:domIndex(after)+1});break}let desc=scan.pmViewDesc;if(desc&&desc.node&&desc.node.isBlock)break}}else{let prev=node.childNodes[offset-1];brKludge=prev&&("BR"==prev.nodeName||"false"==prev.contentEditable)}}if(gecko$1&&domSel.focusNode&&domSel.focusNode!=headDOM.node&&1==domSel.focusNode.nodeType){let after=domSel.focusNode.childNodes[domSel.focusOffset];after&&"false"==after.contentEditable&&(force=!0)}if(!(force||brKludge&&safari$1)&&isEquivalentPosition(anchorDOM.node,anchorDOM.offset,domSel.anchorNode,domSel.anchorOffset)&&isEquivalentPosition(headDOM.node,headDOM.offset,domSel.focusNode,domSel.focusOffset))return;let domSelExtended=!1;if((domSel.extend||anchor==head)&&!brKludge){domSel.collapse(anchorDOM.node,anchorDOM.offset);try{anchor!=head&&domSel.extend(headDOM.node,headDOM.offset),domSelExtended=!0}catch(_){}}if(!domSelExtended){if(anchor>head){let tmp=anchorDOM;anchorDOM=headDOM,headDOM=tmp}let range=document.createRange();range.setEnd(headDOM.node,headDOM.offset),range.setStart(anchorDOM.node,anchorDOM.offset),domSel.removeAllRanges(),domSel.addRange(range)}}ignoreMutation(mutation){return!this.contentDOM&&"selection"!=mutation.type}get contentLost(){return this.contentDOM&&this.contentDOM!=this.dom&&!this.dom.contains(this.contentDOM)}markDirty(from,to){for(let offset=0,i=0;i<this.children.length;i++){let child=this.children[i],end=offset+child.size;if(offset==end?from<=end&&to>=offset:from<end&&to>offset){let startInside=offset+child.border,endInside=end-child.border;if(from>=startInside&&to<=endInside)return this.dirty=from==offset||to==end?2:1,void(from!=startInside||to!=endInside||!child.contentLost&&child.dom.parentNode==this.contentDOM?child.markDirty(from-startInside,to-startInside):child.dirty=3);child.dirty=child.dom!=child.contentDOM||child.dom.parentNode!=this.contentDOM||child.children.length?3:2}offset=end}this.dirty=2}markParentsDirty(){let level=1;for(let node=this.parent;node;node=node.parent,level++){let dirty=1==level?2:1;node.dirty<dirty&&(node.dirty=dirty)}}get domAtom(){return!1}get ignoreForCoords(){return!1}}class WidgetViewDesc extends ViewDesc{constructor(parent,widget,view,pos){let self,dom=widget.type.toDOM;if("function"==typeof dom&&(dom=dom(view,(()=>self?self.parent?self.parent.posBeforeChild(self):void 0:pos))),!widget.type.spec.raw){if(1!=dom.nodeType){let wrap=document.createElement("span");wrap.appendChild(dom),dom=wrap}dom.contentEditable="false",dom.classList.add("ProseMirror-widget")}super(parent,[],dom,null),this.widget=widget,this.widget=widget,self=this}matchesWidget(widget){return 0==this.dirty&&widget.type.eq(this.widget.type)}parseRule(){return{ignore:!0}}stopEvent(event){let stop=this.widget.spec.stopEvent;return!!stop&&stop(event)}ignoreMutation(mutation){return"selection"!=mutation.type||this.widget.spec.ignoreSelection}destroy(){this.widget.type.destroy(this.dom),super.destroy()}get domAtom(){return!0}get side(){return this.widget.type.side}}class CompositionViewDesc extends ViewDesc{constructor(parent,dom,textDOM,text){super(parent,[],dom,null),this.textDOM=textDOM,this.text=text}get size(){return this.text.length}localPosFromDOM(dom,offset){return dom!=this.textDOM?this.posAtStart+(offset?this.size:0):this.posAtStart+offset}domFromPos(pos){return{node:this.textDOM,offset:pos}}ignoreMutation(mut){return"characterData"===mut.type&&mut.target.nodeValue==mut.oldValue}}class MarkViewDesc extends ViewDesc{constructor(parent,mark,dom,contentDOM){super(parent,[],dom,contentDOM),this.mark=mark}static create(parent,mark,inline,view){let custom=view.nodeViews[mark.type.name],spec=custom&&custom(mark,view,inline);return spec&&spec.dom||(spec=DOMSerializer.renderSpec(document,mark.type.spec.toDOM(mark,inline))),new MarkViewDesc(parent,mark,spec.dom,spec.contentDOM||spec.dom)}parseRule(){return 3&this.dirty||this.mark.type.spec.reparseInView?null:{mark:this.mark.type.name,attrs:this.mark.attrs,contentElement:this.contentDOM}}matchesMark(mark){return 3!=this.dirty&&this.mark.eq(mark)}markDirty(from,to){if(super.markDirty(from,to),0!=this.dirty){let parent=this.parent;for(;!parent.node;)parent=parent.parent;parent.dirty<this.dirty&&(parent.dirty=this.dirty),this.dirty=0}}slice(from,to,view){let copy=MarkViewDesc.create(this.parent,this.mark,!0,view),nodes=this.children,size=this.size;to<size&&(nodes=replaceNodes(nodes,to,size,view)),from>0&&(nodes=replaceNodes(nodes,0,from,view));for(let i=0;i<nodes.length;i++)nodes[i].parent=copy;return copy.children=nodes,copy}}class NodeViewDesc extends ViewDesc{constructor(parent,node,outerDeco,innerDeco,dom,contentDOM,nodeDOM,view,pos){super(parent,[],dom,contentDOM),this.node=node,this.outerDeco=outerDeco,this.innerDeco=innerDeco,this.nodeDOM=nodeDOM}static create(parent,node,outerDeco,innerDeco,view,pos){let descObj,custom=view.nodeViews[node.type.name],spec=custom&&custom(node,view,(()=>descObj?descObj.parent?descObj.parent.posBeforeChild(descObj):void 0:pos),outerDeco,innerDeco),dom=spec&&spec.dom,contentDOM=spec&&spec.contentDOM;if(node.isText)if(dom){if(3!=dom.nodeType)throw new RangeError("Text must be rendered as a DOM text node")}else dom=document.createTextNode(node.text);else dom||({dom:dom,contentDOM:contentDOM}=DOMSerializer.renderSpec(document,node.type.spec.toDOM(node)));contentDOM||node.isText||"BR"==dom.nodeName||(dom.hasAttribute("contenteditable")||(dom.contentEditable="false"),node.type.spec.draggable&&(dom.draggable=!0));let nodeDOM=dom;return dom=applyOuterDeco(dom,outerDeco,node),spec?descObj=new CustomNodeViewDesc(parent,node,outerDeco,innerDeco,dom,contentDOM||null,nodeDOM,spec,view,pos+1):node.isText?new TextViewDesc(parent,node,outerDeco,innerDeco,dom,nodeDOM,view):new NodeViewDesc(parent,node,outerDeco,innerDeco,dom,contentDOM||null,nodeDOM,view,pos+1)}parseRule(){if(this.node.type.spec.reparseInView)return null;let rule={node:this.node.type.name,attrs:this.node.attrs};if("pre"==this.node.type.whitespace&&(rule.preserveWhitespace="full"),this.contentDOM)if(this.contentLost){for(let i=this.children.length-1;i>=0;i--){let child=this.children[i];if(this.dom.contains(child.dom.parentNode)){rule.contentElement=child.dom.parentNode;break}}rule.contentElement||(rule.getContent=()=>Fragment.empty)}else rule.contentElement=this.contentDOM;else rule.getContent=()=>this.node.content;return rule}matchesNode(node,outerDeco,innerDeco){return 0==this.dirty&&node.eq(this.node)&&sameOuterDeco(outerDeco,this.outerDeco)&&innerDeco.eq(this.innerDeco)}get size(){return this.node.nodeSize}get border(){return this.node.isLeaf?0:1}updateChildren(view,pos){let inline=this.node.inlineContent,off=pos,composition=view.composing?this.localCompositionInfo(view,pos):null,localComposition=composition&&composition.pos>-1?composition:null,compositionInChild=composition&&composition.pos<0,updater=new ViewTreeUpdater(this,localComposition&&localComposition.node,view);!function(parent,deco,onWidget,onNode){let locals=deco.locals(parent),offset=0;if(0==locals.length){for(let i=0;i<parent.childCount;i++){let child=parent.child(i);onNode(child,locals,deco.forChild(offset,child),i),offset+=child.nodeSize}return}let decoIndex=0,active=[],restNode=null;for(let parentIndex=0;;){let widget,widgets,child,index;for(;decoIndex<locals.length&&locals[decoIndex].to==offset;){let next=locals[decoIndex++];next.widget&&(widget?(widgets||(widgets=[widget])).push(next):widget=next)}if(widget)if(widgets){widgets.sort(compareSide);for(let i=0;i<widgets.length;i++)onWidget(widgets[i],parentIndex,!!restNode)}else onWidget(widget,parentIndex,!!restNode);if(restNode)index=-1,child=restNode,restNode=null;else{if(!(parentIndex<parent.childCount))break;index=parentIndex,child=parent.child(parentIndex++)}for(let i=0;i<active.length;i++)active[i].to<=offset&&active.splice(i--,1);for(;decoIndex<locals.length&&locals[decoIndex].from<=offset&&locals[decoIndex].to>offset;)active.push(locals[decoIndex++]);let end=offset+child.nodeSize;if(child.isText){let cutAt=end;decoIndex<locals.length&&locals[decoIndex].from<cutAt&&(cutAt=locals[decoIndex].from);for(let i=0;i<active.length;i++)active[i].to<cutAt&&(cutAt=active[i].to);cutAt<end&&(restNode=child.cut(cutAt-offset),child=child.cut(0,cutAt-offset),end=cutAt,index=-1)}else for(;decoIndex<locals.length&&locals[decoIndex].to<end;)decoIndex++;let outerDeco=child.isInline&&!child.isLeaf?active.filter((d=>!d.inline)):active.slice();onNode(child,outerDeco,deco.forChild(offset,child),index),offset=end}}(this.node,this.innerDeco,((widget,i,insideNode)=>{widget.spec.marks?updater.syncToMarks(widget.spec.marks,inline,view):widget.type.side>=0&&!insideNode&&updater.syncToMarks(i==this.node.childCount?Mark.none:this.node.child(i).marks,inline,view),updater.placeWidget(widget,view,off)}),((child,outerDeco,innerDeco,i)=>{let compIndex;updater.syncToMarks(child.marks,inline,view),updater.findNodeMatch(child,outerDeco,innerDeco,i)||compositionInChild&&view.state.selection.from>off&&view.state.selection.to<off+child.nodeSize&&(compIndex=updater.findIndexWithChild(composition.node))>-1&&updater.updateNodeAt(child,outerDeco,innerDeco,compIndex,view)||updater.updateNextNode(child,outerDeco,innerDeco,view,i,off)||updater.addNode(child,outerDeco,innerDeco,view,off),off+=child.nodeSize})),updater.syncToMarks([],inline,view),this.node.isTextblock&&updater.addTextblockHacks(),updater.destroyRest(),(updater.changed||2==this.dirty)&&(localComposition&&this.protectLocalComposition(view,localComposition),renderDescs(this.contentDOM,this.children,view),ios$1&&function(dom){if("UL"==dom.nodeName||"OL"==dom.nodeName){let oldCSS=dom.style.cssText;dom.style.cssText=oldCSS+"; list-style: square !important",window.getComputedStyle(dom).listStyle,dom.style.cssText=oldCSS}}(this.dom))}localCompositionInfo(view,pos){let{from:from,to:to}=view.state.selection;if(!(view.state.selection instanceof TextSelection)||from<pos||to>pos+this.node.content.size)return null;let sel=view.domSelectionRange(),textBefore=function(node,offset){for(;;){if(3==node.nodeType&&offset)return node;if(1==node.nodeType&&offset>0){if("false"!=node.contentEditable)return null;offset=nodeSize(node=node.childNodes[offset-1])}else{if(!node.parentNode||hasBlockDesc(node))return null;offset=domIndex(node),node=node.parentNode}}}(sel.focusNode,sel.focusOffset),textAfter=function(node,offset){for(;;){if(3==node.nodeType&&offset<node.nodeValue.length)return node;if(1==node.nodeType&&offset<node.childNodes.length){if("false"!=node.contentEditable)return null;node=node.childNodes[offset],offset=0}else{if(!node.parentNode||hasBlockDesc(node))return null;offset=domIndex(node)+1,node=node.parentNode}}}(sel.focusNode,sel.focusOffset),textNode=textBefore||textAfter;if(textBefore&&textAfter&&textBefore!=textAfter){let descAfter=textAfter.pmViewDesc;(!descAfter||descAfter instanceof TextViewDesc&&descAfter.node.text!=textAfter.nodeValue)&&(textNode=textAfter)}if(!textNode||!this.dom.contains(textNode.parentNode))return null;if(this.node.inlineContent){let text=textNode.nodeValue,textPos=function(frag,text,from,to){for(let i=0,pos=0;i<frag.childCount&&pos<=to;){let child=frag.child(i++),childStart=pos;if(pos+=child.nodeSize,!child.isText)continue;let str=child.text;for(;i<frag.childCount;){let next=frag.child(i++);if(pos+=next.nodeSize,!next.isText)break;str+=next.text}if(pos>=from){if(pos>=to&&str.slice(to-text.length-childStart,to-childStart)==text)return to-text.length;let found=childStart<to?str.lastIndexOf(text,to-childStart-1):-1;if(found>=0&&found+text.length+childStart>=from)return childStart+found;if(from==to&&str.length>=to+text.length-childStart&&str.slice(to-childStart,to-childStart+text.length)==text)return to}}return-1}(this.node.content,text,from-pos,to-pos);return textPos<0?null:{node:textNode,pos:textPos,text:text}}return{node:textNode,pos:-1,text:""}}protectLocalComposition(view,{node:node,pos:pos,text:text}){if(this.getDesc(node))return;let topNode=node;for(;topNode.parentNode!=this.contentDOM;topNode=topNode.parentNode){for(;topNode.previousSibling;)topNode.parentNode.removeChild(topNode.previousSibling);for(;topNode.nextSibling;)topNode.parentNode.removeChild(topNode.nextSibling);topNode.pmViewDesc&&(topNode.pmViewDesc=void 0)}let desc=new CompositionViewDesc(this,topNode,node,text);view.input.compositionNodes.push(desc),this.children=replaceNodes(this.children,pos,pos+text.length,view,desc)}update(node,outerDeco,innerDeco,view){return!(3==this.dirty||!node.sameMarkup(this.node))&&(this.updateInner(node,outerDeco,innerDeco,view),!0)}updateInner(node,outerDeco,innerDeco,view){this.updateOuterDeco(outerDeco),this.node=node,this.innerDeco=innerDeco,this.contentDOM&&this.updateChildren(view,this.posAtStart),this.dirty=0}updateOuterDeco(outerDeco){if(sameOuterDeco(outerDeco,this.outerDeco))return;let needsWrap=1!=this.nodeDOM.nodeType,oldDOM=this.dom;this.dom=patchOuterDeco(this.dom,this.nodeDOM,computeOuterDeco(this.outerDeco,this.node,needsWrap),computeOuterDeco(outerDeco,this.node,needsWrap)),this.dom!=oldDOM&&(oldDOM.pmViewDesc=void 0,this.dom.pmViewDesc=this),this.outerDeco=outerDeco}selectNode(){1==this.nodeDOM.nodeType&&this.nodeDOM.classList.add("ProseMirror-selectednode"),!this.contentDOM&&this.node.type.spec.draggable||(this.dom.draggable=!0)}deselectNode(){1==this.nodeDOM.nodeType&&this.nodeDOM.classList.remove("ProseMirror-selectednode"),!this.contentDOM&&this.node.type.spec.draggable||this.dom.removeAttribute("draggable")}get domAtom(){return this.node.isAtom}}function docViewDesc(doc,outerDeco,innerDeco,dom,view){applyOuterDeco(dom,outerDeco,doc);let docView=new NodeViewDesc(void 0,doc,outerDeco,innerDeco,dom,dom,dom,view,0);return docView.contentDOM&&docView.updateChildren(view,0),docView}class TextViewDesc extends NodeViewDesc{constructor(parent,node,outerDeco,innerDeco,dom,nodeDOM,view){super(parent,node,outerDeco,innerDeco,dom,null,nodeDOM,view,0)}parseRule(){let skip=this.nodeDOM.parentNode;for(;skip&&skip!=this.dom&&!skip.pmIsDeco;)skip=skip.parentNode;return{skip:skip||!0}}update(node,outerDeco,innerDeco,view){return!(3==this.dirty||0!=this.dirty&&!this.inParent()||!node.sameMarkup(this.node))&&(this.updateOuterDeco(outerDeco),0==this.dirty&&node.text==this.node.text||node.text==this.nodeDOM.nodeValue||(this.nodeDOM.nodeValue=node.text,view.trackWrites==this.nodeDOM&&(view.trackWrites=null)),this.node=node,this.dirty=0,!0)}inParent(){let parentDOM=this.parent.contentDOM;for(let n=this.nodeDOM;n;n=n.parentNode)if(n==parentDOM)return!0;return!1}domFromPos(pos){return{node:this.nodeDOM,offset:pos}}localPosFromDOM(dom,offset,bias){return dom==this.nodeDOM?this.posAtStart+Math.min(offset,this.node.text.length):super.localPosFromDOM(dom,offset,bias)}ignoreMutation(mutation){return"characterData"!=mutation.type&&"selection"!=mutation.type}slice(from,to,view){let node=this.node.cut(from,to),dom=document.createTextNode(node.text);return new TextViewDesc(this.parent,node,this.outerDeco,this.innerDeco,dom,dom,view)}markDirty(from,to){super.markDirty(from,to),this.dom==this.nodeDOM||0!=from&&to!=this.nodeDOM.nodeValue.length||(this.dirty=3)}get domAtom(){return!1}}class TrailingHackViewDesc extends ViewDesc{parseRule(){return{ignore:!0}}matchesHack(nodeName){return 0==this.dirty&&this.dom.nodeName==nodeName}get domAtom(){return!0}get ignoreForCoords(){return"IMG"==this.dom.nodeName}}class CustomNodeViewDesc extends NodeViewDesc{constructor(parent,node,outerDeco,innerDeco,dom,contentDOM,nodeDOM,spec,view,pos){super(parent,node,outerDeco,innerDeco,dom,contentDOM,nodeDOM,view,pos),this.spec=spec}update(node,outerDeco,innerDeco,view){if(3==this.dirty)return!1;if(this.spec.update){let result=this.spec.update(node,outerDeco,innerDeco);return result&&this.updateInner(node,outerDeco,innerDeco,view),result}return!(!this.contentDOM&&!node.isLeaf)&&super.update(node,outerDeco,innerDeco,view)}selectNode(){this.spec.selectNode?this.spec.selectNode():super.selectNode()}deselectNode(){this.spec.deselectNode?this.spec.deselectNode():super.deselectNode()}setSelection(anchor,head,root,force){this.spec.setSelection?this.spec.setSelection(anchor,head,root):super.setSelection(anchor,head,root,force)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}stopEvent(event){return!!this.spec.stopEvent&&this.spec.stopEvent(event)}ignoreMutation(mutation){return this.spec.ignoreMutation?this.spec.ignoreMutation(mutation):super.ignoreMutation(mutation)}}function renderDescs(parentDOM,descs,view){let dom=parentDOM.firstChild,written=!1;for(let i=0;i<descs.length;i++){let desc=descs[i],childDOM=desc.dom;if(childDOM.parentNode==parentDOM){for(;childDOM!=dom;)dom=rm(dom),written=!0;dom=dom.nextSibling}else written=!0,parentDOM.insertBefore(childDOM,dom);if(desc instanceof MarkViewDesc){let pos=dom?dom.previousSibling:parentDOM.lastChild;renderDescs(desc.contentDOM,desc.children,view),dom=pos?pos.nextSibling:parentDOM.firstChild}}for(;dom;)dom=rm(dom),written=!0;written&&view.trackWrites==parentDOM&&(view.trackWrites=null)}const OuterDecoLevel=function(nodeName){nodeName&&(this.nodeName=nodeName)};OuterDecoLevel.prototype=Object.create(null);const noDeco=[new OuterDecoLevel];function computeOuterDeco(outerDeco,node,needsWrap){if(0==outerDeco.length)return noDeco;let top=needsWrap?noDeco[0]:new OuterDecoLevel,result=[top];for(let i=0;i<outerDeco.length;i++){let attrs=outerDeco[i].type.attrs;if(attrs){attrs.nodeName&&result.push(top=new OuterDecoLevel(attrs.nodeName));for(let name in attrs){let val=attrs[name];null!=val&&(needsWrap&&1==result.length&&result.push(top=new OuterDecoLevel(node.isInline?"span":"div")),"class"==name?top.class=(top.class?top.class+" ":"")+val:"style"==name?top.style=(top.style?top.style+";":"")+val:"nodeName"!=name&&(top[name]=val))}}}return result}function patchOuterDeco(outerDOM,nodeDOM,prevComputed,curComputed){if(prevComputed==noDeco&&curComputed==noDeco)return nodeDOM;let curDOM=nodeDOM;for(let i=0;i<curComputed.length;i++){let deco=curComputed[i],prev=prevComputed[i];if(i){let parent;prev&&prev.nodeName==deco.nodeName&&curDOM!=outerDOM&&(parent=curDOM.parentNode)&&parent.nodeName.toLowerCase()==deco.nodeName||(parent=document.createElement(deco.nodeName),parent.pmIsDeco=!0,parent.appendChild(curDOM),prev=noDeco[0]),curDOM=parent}patchAttributes(curDOM,prev||noDeco[0],deco)}return curDOM}function patchAttributes(dom,prev,cur){for(let name in prev)"class"==name||"style"==name||"nodeName"==name||name in cur||dom.removeAttribute(name);for(let name in cur)"class"!=name&&"style"!=name&&"nodeName"!=name&&cur[name]!=prev[name]&&dom.setAttribute(name,cur[name]);if(prev.class!=cur.class){let prevList=prev.class?prev.class.split(" ").filter(Boolean):[],curList=cur.class?cur.class.split(" ").filter(Boolean):[];for(let i=0;i<prevList.length;i++)-1==curList.indexOf(prevList[i])&&dom.classList.remove(prevList[i]);for(let i=0;i<curList.length;i++)-1==prevList.indexOf(curList[i])&&dom.classList.add(curList[i]);0==dom.classList.length&&dom.removeAttribute("class")}if(prev.style!=cur.style){if(prev.style){let m,prop=/\s*([\w\-\xa1-\uffff]+)\s*:(?:"(?:\\.|[^"])*"|'(?:\\.|[^'])*'|\(.*?\)|[^;])*/g;for(;m=prop.exec(prev.style);)dom.style.removeProperty(m[1])}cur.style&&(dom.style.cssText+=cur.style)}}function applyOuterDeco(dom,deco,node){return patchOuterDeco(dom,dom,noDeco,computeOuterDeco(deco,node,1!=dom.nodeType))}function sameOuterDeco(a,b){if(a.length!=b.length)return!1;for(let i=0;i<a.length;i++)if(!a[i].type.eq(b[i].type))return!1;return!0}function rm(dom){let next=dom.nextSibling;return dom.parentNode.removeChild(dom),next}class ViewTreeUpdater{constructor(top,lock,view){this.lock=lock,this.view=view,this.index=0,this.stack=[],this.changed=!1,this.top=top,this.preMatch=function(frag,parentDesc){let curDesc=parentDesc,descI=curDesc.children.length,fI=frag.childCount,matched=new Map,matches=[];outer:for(;fI>0;){let desc;for(;;)if(descI){let next=curDesc.children[descI-1];if(!(next instanceof MarkViewDesc)){desc=next,descI--;break}curDesc=next,descI=next.children.length}else{if(curDesc==parentDesc)break outer;descI=curDesc.parent.children.indexOf(curDesc),curDesc=curDesc.parent}let node=desc.node;if(node){if(node!=frag.child(fI-1))break;--fI,matched.set(desc,fI),matches.push(desc)}}return{index:fI,matched:matched,matches:matches.reverse()}}(top.node.content,top)}destroyBetween(start,end){if(start!=end){for(let i=start;i<end;i++)this.top.children[i].destroy();this.top.children.splice(start,end-start),this.changed=!0}}destroyRest(){this.destroyBetween(this.index,this.top.children.length)}syncToMarks(marks,inline,view){let keep=0,depth=this.stack.length>>1,maxKeep=Math.min(depth,marks.length);for(;keep<maxKeep&&(keep==depth-1?this.top:this.stack[keep+1<<1]).matchesMark(marks[keep])&&!1!==marks[keep].type.spec.spanning;)keep++;for(;keep<depth;)this.destroyRest(),this.top.dirty=0,this.index=this.stack.pop(),this.top=this.stack.pop(),depth--;for(;depth<marks.length;){this.stack.push(this.top,this.index+1);let found=-1;for(let i=this.index;i<Math.min(this.index+3,this.top.children.length);i++){let next=this.top.children[i];if(next.matchesMark(marks[depth])&&!this.isLocked(next.dom)){found=i;break}}if(found>-1)found>this.index&&(this.changed=!0,this.destroyBetween(this.index,found)),this.top=this.top.children[this.index];else{let markDesc=MarkViewDesc.create(this.top,marks[depth],inline,view);this.top.children.splice(this.index,0,markDesc),this.top=markDesc,this.changed=!0}this.index=0,depth++}}findNodeMatch(node,outerDeco,innerDeco,index){let targetDesc,found=-1;if(index>=this.preMatch.index&&(targetDesc=this.preMatch.matches[index-this.preMatch.index]).parent==this.top&&targetDesc.matchesNode(node,outerDeco,innerDeco))found=this.top.children.indexOf(targetDesc,this.index);else for(let i=this.index,e=Math.min(this.top.children.length,i+5);i<e;i++){let child=this.top.children[i];if(child.matchesNode(node,outerDeco,innerDeco)&&!this.preMatch.matched.has(child)){found=i;break}}return!(found<0)&&(this.destroyBetween(this.index,found),this.index++,!0)}updateNodeAt(node,outerDeco,innerDeco,index,view){let child=this.top.children[index];return 3==child.dirty&&child.dom==child.contentDOM&&(child.dirty=2),!!child.update(node,outerDeco,innerDeco,view)&&(this.destroyBetween(this.index,index),this.index++,!0)}findIndexWithChild(domNode){for(;;){let parent=domNode.parentNode;if(!parent)return-1;if(parent==this.top.contentDOM){let desc=domNode.pmViewDesc;if(desc)for(let i=this.index;i<this.top.children.length;i++)if(this.top.children[i]==desc)return i;return-1}domNode=parent}}updateNextNode(node,outerDeco,innerDeco,view,index,pos){for(let i=this.index;i<this.top.children.length;i++){let next=this.top.children[i];if(next instanceof NodeViewDesc){let preMatch=this.preMatch.matched.get(next);if(null!=preMatch&&preMatch!=index)return!1;let updated,nextDOM=next.dom,locked=this.isLocked(nextDOM)&&!(node.isText&&next.node&&next.node.isText&&next.nodeDOM.nodeValue==node.text&&3!=next.dirty&&sameOuterDeco(outerDeco,next.outerDeco));if(!locked&&next.update(node,outerDeco,innerDeco,view))return this.destroyBetween(this.index,i),next.dom!=nextDOM&&(this.changed=!0),this.index++,!0;if(!locked&&(updated=this.recreateWrapper(next,node,outerDeco,innerDeco,view,pos)))return this.top.children[this.index]=updated,updated.contentDOM&&(updated.dirty=2,updated.updateChildren(view,pos+1),updated.dirty=0),this.changed=!0,this.index++,!0;break}}return!1}recreateWrapper(next,node,outerDeco,innerDeco,view,pos){if(next.dirty||node.isAtom||!next.children.length||!next.node.content.eq(node.content))return null;let wrapper=NodeViewDesc.create(this.top,node,outerDeco,innerDeco,view,pos);if(wrapper.contentDOM){wrapper.children=next.children,next.children=[];for(let ch of wrapper.children)ch.parent=wrapper}return next.destroy(),wrapper}addNode(node,outerDeco,innerDeco,view,pos){let desc=NodeViewDesc.create(this.top,node,outerDeco,innerDeco,view,pos);desc.contentDOM&&desc.updateChildren(view,pos+1),this.top.children.splice(this.index++,0,desc),this.changed=!0}placeWidget(widget,view,pos){let next=this.index<this.top.children.length?this.top.children[this.index]:null;if(!next||!next.matchesWidget(widget)||widget!=next.widget&&next.widget.type.toDOM.parentNode){let desc=new WidgetViewDesc(this.top,widget,view,pos);this.top.children.splice(this.index++,0,desc),this.changed=!0}else this.index++}addTextblockHacks(){let lastChild=this.top.children[this.index-1],parent=this.top;for(;lastChild instanceof MarkViewDesc;)parent=lastChild,lastChild=parent.children[parent.children.length-1];(!lastChild||!(lastChild instanceof TextViewDesc)||/\n$/.test(lastChild.node.text)||this.view.requiresGeckoHackNode&&/\s$/.test(lastChild.node.text))&&((safari$1||chrome)&&lastChild&&"false"==lastChild.dom.contentEditable&&this.addHackNode("IMG",parent),this.addHackNode("BR",this.top))}addHackNode(nodeName,parent){if(parent==this.top&&this.index<parent.children.length&&parent.children[this.index].matchesHack(nodeName))this.index++;else{let dom=document.createElement(nodeName);"IMG"==nodeName&&(dom.className="ProseMirror-separator",dom.alt=""),"BR"==nodeName&&(dom.className="ProseMirror-trailingBreak");let hack=new TrailingHackViewDesc(this.top,[],dom,null);parent!=this.top?parent.children.push(hack):parent.children.splice(this.index++,0,hack),this.changed=!0}}isLocked(node){return this.lock&&(node==this.lock||1==node.nodeType&&node.contains(this.lock.parentNode))}}function compareSide(a,b){return a.type.side-b.type.side}function replaceNodes(nodes,from,to,view,replacement){let result=[];for(let i=0,off=0;i<nodes.length;i++){let child=nodes[i],start=off,end=off+=child.size;start>=to||end<=from?result.push(child):(start<from&&result.push(child.slice(0,from-start,view)),replacement&&(result.push(replacement),replacement=void 0),end>to&&result.push(child.slice(to-start,child.size,view)))}return result}function selectionFromDOM(view,origin=null){let domSel=view.domSelectionRange(),doc=view.state.doc;if(!domSel.focusNode)return null;let nearestDesc=view.docView.nearestDesc(domSel.focusNode),inWidget=nearestDesc&&0==nearestDesc.size,head=view.docView.posFromDOM(domSel.focusNode,domSel.focusOffset,1);if(head<0)return null;let $anchor,selection,$head=doc.resolve(head);if(selectionCollapsed(domSel)){for($anchor=$head;nearestDesc&&!nearestDesc.node;)nearestDesc=nearestDesc.parent;let nearestDescNode=nearestDesc.node;if(nearestDesc&&nearestDescNode.isAtom&&NodeSelection.isSelectable(nearestDescNode)&&nearestDesc.parent&&(!nearestDescNode.isInline||!function(node,offset,parent){for(let atStart=0==offset,atEnd=offset==nodeSize(node);atStart||atEnd;){if(node==parent)return!0;let index=domIndex(node);if(!(node=node.parentNode))return!1;atStart=atStart&&0==index,atEnd=atEnd&&index==nodeSize(node)}}(domSel.focusNode,domSel.focusOffset,nearestDesc.dom))){let pos=nearestDesc.posBefore;selection=new NodeSelection(head==pos?$head:doc.resolve(pos))}}else{let anchor=view.docView.posFromDOM(domSel.anchorNode,domSel.anchorOffset,1);if(anchor<0)return null;$anchor=doc.resolve(anchor)}if(!selection){selection=selectionBetween(view,$anchor,$head,"pointer"==origin||view.state.selection.head<$head.pos&&!inWidget?1:-1)}return selection}function editorOwnsSelection(view){return view.editable?view.hasFocus():hasSelection(view)&&document.activeElement&&document.activeElement.contains(view.dom)}function selectionToDOM(view,force=!1){let sel=view.state.selection;if(syncNodeSelection(view,sel),editorOwnsSelection(view)){if(!force&&view.input.mouseDown&&view.input.mouseDown.allowDefault&&chrome){let domSel=view.domSelectionRange(),curSel=view.domObserver.currentSelection;if(domSel.anchorNode&&curSel.anchorNode&&isEquivalentPosition(domSel.anchorNode,domSel.anchorOffset,curSel.anchorNode,curSel.anchorOffset))return view.input.mouseDown.delayedSelectionSync=!0,void view.domObserver.setCurSelection()}if(view.domObserver.disconnectSelection(),view.cursorWrapper)!function(view){let domSel=view.domSelection(),range=document.createRange(),node=view.cursorWrapper.dom,img="IMG"==node.nodeName;img?range.setEnd(node.parentNode,domIndex(node)+1):range.setEnd(node,0);range.collapse(!1),domSel.removeAllRanges(),domSel.addRange(range),!img&&!view.state.selection.visible&&ie$4&&ie_version<=11&&(node.disabled=!0,node.disabled=!1)}(view);else{let resetEditableFrom,resetEditableTo,{anchor:anchor,head:head}=sel;!brokenSelectBetweenUneditable||sel instanceof TextSelection||(sel.$from.parent.inlineContent||(resetEditableFrom=temporarilyEditableNear(view,sel.from)),sel.empty||sel.$from.parent.inlineContent||(resetEditableTo=temporarilyEditableNear(view,sel.to))),view.docView.setSelection(anchor,head,view.root,force),brokenSelectBetweenUneditable&&(resetEditableFrom&&resetEditable(resetEditableFrom),resetEditableTo&&resetEditable(resetEditableTo)),sel.visible?view.dom.classList.remove("ProseMirror-hideselection"):(view.dom.classList.add("ProseMirror-hideselection"),"onselectionchange"in document&&function(view){let doc=view.dom.ownerDocument;doc.removeEventListener("selectionchange",view.input.hideSelectionGuard);let domSel=view.domSelectionRange(),node=domSel.anchorNode,offset=domSel.anchorOffset;doc.addEventListener("selectionchange",view.input.hideSelectionGuard=()=>{domSel.anchorNode==node&&domSel.anchorOffset==offset||(doc.removeEventListener("selectionchange",view.input.hideSelectionGuard),setTimeout((()=>{editorOwnsSelection(view)&&!view.state.selection.visible||view.dom.classList.remove("ProseMirror-hideselection")}),20))})}(view))}view.domObserver.setCurSelection(),view.domObserver.connectSelection()}}const brokenSelectBetweenUneditable=safari$1||chrome&&chrome_version<63;function temporarilyEditableNear(view,pos){let{node:node,offset:offset}=view.docView.domFromPos(pos,0),after=offset<node.childNodes.length?node.childNodes[offset]:null,before=offset?node.childNodes[offset-1]:null;if(safari$1&&after&&"false"==after.contentEditable)return setEditable(after);if(!(after&&"false"!=after.contentEditable||before&&"false"!=before.contentEditable)){if(after)return setEditable(after);if(before)return setEditable(before)}}function setEditable(element){return element.contentEditable="true",safari$1&&element.draggable&&(element.draggable=!1,element.wasDraggable=!0),element}function resetEditable(element){element.contentEditable="false",element.wasDraggable&&(element.draggable=!0,element.wasDraggable=null)}function syncNodeSelection(view,sel){if(sel instanceof NodeSelection){let desc=view.docView.descAt(sel.from);desc!=view.lastSelectedViewDesc&&(clearNodeSelection(view),desc&&desc.selectNode(),view.lastSelectedViewDesc=desc)}else clearNodeSelection(view)}function clearNodeSelection(view){view.lastSelectedViewDesc&&(view.lastSelectedViewDesc.parent&&view.lastSelectedViewDesc.deselectNode(),view.lastSelectedViewDesc=void 0)}function selectionBetween(view,$anchor,$head,bias){return view.someProp("createSelectionBetween",(f=>f(view,$anchor,$head)))||TextSelection.between($anchor,$head,bias)}function hasFocusAndSelection(view){return!(view.editable&&!view.hasFocus())&&hasSelection(view)}function hasSelection(view){let sel=view.domSelectionRange();if(!sel.anchorNode)return!1;try{return view.dom.contains(3==sel.anchorNode.nodeType?sel.anchorNode.parentNode:sel.anchorNode)&&(view.editable||view.dom.contains(3==sel.focusNode.nodeType?sel.focusNode.parentNode:sel.focusNode))}catch(_){return!1}}function moveSelectionBlock(state,dir){let{$anchor:$anchor,$head:$head}=state.selection,$side=dir>0?$anchor.max($head):$anchor.min($head),$start=$side.parent.inlineContent?$side.depth?state.doc.resolve(dir>0?$side.after():$side.before()):null:$side;return $start&&Selection.findFrom($start,dir)}function apply(view,sel){return view.dispatch(view.state.tr.setSelection(sel).scrollIntoView()),!0}function selectHorizontally(view,dir,mods){let sel=view.state.selection;if(!(sel instanceof TextSelection)){if(sel instanceof NodeSelection&&sel.node.isInline)return apply(view,new TextSelection(dir>0?sel.$to:sel.$from));{let next=moveSelectionBlock(view.state,dir);return!!next&&apply(view,next)}}if(mods.indexOf("s")>-1){let{$head:$head}=sel,node=$head.textOffset?null:dir<0?$head.nodeBefore:$head.nodeAfter;if(!node||node.isText||!node.isLeaf)return!1;let $newHead=view.state.doc.resolve($head.pos+node.nodeSize*(dir<0?-1:1));return apply(view,new TextSelection(sel.$anchor,$newHead))}if(!sel.empty)return!1;if(view.endOfTextblock(dir>0?"forward":"backward")){let next=moveSelectionBlock(view.state,dir);return!!(next&&next instanceof NodeSelection)&&apply(view,next)}if(!(mac$3&&mods.indexOf("m")>-1)){let desc,$head=sel.$head,node=$head.textOffset?null:dir<0?$head.nodeBefore:$head.nodeAfter;if(!node||node.isText)return!1;let nodePos=dir<0?$head.pos-node.nodeSize:$head.pos;return!!(node.isAtom||(desc=view.docView.descAt(nodePos))&&!desc.contentDOM)&&(NodeSelection.isSelectable(node)?apply(view,new NodeSelection(dir<0?view.state.doc.resolve($head.pos-node.nodeSize):$head)):!!webkit$1&&apply(view,new TextSelection(view.state.doc.resolve(dir<0?nodePos:nodePos+node.nodeSize))))}}function nodeLen(node){return 3==node.nodeType?node.nodeValue.length:node.childNodes.length}function isIgnorable(dom,dir){let desc=dom.pmViewDesc;return desc&&0==desc.size&&(dir<0||dom.nextSibling||"BR"!=dom.nodeName)}function skipIgnoredNodes(view,dir){return dir<0?function(view){let sel=view.domSelectionRange(),node=sel.focusNode,offset=sel.focusOffset;if(!node)return;let moveNode,moveOffset,force=!1;gecko$1&&1==node.nodeType&&offset<nodeLen(node)&&isIgnorable(node.childNodes[offset],-1)&&(force=!0);for(;;)if(offset>0){if(1!=node.nodeType)break;{let before=node.childNodes[offset-1];if(isIgnorable(before,-1))moveNode=node,moveOffset=--offset;else{if(3!=before.nodeType)break;node=before,offset=node.nodeValue.length}}}else{if(isBlockNode(node))break;{let prev=node.previousSibling;for(;prev&&isIgnorable(prev,-1);)moveNode=node.parentNode,moveOffset=domIndex(prev),prev=prev.previousSibling;if(prev)node=prev,offset=nodeLen(node);else{if(node=node.parentNode,node==view.dom)break;offset=0}}}force?setSelFocus(view,node,offset):moveNode&&setSelFocus(view,moveNode,moveOffset)}(view):function(view){let sel=view.domSelectionRange(),node=sel.focusNode,offset=sel.focusOffset;if(!node)return;let moveNode,moveOffset,len=nodeLen(node);for(;;)if(offset<len){if(1!=node.nodeType)break;if(!isIgnorable(node.childNodes[offset],1))break;moveNode=node,moveOffset=++offset}else{if(isBlockNode(node))break;{let next=node.nextSibling;for(;next&&isIgnorable(next,1);)moveNode=next.parentNode,moveOffset=domIndex(next)+1,next=next.nextSibling;if(next)node=next,offset=0,len=nodeLen(node);else{if(node=node.parentNode,node==view.dom)break;offset=len=0}}}moveNode&&setSelFocus(view,moveNode,moveOffset)}(view)}function isBlockNode(dom){let desc=dom.pmViewDesc;return desc&&desc.node&&desc.node.isBlock}function setSelFocus(view,node,offset){if(3!=node.nodeType){let before,after;(after=function(node,offset){for(;node&&offset==node.childNodes.length&&!hasBlockDesc(node);)offset=domIndex(node)+1,node=node.parentNode;for(;node&&offset<node.childNodes.length;){let next=node.childNodes[offset];if(3==next.nodeType)return next;if(1==next.nodeType&&"false"==next.contentEditable)break;node=next,offset=0}}(node,offset))?(node=after,offset=0):(before=function(node,offset){for(;node&&!offset&&!hasBlockDesc(node);)offset=domIndex(node),node=node.parentNode;for(;node&&offset;){let next=node.childNodes[offset-1];if(3==next.nodeType)return next;if(1==next.nodeType&&"false"==next.contentEditable)break;offset=(node=next).childNodes.length}}(node,offset))&&(node=before,offset=before.nodeValue.length)}let sel=view.domSelection();if(selectionCollapsed(sel)){let range=document.createRange();range.setEnd(node,offset),range.setStart(node,offset),sel.removeAllRanges(),sel.addRange(range)}else sel.extend&&sel.extend(node,offset);view.domObserver.setCurSelection();let{state:state}=view;setTimeout((()=>{view.state==state&&selectionToDOM(view)}),50)}function findDirection(view,pos){let $pos=view.state.doc.resolve(pos);if(!chrome&&!windows&&$pos.parent.inlineContent){let coords=view.coordsAtPos(pos);if(pos>$pos.start()){let before=view.coordsAtPos(pos-1),mid=(before.top+before.bottom)/2;if(mid>coords.top&&mid<coords.bottom&&Math.abs(before.left-coords.left)>1)return before.left<coords.left?"ltr":"rtl"}if(pos<$pos.end()){let after=view.coordsAtPos(pos+1),mid=(after.top+after.bottom)/2;if(mid>coords.top&&mid<coords.bottom&&Math.abs(after.left-coords.left)>1)return after.left>coords.left?"ltr":"rtl"}}return"rtl"==getComputedStyle(view.dom).direction?"rtl":"ltr"}function selectVertically(view,dir,mods){let sel=view.state.selection;if(sel instanceof TextSelection&&!sel.empty||mods.indexOf("s")>-1)return!1;if(mac$3&&mods.indexOf("m")>-1)return!1;let{$from:$from,$to:$to}=sel;if(!$from.parent.inlineContent||view.endOfTextblock(dir<0?"up":"down")){let next=moveSelectionBlock(view.state,dir);if(next&&next instanceof NodeSelection)return apply(view,next)}if(!$from.parent.inlineContent){let side=dir<0?$from:$to,beyond=sel instanceof AllSelection?Selection.near(side,dir):Selection.findFrom(side,dir);return!!beyond&&apply(view,beyond)}return!1}function stopNativeHorizontalDelete(view,dir){if(!(view.state.selection instanceof TextSelection))return!0;let{$head:$head,$anchor:$anchor,empty:empty}=view.state.selection;if(!$head.sameParent($anchor))return!0;if(!empty)return!1;if(view.endOfTextblock(dir>0?"forward":"backward"))return!0;let nextNode=!$head.textOffset&&(dir<0?$head.nodeBefore:$head.nodeAfter);if(nextNode&&!nextNode.isText){let tr=view.state.tr;return dir<0?tr.delete($head.pos-nextNode.nodeSize,$head.pos):tr.delete($head.pos,$head.pos+nextNode.nodeSize),view.dispatch(tr),!0}return!1}function switchEditable(view,node,state){view.domObserver.stop(),node.contentEditable=state,view.domObserver.start()}function captureKeyDown(view,event){let code=event.keyCode,mods=function(event){let result="";return event.ctrlKey&&(result+="c"),event.metaKey&&(result+="m"),event.altKey&&(result+="a"),event.shiftKey&&(result+="s"),result}(event);if(8==code||mac$3&&72==code&&"c"==mods)return stopNativeHorizontalDelete(view,-1)||skipIgnoredNodes(view,-1);if(46==code&&!event.shiftKey||mac$3&&68==code&&"c"==mods)return stopNativeHorizontalDelete(view,1)||skipIgnoredNodes(view,1);if(13==code||27==code)return!0;if(37==code||mac$3&&66==code&&"c"==mods){let dir=37==code?"ltr"==findDirection(view,view.state.selection.from)?-1:1:-1;return selectHorizontally(view,dir,mods)||skipIgnoredNodes(view,dir)}if(39==code||mac$3&&70==code&&"c"==mods){let dir=39==code?"ltr"==findDirection(view,view.state.selection.from)?1:-1:1;return selectHorizontally(view,dir,mods)||skipIgnoredNodes(view,dir)}return 38==code||mac$3&&80==code&&"c"==mods?selectVertically(view,-1,mods)||skipIgnoredNodes(view,-1):40==code||mac$3&&78==code&&"c"==mods?function(view){if(!safari$1||view.state.selection.$head.parentOffset>0)return!1;let{focusNode:focusNode,focusOffset:focusOffset}=view.domSelectionRange();if(focusNode&&1==focusNode.nodeType&&0==focusOffset&&focusNode.firstChild&&"false"==focusNode.firstChild.contentEditable){let child=focusNode.firstChild;switchEditable(view,child,"true"),setTimeout((()=>switchEditable(view,child,"false")),20)}return!1}(view)||selectVertically(view,1,mods)||skipIgnoredNodes(view,1):mods==(mac$3?"m":"c")&&(66==code||73==code||89==code||90==code)}function serializeForClipboard(view,slice){view.someProp("transformCopied",(f=>{slice=f(slice,view)}));let context=[],{content:content,openStart:openStart,openEnd:openEnd}=slice;for(;openStart>1&&openEnd>1&&1==content.childCount&&1==content.firstChild.childCount;){openStart--,openEnd--;let node=content.firstChild;context.push(node.type.name,node.attrs!=node.type.defaultAttrs?node.attrs:null),content=node.content}let serializer=view.someProp("clipboardSerializer")||DOMSerializer.fromSchema(view.state.schema),doc=detachedDoc(),wrap=doc.createElement("div");wrap.appendChild(serializer.serializeFragment(content,{document:doc}));let needsWrap,firstChild=wrap.firstChild,wrappers=0;for(;firstChild&&1==firstChild.nodeType&&(needsWrap=wrapMap[firstChild.nodeName.toLowerCase()]);){for(let i=needsWrap.length-1;i>=0;i--){let wrapper=doc.createElement(needsWrap[i]);for(;wrap.firstChild;)wrapper.appendChild(wrap.firstChild);wrap.appendChild(wrapper),wrappers++}firstChild=wrap.firstChild}firstChild&&1==firstChild.nodeType&&firstChild.setAttribute("data-pm-slice",`${openStart} ${openEnd}${wrappers?` -${wrappers}`:""} ${JSON.stringify(context)}`);let text=view.someProp("clipboardTextSerializer",(f=>f(slice,view)))||slice.content.textBetween(0,slice.content.size,"\n\n");return{dom:wrap,text:text}}function parseFromClipboard(view,text,html,plainText,$context){let dom,slice,inCode=$context.parent.type.spec.code;if(!html&&!text)return null;let asText=text&&(plainText||inCode||!html);if(asText){if(view.someProp("transformPastedText",(f=>{text=f(text,inCode||plainText,view)})),inCode)return text?new Slice(Fragment.from(view.state.schema.text(text.replace(/\r\n?/g,"\n"))),0,0):Slice.empty;let parsed=view.someProp("clipboardTextParser",(f=>f(text,$context,plainText,view)));if(parsed)slice=parsed;else{let marks=$context.marks(),{schema:schema}=view.state,serializer=DOMSerializer.fromSchema(schema);dom=document.createElement("div"),text.split(/(?:\r\n?|\n)+/).forEach((block=>{let p=dom.appendChild(document.createElement("p"));block&&p.appendChild(serializer.serializeNode(schema.text(block,marks)))}))}}else view.someProp("transformPastedHTML",(f=>{html=f(html,view)})),dom=function(html){let metas=/^(\s*<meta [^>]*>)*/.exec(html);metas&&(html=html.slice(metas[0].length));let wrap,elt=detachedDoc().createElement("div"),firstTag=/<([a-z][^>\s]+)/i.exec(html);(wrap=firstTag&&wrapMap[firstTag[1].toLowerCase()])&&(html=wrap.map((n=>"<"+n+">")).join("")+html+wrap.map((n=>"</"+n+">")).reverse().join(""));if(elt.innerHTML=html,wrap)for(let i=0;i<wrap.length;i++)elt=elt.querySelector(wrap[i])||elt;return elt}(html),webkit$1&&function(dom){let nodes=dom.querySelectorAll(chrome?"span:not([class]):not([style])":"span.Apple-converted-space");for(let i=0;i<nodes.length;i++){let node=nodes[i];1==node.childNodes.length&&""==node.textContent&&node.parentNode&&node.parentNode.replaceChild(dom.ownerDocument.createTextNode(" "),node)}}(dom);let contextNode=dom&&dom.querySelector("[data-pm-slice]"),sliceData=contextNode&&/^(\d+) (\d+)(?: -(\d+))? (.*)/.exec(contextNode.getAttribute("data-pm-slice")||"");if(sliceData&&sliceData[3])for(let i=+sliceData[3];i>0;i--){let child=dom.firstChild;for(;child&&1!=child.nodeType;)child=child.nextSibling;if(!child)break;dom=child}if(!slice){let parser=view.someProp("clipboardParser")||view.someProp("domParser")||DOMParser.fromSchema(view.state.schema);slice=parser.parseSlice(dom,{preserveWhitespace:!(!asText&&!sliceData),context:$context,ruleFromNode:dom=>"BR"!=dom.nodeName||dom.nextSibling||!dom.parentNode||inlineParents.test(dom.parentNode.nodeName)?null:{ignore:!0}})}if(sliceData)slice=function(slice,context){if(!slice.size)return slice;let array,schema=slice.content.firstChild.type.schema;try{array=JSON.parse(context)}catch(e){return slice}let{content:content,openStart:openStart,openEnd:openEnd}=slice;for(let i=array.length-2;i>=0;i-=2){let type=schema.nodes[array[i]];if(!type||type.hasRequiredAttrs())break;content=Fragment.from(type.create(array[i+1],content)),openStart++,openEnd++}return new Slice(content,openStart,openEnd)}(closeSlice(slice,+sliceData[1],+sliceData[2]),sliceData[4]);else if(slice=Slice.maxOpen(function(fragment,$context){if(fragment.childCount<2)return fragment;for(let d=$context.depth;d>=0;d--){let lastWrap,match=$context.node(d).contentMatchAt($context.index(d)),result=[];if(fragment.forEach((node=>{if(!result)return;let inLast,wrap=match.findWrapping(node.type);if(!wrap)return result=null;if(inLast=result.length&&lastWrap.length&&addToSibling(wrap,lastWrap,node,result[result.length-1],0))result[result.length-1]=inLast;else{result.length&&(result[result.length-1]=closeRight(result[result.length-1],lastWrap.length));let wrapped=withWrappers(node,wrap);result.push(wrapped),match=match.matchType(wrapped.type),lastWrap=wrap}})),result)return Fragment.from(result)}return fragment}(slice.content,$context),!0),slice.openStart||slice.openEnd){let openStart=0,openEnd=0;for(let node=slice.content.firstChild;openStart<slice.openStart&&!node.type.spec.isolating;openStart++,node=node.firstChild);for(let node=slice.content.lastChild;openEnd<slice.openEnd&&!node.type.spec.isolating;openEnd++,node=node.lastChild);slice=closeSlice(slice,openStart,openEnd)}return view.someProp("transformPasted",(f=>{slice=f(slice,view)})),slice}const inlineParents=/^(a|abbr|acronym|b|cite|code|del|em|i|ins|kbd|label|output|q|ruby|s|samp|span|strong|sub|sup|time|u|tt|var)$/i;function withWrappers(node,wrap,from=0){for(let i=wrap.length-1;i>=from;i--)node=wrap[i].create(null,Fragment.from(node));return node}function addToSibling(wrap,lastWrap,node,sibling,depth){if(depth<wrap.length&&depth<lastWrap.length&&wrap[depth]==lastWrap[depth]){let inner=addToSibling(wrap,lastWrap,node,sibling.lastChild,depth+1);if(inner)return sibling.copy(sibling.content.replaceChild(sibling.childCount-1,inner));if(sibling.contentMatchAt(sibling.childCount).matchType(depth==wrap.length-1?node.type:wrap[depth+1]))return sibling.copy(sibling.content.append(Fragment.from(withWrappers(node,wrap,depth+1))))}}function closeRight(node,depth){if(0==depth)return node;let fragment=node.content.replaceChild(node.childCount-1,closeRight(node.lastChild,depth-1)),fill=node.contentMatchAt(node.childCount).fillBefore(Fragment.empty,!0);return node.copy(fragment.append(fill))}function closeRange(fragment,side,from,to,depth,openEnd){let node=side<0?fragment.firstChild:fragment.lastChild,inner=node.content;return fragment.childCount>1&&(openEnd=0),depth<to-1&&(inner=closeRange(inner,side,from,to,depth+1,openEnd)),depth>=from&&(inner=side<0?node.contentMatchAt(0).fillBefore(inner,openEnd<=depth).append(inner):inner.append(node.contentMatchAt(node.childCount).fillBefore(Fragment.empty,!0))),fragment.replaceChild(side<0?0:fragment.childCount-1,node.copy(inner))}function closeSlice(slice,openStart,openEnd){return openStart<slice.openStart&&(slice=new Slice(closeRange(slice.content,-1,openStart,slice.openStart,0,slice.openEnd),openStart,slice.openEnd)),openEnd<slice.openEnd&&(slice=new Slice(closeRange(slice.content,1,openEnd,slice.openEnd,0,0),slice.openStart,openEnd)),slice}const wrapMap={thead:["table"],tbody:["table"],tfoot:["table"],caption:["table"],colgroup:["table"],col:["table","colgroup"],tr:["table","tbody"],td:["table","tbody","tr"],th:["table","tbody","tr"]};let _detachedDoc=null;function detachedDoc(){return _detachedDoc||(_detachedDoc=document.implementation.createHTMLDocument("title"))}const handlers={},editHandlers={},passiveHandlers={touchstart:!0,touchmove:!0};class InputState{constructor(){this.shiftKey=!1,this.mouseDown=null,this.lastKeyCode=null,this.lastKeyCodeTime=0,this.lastClick={time:0,x:0,y:0,type:""},this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastIOSEnter=0,this.lastIOSEnterFallbackTimeout=-1,this.lastFocus=0,this.lastTouch=0,this.lastAndroidDelete=0,this.composing=!1,this.composingTimeout=-1,this.compositionNodes=[],this.compositionEndedAt=-2e8,this.compositionID=1,this.compositionPendingChanges=0,this.domChangeCount=0,this.eventHandlers=Object.create(null),this.hideSelectionGuard=null}}function setSelectionOrigin(view,origin){view.input.lastSelectionOrigin=origin,view.input.lastSelectionTime=Date.now()}function ensureListeners(view){view.someProp("handleDOMEvents",(currentHandlers=>{for(let type in currentHandlers)view.input.eventHandlers[type]||view.dom.addEventListener(type,view.input.eventHandlers[type]=event=>runCustomHandler(view,event))}))}function runCustomHandler(view,event){return view.someProp("handleDOMEvents",(handlers=>{let handler=handlers[event.type];return!!handler&&(handler(view,event)||event.defaultPrevented)}))}function eventBelongsToView(view,event){if(!event.bubbles)return!0;if(event.defaultPrevented)return!1;for(let node=event.target;node!=view.dom;node=node.parentNode)if(!node||11==node.nodeType||node.pmViewDesc&&node.pmViewDesc.stopEvent(event))return!1;return!0}function eventCoords(event){return{left:event.clientX,top:event.clientY}}function runHandlerOnContext(view,propName,pos,inside,event){if(-1==inside)return!1;let $pos=view.state.doc.resolve(inside);for(let i=$pos.depth+1;i>0;i--)if(view.someProp(propName,(f=>i>$pos.depth?f(view,pos,$pos.nodeAfter,$pos.before(i),event,!0):f(view,pos,$pos.node(i),$pos.before(i),event,!1))))return!0;return!1}function updateSelection(view,selection,origin){view.focused||view.focus();let tr=view.state.tr.setSelection(selection);"pointer"==origin&&tr.setMeta("pointer",!0),view.dispatch(tr)}function handleSingleClick(view,pos,inside,event,selectNode){return runHandlerOnContext(view,"handleClickOn",pos,inside,event)||view.someProp("handleClick",(f=>f(view,pos,event)))||(selectNode?function(view,inside){if(-1==inside)return!1;let selectedNode,selectAt,sel=view.state.selection;sel instanceof NodeSelection&&(selectedNode=sel.node);let $pos=view.state.doc.resolve(inside);for(let i=$pos.depth+1;i>0;i--){let node=i>$pos.depth?$pos.nodeAfter:$pos.node(i);if(NodeSelection.isSelectable(node)){selectAt=selectedNode&&sel.$from.depth>0&&i>=sel.$from.depth&&$pos.before(sel.$from.depth+1)==sel.$from.pos?$pos.before(sel.$from.depth):$pos.before(i);break}}return null!=selectAt&&(updateSelection(view,NodeSelection.create(view.state.doc,selectAt),"pointer"),!0)}(view,inside):function(view,inside){if(-1==inside)return!1;let $pos=view.state.doc.resolve(inside),node=$pos.nodeAfter;return!!(node&&node.isAtom&&NodeSelection.isSelectable(node))&&(updateSelection(view,new NodeSelection($pos),"pointer"),!0)}(view,inside))}function handleDoubleClick(view,pos,inside,event){return runHandlerOnContext(view,"handleDoubleClickOn",pos,inside,event)||view.someProp("handleDoubleClick",(f=>f(view,pos,event)))}function handleTripleClick(view,pos,inside,event){return runHandlerOnContext(view,"handleTripleClickOn",pos,inside,event)||view.someProp("handleTripleClick",(f=>f(view,pos,event)))||function(view,inside,event){if(0!=event.button)return!1;let doc=view.state.doc;if(-1==inside)return!!doc.inlineContent&&(updateSelection(view,TextSelection.create(doc,0,doc.content.size),"pointer"),!0);let $pos=doc.resolve(inside);for(let i=$pos.depth+1;i>0;i--){let node=i>$pos.depth?$pos.nodeAfter:$pos.node(i),nodePos=$pos.before(i);if(node.inlineContent)updateSelection(view,TextSelection.create(doc,nodePos+1,nodePos+1+node.content.size),"pointer");else{if(!NodeSelection.isSelectable(node))continue;updateSelection(view,NodeSelection.create(doc,nodePos),"pointer")}return!0}}(view,inside,event)}function forceDOMFlush(view){return endComposition(view)}editHandlers.keydown=(view,_event)=>{let event=_event;if(view.input.shiftKey=16==event.keyCode||event.shiftKey,!inOrNearComposition(view,event)&&(view.input.lastKeyCode=event.keyCode,view.input.lastKeyCodeTime=Date.now(),!android||!chrome||13!=event.keyCode))if(229!=event.keyCode&&view.domObserver.forceFlush(),!ios$1||13!=event.keyCode||event.ctrlKey||event.altKey||event.metaKey)view.someProp("handleKeyDown",(f=>f(view,event)))||captureKeyDown(view,event)?event.preventDefault():setSelectionOrigin(view,"key");else{let now=Date.now();view.input.lastIOSEnter=now,view.input.lastIOSEnterFallbackTimeout=setTimeout((()=>{view.input.lastIOSEnter==now&&(view.someProp("handleKeyDown",(f=>f(view,keyEvent(13,"Enter")))),view.input.lastIOSEnter=0)}),200)}},editHandlers.keyup=(view,event)=>{16==event.keyCode&&(view.input.shiftKey=!1)},editHandlers.keypress=(view,_event)=>{let event=_event;if(inOrNearComposition(view,event)||!event.charCode||event.ctrlKey&&!event.altKey||mac$3&&event.metaKey)return;if(view.someProp("handleKeyPress",(f=>f(view,event))))return void event.preventDefault();let sel=view.state.selection;if(!(sel instanceof TextSelection&&sel.$from.sameParent(sel.$to))){let text=String.fromCharCode(event.charCode);/[\r\n]/.test(text)||view.someProp("handleTextInput",(f=>f(view,sel.$from.pos,sel.$to.pos,text)))||view.dispatch(view.state.tr.insertText(text).scrollIntoView()),event.preventDefault()}};const selectNodeModifier=mac$3?"metaKey":"ctrlKey";handlers.mousedown=(view,_event)=>{let event=_event;view.input.shiftKey=event.shiftKey;let flushed=forceDOMFlush(view),now=Date.now(),type="singleClick";now-view.input.lastClick.time<500&&function(event,click){let dx=click.x-event.clientX,dy=click.y-event.clientY;return dx*dx+dy*dy<100}(event,view.input.lastClick)&&!event[selectNodeModifier]&&("singleClick"==view.input.lastClick.type?type="doubleClick":"doubleClick"==view.input.lastClick.type&&(type="tripleClick")),view.input.lastClick={time:now,x:event.clientX,y:event.clientY,type:type};let pos=view.posAtCoords(eventCoords(event));pos&&("singleClick"==type?(view.input.mouseDown&&view.input.mouseDown.done(),view.input.mouseDown=new MouseDown(view,pos,event,!!flushed)):("doubleClick"==type?handleDoubleClick:handleTripleClick)(view,pos.pos,pos.inside,event)?event.preventDefault():setSelectionOrigin(view,"pointer"))};class MouseDown{constructor(view,pos,event,flushed){let targetNode,targetPos;if(this.view=view,this.pos=pos,this.event=event,this.flushed=flushed,this.delayedSelectionSync=!1,this.mightDrag=null,this.startDoc=view.state.doc,this.selectNode=!!event[selectNodeModifier],this.allowDefault=event.shiftKey,pos.inside>-1)targetNode=view.state.doc.nodeAt(pos.inside),targetPos=pos.inside;else{let $pos=view.state.doc.resolve(pos.pos);targetNode=$pos.parent,targetPos=$pos.depth?$pos.before():0}const target=flushed?null:event.target,targetDesc=target?view.docView.nearestDesc(target,!0):null;this.target=targetDesc?targetDesc.dom:null;let{selection:selection}=view.state;(0==event.button&&targetNode.type.spec.draggable&&!1!==targetNode.type.spec.selectable||selection instanceof NodeSelection&&selection.from<=targetPos&&selection.to>targetPos)&&(this.mightDrag={node:targetNode,pos:targetPos,addAttr:!(!this.target||this.target.draggable),setUneditable:!(!this.target||!gecko$1||this.target.hasAttribute("contentEditable"))}),this.target&&this.mightDrag&&(this.mightDrag.addAttr||this.mightDrag.setUneditable)&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&(this.target.draggable=!0),this.mightDrag.setUneditable&&setTimeout((()=>{this.view.input.mouseDown==this&&this.target.setAttribute("contentEditable","false")}),20),this.view.domObserver.start()),view.root.addEventListener("mouseup",this.up=this.up.bind(this)),view.root.addEventListener("mousemove",this.move=this.move.bind(this)),setSelectionOrigin(view,"pointer")}done(){this.view.root.removeEventListener("mouseup",this.up),this.view.root.removeEventListener("mousemove",this.move),this.mightDrag&&this.target&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&this.target.removeAttribute("draggable"),this.mightDrag.setUneditable&&this.target.removeAttribute("contentEditable"),this.view.domObserver.start()),this.delayedSelectionSync&&setTimeout((()=>selectionToDOM(this.view))),this.view.input.mouseDown=null}up(event){if(this.done(),!this.view.dom.contains(event.target))return;let pos=this.pos;this.view.state.doc!=this.startDoc&&(pos=this.view.posAtCoords(eventCoords(event))),this.updateAllowDefault(event),this.allowDefault||!pos?setSelectionOrigin(this.view,"pointer"):handleSingleClick(this.view,pos.pos,pos.inside,event,this.selectNode)?event.preventDefault():0==event.button&&(this.flushed||safari$1&&this.mightDrag&&!this.mightDrag.node.isAtom||chrome&&!this.view.state.selection.visible&&Math.min(Math.abs(pos.pos-this.view.state.selection.from),Math.abs(pos.pos-this.view.state.selection.to))<=2)?(updateSelection(this.view,Selection.near(this.view.state.doc.resolve(pos.pos)),"pointer"),event.preventDefault()):setSelectionOrigin(this.view,"pointer")}move(event){this.updateAllowDefault(event),setSelectionOrigin(this.view,"pointer"),0==event.buttons&&this.done()}updateAllowDefault(event){!this.allowDefault&&(Math.abs(this.event.x-event.clientX)>4||Math.abs(this.event.y-event.clientY)>4)&&(this.allowDefault=!0)}}function inOrNearComposition(view,event){return!!view.composing||!!(safari$1&&Math.abs(event.timeStamp-view.input.compositionEndedAt)<500)&&(view.input.compositionEndedAt=-2e8,!0)}handlers.touchstart=view=>{view.input.lastTouch=Date.now(),forceDOMFlush(view),setSelectionOrigin(view,"pointer")},handlers.touchmove=view=>{view.input.lastTouch=Date.now(),setSelectionOrigin(view,"pointer")},handlers.contextmenu=view=>forceDOMFlush(view);const timeoutComposition=android?5e3:-1;function scheduleComposeEnd(view,delay){clearTimeout(view.input.composingTimeout),delay>-1&&(view.input.composingTimeout=setTimeout((()=>endComposition(view)),delay))}function clearComposition(view){for(view.composing&&(view.input.composing=!1,view.input.compositionEndedAt=function(){let event=document.createEvent("Event");return event.initEvent("event",!0,!0),event.timeStamp}());view.input.compositionNodes.length>0;)view.input.compositionNodes.pop().markParentsDirty()}function endComposition(view,forceUpdate=!1){if(!(android&&view.domObserver.flushingSoon>=0)){if(view.domObserver.forceFlush(),clearComposition(view),forceUpdate||view.docView&&view.docView.dirty){let sel=selectionFromDOM(view);return sel&&!sel.eq(view.state.selection)?view.dispatch(view.state.tr.setSelection(sel)):view.updateState(view.state),!0}return!1}}editHandlers.compositionstart=editHandlers.compositionupdate=view=>{if(!view.composing){view.domObserver.flush();let{state:state}=view,$pos=state.selection.$from;if(state.selection.empty&&(state.storedMarks||!$pos.textOffset&&$pos.parentOffset&&$pos.nodeBefore.marks.some((m=>!1===m.type.spec.inclusive))))view.markCursor=view.state.storedMarks||$pos.marks(),endComposition(view,!0),view.markCursor=null;else if(endComposition(view),gecko$1&&state.selection.empty&&$pos.parentOffset&&!$pos.textOffset&&$pos.nodeBefore.marks.length){let sel=view.domSelectionRange();for(let node=sel.focusNode,offset=sel.focusOffset;node&&1==node.nodeType&&0!=offset;){let before=offset<0?node.lastChild:node.childNodes[offset-1];if(!before)break;if(3==before.nodeType){view.domSelection().collapse(before,before.nodeValue.length);break}node=before,offset=-1}}view.input.composing=!0}scheduleComposeEnd(view,timeoutComposition)},editHandlers.compositionend=(view,event)=>{view.composing&&(view.input.composing=!1,view.input.compositionEndedAt=event.timeStamp,view.input.compositionPendingChanges=view.domObserver.pendingRecords().length?view.input.compositionID:0,view.input.compositionPendingChanges&&Promise.resolve().then((()=>view.domObserver.flush())),view.input.compositionID++,scheduleComposeEnd(view,20))};const brokenClipboardAPI=ie$4&&ie_version<15||ios$1&&webkit_version<604;function doPaste(view,text,html,preferPlain,event){let slice=parseFromClipboard(view,text,html,preferPlain,view.state.selection.$from);if(view.someProp("handlePaste",(f=>f(view,event,slice||Slice.empty))))return!0;if(!slice)return!1;let singleNode=function(slice){return 0==slice.openStart&&0==slice.openEnd&&1==slice.content.childCount?slice.content.firstChild:null}(slice),tr=singleNode?view.state.tr.replaceSelectionWith(singleNode,preferPlain):view.state.tr.replaceSelection(slice);return view.dispatch(tr.scrollIntoView().setMeta("paste",!0).setMeta("uiEvent","paste")),!0}function getText(clipboardData){let text=clipboardData.getData("text/plain")||clipboardData.getData("Text");if(text)return text;let uris=clipboardData.getData("text/uri-list");return uris?uris.replace(/\r?\n/g," "):""}handlers.copy=editHandlers.cut=(view,_event)=>{let event=_event,sel=view.state.selection,cut="cut"==event.type;if(sel.empty)return;let data=brokenClipboardAPI?null:event.clipboardData,slice=sel.content(),{dom:dom,text:text}=serializeForClipboard(view,slice);data?(event.preventDefault(),data.clearData(),data.setData("text/html",dom.innerHTML),data.setData("text/plain",text)):function(view,dom){if(!view.dom.parentNode)return;let wrap=view.dom.parentNode.appendChild(document.createElement("div"));wrap.appendChild(dom),wrap.style.cssText="position: fixed; left: -10000px; top: 10px";let sel=getSelection(),range=document.createRange();range.selectNodeContents(dom),view.dom.blur(),sel.removeAllRanges(),sel.addRange(range),setTimeout((()=>{wrap.parentNode&&wrap.parentNode.removeChild(wrap),view.focus()}),50)}(view,dom),cut&&view.dispatch(view.state.tr.deleteSelection().scrollIntoView().setMeta("uiEvent","cut"))},editHandlers.paste=(view,_event)=>{let event=_event;if(view.composing&&!android)return;let data=brokenClipboardAPI?null:event.clipboardData,plain=view.input.shiftKey&&45!=view.input.lastKeyCode;data&&doPaste(view,getText(data),data.getData("text/html"),plain,event)?event.preventDefault():function(view,event){if(!view.dom.parentNode)return;let plainText=view.input.shiftKey||view.state.selection.$from.parent.type.spec.code,target=view.dom.parentNode.appendChild(document.createElement(plainText?"textarea":"div"));plainText||(target.contentEditable="true"),target.style.cssText="position: fixed; left: -10000px; top: 10px",target.focus();let plain=view.input.shiftKey&&45!=view.input.lastKeyCode;setTimeout((()=>{view.focus(),target.parentNode&&target.parentNode.removeChild(target),plainText?doPaste(view,target.value,null,plain,event):doPaste(view,target.textContent,target.innerHTML,plain,event)}),50)}(view,event)};class Dragging{constructor(slice,move,node){this.slice=slice,this.move=move,this.node=node}}const dragCopyModifier=mac$3?"altKey":"ctrlKey";handlers.dragstart=(view,_event)=>{let event=_event,mouseDown=view.input.mouseDown;if(mouseDown&&mouseDown.done(),!event.dataTransfer)return;let node,sel=view.state.selection,pos=sel.empty?null:view.posAtCoords(eventCoords(event));if(pos&&pos.pos>=sel.from&&pos.pos<=(sel instanceof NodeSelection?sel.to-1:sel.to));else if(mouseDown&&mouseDown.mightDrag)node=NodeSelection.create(view.state.doc,mouseDown.mightDrag.pos);else if(event.target&&1==event.target.nodeType){let desc=view.docView.nearestDesc(event.target,!0);desc&&desc.node.type.spec.draggable&&desc!=view.docView&&(node=NodeSelection.create(view.state.doc,desc.posBefore))}let slice=(node||view.state.selection).content(),{dom:dom,text:text}=serializeForClipboard(view,slice);event.dataTransfer.clearData(),event.dataTransfer.setData(brokenClipboardAPI?"Text":"text/html",dom.innerHTML),event.dataTransfer.effectAllowed="copyMove",brokenClipboardAPI||event.dataTransfer.setData("text/plain",text),view.dragging=new Dragging(slice,!event[dragCopyModifier],node)},handlers.dragend=view=>{let dragging=view.dragging;window.setTimeout((()=>{view.dragging==dragging&&(view.dragging=null)}),50)},editHandlers.dragover=editHandlers.dragenter=(_,e)=>e.preventDefault(),editHandlers.drop=(view,_event)=>{let event=_event,dragging=view.dragging;if(view.dragging=null,!event.dataTransfer)return;let eventPos=view.posAtCoords(eventCoords(event));if(!eventPos)return;let $mouse=view.state.doc.resolve(eventPos.pos),slice=dragging&&dragging.slice;slice?view.someProp("transformPasted",(f=>{slice=f(slice,view)})):slice=parseFromClipboard(view,getText(event.dataTransfer),brokenClipboardAPI?null:event.dataTransfer.getData("text/html"),!1,$mouse);let move=!(!dragging||event[dragCopyModifier]);if(view.someProp("handleDrop",(f=>f(view,event,slice||Slice.empty,move))))return void event.preventDefault();if(!slice)return;event.preventDefault();let insertPos=slice?function(doc,pos,slice){let $pos=doc.resolve(pos);if(!slice.content.size)return pos;let content=slice.content;for(let i=0;i<slice.openStart;i++)content=content.firstChild.content;for(let pass=1;pass<=(0==slice.openStart&&slice.size?2:1);pass++)for(let d=$pos.depth;d>=0;d--){let bias=d==$pos.depth?0:$pos.pos<=($pos.start(d+1)+$pos.end(d+1))/2?-1:1,insertPos=$pos.index(d)+(bias>0?1:0),parent=$pos.node(d),fits=!1;if(1==pass)fits=parent.canReplace(insertPos,insertPos,content);else{let wrapping=parent.contentMatchAt(insertPos).findWrapping(content.firstChild.type);fits=wrapping&&parent.canReplaceWith(insertPos,insertPos,wrapping[0])}if(fits)return 0==bias?$pos.pos:bias<0?$pos.before(d+1):$pos.after(d+1)}return null}(view.state.doc,$mouse.pos,slice):$mouse.pos;null==insertPos&&(insertPos=$mouse.pos);let tr=view.state.tr;if(move){let{node:node}=dragging;node?node.replace(tr):tr.deleteSelection()}let pos=tr.mapping.map(insertPos),isNode=0==slice.openStart&&0==slice.openEnd&&1==slice.content.childCount,beforeInsert=tr.doc;if(isNode?tr.replaceRangeWith(pos,pos,slice.content.firstChild):tr.replaceRange(pos,pos,slice),tr.doc.eq(beforeInsert))return;let $pos=tr.doc.resolve(pos);if(isNode&&NodeSelection.isSelectable(slice.content.firstChild)&&$pos.nodeAfter&&$pos.nodeAfter.sameMarkup(slice.content.firstChild))tr.setSelection(new NodeSelection($pos));else{let end=tr.mapping.map(insertPos);tr.mapping.maps[tr.mapping.maps.length-1].forEach(((_from,_to,_newFrom,newTo)=>end=newTo)),tr.setSelection(selectionBetween(view,$pos,tr.doc.resolve(end)))}view.focus(),view.dispatch(tr.setMeta("uiEvent","drop"))},handlers.focus=view=>{view.input.lastFocus=Date.now(),view.focused||(view.domObserver.stop(),view.dom.classList.add("ProseMirror-focused"),view.domObserver.start(),view.focused=!0,setTimeout((()=>{view.docView&&view.hasFocus()&&!view.domObserver.currentSelection.eq(view.domSelectionRange())&&selectionToDOM(view)}),20))},handlers.blur=(view,_event)=>{let event=_event;view.focused&&(view.domObserver.stop(),view.dom.classList.remove("ProseMirror-focused"),view.domObserver.start(),event.relatedTarget&&view.dom.contains(event.relatedTarget)&&view.domObserver.currentSelection.clear(),view.focused=!1)},handlers.beforeinput=(view,_event)=>{if(chrome&&android&&"deleteContentBackward"==_event.inputType){view.domObserver.flushSoon();let{domChangeCount:domChangeCount}=view.input;setTimeout((()=>{if(view.input.domChangeCount!=domChangeCount)return;if(view.dom.blur(),view.focus(),view.someProp("handleKeyDown",(f=>f(view,keyEvent(8,"Backspace")))))return;let{$cursor:$cursor}=view.state.selection;$cursor&&$cursor.pos>0&&view.dispatch(view.state.tr.delete($cursor.pos-1,$cursor.pos).scrollIntoView())}),50)}};for(let prop in editHandlers)handlers[prop]=editHandlers[prop];function compareObjs(a,b){if(a==b)return!0;for(let p in a)if(a[p]!==b[p])return!1;for(let p in b)if(!(p in a))return!1;return!0}class WidgetType{constructor(toDOM,spec){this.toDOM=toDOM,this.spec=spec||noSpec,this.side=this.spec.side||0}map(mapping,span,offset,oldOffset){let{pos:pos,deleted:deleted}=mapping.mapResult(span.from+oldOffset,this.side<0?-1:1);return deleted?null:new Decoration(pos-offset,pos-offset,this)}valid(){return!0}eq(other){return this==other||other instanceof WidgetType&&(this.spec.key&&this.spec.key==other.spec.key||this.toDOM==other.toDOM&&compareObjs(this.spec,other.spec))}destroy(node){this.spec.destroy&&this.spec.destroy(node)}}class InlineType{constructor(attrs,spec){this.attrs=attrs,this.spec=spec||noSpec}map(mapping,span,offset,oldOffset){let from=mapping.map(span.from+oldOffset,this.spec.inclusiveStart?-1:1)-offset,to=mapping.map(span.to+oldOffset,this.spec.inclusiveEnd?1:-1)-offset;return from>=to?null:new Decoration(from,to,this)}valid(_,span){return span.from<span.to}eq(other){return this==other||other instanceof InlineType&&compareObjs(this.attrs,other.attrs)&&compareObjs(this.spec,other.spec)}static is(span){return span.type instanceof InlineType}destroy(){}}class NodeType{constructor(attrs,spec){this.attrs=attrs,this.spec=spec||noSpec}map(mapping,span,offset,oldOffset){let from=mapping.mapResult(span.from+oldOffset,1);if(from.deleted)return null;let to=mapping.mapResult(span.to+oldOffset,-1);return to.deleted||to.pos<=from.pos?null:new Decoration(from.pos-offset,to.pos-offset,this)}valid(node,span){let child,{index:index,offset:offset}=node.content.findIndex(span.from);return offset==span.from&&!(child=node.child(index)).isText&&offset+child.nodeSize==span.to}eq(other){return this==other||other instanceof NodeType&&compareObjs(this.attrs,other.attrs)&&compareObjs(this.spec,other.spec)}destroy(){}}class Decoration{constructor(from,to,type){this.from=from,this.to=to,this.type=type}copy(from,to){return new Decoration(from,to,this.type)}eq(other,offset=0){return this.type.eq(other.type)&&this.from+offset==other.from&&this.to+offset==other.to}map(mapping,offset,oldOffset){return this.type.map(mapping,this,offset,oldOffset)}static widget(pos,toDOM,spec){return new Decoration(pos,pos,new WidgetType(toDOM,spec))}static inline(from,to,attrs,spec){return new Decoration(from,to,new InlineType(attrs,spec))}static node(from,to,attrs,spec){return new Decoration(from,to,new NodeType(attrs,spec))}get spec(){return this.type.spec}get inline(){return this.type instanceof InlineType}get widget(){return this.type instanceof WidgetType}}const none=[],noSpec={};class DecorationSet{constructor(local,children){this.local=local.length?local:none,this.children=children.length?children:none}static create(doc,decorations){return decorations.length?buildTree(decorations,doc,0,noSpec):empty}find(start,end,predicate){let result=[];return this.findInner(null==start?0:start,null==end?1e9:end,result,0,predicate),result}findInner(start,end,result,offset,predicate){for(let i=0;i<this.local.length;i++){let span=this.local[i];span.from<=end&&span.to>=start&&(!predicate||predicate(span.spec))&&result.push(span.copy(span.from+offset,span.to+offset))}for(let i=0;i<this.children.length;i+=3)if(this.children[i]<end&&this.children[i+1]>start){let childOff=this.children[i]+1;this.children[i+2].findInner(start-childOff,end-childOff,result,offset+childOff,predicate)}}map(mapping,doc,options){return this==empty||0==mapping.maps.length?this:this.mapInner(mapping,doc,0,0,options||noSpec)}mapInner(mapping,node,offset,oldOffset,options){let newLocal;for(let i=0;i<this.local.length;i++){let mapped=this.local[i].map(mapping,offset,oldOffset);mapped&&mapped.type.valid(node,mapped)?(newLocal||(newLocal=[])).push(mapped):options.onRemove&&options.onRemove(this.local[i].spec)}return this.children.length?function(oldChildren,newLocal,mapping,node,offset,oldOffset,options){let children=oldChildren.slice();for(let i=0,baseOffset=oldOffset;i<mapping.maps.length;i++){let moved=0;mapping.maps[i].forEach(((oldStart,oldEnd,newStart,newEnd)=>{let dSize=newEnd-newStart-(oldEnd-oldStart);for(let i=0;i<children.length;i+=3){let end=children[i+1];if(end<0||oldStart>end+baseOffset-moved)continue;let start=children[i]+baseOffset-moved;oldEnd>=start?children[i+1]=oldStart<=start?-2:-1:oldStart>=baseOffset&&dSize&&(children[i]+=dSize,children[i+1]+=dSize)}moved+=dSize})),baseOffset=mapping.maps[i].map(baseOffset,-1)}let mustRebuild=!1;for(let i=0;i<children.length;i+=3)if(children[i+1]<0){if(-2==children[i+1]){mustRebuild=!0,children[i+1]=-1;continue}let from=mapping.map(oldChildren[i]+oldOffset),fromLocal=from-offset;if(fromLocal<0||fromLocal>=node.content.size){mustRebuild=!0;continue}let toLocal=mapping.map(oldChildren[i+1]+oldOffset,-1)-offset,{index:index,offset:childOffset}=node.content.findIndex(fromLocal),childNode=node.maybeChild(index);if(childNode&&childOffset==fromLocal&&childOffset+childNode.nodeSize==toLocal){let mapped=children[i+2].mapInner(mapping,childNode,from+1,oldChildren[i]+oldOffset+1,options);mapped!=empty?(children[i]=fromLocal,children[i+1]=toLocal,children[i+2]=mapped):(children[i+1]=-2,mustRebuild=!0)}else mustRebuild=!0}if(mustRebuild){let decorations=function(children,oldChildren,decorations,mapping,offset,oldOffset,options){function gather(set,oldOffset){for(let i=0;i<set.local.length;i++){let mapped=set.local[i].map(mapping,offset,oldOffset);mapped?decorations.push(mapped):options.onRemove&&options.onRemove(set.local[i].spec)}for(let i=0;i<set.children.length;i+=3)gather(set.children[i+2],set.children[i]+oldOffset+1)}for(let i=0;i<children.length;i+=3)-1==children[i+1]&&gather(children[i+2],oldChildren[i]+oldOffset+1);return decorations}(children,oldChildren,newLocal,mapping,offset,oldOffset,options),built=buildTree(decorations,node,0,options);newLocal=built.local;for(let i=0;i<children.length;i+=3)children[i+1]<0&&(children.splice(i,3),i-=3);for(let i=0,j=0;i<built.children.length;i+=3){let from=built.children[i];for(;j<children.length&&children[j]<from;)j+=3;children.splice(j,0,built.children[i],built.children[i+1],built.children[i+2])}}return new DecorationSet(newLocal.sort(byPos),children)}(this.children,newLocal||[],mapping,node,offset,oldOffset,options):newLocal?new DecorationSet(newLocal.sort(byPos),none):empty}add(doc,decorations){return decorations.length?this==empty?DecorationSet.create(doc,decorations):this.addInner(doc,decorations,0):this}addInner(doc,decorations,offset){let children,childIndex=0;doc.forEach(((childNode,childOffset)=>{let found,baseOffset=childOffset+offset;if(found=takeSpansForNode(decorations,childNode,baseOffset)){for(children||(children=this.children.slice());childIndex<children.length&&children[childIndex]<childOffset;)childIndex+=3;children[childIndex]==childOffset?children[childIndex+2]=children[childIndex+2].addInner(childNode,found,baseOffset+1):children.splice(childIndex,0,childOffset,childOffset+childNode.nodeSize,buildTree(found,childNode,baseOffset+1,noSpec)),childIndex+=3}}));let local=moveSpans(childIndex?withoutNulls(decorations):decorations,-offset);for(let i=0;i<local.length;i++)local[i].type.valid(doc,local[i])||local.splice(i--,1);return new DecorationSet(local.length?this.local.concat(local).sort(byPos):this.local,children||this.children)}remove(decorations){return 0==decorations.length||this==empty?this:this.removeInner(decorations,0)}removeInner(decorations,offset){let children=this.children,local=this.local;for(let i=0;i<children.length;i+=3){let found,from=children[i]+offset,to=children[i+1]+offset;for(let span,j=0;j<decorations.length;j++)(span=decorations[j])&&span.from>from&&span.to<to&&(decorations[j]=null,(found||(found=[])).push(span));if(!found)continue;children==this.children&&(children=this.children.slice());let removed=children[i+2].removeInner(found,from+1);removed!=empty?children[i+2]=removed:(children.splice(i,3),i-=3)}if(local.length)for(let span,i=0;i<decorations.length;i++)if(span=decorations[i])for(let j=0;j<local.length;j++)local[j].eq(span,offset)&&(local==this.local&&(local=this.local.slice()),local.splice(j--,1));return children==this.children&&local==this.local?this:local.length||children.length?new DecorationSet(local,children):empty}forChild(offset,node){if(this==empty)return this;if(node.isLeaf)return DecorationSet.empty;let child,local;for(let i=0;i<this.children.length;i+=3)if(this.children[i]>=offset){this.children[i]==offset&&(child=this.children[i+2]);break}let start=offset+1,end=start+node.content.size;for(let i=0;i<this.local.length;i++){let dec=this.local[i];if(dec.from<end&&dec.to>start&&dec.type instanceof InlineType){let from=Math.max(start,dec.from)-start,to=Math.min(end,dec.to)-start;from<to&&(local||(local=[])).push(dec.copy(from,to))}}if(local){let localSet=new DecorationSet(local.sort(byPos),none);return child?new DecorationGroup([localSet,child]):localSet}return child||empty}eq(other){if(this==other)return!0;if(!(other instanceof DecorationSet)||this.local.length!=other.local.length||this.children.length!=other.children.length)return!1;for(let i=0;i<this.local.length;i++)if(!this.local[i].eq(other.local[i]))return!1;for(let i=0;i<this.children.length;i+=3)if(this.children[i]!=other.children[i]||this.children[i+1]!=other.children[i+1]||!this.children[i+2].eq(other.children[i+2]))return!1;return!0}locals(node){return removeOverlap(this.localsInner(node))}localsInner(node){if(this==empty)return none;if(node.inlineContent||!this.local.some(InlineType.is))return this.local;let result=[];for(let i=0;i<this.local.length;i++)this.local[i].type instanceof InlineType||result.push(this.local[i]);return result}}DecorationSet.empty=new DecorationSet([],[]),DecorationSet.removeOverlap=removeOverlap;const empty=DecorationSet.empty;class DecorationGroup{constructor(members){this.members=members}map(mapping,doc){const mappedDecos=this.members.map((member=>member.map(mapping,doc,noSpec)));return DecorationGroup.from(mappedDecos)}forChild(offset,child){if(child.isLeaf)return DecorationSet.empty;let found=[];for(let i=0;i<this.members.length;i++){let result=this.members[i].forChild(offset,child);result!=empty&&(result instanceof DecorationGroup?found=found.concat(result.members):found.push(result))}return DecorationGroup.from(found)}eq(other){if(!(other instanceof DecorationGroup)||other.members.length!=this.members.length)return!1;for(let i=0;i<this.members.length;i++)if(!this.members[i].eq(other.members[i]))return!1;return!0}locals(node){let result,sorted=!0;for(let i=0;i<this.members.length;i++){let locals=this.members[i].localsInner(node);if(locals.length)if(result){sorted&&(result=result.slice(),sorted=!1);for(let j=0;j<locals.length;j++)result.push(locals[j])}else result=locals}return result?removeOverlap(sorted?result:result.sort(byPos)):none}static from(members){switch(members.length){case 0:return empty;case 1:return members[0];default:return new DecorationGroup(members.every((m=>m instanceof DecorationSet))?members:members.reduce(((r,m)=>r.concat(m instanceof DecorationSet?m:m.members)),[]))}}}function moveSpans(spans,offset){if(!offset||!spans.length)return spans;let result=[];for(let i=0;i<spans.length;i++){let span=spans[i];result.push(new Decoration(span.from+offset,span.to+offset,span.type))}return result}function takeSpansForNode(spans,node,offset){if(node.isLeaf)return null;let end=offset+node.nodeSize,found=null;for(let span,i=0;i<spans.length;i++)(span=spans[i])&&span.from>offset&&span.to<end&&((found||(found=[])).push(span),spans[i]=null);return found}function withoutNulls(array){let result=[];for(let i=0;i<array.length;i++)null!=array[i]&&result.push(array[i]);return result}function buildTree(spans,node,offset,options){let children=[],hasNulls=!1;node.forEach(((childNode,localStart)=>{let found=takeSpansForNode(spans,childNode,localStart+offset);if(found){hasNulls=!0;let subtree=buildTree(found,childNode,offset+localStart+1,options);subtree!=empty&&children.push(localStart,localStart+childNode.nodeSize,subtree)}}));let locals=moveSpans(hasNulls?withoutNulls(spans):spans,-offset).sort(byPos);for(let i=0;i<locals.length;i++)locals[i].type.valid(node,locals[i])||(options.onRemove&&options.onRemove(locals[i].spec),locals.splice(i--,1));return locals.length||children.length?new DecorationSet(locals,children):empty}function byPos(a,b){return a.from-b.from||a.to-b.to}function removeOverlap(spans){let working=spans;for(let i=0;i<working.length-1;i++){let span=working[i];if(span.from!=span.to)for(let j=i+1;j<working.length;j++){let next=working[j];if(next.from!=span.from){next.from<span.to&&(working==spans&&(working=spans.slice()),working[i]=span.copy(span.from,next.from),insertAhead(working,j,span.copy(next.from,span.to)));break}next.to!=span.to&&(working==spans&&(working=spans.slice()),working[j]=next.copy(next.from,span.to),insertAhead(working,j+1,next.copy(span.to,next.to)))}}return working}function insertAhead(array,i,deco){for(;i<array.length&&byPos(deco,array[i])>0;)i++;array.splice(i,0,deco)}function viewDecorations(view){let found=[];return view.someProp("decorations",(f=>{let result=f(view.state);result&&result!=empty&&found.push(result)})),view.cursorWrapper&&found.push(DecorationSet.create(view.state.doc,[view.cursorWrapper.deco])),DecorationGroup.from(found)}const observeOptions={childList:!0,characterData:!0,characterDataOldValue:!0,attributes:!0,attributeOldValue:!0,subtree:!0},useCharData=ie$4&&ie_version<=11;class SelectionState{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}set(sel){this.anchorNode=sel.anchorNode,this.anchorOffset=sel.anchorOffset,this.focusNode=sel.focusNode,this.focusOffset=sel.focusOffset}clear(){this.anchorNode=this.focusNode=null}eq(sel){return sel.anchorNode==this.anchorNode&&sel.anchorOffset==this.anchorOffset&&sel.focusNode==this.focusNode&&sel.focusOffset==this.focusOffset}}class DOMObserver{constructor(view,handleDOMChange){this.view=view,this.handleDOMChange=handleDOMChange,this.queue=[],this.flushingSoon=-1,this.observer=null,this.currentSelection=new SelectionState,this.onCharData=null,this.suppressingSelectionUpdates=!1,this.observer=window.MutationObserver&&new window.MutationObserver((mutations=>{for(let i=0;i<mutations.length;i++)this.queue.push(mutations[i]);ie$4&&ie_version<=11&&mutations.some((m=>"childList"==m.type&&m.removedNodes.length||"characterData"==m.type&&m.oldValue.length>m.target.nodeValue.length))?this.flushSoon():this.flush()})),useCharData&&(this.onCharData=e=>{this.queue.push({target:e.target,type:"characterData",oldValue:e.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this)}flushSoon(){this.flushingSoon<0&&(this.flushingSoon=window.setTimeout((()=>{this.flushingSoon=-1,this.flush()}),20))}forceFlush(){this.flushingSoon>-1&&(window.clearTimeout(this.flushingSoon),this.flushingSoon=-1,this.flush())}start(){this.observer&&(this.observer.takeRecords(),this.observer.observe(this.view.dom,observeOptions)),this.onCharData&&this.view.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.connectSelection()}stop(){if(this.observer){let take=this.observer.takeRecords();if(take.length){for(let i=0;i<take.length;i++)this.queue.push(take[i]);window.setTimeout((()=>this.flush()),20)}this.observer.disconnect()}this.onCharData&&this.view.dom.removeEventListener("DOMCharacterDataModified",this.onCharData),this.disconnectSelection()}connectSelection(){this.view.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)}disconnectSelection(){this.view.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange)}suppressSelectionUpdates(){this.suppressingSelectionUpdates=!0,setTimeout((()=>this.suppressingSelectionUpdates=!1),50)}onSelectionChange(){if(hasFocusAndSelection(this.view)){if(this.suppressingSelectionUpdates)return selectionToDOM(this.view);if(ie$4&&ie_version<=11&&!this.view.state.selection.empty){let sel=this.view.domSelectionRange();if(sel.focusNode&&isEquivalentPosition(sel.focusNode,sel.focusOffset,sel.anchorNode,sel.anchorOffset))return this.flushSoon()}this.flush()}}setCurSelection(){this.currentSelection.set(this.view.domSelectionRange())}ignoreSelectionChange(sel){if(!sel.focusNode)return!0;let container,ancestors=new Set;for(let scan=sel.focusNode;scan;scan=parentNode(scan))ancestors.add(scan);for(let scan=sel.anchorNode;scan;scan=parentNode(scan))if(ancestors.has(scan)){container=scan;break}let desc=container&&this.view.docView.nearestDesc(container);return desc&&desc.ignoreMutation({type:"selection",target:3==container.nodeType?container.parentNode:container})?(this.setCurSelection(),!0):void 0}pendingRecords(){if(this.observer)for(let mut of this.observer.takeRecords())this.queue.push(mut);return this.queue}flush(){let{view:view}=this;if(!view.docView||this.flushingSoon>-1)return;let mutations=this.pendingRecords();mutations.length&&(this.queue=[]);let sel=view.domSelectionRange(),newSel=!this.suppressingSelectionUpdates&&!this.currentSelection.eq(sel)&&hasFocusAndSelection(view)&&!this.ignoreSelectionChange(sel),from=-1,to=-1,typeOver=!1,added=[];if(view.editable)for(let i=0;i<mutations.length;i++){let result=this.registerMutation(mutations[i],added);result&&(from=from<0?result.from:Math.min(result.from,from),to=to<0?result.to:Math.max(result.to,to),result.typeOver&&(typeOver=!0))}if(gecko$1&&added.length>1){let brs=added.filter((n=>"BR"==n.nodeName));if(2==brs.length){let a=brs[0],b=brs[1];a.parentNode&&a.parentNode.parentNode==b.parentNode?b.remove():a.remove()}}let readSel=null;from<0&&newSel&&view.input.lastFocus>Date.now()-200&&Math.max(view.input.lastTouch,view.input.lastClick.time)<Date.now()-300&&selectionCollapsed(sel)&&(readSel=selectionFromDOM(view))&&readSel.eq(Selection.near(view.state.doc.resolve(0),1))?(view.input.lastFocus=0,selectionToDOM(view),this.currentSelection.set(sel),view.scrollToSelection()):(from>-1||newSel)&&(from>-1&&(view.docView.markDirty(from,to),function(view){if(cssChecked.has(view))return;if(cssChecked.set(view,null),-1!==["normal","nowrap","pre-line"].indexOf(getComputedStyle(view.dom).whiteSpace)){if(view.requiresGeckoHackNode=gecko$1,cssCheckWarned)return;console.warn("ProseMirror expects the CSS white-space property to be set, preferably to 'pre-wrap'. It is recommended to load style/prosemirror.css from the prosemirror-view package."),cssCheckWarned=!0}}(view)),this.handleDOMChange(from,to,typeOver,added),view.docView&&view.docView.dirty?view.updateState(view.state):this.currentSelection.eq(sel)||selectionToDOM(view),this.currentSelection.set(sel))}registerMutation(mut,added){if(added.indexOf(mut.target)>-1)return null;let desc=this.view.docView.nearestDesc(mut.target);if("attributes"==mut.type&&(desc==this.view.docView||"contenteditable"==mut.attributeName||"style"==mut.attributeName&&!mut.oldValue&&!mut.target.getAttribute("style")))return null;if(!desc||desc.ignoreMutation(mut))return null;if("childList"==mut.type){for(let i=0;i<mut.addedNodes.length;i++)added.push(mut.addedNodes[i]);if(desc.contentDOM&&desc.contentDOM!=desc.dom&&!desc.contentDOM.contains(mut.target))return{from:desc.posBefore,to:desc.posAfter};let prev=mut.previousSibling,next=mut.nextSibling;if(ie$4&&ie_version<=11&&mut.addedNodes.length)for(let i=0;i<mut.addedNodes.length;i++){let{previousSibling:previousSibling,nextSibling:nextSibling}=mut.addedNodes[i];(!previousSibling||Array.prototype.indexOf.call(mut.addedNodes,previousSibling)<0)&&(prev=previousSibling),(!nextSibling||Array.prototype.indexOf.call(mut.addedNodes,nextSibling)<0)&&(next=nextSibling)}let fromOffset=prev&&prev.parentNode==mut.target?domIndex(prev)+1:0,from=desc.localPosFromDOM(mut.target,fromOffset,-1),toOffset=next&&next.parentNode==mut.target?domIndex(next):mut.target.childNodes.length;return{from:from,to:desc.localPosFromDOM(mut.target,toOffset,1)}}return"attributes"==mut.type?{from:desc.posAtStart-desc.border,to:desc.posAtEnd+desc.border}:{from:desc.posAtStart,to:desc.posAtEnd,typeOver:mut.target.nodeValue==mut.oldValue}}}let cssChecked=new WeakMap,cssCheckWarned=!1;function ruleFromNode(dom){let desc=dom.pmViewDesc;if(desc)return desc.parseRule();if("BR"==dom.nodeName&&dom.parentNode){if(safari$1&&/^(ul|ol)$/i.test(dom.parentNode.nodeName)){let skip=document.createElement("div");return skip.appendChild(document.createElement("li")),{skip:skip}}if(dom.parentNode.lastChild==dom||safari$1&&/^(tr|table)$/i.test(dom.parentNode.nodeName))return{ignore:!0}}else if("IMG"==dom.nodeName&&dom.getAttribute("mark-placeholder"))return{ignore:!0};return null}const isInline=/^(a|abbr|acronym|b|bd[io]|big|br|button|cite|code|data(list)?|del|dfn|em|i|ins|kbd|label|map|mark|meter|output|q|ruby|s|samp|small|span|strong|su[bp]|time|u|tt|var)$/i;function readDOMChange(view,from,to,typeOver,addedNodes){let compositionID=view.input.compositionPendingChanges||(view.composing?view.input.compositionID:0);if(view.input.compositionPendingChanges=0,from<0){let origin=view.input.lastSelectionTime>Date.now()-50?view.input.lastSelectionOrigin:null,newSel=selectionFromDOM(view,origin);if(newSel&&!view.state.selection.eq(newSel)){if(chrome&&android&&13===view.input.lastKeyCode&&Date.now()-100<view.input.lastKeyCodeTime&&view.someProp("handleKeyDown",(f=>f(view,keyEvent(13,"Enter")))))return;let tr=view.state.tr.setSelection(newSel);"pointer"==origin?tr.setMeta("pointer",!0):"key"==origin&&tr.scrollIntoView(),compositionID&&tr.setMeta("composition",compositionID),view.dispatch(tr)}return}let $before=view.state.doc.resolve(from),shared=$before.sharedDepth(to);from=$before.before(shared+1),to=view.state.doc.resolve(to).after(shared+1);let preferredPos,preferredSide,sel=view.state.selection,parse=function(view,from_,to_){let find,{node:parent,fromOffset:fromOffset,toOffset:toOffset,from:from,to:to}=view.docView.parseRange(from_,to_),domSel=view.domSelectionRange(),anchor=domSel.anchorNode;if(anchor&&view.dom.contains(1==anchor.nodeType?anchor:anchor.parentNode)&&(find=[{node:anchor,offset:domSel.anchorOffset}],selectionCollapsed(domSel)||find.push({node:domSel.focusNode,offset:domSel.focusOffset})),chrome&&8===view.input.lastKeyCode)for(let off=toOffset;off>fromOffset;off--){let node=parent.childNodes[off-1],desc=node.pmViewDesc;if("BR"==node.nodeName&&!desc){toOffset=off;break}if(!desc||desc.size)break}let startDoc=view.state.doc,parser=view.someProp("domParser")||DOMParser.fromSchema(view.state.schema),$from=startDoc.resolve(from),sel=null,doc=parser.parse(parent,{topNode:$from.parent,topMatch:$from.parent.contentMatchAt($from.index()),topOpen:!0,from:fromOffset,to:toOffset,preserveWhitespace:"pre"!=$from.parent.type.whitespace||"full",findPositions:find,ruleFromNode:ruleFromNode,context:$from});if(find&&null!=find[0].pos){let anchor=find[0].pos,head=find[1]&&find[1].pos;null==head&&(head=anchor),sel={anchor:anchor+from,head:head+from}}return{doc:doc,sel:sel,from:from,to:to}}(view,from,to),doc=view.state.doc,compare=doc.slice(parse.from,parse.to);8===view.input.lastKeyCode&&Date.now()-100<view.input.lastKeyCodeTime?(preferredPos=view.state.selection.to,preferredSide="end"):(preferredPos=view.state.selection.from,preferredSide="start"),view.input.lastKeyCode=null;let change=function(a,b,pos,preferredPos,preferredSide){let start=a.findDiffStart(b,pos);if(null==start)return null;let{a:endA,b:endB}=a.findDiffEnd(b,pos+a.size,pos+b.size);if("end"==preferredSide){preferredPos-=endA+Math.max(0,start-Math.min(endA,endB))-start}if(endA<start&&a.size<b.size){let move=preferredPos<=start&&preferredPos>=endA?start-preferredPos:0;start-=move,start&&start<b.size&&isSurrogatePair(b.textBetween(start-1,start+1))&&(start+=move?1:-1),endB=start+(endB-endA),endA=start}else if(endB<start){let move=preferredPos<=start&&preferredPos>=endB?start-preferredPos:0;start-=move,start&&start<a.size&&isSurrogatePair(a.textBetween(start-1,start+1))&&(start+=move?1:-1),endA=start+(endA-endB),endB=start}return{start:start,endA:endA,endB:endB}}(compare.content,parse.doc.content,parse.from,preferredPos,preferredSide);if((ios$1&&view.input.lastIOSEnter>Date.now()-225||android)&&addedNodes.some((n=>1==n.nodeType&&!isInline.test(n.nodeName)))&&(!change||change.endA>=change.endB)&&view.someProp("handleKeyDown",(f=>f(view,keyEvent(13,"Enter")))))return void(view.input.lastIOSEnter=0);if(!change){if(!(typeOver&&sel instanceof TextSelection&&!sel.empty&&sel.$head.sameParent(sel.$anchor))||view.composing||parse.sel&&parse.sel.anchor!=parse.sel.head){if(parse.sel){let sel=resolveSelection(view,view.state.doc,parse.sel);if(sel&&!sel.eq(view.state.selection)){let tr=view.state.tr.setSelection(sel);compositionID&&tr.setMeta("composition",compositionID),view.dispatch(tr)}}return}change={start:sel.from,endA:sel.to,endB:sel.to}}view.input.domChangeCount++,view.state.selection.from<view.state.selection.to&&change.start==change.endB&&view.state.selection instanceof TextSelection&&(change.start>view.state.selection.from&&change.start<=view.state.selection.from+2&&view.state.selection.from>=parse.from?change.start=view.state.selection.from:change.endA<view.state.selection.to&&change.endA>=view.state.selection.to-2&&view.state.selection.to<=parse.to&&(change.endB+=view.state.selection.to-change.endA,change.endA=view.state.selection.to)),ie$4&&ie_version<=11&&change.endB==change.start+1&&change.endA==change.start&&change.start>parse.from&&" "==parse.doc.textBetween(change.start-parse.from-1,change.start-parse.from+1)&&(change.start--,change.endA--,change.endB--);let nextSel,$from=parse.doc.resolveNoCache(change.start-parse.from),$to=parse.doc.resolveNoCache(change.endB-parse.from),$fromA=doc.resolve(change.start),inlineChange=$from.sameParent($to)&&$from.parent.inlineContent&&$fromA.end()>=change.endA;if((ios$1&&view.input.lastIOSEnter>Date.now()-225&&(!inlineChange||addedNodes.some((n=>"DIV"==n.nodeName||"P"==n.nodeName)))||!inlineChange&&$from.pos<parse.doc.content.size&&!$from.sameParent($to)&&(nextSel=Selection.findFrom(parse.doc.resolve($from.pos+1),1,!0))&&nextSel.head==$to.pos)&&view.someProp("handleKeyDown",(f=>f(view,keyEvent(13,"Enter")))))return void(view.input.lastIOSEnter=0);if(view.state.selection.anchor>change.start&&function(old,start,end,$newStart,$newEnd){if(end-start<=$newEnd.pos-$newStart.pos||skipClosingAndOpening($newStart,!0,!1)<$newEnd.pos)return!1;let $start=old.resolve(start);if(!$newStart.parent.isTextblock){let after=$start.nodeAfter;return null!=after&&end==start+after.nodeSize}if($start.parentOffset<$start.parent.content.size||!$start.parent.isTextblock)return!1;let $next=old.resolve(skipClosingAndOpening($start,!0,!0));return!(!$next.parent.isTextblock||$next.pos>end||skipClosingAndOpening($next,!0,!1)<end)&&$newStart.parent.content.cut($newStart.parentOffset).eq($next.parent.content)}(doc,change.start,change.endA,$from,$to)&&view.someProp("handleKeyDown",(f=>f(view,keyEvent(8,"Backspace")))))return void(android&&chrome&&view.domObserver.suppressSelectionUpdates());chrome&&android&&change.endB==change.start&&(view.input.lastAndroidDelete=Date.now()),android&&!inlineChange&&$from.start()!=$to.start()&&0==$to.parentOffset&&$from.depth==$to.depth&&parse.sel&&parse.sel.anchor==parse.sel.head&&parse.sel.head==change.endA&&(change.endB-=2,$to=parse.doc.resolveNoCache(change.endB-parse.from),setTimeout((()=>{view.someProp("handleKeyDown",(function(f){return f(view,keyEvent(13,"Enter"))}))}),20));let tr,storedMarks,markChange,chFrom=change.start,chTo=change.endA;if(inlineChange)if($from.pos==$to.pos)ie$4&&ie_version<=11&&0==$from.parentOffset&&(view.domObserver.suppressSelectionUpdates(),setTimeout((()=>selectionToDOM(view)),20)),tr=view.state.tr.delete(chFrom,chTo),storedMarks=doc.resolve(change.start).marksAcross(doc.resolve(change.endA));else if(change.endA==change.endB&&(markChange=function(cur,prev){let type,mark,update,curMarks=cur.firstChild.marks,prevMarks=prev.firstChild.marks,added=curMarks,removed=prevMarks;for(let i=0;i<prevMarks.length;i++)added=prevMarks[i].removeFromSet(added);for(let i=0;i<curMarks.length;i++)removed=curMarks[i].removeFromSet(removed);if(1==added.length&&0==removed.length)mark=added[0],type="add",update=node=>node.mark(mark.addToSet(node.marks));else{if(0!=added.length||1!=removed.length)return null;mark=removed[0],type="remove",update=node=>node.mark(mark.removeFromSet(node.marks))}let updated=[];for(let i=0;i<prev.childCount;i++)updated.push(update(prev.child(i)));if(Fragment.from(updated).eq(cur))return{mark:mark,type:type}}($from.parent.content.cut($from.parentOffset,$to.parentOffset),$fromA.parent.content.cut($fromA.parentOffset,change.endA-$fromA.start()))))tr=view.state.tr,"add"==markChange.type?tr.addMark(chFrom,chTo,markChange.mark):tr.removeMark(chFrom,chTo,markChange.mark);else if($from.parent.child($from.index()).isText&&$from.index()==$to.index()-($to.textOffset?0:1)){let text=$from.parent.textBetween($from.parentOffset,$to.parentOffset);if(view.someProp("handleTextInput",(f=>f(view,chFrom,chTo,text))))return;tr=view.state.tr.insertText(text,chFrom,chTo)}if(tr||(tr=view.state.tr.replace(chFrom,chTo,parse.doc.slice(change.start-parse.from,change.endB-parse.from))),parse.sel){let sel=resolveSelection(view,tr.doc,parse.sel);sel&&!(chrome&&android&&view.composing&&sel.empty&&(change.start!=change.endB||view.input.lastAndroidDelete<Date.now()-100)&&(sel.head==chFrom||sel.head==tr.mapping.map(chTo)-1)||ie$4&&sel.empty&&sel.head==chFrom)&&tr.setSelection(sel)}storedMarks&&tr.ensureMarks(storedMarks),compositionID&&tr.setMeta("composition",compositionID),view.dispatch(tr.scrollIntoView())}function resolveSelection(view,doc,parsedSel){return Math.max(parsedSel.anchor,parsedSel.head)>doc.content.size?null:selectionBetween(view,doc.resolve(parsedSel.anchor),doc.resolve(parsedSel.head))}function skipClosingAndOpening($pos,fromEnd,mayOpen){let depth=$pos.depth,end=fromEnd?$pos.end():$pos.pos;for(;depth>0&&(fromEnd||$pos.indexAfter(depth)==$pos.node(depth).childCount);)depth--,end++,fromEnd=!1;if(mayOpen){let next=$pos.node(depth).maybeChild($pos.indexAfter(depth));for(;next&&!next.isLeaf;)next=next.firstChild,end++}return end}function isSurrogatePair(str){if(2!=str.length)return!1;let a=str.charCodeAt(0),b=str.charCodeAt(1);return a>=56320&&a<=57343&&b>=55296&&b<=56319}class EditorView{constructor(place,props){this._root=null,this.focused=!1,this.trackWrites=null,this.mounted=!1,this.markCursor=null,this.cursorWrapper=null,this.lastSelectedViewDesc=void 0,this.input=new InputState,this.prevDirectPlugins=[],this.pluginViews=[],this.requiresGeckoHackNode=!1,this.dragging=null,this._props=props,this.state=props.state,this.directPlugins=props.plugins||[],this.directPlugins.forEach(checkStateComponent),this.dispatch=this.dispatch.bind(this),this.dom=place&&place.mount||document.createElement("div"),place&&(place.appendChild?place.appendChild(this.dom):"function"==typeof place?place(this.dom):place.mount&&(this.mounted=!0)),this.editable=getEditable(this),updateCursorWrapper(this),this.nodeViews=buildNodeViews(this),this.docView=docViewDesc(this.state.doc,computeDocDeco(this),viewDecorations(this),this.dom,this),this.domObserver=new DOMObserver(this,((from,to,typeOver,added)=>readDOMChange(this,from,to,typeOver,added))),this.domObserver.start(),function(view){for(let event in handlers){let handler=handlers[event];view.dom.addEventListener(event,view.input.eventHandlers[event]=event=>{!eventBelongsToView(view,event)||runCustomHandler(view,event)||!view.editable&&event.type in editHandlers||handler(view,event)},passiveHandlers[event]?{passive:!0}:void 0)}safari$1&&view.dom.addEventListener("input",(()=>null)),ensureListeners(view)}(this),this.updatePluginViews()}get composing(){return this.input.composing}get props(){if(this._props.state!=this.state){let prev=this._props;this._props={};for(let name in prev)this._props[name]=prev[name];this._props.state=this.state}return this._props}update(props){props.handleDOMEvents!=this._props.handleDOMEvents&&ensureListeners(this);let prevProps=this._props;this._props=props,props.plugins&&(props.plugins.forEach(checkStateComponent),this.directPlugins=props.plugins),this.updateStateInner(props.state,prevProps)}setProps(props){let updated={};for(let name in this._props)updated[name]=this._props[name];updated.state=this.state;for(let name in props)updated[name]=props[name];this.update(updated)}updateState(state){this.updateStateInner(state,this._props)}updateStateInner(state,prevProps){var _a;let prev=this.state,redraw=!1,updateSel=!1;state.storedMarks&&this.composing&&(clearComposition(this),updateSel=!0),this.state=state;let pluginsChanged=prev.plugins!=state.plugins||this._props.plugins!=prevProps.plugins;if(pluginsChanged||this._props.plugins!=prevProps.plugins||this._props.nodeViews!=prevProps.nodeViews){let nodeViews=buildNodeViews(this);(function(a,b){let nA=0,nB=0;for(let prop in a){if(a[prop]!=b[prop])return!0;nA++}for(let _ in b)nB++;return nA!=nB})(nodeViews,this.nodeViews)&&(this.nodeViews=nodeViews,redraw=!0)}(pluginsChanged||prevProps.handleDOMEvents!=this._props.handleDOMEvents)&&ensureListeners(this),this.editable=getEditable(this),updateCursorWrapper(this);let innerDeco=viewDecorations(this),outerDeco=computeDocDeco(this),scroll=prev.plugins==state.plugins||prev.doc.eq(state.doc)?state.scrollToSelection>prev.scrollToSelection?"to selection":"preserve":"reset",updateDoc=redraw||!this.docView.matchesNode(state.doc,outerDeco,innerDeco);!updateDoc&&state.selection.eq(prev.selection)||(updateSel=!0);let oldScrollPos="preserve"==scroll&&updateSel&&null==this.dom.style.overflowAnchor&&function(view){let refDOM,refTop,rect=view.dom.getBoundingClientRect(),startY=Math.max(0,rect.top);for(let x=(rect.left+rect.right)/2,y=startY+1;y<Math.min(innerHeight,rect.bottom);y+=5){let dom=view.root.elementFromPoint(x,y);if(!dom||dom==view.dom||!view.dom.contains(dom))continue;let localRect=dom.getBoundingClientRect();if(localRect.top>=startY-20){refDOM=dom,refTop=localRect.top;break}}return{refDOM:refDOM,refTop:refTop,stack:scrollStack(view.dom)}}(this);if(updateSel){this.domObserver.stop();let forceSelUpdate=updateDoc&&(ie$4||chrome)&&!this.composing&&!prev.selection.empty&&!state.selection.empty&&function(sel1,sel2){let depth=Math.min(sel1.$anchor.sharedDepth(sel1.head),sel2.$anchor.sharedDepth(sel2.head));return sel1.$anchor.start(depth)!=sel2.$anchor.start(depth)}(prev.selection,state.selection);if(updateDoc){let chromeKludge=chrome?this.trackWrites=this.domSelectionRange().focusNode:null;!redraw&&this.docView.update(state.doc,outerDeco,innerDeco,this)||(this.docView.updateOuterDeco(outerDeco),this.docView.destroy(),this.docView=docViewDesc(state.doc,outerDeco,innerDeco,this.dom,this)),chromeKludge&&!this.trackWrites&&(forceSelUpdate=!0)}forceSelUpdate||!(this.input.mouseDown&&this.domObserver.currentSelection.eq(this.domSelectionRange())&&function(view){let anchorDOM=view.docView.domFromPos(view.state.selection.anchor,0),domSel=view.domSelectionRange();return isEquivalentPosition(anchorDOM.node,anchorDOM.offset,domSel.anchorNode,domSel.anchorOffset)}(this))?selectionToDOM(this,forceSelUpdate):(syncNodeSelection(this,state.selection),this.domObserver.setCurSelection()),this.domObserver.start()}this.updatePluginViews(prev),(null===(_a=this.dragging)||void 0===_a?void 0:_a.node)&&!prev.doc.eq(state.doc)&&this.updateDraggedNode(this.dragging,prev),"reset"==scroll?this.dom.scrollTop=0:"to selection"==scroll?this.scrollToSelection():oldScrollPos&&function({refDOM:refDOM,refTop:refTop,stack:stack}){let newRefTop=refDOM?refDOM.getBoundingClientRect().top:0;restoreScrollStack(stack,0==newRefTop?0:newRefTop-refTop)}(oldScrollPos)}scrollToSelection(){let startDOM=this.domSelectionRange().focusNode;if(this.someProp("handleScrollToSelection",(f=>f(this))));else if(this.state.selection instanceof NodeSelection){let target=this.docView.domAfterPos(this.state.selection.from);1==target.nodeType&&scrollRectIntoView(this,target.getBoundingClientRect(),startDOM)}else scrollRectIntoView(this,this.coordsAtPos(this.state.selection.head,1),startDOM)}destroyPluginViews(){let view;for(;view=this.pluginViews.pop();)view.destroy&&view.destroy()}updatePluginViews(prevState){if(prevState&&prevState.plugins==this.state.plugins&&this.directPlugins==this.prevDirectPlugins)for(let i=0;i<this.pluginViews.length;i++){let pluginView=this.pluginViews[i];pluginView.update&&pluginView.update(this,prevState)}else{this.prevDirectPlugins=this.directPlugins,this.destroyPluginViews();for(let i=0;i<this.directPlugins.length;i++){let plugin=this.directPlugins[i];plugin.spec.view&&this.pluginViews.push(plugin.spec.view(this))}for(let i=0;i<this.state.plugins.length;i++){let plugin=this.state.plugins[i];plugin.spec.view&&this.pluginViews.push(plugin.spec.view(this))}}}updateDraggedNode(dragging,prev){let sel=dragging.node,found=-1;if(this.state.doc.nodeAt(sel.from)==sel.node)found=sel.from;else{let movedPos=sel.from+(this.state.doc.content.size-prev.doc.content.size);(movedPos>0&&this.state.doc.nodeAt(movedPos))==sel.node&&(found=movedPos)}this.dragging=new Dragging(dragging.slice,dragging.move,found<0?void 0:NodeSelection.create(this.state.doc,found))}someProp(propName,f){let value,prop=this._props&&this._props[propName];if(null!=prop&&(value=f?f(prop):prop))return value;for(let i=0;i<this.directPlugins.length;i++){let prop=this.directPlugins[i].props[propName];if(null!=prop&&(value=f?f(prop):prop))return value}let plugins=this.state.plugins;if(plugins)for(let i=0;i<plugins.length;i++){let prop=plugins[i].props[propName];if(null!=prop&&(value=f?f(prop):prop))return value}}hasFocus(){if(ie$4){let node=this.root.activeElement;if(node==this.dom)return!0;if(!node||!this.dom.contains(node))return!1;for(;node&&this.dom!=node&&this.dom.contains(node);){if("false"==node.contentEditable)return!1;node=node.parentElement}return!0}return this.root.activeElement==this.dom}focus(){this.domObserver.stop(),this.editable&&function(dom){if(dom.setActive)return dom.setActive();if(preventScrollSupported)return dom.focus(preventScrollSupported);let stored=scrollStack(dom);dom.focus(null==preventScrollSupported?{get preventScroll(){return preventScrollSupported={preventScroll:!0},!0}}:void 0),preventScrollSupported||(preventScrollSupported=!1,restoreScrollStack(stored,0))}(this.dom),selectionToDOM(this),this.domObserver.start()}get root(){let cached=this._root;if(null==cached)for(let search=this.dom.parentNode;search;search=search.parentNode)if(9==search.nodeType||11==search.nodeType&&search.host)return search.getSelection||(Object.getPrototypeOf(search).getSelection=()=>search.ownerDocument.getSelection()),this._root=search;return cached||document}updateRoot(){this._root=null}posAtCoords(coords){return posAtCoords(this,coords)}coordsAtPos(pos,side=1){return coordsAtPos(this,pos,side)}domAtPos(pos,side=0){return this.docView.domFromPos(pos,side)}nodeDOM(pos){let desc=this.docView.descAt(pos);return desc?desc.nodeDOM:null}posAtDOM(node,offset,bias=-1){let pos=this.docView.posFromDOM(node,offset,bias);if(null==pos)throw new RangeError("DOM position not inside the editor");return pos}endOfTextblock(dir,state){return endOfTextblock(this,state||this.state,dir)}pasteHTML(html,event){return doPaste(this,"",html,!1,event||new ClipboardEvent("paste"))}pasteText(text,event){return doPaste(this,text,null,!0,event||new ClipboardEvent("paste"))}destroy(){this.docView&&(!function(view){view.domObserver.stop();for(let type in view.input.eventHandlers)view.dom.removeEventListener(type,view.input.eventHandlers[type]);clearTimeout(view.input.composingTimeout),clearTimeout(view.input.lastIOSEnterFallbackTimeout)}(this),this.destroyPluginViews(),this.mounted?(this.docView.update(this.state.doc,[],viewDecorations(this),this),this.dom.textContent=""):this.dom.parentNode&&this.dom.parentNode.removeChild(this.dom),this.docView.destroy(),this.docView=null,reusedRange=null)}get isDestroyed(){return null==this.docView}dispatchEvent(event){return function(view,event){runCustomHandler(view,event)||!handlers[event.type]||!view.editable&&event.type in editHandlers||handlers[event.type](view,event)}(this,event)}dispatch(tr){let dispatchTransaction=this._props.dispatchTransaction;dispatchTransaction?dispatchTransaction.call(this,tr):this.updateState(this.state.apply(tr))}domSelectionRange(){return safari$1&&11===this.root.nodeType&&function(doc){let elt=doc.activeElement;for(;elt&&elt.shadowRoot;)elt=elt.shadowRoot.activeElement;return elt}(this.dom.ownerDocument)==this.dom?function(view){let found;function read(event){event.preventDefault(),event.stopImmediatePropagation(),found=event.getTargetRanges()[0]}view.dom.addEventListener("beforeinput",read,!0),document.execCommand("indent"),view.dom.removeEventListener("beforeinput",read,!0);let anchorNode=found.startContainer,anchorOffset=found.startOffset,focusNode=found.endContainer,focusOffset=found.endOffset,currentAnchor=view.domAtPos(view.state.selection.anchor);return isEquivalentPosition(currentAnchor.node,currentAnchor.offset,focusNode,focusOffset)&&([anchorNode,anchorOffset,focusNode,focusOffset]=[focusNode,focusOffset,anchorNode,anchorOffset]),{anchorNode:anchorNode,anchorOffset:anchorOffset,focusNode:focusNode,focusOffset:focusOffset}}(this):this.domSelection()}domSelection(){return this.root.getSelection()}}function computeDocDeco(view){let attrs=Object.create(null);return attrs.class="ProseMirror",attrs.contenteditable=String(view.editable),view.someProp("attributes",(value=>{if("function"==typeof value&&(value=value(view.state)),value)for(let attr in value)"class"==attr?attrs.class+=" "+value[attr]:"style"==attr?attrs.style=(attrs.style?attrs.style+";":"")+value[attr]:attrs[attr]||"contenteditable"==attr||"nodeName"==attr||(attrs[attr]=String(value[attr]))})),attrs.translate||(attrs.translate="no"),[Decoration.node(0,view.state.doc.content.size,attrs)]}function updateCursorWrapper(view){if(view.markCursor){let dom=document.createElement("img");dom.className="ProseMirror-separator",dom.setAttribute("mark-placeholder","true"),dom.setAttribute("alt",""),view.cursorWrapper={dom:dom,deco:Decoration.widget(view.state.selection.head,dom,{raw:!0,marks:view.markCursor})}}else view.cursorWrapper=null}function getEditable(view){return!view.someProp("editable",(value=>!1===value(view.state)))}function buildNodeViews(view){let result=Object.create(null);function add(obj){for(let prop in obj)Object.prototype.hasOwnProperty.call(result,prop)||(result[prop]=obj[prop])}return view.someProp("nodeViews",add),view.someProp("markViews",add),result}function checkStateComponent(plugin){if(plugin.spec.state||plugin.spec.filterTransaction||plugin.spec.appendTransaction)throw new RangeError("Plugins passed directly to the view must not have a state component")}class InputRule{constructor(match,handler,options={}){this.match=match,this.match=match,this.handler="string"==typeof handler?function(string){return function(state,match,start,end){let insert=string;if(match[1]){let offset=match[0].lastIndexOf(match[1]);insert+=match[0].slice(offset+match[1].length);let cutOff=(start+=offset)-end;cutOff>0&&(insert=match[0].slice(offset-cutOff,offset)+insert,start=end)}return state.tr.insertText(insert,start,end)}}(handler):handler,this.undoable=!1!==options.undoable,this.inCode=options.inCode||!1}}const undoInputRule=(state,dispatch)=>{let plugins=state.plugins;for(let i=0;i<plugins.length;i++){let undoable,plugin=plugins[i];if(plugin.spec.isInputRules&&(undoable=plugin.getState(state))){if(dispatch){let tr=state.tr,toUndo=undoable.transform;for(let j=toUndo.steps.length-1;j>=0;j--)tr.step(toUndo.steps[j].invert(toUndo.docs[j]));if(undoable.text){let marks=tr.doc.resolve(undoable.from).marks();tr.replaceWith(undoable.from,undoable.to,state.schema.text(undoable.text,marks))}else tr.delete(undoable.from,undoable.to);dispatch(tr)}return!0}}return!1};function wrappingInputRule(regexp,nodeType,getAttrs=null,joinPredicate){return new InputRule(regexp,((state,match,start,end)=>{let attrs=getAttrs instanceof Function?getAttrs(match):getAttrs,tr=state.tr.delete(start,end),range=tr.doc.resolve(start).blockRange(),wrapping=range&&findWrapping(range,nodeType,attrs);if(!wrapping)return null;tr.wrap(range,wrapping);let before=tr.doc.resolve(start-1).nodeBefore;return before&&before.type==nodeType&&canJoin(tr.doc,start-1)&&(!joinPredicate||joinPredicate(match,before))&&tr.join(start-1),tr}))}function textblockTypeInputRule(regexp,nodeType,getAttrs=null){return new InputRule(regexp,((state,match,start,end)=>{let $start=state.doc.resolve(start),attrs=getAttrs instanceof Function?getAttrs(match):getAttrs;return $start.node(-1).canReplaceWith($start.index(-1),$start.indexAfter(-1),nodeType)?state.tr.delete(start,end).setBlockType(start,start,nodeType,attrs):null}))}new InputRule(/--$/,""),new InputRule(/\.\.\.$/,""),new InputRule(/(?:^|[\s\{\[\(\<'"\u2018\u201C])(")$/,""),new InputRule(/"$/,""),new InputRule(/(?:^|[\s\{\[\(\<'"\u2018\u201C])(')$/,""),new InputRule(/'$/,"");const nav="undefined"!=typeof navigator?navigator:null,doc="undefined"!=typeof document?document:null,agent=nav&&nav.userAgent||"",ie_edge=/Edge\/(\d+)/.exec(agent),ie_upto10=/MSIE \d/.exec(agent),ie_11up=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(agent),ie$3=!!(ie_upto10||ie_11up||ie_edge);ie_upto10?document.documentMode:ie_11up?ie_11up[1]:ie_edge&&ie_edge[1];!ie$3&&/gecko\/(\d+)/i.test(agent)&&(/Firefox\/(\d+)/.exec(agent)||[0,0])[1];const _chrome=!ie$3&&/Chrome\/(\d+)/.exec(agent);_chrome&&_chrome[1];!ie$3&&!!nav&&/Apple Computer/.test(nav.vendor)&&(/Mobile\/\w+/.test(agent)||!!nav&&nav.maxTouchPoints>2)||nav&&/Mac/.test(nav.platform);function run(view,from,to,text,rules,plugin){if(view.composing)return!1;const state=view.state,$from=state.doc.resolve(from);if($from.parent.type.spec.code)return!1;const textBefore=$from.parent.textBetween(Math.max(0,$from.parentOffset-500),$from.parentOffset,void 0,"")+text;for(let i=0;i<rules.length;i++){const match=rules[i].match.exec(textBefore),tr=match&&match[0]&&rules[i].handler(state,match,from-(match[0].length-text.length),to);if(tr)return view.dispatch(tr.setMeta(plugin,{transform:tr,from:from,to:to,text:text})),!0}return!1}!!doc&&"webkitFontSmoothing"in doc.documentElement.style&&(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1];const customInputRulesKey=new PluginKey("MILKDOWN_CUSTOM_INPUTRULES");function customInputRules({rules:rules}){const plugin=new Plugin({key:customInputRulesKey,isInputRules:!0,state:{init:()=>null,apply(tr,prev){const stored=tr.getMeta(this);return stored||(tr.selectionSet||tr.docChanged?null:prev)}},props:{handleTextInput:(view,from,to,text)=>run(view,from,to,text,rules,plugin),handleDOMEvents:{compositionend:view=>(setTimeout((()=>{const{$cursor:$cursor}=view.state.selection;$cursor&&run(view,$cursor.pos,$cursor.pos,"",rules,plugin)})),!1)},handleKeyDown(view,event){if("Enter"!==event.key)return!1;const{$cursor:$cursor}=view.state.selection;return!!$cursor&&run(view,$cursor.pos,$cursor.pos,"\n",rules,plugin)}}});return plugin}function markRule(regexp,markType,options={}){return new InputRule(regexp,((state,match,start,end)=>{var _a,_b,_c,_d;const{tr:tr}=state;let group=match[match.length-1],fullMatch=match[0],initialStoredMarks=[],markEnd=end;const captured={group:group,fullMatch:fullMatch,start:start,end:end},result=null==(_a=options.updateCaptured)?void 0:_a.call(options,captured);if(Object.assign(captured,result),({group:group,fullMatch:fullMatch,start:start,end:end}=captured),null===fullMatch)return null;if(""===(null==group?void 0:group.trim()))return null;if(group){const startSpaces=fullMatch.search(/\S/),textStart=start+fullMatch.indexOf(group),textEnd=textStart+group.length;initialStoredMarks=null!=(_b=tr.storedMarks)?_b:[],textEnd<end&&tr.delete(textEnd,end),textStart>start&&tr.delete(start+startSpaces,textStart),markEnd=start+startSpaces+group.length;const attrs=null==(_c=options.getAttr)?void 0:_c.call(options,match);tr.addMark(start,markEnd,markType.create(attrs)),tr.setStoredMarks(initialStoredMarks),null==(_d=options.beforeDispatch)||_d.call(options,{match:match,start:start,end:end,tr:tr})}return tr}))}function findSelectedNodeOfType(selection,nodeType){if(!(selection instanceof NodeSelection))return;const{node:node,$from:$from}=selection;return function(nodeType,node){return Array.isArray(nodeType)&&nodeType.includes(node.type)||node.type===nodeType}(nodeType,node)?{node:node,pos:$from.pos,start:$from.start($from.depth),depth:$from.depth}:void 0}const deleteSelection=(state,dispatch)=>!state.selection.empty&&(dispatch&&dispatch(state.tr.deleteSelection().scrollIntoView()),!0);const joinBackward=(state,dispatch,view)=>{let $cursor=function(state,view){let{$cursor:$cursor}=state.selection;return!$cursor||(view?!view.endOfTextblock("backward",state):$cursor.parentOffset>0)?null:$cursor}(state,view);if(!$cursor)return!1;let $cut=findCutBefore($cursor);if(!$cut){let range=$cursor.blockRange(),target=range&&liftTarget(range);return null!=target&&(dispatch&&dispatch(state.tr.lift(range,target).scrollIntoView()),!0)}let before=$cut.nodeBefore;if(!before.type.spec.isolating&&deleteBarrier(state,$cut,dispatch))return!0;if(0==$cursor.parent.content.size&&(textblockAt(before,"end")||NodeSelection.isSelectable(before))){let delStep=replaceStep(state.doc,$cursor.before(),$cursor.after(),Slice.empty);if(delStep&&delStep.slice.size<delStep.to-delStep.from){if(dispatch){let tr=state.tr.step(delStep);tr.setSelection(textblockAt(before,"end")?Selection.findFrom(tr.doc.resolve(tr.mapping.map($cut.pos,-1)),-1):NodeSelection.create(tr.doc,$cut.pos-before.nodeSize)),dispatch(tr.scrollIntoView())}return!0}}return!(!before.isAtom||$cut.depth!=$cursor.depth-1)&&(dispatch&&dispatch(state.tr.delete($cut.pos-before.nodeSize,$cut.pos).scrollIntoView()),!0)};function textblockAt(node,side,only=!1){for(let scan=node;scan;scan="start"==side?scan.firstChild:scan.lastChild){if(scan.isTextblock)return!0;if(only&&1!=scan.childCount)return!1}return!1}const selectNodeBackward=(state,dispatch,view)=>{let{$head:$head,empty:empty}=state.selection,$cut=$head;if(!empty)return!1;if($head.parent.isTextblock){if(view?!view.endOfTextblock("backward",state):$head.parentOffset>0)return!1;$cut=findCutBefore($head)}let node=$cut&&$cut.nodeBefore;return!(!node||!NodeSelection.isSelectable(node))&&(dispatch&&dispatch(state.tr.setSelection(NodeSelection.create(state.doc,$cut.pos-node.nodeSize)).scrollIntoView()),!0)};function findCutBefore($pos){if(!$pos.parent.type.spec.isolating)for(let i=$pos.depth-1;i>=0;i--){if($pos.index(i)>0)return $pos.doc.resolve($pos.before(i+1));if($pos.node(i).type.spec.isolating)break}return null}function findCutAfter($pos){if(!$pos.parent.type.spec.isolating)for(let i=$pos.depth-1;i>=0;i--){let parent=$pos.node(i);if($pos.index(i)+1<parent.childCount)return $pos.doc.resolve($pos.after(i+1));if(parent.type.spec.isolating)break}return null}function defaultBlockAt(match){for(let i=0;i<match.edgeCount;i++){let{type:type}=match.edge(i);if(type.isTextblock&&!type.hasRequiredAttrs())return type}return null}const splitBlock=(state,dispatch)=>{let{$from:$from,$to:$to}=state.selection;if(state.selection instanceof NodeSelection&&state.selection.node.isBlock)return!(!$from.parentOffset||!canSplit(state.doc,$from.pos)||(dispatch&&dispatch(state.tr.split($from.pos).scrollIntoView()),0));if(!$from.parent.isBlock)return!1;if(dispatch){let atEnd=$to.parentOffset==$to.parent.content.size,tr=state.tr;(state.selection instanceof TextSelection||state.selection instanceof AllSelection)&&tr.deleteSelection();let deflt=0==$from.depth?null:defaultBlockAt($from.node(-1).contentMatchAt($from.indexAfter(-1))),splitType=splitNode&&splitNode($to.parent,atEnd),types=splitType?[splitType]:atEnd&&deflt?[{type:deflt}]:void 0,can=canSplit(tr.doc,tr.mapping.map($from.pos),1,types);if(types||can||!canSplit(tr.doc,tr.mapping.map($from.pos),1,deflt?[{type:deflt}]:void 0)||(deflt&&(types=[{type:deflt}]),can=!0),can&&(tr.split(tr.mapping.map($from.pos),1,types),!atEnd&&!$from.parentOffset&&$from.parent.type!=deflt)){let first=tr.mapping.map($from.before()),$first=tr.doc.resolve(first);deflt&&$from.node(-1).canReplaceWith($first.index(),$first.index()+1,deflt)&&tr.setNodeMarkup(tr.mapping.map($from.before()),deflt)}dispatch(tr.scrollIntoView())}return!0};var splitNode;function deleteBarrier(state,$cut,dispatch){let conn,match,before=$cut.nodeBefore,after=$cut.nodeAfter;if(before.type.spec.isolating||after.type.spec.isolating)return!1;if(function(state,$pos,dispatch){let before=$pos.nodeBefore,after=$pos.nodeAfter,index=$pos.index();return!(!(before&&after&&before.type.compatibleContent(after.type))||(!before.content.size&&$pos.parent.canReplace(index-1,index)?(dispatch&&dispatch(state.tr.delete($pos.pos-before.nodeSize,$pos.pos).scrollIntoView()),0):!$pos.parent.canReplace(index,index+1)||!after.isTextblock&&!canJoin(state.doc,$pos.pos)||(dispatch&&dispatch(state.tr.clearIncompatible($pos.pos,before.type,before.contentMatchAt(before.childCount)).join($pos.pos).scrollIntoView()),0)))}(state,$cut,dispatch))return!0;let canDelAfter=$cut.parent.canReplace($cut.index(),$cut.index()+1);if(canDelAfter&&(conn=(match=before.contentMatchAt(before.childCount)).findWrapping(after.type))&&match.matchType(conn[0]||after.type).validEnd){if(dispatch){let end=$cut.pos+after.nodeSize,wrap=Fragment.empty;for(let i=conn.length-1;i>=0;i--)wrap=Fragment.from(conn[i].create(null,wrap));wrap=Fragment.from(before.copy(wrap));let tr=state.tr.step(new ReplaceAroundStep($cut.pos-1,end,$cut.pos,end,new Slice(wrap,1,0),conn.length,!0)),joinAt=end+2*conn.length;canJoin(tr.doc,joinAt)&&tr.join(joinAt),dispatch(tr.scrollIntoView())}return!0}let selAfter=Selection.findFrom($cut,1),range=selAfter&&selAfter.$from.blockRange(selAfter.$to),target=range&&liftTarget(range);if(null!=target&&target>=$cut.depth)return dispatch&&dispatch(state.tr.lift(range,target).scrollIntoView()),!0;if(canDelAfter&&textblockAt(after,"start",!0)&&textblockAt(before,"end")){let at=before,wrap=[];for(;wrap.push(at),!at.isTextblock;)at=at.lastChild;let afterText=after,afterDepth=1;for(;!afterText.isTextblock;afterText=afterText.firstChild)afterDepth++;if(at.canReplace(at.childCount,at.childCount,afterText.content)){if(dispatch){let end=Fragment.empty;for(let i=wrap.length-1;i>=0;i--)end=Fragment.from(wrap[i].copy(end));dispatch(state.tr.step(new ReplaceAroundStep($cut.pos-wrap.length,$cut.pos+after.nodeSize,$cut.pos+afterDepth,$cut.pos+after.nodeSize-afterDepth,new Slice(end,wrap.length,0),0,!0)).scrollIntoView())}return!0}}return!1}function selectTextblockSide(side){return function(state,dispatch){let sel=state.selection,$pos=side<0?sel.$from:sel.$to,depth=$pos.depth;for(;$pos.node(depth).isInline;){if(!depth)return!1;depth--}return!!$pos.node(depth).isTextblock&&(dispatch&&dispatch(state.tr.setSelection(TextSelection.create(state.doc,side<0?$pos.start(depth):$pos.end(depth)))),!0)}}const selectTextblockStart=selectTextblockSide(-1),selectTextblockEnd=selectTextblockSide(1);function wrapIn(nodeType,attrs=null){return function(state,dispatch){let{$from:$from,$to:$to}=state.selection,range=$from.blockRange($to),wrapping=range&&findWrapping(range,nodeType,attrs);return!!wrapping&&(dispatch&&dispatch(state.tr.wrap(range,wrapping).scrollIntoView()),!0)}}function setBlockType(nodeType,attrs=null){return function(state,dispatch){let applicable=!1;for(let i=0;i<state.selection.ranges.length&&!applicable;i++){let{$from:{pos:from},$to:{pos:to}}=state.selection.ranges[i];state.doc.nodesBetween(from,to,((node,pos)=>{if(applicable)return!1;if(node.isTextblock&&!node.hasMarkup(nodeType,attrs))if(node.type==nodeType)applicable=!0;else{let $pos=state.doc.resolve(pos),index=$pos.index();applicable=$pos.parent.canReplaceWith(index,index+1,nodeType)}}))}if(!applicable)return!1;if(dispatch){let tr=state.tr;for(let i=0;i<state.selection.ranges.length;i++){let{$from:{pos:from},$to:{pos:to}}=state.selection.ranges[i];tr.setBlockType(from,to,nodeType,attrs)}dispatch(tr.scrollIntoView())}return!0}}function toggleMark(markType,attrs=null){return function(state,dispatch){let{empty:empty,$cursor:$cursor,ranges:ranges}=state.selection;if(empty&&!$cursor||!function(doc,ranges,type){for(let i=0;i<ranges.length;i++){let{$from:$from,$to:$to}=ranges[i],can=0==$from.depth&&doc.inlineContent&&doc.type.allowsMarkType(type);if(doc.nodesBetween($from.pos,$to.pos,(node=>{if(can)return!1;can=node.inlineContent&&node.type.allowsMarkType(type)})),can)return!0}return!1}(state.doc,ranges,markType))return!1;if(dispatch)if($cursor)markType.isInSet(state.storedMarks||$cursor.marks())?dispatch(state.tr.removeStoredMark(markType)):dispatch(state.tr.addStoredMark(markType.create(attrs)));else{let has=!1,tr=state.tr;for(let i=0;!has&&i<ranges.length;i++){let{$from:$from,$to:$to}=ranges[i];has=state.doc.rangeHasMark($from.pos,$to.pos,markType)}for(let i=0;i<ranges.length;i++){let{$from:$from,$to:$to}=ranges[i];if(has)tr.removeMark($from.pos,$to.pos,markType);else{let from=$from.pos,to=$to.pos,start=$from.nodeAfter,end=$to.nodeBefore,spaceStart=start&&start.isText?/^\s*/.exec(start.text)[0].length:0,spaceEnd=end&&end.isText?/\s*$/.exec(end.text)[0].length:0;from+spaceStart<to&&(from+=spaceStart,to-=spaceEnd),tr.addMark(from,to,markType.create(attrs))}}dispatch(tr.scrollIntoView())}return!0}}function chainCommands(...commands){return function(state,dispatch,view){for(let i=0;i<commands.length;i++)if(commands[i](state,dispatch,view))return!0;return!1}}let backspace=chainCommands(deleteSelection,joinBackward,selectNodeBackward),del=chainCommands(deleteSelection,((state,dispatch,view)=>{let $cursor=function(state,view){let{$cursor:$cursor}=state.selection;return!$cursor||(view?!view.endOfTextblock("forward",state):$cursor.parentOffset<$cursor.parent.content.size)?null:$cursor}(state,view);if(!$cursor)return!1;let $cut=findCutAfter($cursor);if(!$cut)return!1;let after=$cut.nodeAfter;if(deleteBarrier(state,$cut,dispatch))return!0;if(0==$cursor.parent.content.size&&(textblockAt(after,"start")||NodeSelection.isSelectable(after))){let delStep=replaceStep(state.doc,$cursor.before(),$cursor.after(),Slice.empty);if(delStep&&delStep.slice.size<delStep.to-delStep.from){if(dispatch){let tr=state.tr.step(delStep);tr.setSelection(textblockAt(after,"start")?Selection.findFrom(tr.doc.resolve(tr.mapping.map($cut.pos)),1):NodeSelection.create(tr.doc,tr.mapping.map($cut.pos))),dispatch(tr.scrollIntoView())}return!0}}return!(!after.isAtom||$cut.depth!=$cursor.depth-1)&&(dispatch&&dispatch(state.tr.delete($cut.pos,$cut.pos+after.nodeSize).scrollIntoView()),!0)}),((state,dispatch,view)=>{let{$head:$head,empty:empty}=state.selection,$cut=$head;if(!empty)return!1;if($head.parent.isTextblock){if(view?!view.endOfTextblock("forward",state):$head.parentOffset<$head.parent.content.size)return!1;$cut=findCutAfter($head)}let node=$cut&&$cut.nodeAfter;return!(!node||!NodeSelection.isSelectable(node))&&(dispatch&&dispatch(state.tr.setSelection(NodeSelection.create(state.doc,$cut.pos)).scrollIntoView()),!0)}));const pcBaseKeymap={Enter:chainCommands(((state,dispatch)=>{let{$head:$head,$anchor:$anchor}=state.selection;return!(!$head.parent.type.spec.code||!$head.sameParent($anchor))&&(dispatch&&dispatch(state.tr.insertText("\n").scrollIntoView()),!0)}),((state,dispatch)=>{let sel=state.selection,{$from:$from,$to:$to}=sel;if(sel instanceof AllSelection||$from.parent.inlineContent||$to.parent.inlineContent)return!1;let type=defaultBlockAt($to.parent.contentMatchAt($to.indexAfter()));if(!type||!type.isTextblock)return!1;if(dispatch){let side=(!$from.parentOffset&&$to.index()<$to.parent.childCount?$from:$to).pos,tr=state.tr.insert(side,type.createAndFill());tr.setSelection(TextSelection.create(tr.doc,side+1)),dispatch(tr.scrollIntoView())}return!0}),((state,dispatch)=>{let{$cursor:$cursor}=state.selection;if(!$cursor||$cursor.parent.content.size)return!1;if($cursor.depth>1&&$cursor.after()!=$cursor.end(-1)){let before=$cursor.before();if(canSplit(state.doc,before))return dispatch&&dispatch(state.tr.split(before).scrollIntoView()),!0}let range=$cursor.blockRange(),target=range&&liftTarget(range);return null!=target&&(dispatch&&dispatch(state.tr.lift(range,target).scrollIntoView()),!0)}),splitBlock),"Mod-Enter":(state,dispatch)=>{let{$head:$head,$anchor:$anchor}=state.selection;if(!$head.parent.type.spec.code||!$head.sameParent($anchor))return!1;let above=$head.node(-1),after=$head.indexAfter(-1),type=defaultBlockAt(above.contentMatchAt(after));if(!type||!above.canReplaceWith(after,after,type))return!1;if(dispatch){let pos=$head.after(),tr=state.tr.replaceWith(pos,pos,type.createAndFill());tr.setSelection(Selection.near(tr.doc.resolve(pos),1)),dispatch(tr.scrollIntoView())}return!0},Backspace:backspace,"Mod-Backspace":backspace,"Shift-Backspace":backspace,Delete:del,"Mod-Delete":del,"Mod-a":(state,dispatch)=>(dispatch&&dispatch(state.tr.setSelection(new AllSelection(state.doc))),!0)},macBaseKeymap={"Ctrl-h":pcBaseKeymap.Backspace,"Alt-Backspace":pcBaseKeymap["Mod-Backspace"],"Ctrl-d":pcBaseKeymap.Delete,"Ctrl-Alt-Backspace":pcBaseKeymap["Mod-Delete"],"Alt-Delete":pcBaseKeymap["Mod-Delete"],"Alt-d":pcBaseKeymap["Mod-Delete"],"Ctrl-a":selectTextblockStart,"Ctrl-e":selectTextblockEnd};for(let key in pcBaseKeymap)macBaseKeymap[key]=pcBaseKeymap[key];const baseKeymap=("undefined"!=typeof navigator?/Mac|iP(hone|[oa]d)/.test(navigator.platform):!("undefined"==typeof os||!os.platform)&&"darwin"==os.platform())?macBaseKeymap:pcBaseKeymap;for(var base={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},shift={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"'},mac$1="undefined"!=typeof navigator&&/Mac/.test(navigator.platform),ie$2="undefined"!=typeof navigator&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent),i=0;i<10;i++)base[48+i]=base[96+i]=String(i);for(i=1;i<=24;i++)base[i+111]="F"+i;for(i=65;i<=90;i++)base[i]=String.fromCharCode(i+32),shift[i]=String.fromCharCode(i);for(var code in base)shift.hasOwnProperty(code)||(shift[code]=base[code]);const mac="undefined"!=typeof navigator&&/Mac|iP(hone|[oa]d)/.test(navigator.platform);function normalizeKeyName(name){let alt,ctrl,shift,meta,parts=name.split(/-(?!$)/),result=parts[parts.length-1];"Space"==result&&(result=" ");for(let i=0;i<parts.length-1;i++){let mod=parts[i];if(/^(cmd|meta|m)$/i.test(mod))meta=!0;else if(/^a(lt)?$/i.test(mod))alt=!0;else if(/^(c|ctrl|control)$/i.test(mod))ctrl=!0;else if(/^s(hift)?$/i.test(mod))shift=!0;else{if(!/^mod$/i.test(mod))throw new Error("Unrecognized modifier name: "+mod);mac?meta=!0:ctrl=!0}}return alt&&(result="Alt-"+result),ctrl&&(result="Ctrl-"+result),meta&&(result="Meta-"+result),shift&&(result="Shift-"+result),result}function modifiers(name,event,shift=!0){return event.altKey&&(name="Alt-"+name),event.ctrlKey&&(name="Ctrl-"+name),event.metaKey&&(name="Meta-"+name),shift&&event.shiftKey&&(name="Shift-"+name),name}function keymap(bindings){return new Plugin({props:{handleKeyDown:keydownHandler(bindings)}})}function keydownHandler(bindings){let map=function(map){let copy=Object.create(null);for(let prop in map)copy[normalizeKeyName(prop)]=map[prop];return copy}(bindings);return function(view,event){let baseName,name=function(event){var name=!(mac$1&&event.metaKey&&event.shiftKey&&!event.ctrlKey&&!event.altKey||ie$2&&event.shiftKey&&event.key&&1==event.key.length||"Unidentified"==event.key)&&event.key||(event.shiftKey?shift:base)[event.keyCode]||event.key||"Unidentified";return"Esc"==name&&(name="Escape"),"Del"==name&&(name="Delete"),"Left"==name&&(name="ArrowLeft"),"Up"==name&&(name="ArrowUp"),"Right"==name&&(name="ArrowRight"),"Down"==name&&(name="ArrowDown"),name}(event),direct=map[modifiers(name,event)];if(direct&&direct(view.state,view.dispatch,view))return!0;if(1==name.length&&" "!=name){if(event.shiftKey){let noShift=map[modifiers(name,event,!1)];if(noShift&&noShift(view.state,view.dispatch,view))return!0}if((event.shiftKey||event.altKey||event.metaKey||name.charCodeAt(0)>127)&&(baseName=base[event.keyCode])&&baseName!=name){let fromCode=map[modifiers(baseName,event)];if(fromCode&&fromCode(view.state,view.dispatch,view))return!0}}return!1}}var ve$1=(e,t,r)=>{if(!t.has(e))throw TypeError("Cannot "+r)},s=(e,t,r)=>(ve$1(e,t,"read from private field"),r?r.call(e):t.get(e)),d=(e,t,r)=>{if(t.has(e))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(e):t.set(e,r)},c=(e,t,r,i)=>(ve$1(e,t,"write to private field"),i?i.call(e,r):t.set(e,r),r);function k(e,t){return e.meta={package:"@milkdown/core",group:"System",...t},e}const De$1={strong:(e,t,r,i)=>{const n=e.marker||r.options.strong||"*",a=r.enter("strong"),h=r.createTracker(i);let m=h.move(n+n);return m+=h.move(r.containerPhrasing(e,{before:m,after:n,...h.current()})),m+=h.move(n+n),a(),m},emphasis:(e,t,r,i)=>{const n=e.marker||r.options.emphasis||"*",a=r.enter("emphasis"),h=r.createTracker(i);let m=h.move(n);return m+=h.move(r.containerPhrasing(e,{before:m,after:n,...h.current()})),m+=h.move(n),a(),m}},L$1=K$2("ConfigReady");const M$1=K$2("InitReady"),G=H$3([],"initTimer"),ke$2=H$3({},"editor"),ue$2=H$3([],"inputRules"),N=H$3([],"prosePlugins"),pe$1=H$3([],"remarkPlugins"),fe$2=H$3([],"nodeView"),ye$2=H$3([],"markView"),P=H$3(unified().use(remarkParse).use(remarkStringify),"remark"),Q$1=H$3({handlers:De$1},"remarkStringifyOptions");function at$1(e){const t=r=>(r.inject(ke$2,e).inject(N,[]).inject(pe$1,[]).inject(ue$2,[]).inject(fe$2,[]).inject(ye$2,[]).inject(Q$1,{handlers:De$1}).inject(P,unified().use(remarkParse).use(remarkStringify)).inject(G,[L$1]).record(M$1),async()=>{await r.waitTimers(G);const i=r.get(Q$1);return r.set(P,unified().use(remarkParse).use(remarkStringify,i)),r.done(M$1),()=>{r.remove(ke$2).remove(N).remove(pe$1).remove(ue$2).remove(fe$2).remove(ye$2).remove(Q$1).remove(P).remove(G).clearTimer(M$1)}});return k(t,{displayName:"Init"}),t}const R$1=K$2("SchemaReady"),U=H$3([],"schemaTimer"),b=H$3({},"schema"),X$1=H$3([],"nodes"),Z$1=H$3([],"marks");function Te$1(e){var t;return{...e,parseDOM:null==(t=e.parseDOM)?void 0:t.map((r=>({priority:e.priority,...r})))}}const Ee$1=e=>(e.inject(b,{}).inject(X$1,[]).inject(Z$1,[]).inject(U,[M$1]).record(R$1),async()=>{await e.waitTimers(U);const t=e.get(P),i=e.get(pe$1).reduce(((m,f)=>m.use(f.plugin,f.options)),t);e.set(P,i);const n=Object.fromEntries(e.get(X$1).map((([m,f])=>[m,Te$1(f)]))),a=Object.fromEntries(e.get(Z$1).map((([m,f])=>[m,Te$1(f)]))),h=new Schema({nodes:n,marks:a});return e.set(b,h),e.done(R$1),()=>{e.remove(b).remove(X$1).remove(Z$1).remove(U).clearTimer(R$1)}});k(Ee$1,{displayName:"Schema"});const W$2=K$2("ParserReady"),Ie$1=()=>{throw p$2()},Y=H$3(Ie$1,"parser"),x$1=H$3([],"parserTimer"),Ve$1=e=>(e.inject(Y,Ie$1).inject(x$1,[R$1]).record(W$2),async()=>{await e.waitTimers(x$1);const t=e.get(P),r=e.get(b);return e.set(Y,H$2.create(r,t)),e.done(W$2),()=>{e.remove(Y).remove(x$1).clearTimer(W$2)}});k(Ve$1,{displayName:"Parser"});const $$1=K$2("SerializerReady"),ee$1=H$3([],"serializerTimer"),Me$1=()=>{throw p$2()},te$1=H$3(Me$1,"serializer"),Ne$1=e=>(e.inject(te$1,Me$1).inject(ee$1,[R$1]).record($$1),async()=>{await e.waitTimers(ee$1);const t=e.get(P),r=e.get(b);return e.set(te$1,K$1.create(r,t)),e.done($$1),()=>{e.remove(te$1).remove(ee$1).clearTimer($$1)}});k(Ne$1,{displayName:"Serializer"});const re$2=H$3("","defaultValue"),V=H$3({},"editorState"),se$1=H$3((e=>e),"stateOptions"),ie$1=H$3([],"editorStateTimer"),q$1=K$2("EditorStateReady");const mt$1=new PluginKey("MILKDOWN_STATE_TRACKER");function dt$1(e){const t=chainCommands(undoInputRule,deleteSelection,joinBackward,selectNodeBackward);return e.Backspace=t,e}const _e$1=e=>(e.inject(re$2,"").inject(V,{}).inject(se$1,(t=>t)).inject(ie$1,[W$2,$$1,J]).record(q$1),async()=>{await e.waitTimers(ie$1);const t=e.get(b),r=e.get(Y),i=e.get(ue$2),n=e.get(se$1),a=e.get(N),m=function(e,t,r){if("string"==typeof e)return t(e);if("html"===e.type)return DOMParser.fromSchema(r).parse(e.dom);if("json"===e.type)return Node.fromJSON(r,e.value);throw l$2(e)}(e.get(re$2),r,t),f=[...a,new Plugin({key:mt$1,state:{init:()=>{},apply:(Be,F,ft,Le)=>{e.set(V,Le)}}}),customInputRules({rules:i}),keymap(dt$1(baseKeymap))];e.set(N,f);const B=n({schema:t,doc:m,plugins:f}),l=EditorState.create(B);return e.set(V,l),e.done(q$1),()=>{e.remove(re$2).remove(V).remove(se$1).remove(ie$1).clearTimer(q$1)}});k(_e$1,{displayName:"EditorState"});const ne$1=K$2("EditorViewReady"),H$1=H$3({},"editorView"),oe$2=H$3([],"editorViewTimer"),ae$1=H$3({},"editorViewOptions"),ce$1=H$3(null,"root"),we$2=H$3(null,"rootDOM"),ge$2=H$3({},"rootAttrs");const ut$1=new PluginKey("MILKDOWN_VIEW_CLEAR"),ze=e=>(e.inject(ce$1,document.body).inject(H$1,{}).inject(ae$1,{}).inject(we$2,null).inject(ge$2,{}).inject(oe$2,[q$1]).record(ne$1),async()=>{await e.wait(M$1);const t=e.get(ce$1)||document.body,r="string"==typeof t?document.querySelector(t):t;e.update(N,(f=>[new Plugin({key:ut$1,view:B=>{const l=r?function(e,t){const r=document.createElement("div");r.className="milkdown",e.appendChild(r),t.set(we$2,r);const i=t.get(ge$2);return Object.entries(i).forEach((([n,a])=>r.setAttribute(n,a))),r}(r,e):void 0;return(()=>{if(l&&r){const F=B.dom;r.replaceChild(l,F),l.appendChild(F)}})(),{destroy:()=>{null!=l&&l.parentNode&&(null==l||l.parentNode.replaceChild(B.dom,l)),null==l||l.remove()}}}}),...f])),await e.waitTimers(oe$2);const i=e.get(V),n=e.get(ae$1),a=Object.fromEntries(e.get(fe$2)),h=Object.fromEntries(e.get(ye$2)),m=new EditorView(r,{state:i,nodeViews:a,markViews:h,...n});return function(e){e.classList.add("editor"),e.setAttribute("role","textbox")}(m.dom),e.set(H$1,m),e.done(ne$1),()=>{null==m||m.destroy(),e.remove(ce$1).remove(H$1).remove(ae$1).remove(we$2).remove(ge$2).remove(oe$2).clearTimer(ne$1)}});var T$1,g;k(ze,{displayName:"EditorView"});let Ke$1=class{constructor(){d(this,T$1,void 0),d(this,g,void 0),c(this,T$1,new G$2),c(this,g,null),this.setCtx=t=>{c(this,g,t)}}get ctx(){return s(this,g)}create(t,r){const i=t.create(s(this,T$1).sliceMap);return i.set(r),i}get(t){return s(this,T$1).get(t).get()}remove(t){return s(this,T$1).remove(t)}call(t,r){if(null==s(this,g))throw y$2();const n=this.get(t)(r),a=s(this,g).get(H$1);return n(a.state,a.dispatch,a)}};T$1=new WeakMap,g=new WeakMap;const je=H$3(new Ke$1,"commands"),me$1=H$3([R$1],"commandsTimer"),J=K$2("CommandsReady"),Ae$1=e=>{const t=new Ke$1;return t.setCtx(e),e.inject(je,t).inject(me$1,[R$1]).record(J),async()=>(await e.waitTimers(me$1),e.done(J),()=>{e.remove(je).remove(me$1).clearTimer(J)})};var j$1,p,y,D,_,z,u,w,O$1,K,S$1,E,A$1,C,I;k(Ae$1,{displayName:"Commands"});j$1=new WeakMap,p=new WeakMap,y=new WeakMap,D=new WeakMap,_=new WeakMap,z=new WeakMap,u=new WeakMap,w=new WeakMap,O$1=new WeakMap,K=new WeakMap,S$1=new WeakMap,E=new WeakMap,A$1=new WeakMap,C=new WeakMap,I=new WeakMap;let Oe$1=class Ce{constructor(){d(this,j$1,void 0),d(this,p,void 0),d(this,y,void 0),d(this,D,void 0),d(this,_,void 0),d(this,z,void 0),d(this,u,void 0),d(this,w,void 0),d(this,O$1,void 0),d(this,K,void 0),d(this,S$1,void 0),d(this,E,void 0),d(this,A$1,void 0),d(this,C,void 0),d(this,I,void 0),c(this,j$1,!1),c(this,p,"Idle"),c(this,y,[]),c(this,D,(()=>{})),c(this,_,new G$2),c(this,z,new J$2),c(this,u,new Map),c(this,w,new Map),c(this,O$1,new U$2(s(this,_),s(this,z))),c(this,K,(()=>{const t=function(e){const t=r=>(r.record(L$1),async()=>(await e(r),r.done(L$1),()=>{r.clearTimer(L$1)}));return k(t,{displayName:"Config"}),t}((async i=>{await Promise.all(s(this,y).map((n=>n(i))))})),r=[Ee$1,Ve$1,Ne$1,Ae$1,_e$1,ze,at$1(this),t];s(this,S$1).call(this,r,s(this,w))})),c(this,S$1,((t,r)=>{t.forEach((i=>{const n=s(this,O$1).produce(s(this,j$1)?i.meta:void 0),a=i(n);r.set(i,{ctx:n,handler:a,cleanup:void 0})}))})),c(this,E,((t,r=!1)=>Promise.all([t].flat().map((i=>{const n=s(this,u).get(i),a=null==n?void 0:n.cleanup;return r?s(this,u).delete(i):s(this,u).set(i,{ctx:void 0,handler:void 0,cleanup:void 0}),"function"==typeof a?a():a}))))),c(this,A$1,(async()=>{await Promise.all([...s(this,w).entries()].map((([t,{cleanup:r}])=>"function"==typeof r?r():r))),s(this,w).clear()})),c(this,C,(t=>{c(this,p,t),s(this,D).call(this,t)})),c(this,I,(t=>[...t.entries()].map((async([r,i])=>{const{ctx:n,handler:a}=i;if(!a)return;const h=await a();t.set(r,{ctx:n,handler:a,cleanup:h})})))),this.enableInspector=(t=!0)=>(c(this,j$1,t),this),this.onStatusChange=t=>(c(this,D,t),this),this.config=t=>(s(this,y).push(t),this),this.removeConfig=t=>(c(this,y,s(this,y).filter((r=>r!==t))),this),this.use=t=>{const r=[t].flat();return r.flat().forEach((i=>{s(this,u).set(i,{ctx:void 0,handler:void 0,cleanup:void 0})})),"Created"===s(this,p)&&s(this,S$1).call(this,r,s(this,u)),this},this.remove=async t=>"OnCreate"===s(this,p)?(console.warn("[Milkdown]: You are trying to remove plugins when the editor is creating, this is not recommended, please check your code."),new Promise((r=>{setTimeout((()=>{r(this.remove(t))}),50)}))):(await s(this,E).call(this,[t].flat(),!0),this),this.create=async()=>("OnCreate"===s(this,p)||("Created"===s(this,p)&&await this.destroy(),s(this,C).call(this,"OnCreate"),s(this,K).call(this),s(this,S$1).call(this,[...s(this,u).keys()],s(this,u)),await Promise.all([s(this,I).call(this,s(this,w)),s(this,I).call(this,s(this,u))].flat()),s(this,C).call(this,"Created")),this),this.destroy=async(t=!1)=>"Destroyed"===s(this,p)||"OnDestroy"===s(this,p)?this:"OnCreate"===s(this,p)?new Promise((r=>{setTimeout((()=>{r(this.destroy(t))}),50)})):(t&&c(this,y,[]),s(this,C).call(this,"OnDestroy"),await s(this,E).call(this,[...s(this,u).keys()],t),await s(this,A$1).call(this),s(this,C).call(this,"Destroyed"),this),this.action=t=>t(s(this,O$1)),this.inspect=()=>s(this,j$1)?[...s(this,w).values(),...s(this,u).values()].map((({ctx:t})=>{var r;return null==(r=null==t?void 0:t.inspector)?void 0:r.read()})).filter((t=>!!t)):(console.warn("[Milkdown]: You are trying to collect inspection when inspector is disabled, please enable inspector by `editor.enableInspector()` first."),[])}static make(){return new Ce}get ctx(){return s(this,O$1)}get status(){return s(this,p)}};const POOL_SIZE_MULTIPLIER=128;let pool,poolOffset;function random(bytes){return function(bytes){!pool||pool.length<bytes?(pool=Buffer.allocUnsafe(bytes*POOL_SIZE_MULTIPLIER),node_crypto.webcrypto.getRandomValues(pool),poolOffset=0):poolOffset+bytes>pool.length&&(node_crypto.webcrypto.getRandomValues(pool),poolOffset=0),poolOffset+=bytes}(bytes-=0),pool.subarray(poolOffset-bytes,poolOffset)}function re$1(n,o){const r=function(e="cmdKey"){return H$3((()=>()=>!1),e)}(n),t=e=>async()=>{t.key=r,await e.wait(J);const a=o(e);return e.get(je).create(r,a),t.run=s=>e.get(je).call(n,s),()=>{e.get(je).remove(r)}};return t}function oe$1(n){const o=r=>async()=>{await r.wait(R$1);const t=n(r);return r.update(ue$2,(e=>[...e,t])),o.inputRule=t,()=>{r.update(ue$2,(e=>e.filter((a=>a!==t))))}};return o}function W$1(n,o){const r=t=>async()=>{const e=o(t);return t.update(X$1,(a=>[...a.filter((s=>s[0]!==n)),[n,e]])),r.id=n,r.schema=e,()=>{t.update(X$1,(a=>a.filter((([s])=>s!==n))))}};return r.type=t=>{const e=t.get(b).nodes[n];if(!e)throw M$4(n);return e},r}function ue$1(n){let o;const r=t=>async()=>(await t.wait(R$1),o=n(t),t.update(N,(e=>[...e,o])),()=>{t.update(N,(e=>e.filter((a=>a!==o))))});return r.plugin=()=>o,r.key=()=>o.spec.key,r}function h(n,o){const r=H$3(n,o),t=e=>(e.inject(r),()=>()=>{e.remove(r)});return t.key=r,t}function fe$1(n,o){const r=h(o,n),t=W$1(n,(a=>a.get(r.key)(a))),e=[r,t];return e.id=t.id,e.node=t,e.type=a=>t.type(a),e.schema=t.schema,e.ctx=r,e.key=r.key,e.extendSchema=a=>s=>()=>{const i=s.get(r.key),c=a(i)(s);s.update(X$1,(m=>[...m.filter((S=>S[0]!==n)),[n,c]])),e.schema=c},e}function ye$1(n,o){const r=h(o,n),t=function(n,o){const r=t=>async()=>{const e=o(t);return t.update(Z$1,(a=>[...a.filter((s=>s[0]!==n)),[n,e]])),r.id=n,r.schema=e,()=>{t.update(Z$1,(a=>a.filter((([s])=>s!==n))))}};return r.type=t=>{const e=t.get(b).marks[n];if(!e)throw x$4(n);return e},r}(n,(a=>a.get(r.key)(a))),e=[r,t];return e.id=t.id,e.mark=t,e.type=t.type,e.schema=t.schema,e.ctx=r,e.key=r.key,e.extendSchema=a=>s=>()=>{const i=s.get(r.key),c=a(i)(s);s.update(Z$1,(m=>[...m.filter((S=>S[0]!==n)),[n,c]])),e.schema=c},e}function ge$1(n,o){const r=Object.fromEntries(Object.entries(o).map((([s,{shortcuts:i}])=>[s,i]))),t=h(r,`${n}Keymap`),e=function(n){const o=r=>async()=>{await r.wait(R$1);const t=n(r),e=keymap(t);return r.update(N,(a=>[...a,e])),o.keymap=t,()=>{r.update(N,(a=>a.filter((s=>s!==e))))}};return o}((s=>{const i=s.get(t.key),u=Object.entries(o).flatMap((([c,{command:m}])=>[i[c]].flat().map((V=>[V,m(s)]))));return Object.fromEntries(u)})),a=[t,e];return a.ctx=t,a.shortcuts=e,a.key=t.key,a.keymap=e.keymap,a}!function(alphabet,size=21){(function(alphabet,defaultSize,getRandom){let mask=(2<<31-Math.clz32(alphabet.length-1|1))-1,step=Math.ceil(1.6*mask*defaultSize/alphabet.length)})(alphabet,size,random)}("abcedfghicklmn",10);const he$1=(n,o=(()=>({})))=>h(o,`${n}Attr`),we$1=(n,o=(()=>({})))=>h(o,`${n}Attr`);function ke$1(n,o,r){const t=h(r??{},n),e=s=>async()=>{await s.wait(M$1);const u={plugin:o(s),options:s.get(t.key)};return s.update(pe$1,(c=>[...c,u])),()=>{s.update(pe$1,(c=>c.filter((m=>m!==u))))}},a=[t,e];return a.id=n,a.plugin=e,a.options=t,a}function escapeStringRegexp$1(string){if("string"!=typeof string)throw new TypeError("Expected a string");return string.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d")}function escapeStringRegexp(string){if("string"!=typeof string)throw new TypeError("Expected a string");return string.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d")}const replacements=[["","ss"],["","Ss"],["","ae"],["","Ae"],["","oe"],["","Oe"],["","ue"],["","Ue"],["","A"],["","A"],["","A"],["","A"],["","Ae"],["","A"],["","AE"],["","C"],["","E"],["","E"],["","E"],["","E"],["","I"],["","I"],["","I"],["","I"],["","D"],["","N"],["","O"],["","O"],["","O"],["","O"],["","Oe"],["","O"],["","O"],["","U"],["","U"],["","U"],["","Ue"],["","U"],["","Y"],["","TH"],["","ss"],["","a"],["","a"],["","a"],["","a"],["","ae"],["","a"],["","ae"],["","c"],["","e"],["","e"],["","e"],["","e"],["","i"],["","i"],["","i"],["","i"],["","d"],["","n"],["","o"],["","o"],["","o"],["","o"],["","oe"],["","o"],["","o"],["","u"],["","u"],["","u"],["","ue"],["","u"],["","y"],["","th"],["","y"],["","SS"],["","a"],["","A"],["","a"],["","A"],["","a"],["","A"],["","a"],["","A"],["","e"],["","E"],["","e"],["","E"],["","e"],["","E"],["","i"],["","I"],["","i"],["","I"],["","o"],["","O"],["","o"],["","O"],["","o"],["","O"],["","o"],["","O"],["","u"],["","U"],["","u"],["","U"],["","y"],["","Y"],["","a"],["","A"],["","D"],["","d"],["","i"],["","I"],["","u"],["","U"],["","o"],["","O"],["","u"],["","U"],["","a"],["","A"],["","a"],["","A"],["","a"],["","A"],["","a"],["","A"],["","a"],["","A"],["","a"],["","A"],["","a"],["","A"],["","a"],["","A"],["","a"],["","A"],["","a"],["","A"],["","a"],["","A"],["","a"],["","A"],["","e"],["","E"],["","e"],["","E"],["","e"],["","E"],["","e"],["","E"],["","e"],["","E"],["","e"],["","E"],["","e"],["","E"],["","e"],["","E"],["","i"],["","I"],["","i"],["","I"],["","o"],["","O"],["","o"],["","O"],["","o"],["","O"],["","o"],["","O"],["","o"],["","O"],["","o"],["","O"],["","o"],["","O"],["","o"],["","O"],["","o"],["","O"],["","o"],["","O"],["","o"],["","O"],["","o"],["","O"],["","u"],["","U"],["","u"],["","U"],["","u"],["","U"],["","u"],["","U"],["","u"],["","U"],["","u"],["","U"],["","u"],["","U"],["","y"],["","Y"],["","y"],["","Y"],["","y"],["","Y"],["","y"],["","Y"],["","e"],["","a"],["","a"],["","w"],["","i"],["","y"],["","a"],["","b"],["","t"],["","t"],["","th"],["","j"],["","h"],["","kh"],["","d"],["","dh"],["","r"],["","z"],["","s"],["","sh"],["","s"],["","d"],["","t"],["","z"],["","e"],["","gh"],["","_"],["","f"],["","q"],["","k"],["","l"],["","m"],["","n"],["","h"],["","w"],["","a"],["","y"],["","a"],["","u"],["","i"],["","0"],["","1"],["","2"],["","3"],["","4"],["","5"],["","6"],["","7"],["","8"],["","9"],["","ch"],["","k"],["","g"],["","p"],["","zh"],["","y"],["","0"],["","1"],["","2"],["","3"],["","4"],["","5"],["","6"],["","7"],["","8"],["","9"],["","p"],["","z"],["","c"],["","d"],["","d"],["","r"],["","r"],["","z"],["","g"],["","x"],["","g"],["","n"],["","e"],["","e"],["","ai"],["","t"],["","d"],["","r"],["","n"],["","h"],["","h"],["","e"],["","A"],["","a"],["","B"],["","b"],["","V"],["","v"],["","G"],["","g"],["","D"],["","d"],["","ye"],["","Ye"],["","yE"],["","YE"],["","E"],["","e"],["","Yo"],["","yo"],["","Zh"],["","zh"],["","Z"],["","z"],["","I"],["","i"],["","iy"],["","Iy"],["","IY"],["","iY"],["","Y"],["","y"],["","K"],["","k"],["","L"],["","l"],["","M"],["","m"],["","N"],["","n"],["","O"],["","o"],["","P"],["","p"],["","R"],["","r"],["","S"],["","s"],["","T"],["","t"],["","U"],["","u"],["","F"],["","f"],["","Kh"],["","kh"],["","Ts"],["","ts"],["","Ch"],["","ch"],["","Sh"],["","sh"],["","Sch"],["","sch"],["",""],["",""],["","Y"],["","y"],["",""],["",""],["","E"],["","e"],["","Yu"],["","yu"],["","Ya"],["","ya"],["","a"],["","A"],["","s"],["","S"],["","t"],["","T"],["","t"],["","T"],["","s"],["","S"],["","c"],["","C"],["","g"],["","G"],["","i"],["","I"],["","a"],["","A"],["","b"],["","B"],["","g"],["","G"],["","d"],["","D"],["","ye"],["","Ye"],["","z"],["","Z"],["","e"],["","E"],["","y"],["","Y"],["","t"],["","T"],["","zh"],["","Zh"],["","i"],["","I"],["","l"],["","L"],["","kh"],["","Kh"],["","ts"],["","Ts"],["","k"],["","K"],["","h"],["","H"],["","dz"],["","Dz"],["","gh"],["","Gh"],["","tch"],["","Tch"],["","m"],["","M"],["","y"],["","Y"],["","n"],["","N"],["","sh"],["","Sh"],["","vo"],["","Vo"],["","ch"],["","Ch"],["","p"],["","P"],["","j"],["","J"],["","r"],["","R"],["","s"],["","S"],["","v"],["","V"],["","t"],["","T"],["","r"],["","R"],["","c"],["","C"],["","u"],["","U"],["","U"],["","p"],["","P"],["","q"],["","Q"],["","o"],["","O"],["","f"],["","F"],["","yev"],["","a"],["","b"],["","g"],["","d"],["","e"],["","v"],["","z"],["","t"],["","i"],["","k"],["","l"],["","m"],["","n"],["","o"],["","p"],["","zh"],["","r"],["","s"],["","t"],["","u"],["","ph"],["","q"],["","gh"],["","k"],["","sh"],["","ch"],["","ts"],["","dz"],["","ts"],["","tch"],["","kh"],["","j"],["","h"],["","c"],["","d"],["","e"],["","n"],["","r"],["","s"],["","t"],["","u"],["","z"],["","C"],["","D"],["","E"],["","N"],["","R"],["","S"],["","T"],["","U"],["","Z"],["","h"],["","sh"],["","n"],["","r"],["","b"],["","lh"],["","k"],["","a"],["","v"],["","m"],["","f"],["","dh"],["","th"],["","l"],["","g"],["","gn"],["","s"],["","d"],["","z"],["","t"],["","y"],["","p"],["","j"],["","ch"],["","tt"],["","hh"],["","kh"],["","th"],["","z"],["","sh"],["","s"],["","d"],["","t"],["","z"],["","a"],["","gh"],["","q"],["","w"],["","a"],["","aa"],["","i"],["","ee"],["","u"],["","oo"],["","e"],["","ey"],["","o"],["","oa"],["",""],["","a"],["","v"],["","g"],["","d"],["","e"],["","z"],["","i"],["","th"],["","i"],["","k"],["","l"],["","m"],["","n"],["","ks"],["","o"],["","p"],["","r"],["","s"],["","t"],["","y"],["","f"],["","x"],["","ps"],["","o"],["","a"],["","e"],["","i"],["","o"],["","y"],["","i"],["","o"],["","s"],["","i"],["","y"],["","y"],["","i"],["","A"],["","B"],["","G"],["","D"],["","E"],["","Z"],["","I"],["","TH"],["","I"],["","K"],["","L"],["","M"],["","N"],["","KS"],["","O"],["","P"],["","R"],["","S"],["","T"],["","Y"],["","F"],["","X"],["","PS"],["","O"],["","A"],["","E"],["","I"],["","O"],["","Y"],["","I"],["","O"],["","I"],["","Y"],["","a"],["","e"],["","g"],["","i"],["","k"],["","l"],["","n"],["","u"],["","A"],["","E"],["","G"],["","I"],["","K"],["","L"],["","N"],["","U"],["","c"],["","s"],["","z"],["","C"],["","S"],["","Z"],["","a"],["","c"],["","e"],["","e"],["","i"],["","s"],["","u"],["","u"],["","z"],["","A"],["","C"],["","E"],["","E"],["","I"],["","S"],["","U"],["","U"],["","Kj"],["","kj"],["","Lj"],["","lj"],["","Nj"],["","nj"],["","Ts"],["","ts"],["","a"],["","c"],["","e"],["","l"],["","n"],["","s"],["","z"],["","z"],["","A"],["","C"],["","E"],["","L"],["","N"],["","S"],["","Z"],["","Z"],["","Ye"],["","I"],["","Yi"],["","G"],["","ye"],["","i"],["","yi"],["","g"],["","IJ"],["","ij"],["","c"],["","Y"],["","b"],["","t"],["","Bo"],["","B"],["","CE"],["","C"],["","Cr"],["","F"],["","m"],["","N"],["","Pt"],["","Rs"],["","W"],["","s"],["","E"],["","K"],["","T"],["","Dp"],["","S"],["","P"],["","G"],["","A"],["","S"],["","C"],["","tt"],["","S"],["","T"],["","R"],["","L"],["","P"],["","B"],["","$"],["","c"],["","Y"],["","W"],["","A"],["","B"],["","C"],["","D"],["","E"],["","F"],["","G"],["","H"],["","I"],["","J"],["","K"],["","L"],["","M"],["","N"],["","O"],["","P"],["","Q"],["","R"],["","S"],["","T"],["","U"],["","V"],["","W"],["","X"],["","Y"],["","Z"],["","a"],["","b"],["","c"],["","d"],["","e"],["","f"],["","g"],["","h"],["","i"],["","j"],["","k"],["","l"],["","m"],["","n"],["","o"],["","p"],["","q"],["","r"],["","s"],["","t"],["","u"],["","v"],["","w"],["","x"],["","y"],["","z"],["","A"],["","B"],["","C"],["","D"],["","E"],["","F"],["","G"],["","H"],["","I"],["","J"],["","K"],["","L"],["","M"],["","N"],["","O"],["","P"],["","Q"],["","R"],["","S"],["","T"],["","U"],["","V"],["","W"],["","X"],["","Y"],["","Z"],["","a"],["","b"],["","c"],["","d"],["","e"],["","f"],["","g"],["","i"],["","j"],["","k"],["","l"],["","m"],["","n"],["","o"],["","p"],["","q"],["","r"],["","s"],["","t"],["","u"],["","v"],["","w"],["","x"],["","y"],["","z"],["","A"],["","B"],["","C"],["","D"],["","E"],["","F"],["","G"],["","H"],["","I"],["","J"],["","K"],["","L"],["","M"],["","N"],["","O"],["","P"],["","Q"],["","R"],["","S"],["","T"],["","U"],["","V"],["","W"],["","X"],["","Y"],["","Z"],["","a"],["","b"],["","c"],["","d"],["","e"],["","f"],["","g"],["","h"],["","i"],["","j"],["","k"],["","l"],["","m"],["","n"],["","o"],["","p"],["","q"],["","r"],["","s"],["","t"],["","u"],["","v"],["","w"],["","x"],["","y"],["","z"],["","A"],["","C"],["","D"],["","g"],["","J"],["","K"],["","N"],["","O"],["","P"],["","Q"],["","S"],["","T"],["","U"],["","V"],["","W"],["","X"],["","Y"],["","Z"],["","a"],["","b"],["","c"],["","d"],["","f"],["","h"],["","i"],["","j"],["","h"],["","l"],["","m"],["","n"],["","p"],["","q"],["","r"],["","s"],["","t"],["","u"],["","v"],["","w"],["","x"],["","y"],["","z"],["","A"],["","B"],["","C"],["","D"],["","E"],["","F"],["","G"],["","H"],["","I"],["","J"],["","K"],["","L"],["","M"],["","N"],["","O"],["","P"],["","Q"],["","R"],["","S"],["","T"],["","U"],["","V"],["","W"],["","X"],["","Y"],["","Z"],["","a"],["","b"],["","c"],["","d"],["","e"],["","f"],["","g"],["","h"],["","i"],["","j"],["","k"],["","l"],["","m"],["","n"],["","o"],["","p"],["","q"],["","r"],["","s"],["","t"],["","u"],["","v"],["","w"],["","x"],["","y"],["","z"],["","A"],["","B"],["","D"],["","E"],["","F"],["","G"],["","J"],["","K"],["","L"],["","M"],["","N"],["","O"],["","P"],["","Q"],["","S"],["","T"],["","U"],["","V"],["","W"],["","X"],["","Y"],["","a"],["","b"],["","c"],["","d"],["","e"],["","f"],["","g"],["","h"],["","i"],["","j"],["","k"],["","l"],["","m"],["","n"],["","o"],["","p"],["","q"],["","r"],["","s"],["","t"],["","u"],["","v"],["","w"],["","x"],["","y"],["","z"],["","A"],["","B"],["","D"],["","E"],["","F"],["","G"],["","I"],["","J"],["","K"],["","L"],["","M"],["","N"],["","S"],["","T"],["","U"],["","V"],["","W"],["","X"],["","Y"],["","a"],["","b"],["","c"],["","d"],["","e"],["","f"],["","g"],["","h"],["","i"],["","j"],["","k"],["","l"],["","m"],["","n"],["","o"],["","p"],["","q"],["","r"],["","s"],["","t"],["","u"],["","v"],["","w"],["","x"],["","y"],["","z"],["","A"],["","B"],["","C"],["","D"],["","E"],["","F"],["","G"],["","H"],["","I"],["","J"],["","K"],["","L"],["","M"],["","N"],["","O"],["","P"],["","Q"],["","R"],["","S"],["","T"],["","U"],["","V"],["","W"],["","X"],["","Y"],["","Z"],["","a"],["","b"],["","c"],["","d"],["","e"],["","f"],["","g"],["","h"],["","i"],["","j"],["","k"],["","l"],["","m"],["","n"],["","o"],["","p"],["","q"],["","r"],["","s"],["","t"],["","u"],["","v"],["","w"],["","x"],["","y"],["","z"],["","A"],["","B"],["","C"],["","D"],["","E"],["","F"],["","G"],["","H"],["","I"],["","J"],["","K"],["","L"],["","M"],["","N"],["","O"],["","P"],["","Q"],["","R"],["","S"],["","T"],["","U"],["","V"],["","W"],["","X"],["","Y"],["","Z"],["","a"],["","b"],["","c"],["","d"],["","e"],["","f"],["","g"],["","h"],["","i"],["","j"],["","k"],["","l"],["","m"],["","n"],["","o"],["","p"],["","q"],["","r"],["","s"],["","t"],["","u"],["","v"],["","w"],["","x"],["","y"],["","z"],["","A"],["","B"],["","C"],["","D"],["","E"],["","F"],["","G"],["","H"],["","I"],["","J"],["","K"],["","L"],["","M"],["","N"],["","O"],["","P"],["","Q"],["","R"],["","S"],["","T"],["","U"],["","V"],["","W"],["","X"],["","Y"],["","Z"],["","a"],["","b"],["","c"],["","d"],["","e"],["","f"],["","g"],["","h"],["","i"],["","j"],["","k"],["","l"],["","m"],["","n"],["","o"],["","p"],["","q"],["","r"],["","s"],["","t"],["","u"],["","v"],["","w"],["","x"],["","y"],["","z"],["","A"],["","B"],["","C"],["","D"],["","E"],["","F"],["","G"],["","H"],["","I"],["","J"],["","K"],["","L"],["","M"],["","N"],["","O"],["","P"],["","Q"],["","R"],["","S"],["","T"],["","U"],["","V"],["","W"],["","X"],["","Y"],["","Z"],["","a"],["","b"],["","c"],["","d"],["","e"],["","f"],["","g"],["","h"],["","i"],["","j"],["","k"],["","l"],["","m"],["","n"],["","o"],["","p"],["","q"],["","r"],["","s"],["","t"],["","u"],["","v"],["","w"],["","x"],["","y"],["","z"],["","A"],["","B"],["","C"],["","D"],["","E"],["","F"],["","G"],["","H"],["","I"],["","J"],["","K"],["","L"],["","M"],["","N"],["","O"],["","P"],["","Q"],["","R"],["","S"],["","T"],["","U"],["","V"],["","W"],["","X"],["","Y"],["","Z"],["","a"],["","b"],["","c"],["","d"],["","e"],["","f"],["","g"],["","h"],["","i"],["","j"],["","k"],["","l"],["","m"],["","n"],["","o"],["","p"],["","q"],["","r"],["","s"],["","t"],["","u"],["","v"],["","w"],["","x"],["","y"],["","z"],["","A"],["","B"],["","C"],["","D"],["","E"],["","F"],["","G"],["","H"],["","I"],["","J"],["","K"],["","L"],["","M"],["","N"],["","O"],["","P"],["","Q"],["","R"],["","S"],["","T"],["","U"],["","V"],["","W"],["","X"],["","Y"],["","Z"],["","a"],["","b"],["","c"],["","d"],["","e"],["","f"],["","g"],["","h"],["","i"],["","j"],["","k"],["","l"],["","m"],["","n"],["","o"],["","p"],["","q"],["","r"],["","s"],["","t"],["","u"],["","v"],["","w"],["","x"],["","y"],["","z"],["","l"],["","j"],["","A"],["","B"],["","G"],["","D"],["","E"],["","Z"],["","I"],["","TH"],["","I"],["","K"],["","L"],["","M"],["","N"],["","KS"],["","O"],["","P"],["","R"],["","TH"],["","S"],["","T"],["","Y"],["","F"],["","x"],["","PS"],["","O"],["","D"],["","a"],["","b"],["","g"],["","d"],["","e"],["","z"],["","i"],["","th"],["","i"],["","k"],["","l"],["","m"],["","n"],["","ks"],["","o"],["","p"],["","r"],["","s"],["","s"],["","t"],["","y"],["","f"],["","x"],["","ps"],["","o"],["","d"],["","E"],["","TH"],["","K"],["","f"],["","r"],["","p"],["","A"],["","V"],["","G"],["","D"],["","E"],["","Z"],["","I"],["","TH"],["","I"],["","K"],["","L"],["","M"],["","N"],["","KS"],["","O"],["","P"],["","S"],["","TH"],["","S"],["","T"],["","Y"],["","F"],["","X"],["","PS"],["","O"],["","D"],["","a"],["","v"],["","g"],["","d"],["","e"],["","z"],["","i"],["","th"],["","i"],["","k"],["","l"],["","m"],["","n"],["","ks"],["","o"],["","p"],["","r"],["","s"],["","s"],["","t"],["","y"],["","f"],["","x"],["","ps"],["","o"],["","a"],["","e"],["","i"],["","k"],["","f"],["","r"],["","p"],["","A"],["","B"],["","G"],["","D"],["","E"],["","Z"],["","I"],["","TH"],["","I"],["","K"],["","L"],["","M"],["","N"],["","KS"],["","O"],["","P"],["","R"],["","TH"],["","S"],["","T"],["","Y"],["","F"],["","X"],["","PS"],["","O"],["","D"],["","a"],["","v"],["","g"],["","d"],["","e"],["","z"],["","i"],["","th"],["","i"],["","k"],["","l"],["","m"],["","n"],["","ks"],["","o"],["","p"],["","r"],["","s"],["","s"],["","t"],["","y"],["","f"],["","x"],["","ps"],["","o"],["","a"],["","e"],["","i"],["","k"],["","f"],["","r"],["","p"],["","A"],["","V"],["","G"],["","D"],["","E"],["","Z"],["","I"],["","TH"],["","I"],["","K"],["","L"],["","M"],["","N"],["","KS"],["","O"],["","P"],["","S"],["","TH"],["","S"],["","T"],["","Y"],["","F"],["","X"],["","PS"],["","O"],["","D"],["","av"],["","g"],["","d"],["","e"],["","z"],["","i"],["","i"],["","th"],["","i"],["","k"],["","l"],["","m"],["","n"],["","ks"],["","o"],["","p"],["","r"],["","s"],["","s"],["","t"],["","y"],["","f"],["","x"],["","ps"],["","o"],["","a"],["","e"],["","i"],["","k"],["","f"],["","r"],["","p"],["","F"],["","f"],["","(a)"],["","(b)"],["","(c)"],["","(d)"],["","(e)"],["","(f)"],["","(g)"],["","(h)"],["","(i)"],["","(j)"],["","(k)"],["","(l)"],["","(m)"],["","(n)"],["","(o)"],["","(p)"],["","(q)"],["","(r)"],["","(s)"],["","(t)"],["","(u)"],["","(v)"],["","(w)"],["","(x)"],["","(y)"],["","(z)"],["","(A)"],["","(B)"],["","(C)"],["","(D)"],["","(E)"],["","(F)"],["","(G)"],["","(H)"],["","(I)"],["","(J)"],["","(K)"],["","(L)"],["","(N)"],["","(O)"],["","(P)"],["","(Q)"],["","(R)"],["","(S)"],["","(T)"],["","(U)"],["","(V)"],["","(W)"],["","(X)"],["","(Y)"],["","(Z)"],["","(a)"],["","(b)"],["","(b)"],["","(c)"],["","(e)"],["","(f)"],["","(g)"],["","(h)"],["","(i)"],["","(j)"],["","(k)"],["","(l)"],["","(m)"],["","(n)"],["","(o)"],["","(p)"],["","(q)"],["","(r)"],["","(s)"],["","(t)"],["","(u)"],["","(v)"],["","(w)"],["","(x)"],["","(y)"],["","(z)"],["","C"],["","c"],["","G"],["","g"],["","H"],["","h"],["","Z"],["","z"],["","0"],["","1"],["","2"],["","3"],["","4"],["","5"],["","6"],["","7"],["","8"],["","9"],["","0"],["","1"],["","2"],["","3"],["","4"],["","5"],["","6"],["","7"],["","8"],["","9"],["","0"],["","1"],["","2"],["","3"],["","4"],["","5"],["","6"],["","7"],["","8"],["","9"],["","0"],["","1"],["","2"],["","3"],["","4"],["","5"],["","6"],["","7"],["","8"],["","9"],["","0"],["","1"],["","2"],["","3"],["","4"],["","5"],["","6"],["","7"],["","8"],["","9"],["","1"],["","2"],["","3"],["","4"],["","5"],["","6"],["","7"],["","8"],["","9"],["","10"],["","11"],["","12"],["","13"],["","14"],["","15"],["","16"],["","17"],["","18"],["","19"],["","20"],["","1"],["","2"],["","3"],["","4"],["","5"],["","6"],["","7"],["","8"],["","9"],["","10"],["","11"],["","12"],["","13"],["","14"],["","15"],["","16"],["","17"],["","18"],["","19"],["","20"],["","1."],["","2."],["","3."],["","4."],["","5."],["","6."],["","7."],["","8."],["","9."],["","10."],["","11."],["","12."],["","13."],["","14."],["","15."],["","16."],["","17."],["","18."],["","19."],["","20."],["","0"],["","11"],["","12"],["","13"],["","14"],["","15"],["","16"],["","17"],["","18"],["","19"],["","20"],["","1"],["","2"],["","3"],["","4"],["","5"],["","6"],["","7"],["","8"],["","9"],["","10"],["","0"],["","&"],["","&"],["","&"],["","&"],["","&"],["","&"],["",'"'],["",'"'],["",'"'],["","?!"],["","?!"],["","?!"],["","?!"],["","/"],["","\\"],["","AR"],["","V"],["","V"],["","VR"],["","VF"],["","2"],["","5"],["","f"],["","W"],["","U"],["","V"],["","T"],["","V"],["","MB"],["","VB"],["","3B"],["","3B"],["","100"],["","BACK"],["","END"],["","ON!"],["","SOON"],["","TOP"],["","18"],["","abc"],["","ABCD"],["","abcd"],["","1234"],["","T&@%"],["#","#"],["*","*"],["0","0"],["1","1"],["2","2"],["3","3"],["4","4"],["5","5"],["6","6"],["7","7"],["8","8"],["9","9"],["","10"],["","A"],["","B"],["","AB"],["","CL"],["","O"],["","P"],["","SOS"],["","C"],["","D"],["","E"],["","F"],["","G"],["","H"],["","I"],["","J"],["","K"],["","L"],["","M"],["","N"],["","Q"],["","R"],["","S"],["","T"],["","U"],["","V"],["","W"],["","X"],["","Y"],["","Z"]],doCustomReplacements=(string,replacements)=>{for(const[key,value]of replacements)string=string.replace(new RegExp(escapeStringRegexp(key),"g"),value);return string};const overridableReplacements=[["&"," and "],[""," unicorn "],[""," love "]],decamelize=string=>string.replace(/([A-Z]{2,})(\d+)/g,"$1 $2").replace(/([a-z\d]+)([A-Z]{2,})/g,"$1 $2").replace(/([a-z\d])([A-Z])/g,"$1 $2").replace(/([A-Z]+)([A-Z][a-rt-z\d]+)/g,"$1 $2"),removeMootSeparators=(string,separator)=>{const escapedSeparator=escapeStringRegexp$1(separator);return string.replace(new RegExp(`${escapedSeparator}{2,}`,"g"),separator).replace(new RegExp(`^${escapedSeparator}|${escapedSeparator}$`,"g"),"")},buildPatternSlug=options=>{let negationSetPattern="a-z\\d";if(negationSetPattern+=options.lowercase?"":"A-Z",options.preserveCharacters.length>0)for(const character of options.preserveCharacters){if(character===options.separator)throw new Error(`The separator character \`${options.separator}\` cannot be included in preserved characters: ${options.preserveCharacters}`);negationSetPattern+=escapeStringRegexp$1(character)}return new RegExp(`[^${negationSetPattern}]+`,"g")};function slugify(string,options){if("string"!=typeof string)throw new TypeError(`Expected a string, got \`${typeof string}\``);const shouldPrependUnderscore=(options={separator:"-",lowercase:!0,decamelize:!0,customReplacements:[],preserveLeadingUnderscore:!1,preserveTrailingDash:!1,preserveCharacters:[],...options}).preserveLeadingUnderscore&&string.startsWith("_"),shouldAppendDash=options.preserveTrailingDash&&string.endsWith("-");string=function(string,options){if("string"!=typeof string)throw new TypeError(`Expected a string, got \`${typeof string}\``);options={customReplacements:[],...options};const customReplacements=new Map([...replacements,...options.customReplacements]);return string=string.normalize(),(string=doCustomReplacements(string,customReplacements)).normalize("NFD").replace(/\p{Diacritic}/gu,"").normalize()}(string,{customReplacements:new Map([...overridableReplacements,...options.customReplacements])}),options.decamelize&&(string=decamelize(string));const patternSlug=buildPatternSlug(options);return options.lowercase&&(string=string.toLowerCase()),string=(string=(string=string.replace(/([a-zA-Z\d]+)'([ts])(\s|$)/g,"$1$2$3")).replace(patternSlug,options.separator)).replace(/\\/g,""),options.separator&&(string=removeMootSeparators(string,options.separator)),shouldPrependUnderscore&&(string=`_${string}`),shouldAppendDash&&(string=`${string}-`),string}function liftListItem(itemType){return function(state,dispatch){let{$from:$from,$to:$to}=state.selection,range=$from.blockRange($to,(node=>node.childCount>0&&node.firstChild.type==itemType));return!!range&&(!dispatch||($from.node(range.depth-1).type==itemType?function(state,dispatch,itemType,range){let tr=state.tr,end=range.end,endOfList=range.$to.end(range.depth);end<endOfList&&(tr.step(new ReplaceAroundStep(end-1,endOfList,end,endOfList,new Slice(Fragment.from(itemType.create(null,range.parent.copy())),1,0),1,!0)),range=new NodeRange(tr.doc.resolve(range.$from.pos),tr.doc.resolve(endOfList),range.depth));const target=liftTarget(range);if(null==target)return!1;tr.lift(range,target);let after=tr.mapping.map(end,-1)-1;canJoin(tr.doc,after)&&tr.join(after);return dispatch(tr.scrollIntoView()),!0}(state,dispatch,itemType,range):function(state,dispatch,range){let tr=state.tr,list=range.parent;for(let pos=range.end,i=range.endIndex-1,e=range.startIndex;i>e;i--)pos-=list.child(i).nodeSize,tr.delete(pos-1,pos+1);let $start=tr.doc.resolve(range.start),item=$start.nodeAfter;if(tr.mapping.map(range.end)!=range.start+$start.nodeAfter.nodeSize)return!1;let atStart=0==range.startIndex,atEnd=range.endIndex==list.childCount,parent=$start.node(-1),indexBefore=$start.index(-1);if(!parent.canReplace(indexBefore+(atStart?0:1),indexBefore+1,item.content.append(atEnd?Fragment.empty:Fragment.from(list))))return!1;let start=$start.pos,end=start+item.nodeSize;return tr.step(new ReplaceAroundStep(start-(atStart?1:0),end+(atEnd?1:0),start+1,end-1,new Slice((atStart?Fragment.empty:Fragment.from(list.copy(Fragment.empty))).append(atEnd?Fragment.empty:Fragment.from(list.copy(Fragment.empty))),atStart?0:1,atEnd?0:1),atStart?0:1)),dispatch(tr.scrollIntoView()),!0}(state,dispatch,range)))}}function clean(value){return String(value||"").toUpperCase()}function remarkInlineLinks(){return function(tree){const definition=function(tree){const cache=new Map;if(!tree||!tree.type)throw new Error("mdast-util-definitions expected node");return visit(tree,"definition",(function(definition){const id=clean(definition.identifier);id&&!cache.get(id)&&cache.set(id,definition)})),function(identifier){const id=clean(identifier);return cache.get(id)}}(tree);visit(tree,(function(node,index,parent){if("definition"===node.type&&void 0!==parent&&"number"==typeof index)return parent.children.splice(index,1),[SKIP,index];if("imageReference"===node.type||"linkReference"===node.type){const def=definition(node.identifier);if(def&&parent&&"number"==typeof index)return parent.children[index]="imageReference"===node.type?{type:"image",url:def.url,title:def.title,alt:node.alt}:{type:"link",url:def.url,title:def.title,children:node.children},[SKIP,index]}}))}}function at(t,e){var o;if(!(e.childCount>=1&&"hardbreak"===(null==(o=e.lastChild)?void 0:o.type.name)))return void t.next(e.content);const a=[];e.content.forEach(((s,l,i)=>{i!==e.childCount-1&&a.push(s)})),t.next(Fragment.fromArray(a))}function n(t,e){return Object.assign(t,{meta:{package:"@milkdown/preset-commonmark",...e}}),t}const Z=we$1("emphasis");n(Z,{displayName:"Attr<emphasis>",group:"Emphasis"});const R=ye$1("emphasis",(t=>({attrs:{marker:{default:t.get(Q$1).emphasis||"*"}},parseDOM:[{tag:"i"},{tag:"em"},{style:"font-style",getAttrs:e=>"italic"===e}],toDOM:e=>["em",t.get(Z.key)(e)],parseMarkdown:{match:e=>"emphasis"===e.type,runner:(e,r,a)=>{e.openMark(a,{marker:r.marker}),e.next(r.children),e.closeMark(a)}},toMarkdown:{match:e=>"emphasis"===e.type.name,runner:(e,r)=>{e.withMark(r,"emphasis",void 0,{marker:r.attrs.marker})}}})));n(R.mark,{displayName:"MarkSchema<emphasis>",group:"Emphasis"}),n(R.ctx,{displayName:"MarkSchemaCtx<emphasis>",group:"Emphasis"});const ee=re$1("ToggleEmphasis",(t=>()=>toggleMark(R.type(t))));n(ee,{displayName:"Command<toggleEmphasisCommand>",group:"Emphasis"});const nt=oe$1((t=>markRule(/(?:^|[^*])\*([^*]+)\*$/,R.type(t),{updateCaptured:({fullMatch:e,start:r})=>e.startsWith("*")?{}:{fullMatch:e.slice(1),start:r+1}})));n(nt,{displayName:"InputRule<emphasis>|Star",group:"Emphasis"});const ot=oe$1((t=>markRule(/(?:^|[^_])_([^_]+)_$/,R.type(t),{updateCaptured:({fullMatch:e,start:r})=>e.startsWith("_")?{}:{fullMatch:e.slice(1),start:r+1}})));n(ot,{displayName:"InputRule<emphasis>|Underscore",group:"Emphasis"});const te=ge$1("emphasisKeymap",{ToggleEmphasis:{shortcuts:"Mod-i",command:t=>{const e=t.get(je);return()=>e.call(ee.key)}}});n(te.ctx,{displayName:"KeymapCtx<emphasis>",group:"Emphasis"}),n(te.shortcuts,{displayName:"Keymap<emphasis>",group:"Emphasis"});const re=we$1("strong");n(re,{displayName:"Attr<strong>",group:"Strong"});const $=ye$1("strong",(t=>({attrs:{marker:{default:t.get(Q$1).strong||"*"}},parseDOM:[{tag:"b"},{tag:"strong"},{style:"font-style",getAttrs:e=>"bold"===e}],toDOM:e=>["strong",t.get(re.key)(e)],parseMarkdown:{match:e=>"strong"===e.type,runner:(e,r,a)=>{e.openMark(a,{marker:r.marker}),e.next(r.children),e.closeMark(a)}},toMarkdown:{match:e=>"strong"===e.type.name,runner:(e,r)=>{e.withMark(r,"strong",void 0,{marker:r.attrs.marker})}}})));n($.mark,{displayName:"MarkSchema<strong>",group:"Strong"}),n($.ctx,{displayName:"MarkSchemaCtx<strong>",group:"Strong"});const ae=re$1("ToggleStrong",(t=>()=>toggleMark($.type(t))));n(ae,{displayName:"Command<toggleStrongCommand>",group:"Strong"});const st=oe$1((t=>markRule(/(?:\*\*|__)([^*_]+)(?:\*\*|__)$/,$.type(t))));n(st,{displayName:"InputRule<strong>",group:"Strong"});const ne=ge$1("strongKeymap",{ToggleBold:{shortcuts:["Mod-b"],command:t=>{const e=t.get(je);return()=>e.call(ae.key)}}});n(ne.ctx,{displayName:"KeymapCtx<strong>",group:"Strong"}),n(ne.shortcuts,{displayName:"Keymap<strong>",group:"Strong"});const oe=we$1("inlineCode");n(oe,{displayName:"Attr<inlineCode>",group:"InlineCode"});const x=ye$1("inlineCode",(t=>({priority:100,code:!0,inclusive:!1,parseDOM:[{tag:"code"}],toDOM:e=>["code",t.get(oe.key)(e)],parseMarkdown:{match:e=>"inlineCode"===e.type,runner:(e,r,a)=>{e.openMark(a),e.addText(r.value),e.closeMark(a)}},toMarkdown:{match:e=>"inlineCode"===e.type.name,runner:(e,r,a)=>{e.withMark(r,"inlineCode",a.text||"")}}})));n(x.mark,{displayName:"MarkSchema<inlineCode>",group:"InlineCode"}),n(x.ctx,{displayName:"MarkSchemaCtx<inlineCode>",group:"InlineCode"});const se=re$1("ToggleInlineCode",(t=>()=>(e,r)=>{const{selection:a,tr:o}=e;if(a.empty)return!1;const{from:s,to:l}=a;return e.doc.rangeHasMark(s,l,x.type(t))?(null==r||r(o.removeMark(s,l,x.type(t))),!0):(Object.keys(e.schema.marks).filter((m=>m!==x.type.name)).map((m=>e.schema.marks[m])).forEach((m=>{o.removeMark(s,l,m)})),null==r||r(o.addMark(s,l,x.type(t).create())),!0)}));n(se,{displayName:"Command<toggleInlineCodeCommand>",group:"InlineCode"});const lt=oe$1((t=>markRule(/(?:\`)([^\`]+)(?:\`)$/,x.type(t))));n(lt,{displayName:"InputRule<inlineCodeInputRule>",group:"InlineCode"});const le=ge$1("inlineCodeKeymap",{ToggleInlineCode:{shortcuts:"Mod-e",command:t=>{const e=t.get(je);return()=>e.call(se.key)}}});n(le.ctx,{displayName:"KeymapCtx<inlineCode>",group:"InlineCode"}),n(le.shortcuts,{displayName:"Keymap<inlineCode>",group:"InlineCode"});const ie=we$1("link");n(ie,{displayName:"Attr<link>",group:"Link"});const B=ye$1("link",(t=>({attrs:{href:{},title:{default:null}},parseDOM:[{tag:"a[href]",getAttrs:e=>{if(!(e instanceof HTMLElement))throw S$4(e);return{href:e.getAttribute("href"),title:e.getAttribute("title")}}}],toDOM:e=>["a",{...t.get(ie.key)(e),...e.attrs}],parseMarkdown:{match:e=>"link"===e.type,runner:(e,r,a)=>{const o=r.url,s=r.title;e.openMark(a,{href:o,title:s}),e.next(r.children),e.closeMark(a)}},toMarkdown:{match:e=>"link"===e.type.name,runner:(e,r)=>{e.withMark(r,"link",void 0,{title:r.attrs.title,url:r.attrs.href})}}})));n(B.mark,{displayName:"MarkSchema<link>",group:"Link"});const it=re$1("ToggleLink",(t=>(e={})=>toggleMark(B.type(t),e)));n(it,{displayName:"Command<toggleLinkCommand>",group:"Link"});const dt=re$1("UpdateLink",(t=>(e={})=>(r,a)=>{if(!a)return!1;let o,s=-1;const{selection:l}=r,{from:i,to:d}=l;if(r.doc.nodesBetween(i,i===d?d+1:d,((y,b)=>{if(B.type(t).isInSet(y.marks))return o=y,s=b,!1})),!o)return!1;const m=o.marks.find((({type:y})=>y===B.type(t)));if(!m)return!1;const p=s,k=s+o.nodeSize,{tr:g}=r,C=B.type(t).create({...m.attrs,...e});return!!C&&(a(g.removeMark(p,k,m).addMark(p,k,C).setSelection(new TextSelection(g.selection.$anchor)).scrollIntoView()),!0)}));n(dt,{displayName:"Command<updateLinkCommand>",group:"Link"});const mt=W$1("doc",(()=>({content:"block+",parseMarkdown:{match:({type:t})=>"root"===t,runner:(t,e,r)=>{t.injectRoot(e,r)}},toMarkdown:{match:t=>"doc"===t.type.name,runner:(t,e)=>{t.openNode("root"),t.next(e.content)}}})));n(mt,{displayName:"NodeSchema<doc>",group:"Doc"});const de=he$1("paragraph");n(de,{displayName:"Attr<paragraph>",group:"Paragraph"});const A=fe$1("paragraph",(t=>({content:"inline*",group:"block",parseDOM:[{tag:"p"}],toDOM:e=>["p",t.get(de.key)(e),0],parseMarkdown:{match:e=>"paragraph"===e.type,runner:(e,r,a)=>{e.openNode(a),r.children?e.next(r.children):e.addText(r.value||""),e.closeNode()}},toMarkdown:{match:e=>"paragraph"===e.type.name,runner:(e,r)=>{e.openNode("paragraph"),at(e,r),e.closeNode()}}})));n(A.node,{displayName:"NodeSchema<paragraph>",group:"Paragraph"}),n(A.ctx,{displayName:"NodeSchemaCtx<paragraph>",group:"Paragraph"});const me=re$1("TurnIntoText",(t=>()=>setBlockType(A.type(t))));n(me,{displayName:"Command<turnIntoTextCommand>",group:"Paragraph"});const pe=ge$1("paragraphKeymap",{TurnIntoText:{shortcuts:"Mod-Alt-0",command:t=>{const e=t.get(je);return()=>e.call(me.key)}}});n(pe.ctx,{displayName:"KeymapCtx<paragraph>",group:"Paragraph"}),n(pe.shortcuts,{displayName:"Keymap<paragraph>",group:"Paragraph"});const Dt=Array(6).fill(0).map(((t,e)=>e+1));const j=h((function(t){return slugify(t.textContent)}),"headingIdGenerator");n(j,{displayName:"Ctx<HeadingIdGenerator>",group:"Heading"});const ce=he$1("heading");n(ce,{displayName:"Attr<heading>",group:"Heading"});const H=fe$1("heading",(t=>{const e=t.get(j.key);return{content:"inline*",group:"block",defining:!0,attrs:{id:{default:""},level:{default:1}},parseDOM:Dt.map((r=>({tag:`h${r}`,getAttrs:a=>{if(!(a instanceof HTMLElement))throw S$4(a);return{level:r,id:a.id}}}))),toDOM:r=>[`h${r.attrs.level}`,{...t.get(ce.key)(r),id:r.attrs.id||e(r)},0],parseMarkdown:{match:({type:r})=>"heading"===r,runner:(r,a,o)=>{const s=a.depth;r.openNode(o,{level:s}),r.next(a.children),r.closeNode()}},toMarkdown:{match:r=>"heading"===r.type.name,runner:(r,a)=>{r.openNode("heading",void 0,{depth:a.attrs.level}),at(r,a),r.closeNode()}}}}));n(H.node,{displayName:"NodeSchema<heading>",group:"Heading"}),n(H.ctx,{displayName:"NodeSchemaCtx<heading>",group:"Heading"});const pt=oe$1((t=>textblockTypeInputRule(/^(?<hashes>#+)\s$/,H.type(t),(e=>{var l,i;const r=(null==(i=null==(l=e.groups)?void 0:l.hashes)?void 0:i.length)||0,a=t.get(H$1),{$from:o}=a.state.selection,s=o.node();if("heading"===s.type.name){let d=Number(s.attrs.level)+Number(r);return d>6&&(d=6),{level:d}}return{level:r}}))));n(pt,{displayName:"InputRule<wrapInHeadingInputRule>",group:"Heading"});const L=re$1("WrapInHeading",(t=>e=>(e??(e=1),e<1?setBlockType(A.type(t)):setBlockType(H.type(t),{level:e}))));n(L,{displayName:"Command<wrapInHeadingCommand>",group:"Heading"});const ue=re$1("DowngradeHeading",(t=>()=>(e,r,a)=>{const{$from:o}=e.selection,s=o.node();if(s.type!==H.type(t)||!e.selection.empty||0!==o.parentOffset)return!1;const l=s.attrs.level-1;return l?(null==r||r(e.tr.setNodeMarkup(e.selection.$from.before(),void 0,{...s.attrs,level:l})),!0):setBlockType(A.type(t))(e,r,a)}));n(ue,{displayName:"Command<downgradeHeadingCommand>",group:"Heading"});const ge=ge$1("headingKeymap",{TurnIntoH1:{shortcuts:"Mod-Alt-1",command:t=>{const e=t.get(je);return()=>e.call(L.key,1)}},TurnIntoH2:{shortcuts:"Mod-Alt-2",command:t=>{const e=t.get(je);return()=>e.call(L.key,2)}},TurnIntoH3:{shortcuts:"Mod-Alt-3",command:t=>{const e=t.get(je);return()=>e.call(L.key,3)}},TurnIntoH4:{shortcuts:"Mod-Alt-4",command:t=>{const e=t.get(je);return()=>e.call(L.key,4)}},TurnIntoH5:{shortcuts:"Mod-Alt-5",command:t=>{const e=t.get(je);return()=>e.call(L.key,5)}},TurnIntoH6:{shortcuts:"Mod-Alt-6",command:t=>{const e=t.get(je);return()=>e.call(L.key,6)}},DowngradeHeading:{shortcuts:["Delete","Backspace"],command:t=>{const e=t.get(je);return()=>e.call(ue.key)}}});n(ge.ctx,{displayName:"KeymapCtx<heading>",group:"Heading"}),n(ge.shortcuts,{displayName:"Keymap<heading>",group:"Heading"});const ye=he$1("blockquote");n(ye,{displayName:"Attr<blockquote>",group:"Blockquote"});const q=fe$1("blockquote",(t=>({content:"block+",group:"block",defining:!0,parseDOM:[{tag:"blockquote"}],toDOM:e=>["blockquote",t.get(ye.key)(e),0],parseMarkdown:{match:({type:e})=>"blockquote"===e,runner:(e,r,a)=>{e.openNode(a).next(r.children).closeNode()}},toMarkdown:{match:e=>"blockquote"===e.type.name,runner:(e,r)=>{e.openNode("blockquote").next(r.content).closeNode()}}})));n(q.node,{displayName:"NodeSchema<blockquote>",group:"Blockquote"}),n(q.ctx,{displayName:"NodeSchemaCtx<blockquote>",group:"Blockquote"});const ct=oe$1((t=>wrappingInputRule(/^\s*>\s$/,q.type(t))));n(ct,{displayName:"InputRule<wrapInBlockquoteInputRule>",group:"Blockquote"});const ke=re$1("WrapInBlockquote",(t=>()=>wrapIn(q.type(t))));n(ke,{displayName:"Command<wrapInBlockquoteCommand>",group:"Blockquote"});const he=ge$1("blockquoteKeymap",{WrapInBlockquote:{shortcuts:"Mod-Shift-b",command:t=>{const e=t.get(je);return()=>e.call(ke.key)}}});n(he.ctx,{displayName:"KeymapCtx<blockquote>",group:"Blockquote"}),n(he.shortcuts,{displayName:"Keymap<blockquote>",group:"Blockquote"});const fe=he$1("codeBlock",(()=>({pre:{},code:{}})));n(fe,{displayName:"Attr<codeBlock>",group:"CodeBlock"});const W=fe$1("code_block",(t=>({content:"text*",group:"block",marks:"",defining:!0,code:!0,attrs:{language:{default:""}},parseDOM:[{tag:"pre",preserveWhitespace:"full",getAttrs:e=>{if(!(e instanceof HTMLElement))throw S$4(e);return{language:e.dataset.language}}}],toDOM:e=>{const r=t.get(fe.key)(e);return["pre",{...r.pre,"data-language":e.attrs.language},["code",r.code,0]]},parseMarkdown:{match:({type:e})=>"code"===e,runner:(e,r,a)=>{const o=r.lang,s=r.value;e.openNode(a,{language:o}),s&&e.addText(s),e.closeNode()}},toMarkdown:{match:e=>"code_block"===e.type.name,runner:(e,r)=>{var a;e.addNode("code",void 0,(null==(a=r.content.firstChild)?void 0:a.text)||"",{lang:r.attrs.language})}}})));n(W.node,{displayName:"NodeSchema<codeBlock>",group:"CodeBlock"}),n(W.ctx,{displayName:"NodeSchemaCtx<codeBlock>",group:"CodeBlock"});const ut=oe$1((t=>textblockTypeInputRule(/^```(?<language>[a-z]*)?[\s\n]$/,W.type(t),(e=>{var r;return{language:(null==(r=e.groups)?void 0:r.language)??""}}))));n(ut,{displayName:"InputRule<createCodeBlockInputRule>",group:"CodeBlock"});const Ne=re$1("CreateCodeBlock",(t=>(e="")=>setBlockType(W.type(t),{language:e})));n(Ne,{displayName:"Command<createCodeBlockCommand>",group:"CodeBlock"});const Et=re$1("UpdateCodeBlockLanguage",(()=>({pos:t,language:e}={pos:-1,language:""})=>(r,a)=>t>=0&&(null==a||a(r.tr.setNodeAttribute(t,"language",e)),!0)));n(Et,{displayName:"Command<updateCodeBlockLanguageCommand>",group:"CodeBlock"});const Ie=ge$1("codeBlockKeymap",{CreateCodeBlock:{shortcuts:"Mod-Alt-c",command:t=>{const e=t.get(je);return()=>e.call(Ne.key)}}});n(Ie.ctx,{displayName:"KeymapCtx<codeBlock>",group:"CodeBlock"}),n(Ie.shortcuts,{displayName:"Keymap<codeBlock>",group:"CodeBlock"});const Ce=he$1("image");n(Ce,{displayName:"Attr<image>",group:"Image"});const v=fe$1("image",(t=>({inline:!0,group:"inline",selectable:!0,draggable:!0,marks:"",atom:!0,defining:!0,isolating:!0,attrs:{src:{default:""},alt:{default:""},title:{default:""}},parseDOM:[{tag:"img[src]",getAttrs:e=>{if(!(e instanceof HTMLElement))throw S$4(e);return{src:e.getAttribute("src")||"",alt:e.getAttribute("alt")||"",title:e.getAttribute("title")||e.getAttribute("alt")||""}}}],toDOM:e=>["img",{...t.get(Ce.key)(e),...e.attrs}],parseMarkdown:{match:({type:e})=>"image"===e,runner:(e,r,a)=>{const o=r.url,s=r.alt,l=r.title;e.addNode(a,{src:o,alt:s,title:l})}},toMarkdown:{match:e=>"image"===e.type.name,runner:(e,r)=>{e.addNode("image",void 0,void 0,{title:r.attrs.title,url:r.attrs.src,alt:r.attrs.alt})}}})));n(v.node,{displayName:"NodeSchema<image>",group:"Image"}),n(v.ctx,{displayName:"NodeSchemaCtx<image>",group:"Image"});const gt=re$1("InsertImage",(t=>(e={})=>(r,a)=>{if(!a)return!0;const{src:o="",alt:s="",title:l=""}=e,i=v.type(t).create({src:o,alt:s,title:l});return i&&a(r.tr.replaceSelectionWith(i).scrollIntoView()),!0}));n(gt,{displayName:"Command<insertImageCommand>",group:"Image"});const yt=re$1("UpdateImage",(t=>(e={})=>(r,a)=>{const o=findSelectedNodeOfType(r.selection,v.type(t));if(!o)return!1;const{node:s,pos:l}=o,i={...s.attrs},{src:d,alt:m,title:p}=e;return void 0!==d&&(i.src=d),void 0!==m&&(i.alt=m),void 0!==p&&(i.title=p),null==a||a(r.tr.setNodeMarkup(l,void 0,i).scrollIntoView()),!0}));n(yt,{displayName:"Command<updateImageCommand>",group:"Image"});const Pt=oe$1((t=>new InputRule(/!\[(?<alt>.*?)]\((?<filename>.*?)\s*(?="|\))"?(?<title>[^"]+)?"?\)/,((e,r,a,o)=>{const[s,l,i="",d]=r;return s?e.tr.replaceWith(a,o,v.type(t).create({src:i,alt:l,title:d})):null}))));n(Pt,{displayName:"InputRule<insertImageInputRule>",group:"Image"});const Me=he$1("hardbreak",(t=>({"data-is-inline":t.attrs.isInline})));n(Me,{displayName:"Attr<hardbreak>",group:"Hardbreak"});const S=fe$1("hardbreak",(t=>({inline:!0,group:"inline",attrs:{isInline:{default:!1}},selectable:!1,parseDOM:[{tag:"br"}],toDOM:e=>["br",t.get(Me.key)(e)],parseMarkdown:{match:({type:e})=>"break"===e,runner:(e,r,a)=>{var o;e.addNode(a,{isInline:!(null==(o=r.data)||!o.isInline)})}},leafText:()=>"\n",toMarkdown:{match:e=>"hardbreak"===e.type.name,runner:(e,r)=>{r.attrs.isInline?e.addNode("text",void 0,"\n"):e.addNode("break")}}})));n(S.node,{displayName:"NodeSchema<hardbreak>",group:"Hardbreak"}),n(S.ctx,{displayName:"NodeSchemaCtx<hardbreak>",group:"Hardbreak"});const be=re$1("InsertHardbreak",(t=>()=>(e,r)=>{var s;const{selection:a,tr:o}=e;if(!(a instanceof TextSelection))return!1;if(a.empty){const l=a.$from.node();if(l.childCount>0&&"hardbreak"===(null==(s=l.lastChild)?void 0:s.type.name))return null==r||r(o.replaceRangeWith(a.to-1,a.to,e.schema.node("paragraph")).setSelection(Selection.near(o.doc.resolve(a.to))).scrollIntoView()),!0}return null==r||r(o.setMeta("hardbreak",!0).replaceSelectionWith(S.type(t).create()).scrollIntoView()),!0}));n(be,{displayName:"Command<insertHardbreakCommand>",group:"Hardbreak"});const Le=ge$1("hardbreakKeymap",{InsertHardbreak:{shortcuts:"Shift-Enter",command:t=>{const e=t.get(je);return()=>e.call(be.key)}}});n(Le.ctx,{displayName:"KeymapCtx<hardbreak>",group:"Hardbreak"}),n(Le.shortcuts,{displayName:"Keymap<hardbreak>",group:"Hardbreak"});const xe=he$1("hr");n(xe,{displayName:"Attr<hr>",group:"Hr"});const F=fe$1("hr",(t=>({group:"block",parseDOM:[{tag:"hr"}],toDOM:e=>["hr",t.get(xe.key)(e)],parseMarkdown:{match:({type:e})=>"thematicBreak"===e,runner:(e,r,a)=>{e.addNode(a)}},toMarkdown:{match:e=>"hr"===e.type.name,runner:e=>{e.addNode("thematicBreak")}}})));n(F.node,{displayName:"NodeSchema<hr>",group:"Hr"}),n(F.ctx,{displayName:"NodeSchemaCtx<hr>",group:"Hr"});const kt=oe$1((t=>new InputRule(/^(?:---|___\s|\*\*\*\s)$/,((e,r,a,o)=>{const{tr:s}=e;return r[0]&&s.replaceWith(a-1,o,F.type(t).create()),s}))));n(kt,{displayName:"InputRule<insertHrInputRule>",group:"Hr"});const ht=re$1("InsertHr",(t=>()=>(e,r)=>{if(!r)return!0;const a=A.node.type(t).create(),{tr:o,selection:s}=e,{from:l}=s,i=F.type(t).create();if(!i)return!0;const d=o.replaceSelectionWith(i).insert(l,a),m=Selection.findFrom(d.doc.resolve(l),1,!0);return m&&r(d.setSelection(m).scrollIntoView()),!0}));n(ht,{displayName:"Command<insertHrCommand>",group:"Hr"});const Se=he$1("bulletList");n(Se,{displayName:"Attr<bulletList>",group:"BulletList"});const O=fe$1("bullet_list",(t=>({content:"listItem+",group:"block",attrs:{spread:{default:!1}},parseDOM:[{tag:"ul",getAttrs:e=>{if(!(e instanceof HTMLElement))throw S$4(e);return{spread:e.dataset.spread}}}],toDOM:e=>["ul",{...t.get(Se.key)(e),"data-spread":e.attrs.spread},0],parseMarkdown:{match:({type:e,ordered:r})=>"list"===e&&!r,runner:(e,r,a)=>{const o=null!=r.spread?`${r.spread}`:"false";e.openNode(a,{spread:o}).next(r.children).closeNode()}},toMarkdown:{match:e=>"bullet_list"===e.type.name,runner:(e,r)=>{e.openNode("list",void 0,{ordered:!1,spread:"true"===r.attrs.spread}).next(r.content).closeNode()}}})));n(O.node,{displayName:"NodeSchema<bulletList>",group:"BulletList"}),n(O.ctx,{displayName:"NodeSchemaCtx<bulletList>",group:"BulletList"});const ft=oe$1((t=>wrappingInputRule(/^\s*([-+*])\s$/,O.type(t))));n(ft,{displayName:"InputRule<wrapInBulletListInputRule>",group:"BulletList"});const we=re$1("WrapInBulletList",(t=>()=>wrapIn(O.type(t))));n(we,{displayName:"Command<wrapInBulletListCommand>",group:"BulletList"});const Ae=ge$1("bulletListKeymap",{WrapInBulletList:{shortcuts:"Mod-Alt-8",command:t=>{const e=t.get(je);return()=>e.call(we.key)}}});n(Ae.ctx,{displayName:"KeymapCtx<bulletListKeymap>",group:"BulletList"}),n(Ae.shortcuts,{displayName:"Keymap<bulletListKeymap>",group:"BulletList"});const He=he$1("orderedList");n(He,{displayName:"Attr<orderedList>",group:"OrderedList"});const T=fe$1("ordered_list",(t=>({content:"listItem+",group:"block",attrs:{order:{default:1},spread:{default:!1}},parseDOM:[{tag:"ol",getAttrs:e=>{if(!(e instanceof HTMLElement))throw S$4(e);return{spread:e.dataset.spread,order:e.hasAttribute("start")?Number(e.getAttribute("start")):1}}}],toDOM:e=>["ol",{...t.get(He.key)(e),...1===e.attrs.order?{}:e.attrs.order,"data-spread":e.attrs.spread},0],parseMarkdown:{match:({type:e,ordered:r})=>"list"===e&&!!r,runner:(e,r,a)=>{const o=null!=r.spread?`${r.spread}`:"true";e.openNode(a,{spread:o}).next(r.children).closeNode()}},toMarkdown:{match:e=>"ordered_list"===e.type.name,runner:(e,r)=>{e.openNode("list",void 0,{ordered:!0,start:1,spread:"true"===r.attrs.spread}),e.next(r.content),e.closeNode()}}})));n(T.node,{displayName:"NodeSchema<orderedList>",group:"OrderedList"}),n(T.ctx,{displayName:"NodeSchemaCtx<orderedList>",group:"OrderedList"});const Nt=oe$1((t=>wrappingInputRule(/^\s*(\d+)\.\s$/,T.type(t),(e=>({order:Number(e[1])})),((e,r)=>r.childCount+r.attrs.order===Number(e[1])))));n(Nt,{displayName:"InputRule<wrapInOrderedListInputRule>",group:"OrderedList"});const Be=re$1("WrapInOrderedList",(t=>()=>wrapIn(T.type(t))));n(Be,{displayName:"Command<wrapInOrderedListCommand>",group:"OrderedList"});const Re=ge$1("orderedListKeymap",{WrapInOrderedList:{shortcuts:"Mod-Alt-7",command:t=>{const e=t.get(je);return()=>e.call(Be.key)}}});n(Re.ctx,{displayName:"KeymapCtx<orderedList>",group:"OrderedList"}),n(Re.shortcuts,{displayName:"Keymap<orderedList>",group:"OrderedList"});const ve=he$1("listItem");n(ve,{displayName:"Attr<listItem>",group:"ListItem"});const M=fe$1("list_item",(t=>({group:"listItem",content:"paragraph block*",attrs:{label:{default:""},listType:{default:"bullet"},spread:{default:"true"}},defining:!0,parseDOM:[{tag:"li",getAttrs:e=>{if(!(e instanceof HTMLElement))throw S$4(e);return{label:e.dataset.label,listType:e.dataset["list-type"],spread:e.dataset.spread}}}],toDOM:e=>["li",{...t.get(ve.key)(e),"data-label":e.attrs.label,"data-list-type":e.attrs.listType,"data-spread":e.attrs.spread},0],parseMarkdown:{match:({type:e})=>"listItem"===e,runner:(e,r,a)=>{const o=null!=r.label?`${r.label}.`:"",s=null!=r.label?"ordered":"bullet",l=null!=r.spread?`${r.spread}`:"true";e.openNode(a,{label:o,listType:s,spread:l}),e.next(r.children),e.closeNode()}},toMarkdown:{match:e=>"list_item"===e.type.name,runner:(e,r)=>{e.openNode("listItem",void 0,{spread:"true"===r.attrs.spread}),e.next(r.content),e.closeNode()}}})));n(M.node,{displayName:"NodeSchema<listItem>",group:"ListItem"}),n(M.ctx,{displayName:"NodeSchemaCtx<listItem>",group:"ListItem"});const Oe=re$1("SinkListItem",(t=>()=>{return itemType=M.type(t),function(state,dispatch){let{$from:$from,$to:$to}=state.selection,range=$from.blockRange($to,(node=>node.childCount>0&&node.firstChild.type==itemType));if(!range)return!1;let startIndex=range.startIndex;if(0==startIndex)return!1;let parent=range.parent,nodeBefore=parent.child(startIndex-1);if(nodeBefore.type!=itemType)return!1;if(dispatch){let nestedBefore=nodeBefore.lastChild&&nodeBefore.lastChild.type==parent.type,inner=Fragment.from(nestedBefore?itemType.create():null),slice=new Slice(Fragment.from(itemType.create(null,Fragment.from(parent.type.create(null,inner)))),nestedBefore?3:1,0),before=range.start,after=range.end;dispatch(state.tr.step(new ReplaceAroundStep(before-(nestedBefore?3:1),after,before,after,slice,1,!0)).scrollIntoView())}return!0};var itemType}));n(Oe,{displayName:"Command<sinkListItemCommand>",group:"ListItem"});const Te=re$1("SplitListItem",(t=>()=>liftListItem(M.type(t))));n(Te,{displayName:"Command<liftListItemCommand>",group:"ListItem"});const Ke=re$1("SplitListItem",(t=>()=>{return itemType=M.type(t),function(state,dispatch){let{$from:$from,$to:$to,node:node}=state.selection;if(node&&node.isBlock||$from.depth<2||!$from.sameParent($to))return!1;let grandParent=$from.node(-1);if(grandParent.type!=itemType)return!1;if(0==$from.parent.content.size&&$from.node(-1).childCount==$from.indexAfter(-1)){if(3==$from.depth||$from.node(-3).type!=itemType||$from.index(-2)!=$from.node(-2).childCount-1)return!1;if(dispatch){let wrap=Fragment.empty,depthBefore=$from.index(-1)?1:$from.index(-2)?2:3;for(let d=$from.depth-depthBefore;d>=$from.depth-3;d--)wrap=Fragment.from($from.node(d).copy(wrap));let depthAfter=$from.indexAfter(-1)<$from.node(-2).childCount?1:$from.indexAfter(-2)<$from.node(-3).childCount?2:3;wrap=wrap.append(Fragment.from(itemType.createAndFill()));let start=$from.before($from.depth-(depthBefore-1)),tr=state.tr.replace(start,$from.after(-depthAfter),new Slice(wrap,4-depthBefore,0)),sel=-1;tr.doc.nodesBetween(start,tr.doc.content.size,((node,pos)=>{if(sel>-1)return!1;node.isTextblock&&0==node.content.size&&(sel=pos+1)})),sel>-1&&tr.setSelection(Selection.near(tr.doc.resolve(sel))),dispatch(tr.scrollIntoView())}return!0}let nextType=$to.pos==$from.end()?grandParent.contentMatchAt(0).defaultType:null,tr=state.tr.delete($from.pos,$to.pos),types=nextType?[itemAttrs?{type:itemType,attrs:itemAttrs}:null,{type:nextType}]:void 0;return!!canSplit(tr.doc,$from.pos,2,types)&&(dispatch&&dispatch(tr.split($from.pos,2,types).scrollIntoView()),!0)};var itemType,itemAttrs}));n(Ke,{displayName:"Command<splitListItemCommand>",group:"ListItem"});const De=re$1("LiftFirstListItem",(t=>()=>function(t){return(e,r,a)=>{const{selection:o}=e;if(!(o instanceof TextSelection))return!1;const{empty:s,$from:l}=o;if(!s||0!==l.parentOffset)return!1;const i=l.node(-1);return!(i.type!==M.type(t)||i.firstChild!==l.node()||l.node(-2).childCount>1)&&liftListItem(M.type(t))(e,r,a)}}(t)));n(De,{displayName:"Command<liftFirstListItemCommand>",group:"ListItem"});const _e=ge$1("listItemKeymap",{NextListItem:{shortcuts:"Enter",command:t=>{const e=t.get(je);return()=>e.call(Ke.key)}},SinkListItem:{shortcuts:["Tab","Mod-]"],command:t=>{const e=t.get(je);return()=>e.call(Oe.key)}},LiftListItem:{shortcuts:["Shift-Tab","Mod-["],command:t=>{const e=t.get(je);return()=>e.call(Te.key)}},LiftFirstListItem:{shortcuts:["Backspace","Delete"],command:t=>{const e=t.get(je);return()=>e.call(De.key)}}});n(_e.ctx,{displayName:"KeymapCtx<listItem>",group:"ListItem"}),n(_e.shortcuts,{displayName:"Keymap<listItem>",group:"ListItem"});const It=W$1("text",(()=>({group:"inline",parseMarkdown:{match:({type:t})=>"text"===t,runner:(t,e)=>{t.addText(e.value)}},toMarkdown:{match:t=>"text"===t.type.name,runner:(t,e)=>{t.addNode("text",void 0,e.text)}}})));n(It,{displayName:"NodeSchema<text>",group:"Text"});const Ee=he$1("html");n(Ee,{displayName:"Attr<html>",group:"Html"});const Pe=fe$1("html",(t=>({atom:!0,group:"inline",inline:!0,attrs:{value:{default:""}},toDOM:e=>{const r=document.createElement("span"),a={...t.get(Ee.key)(e),"data-value":e.attrs.value,"data-type":"html"};return r.textContent=e.attrs.value,["span",a,e.attrs.value]},parseDOM:[{tag:'span[data-type="html"]',getAttrs:e=>({value:e.dataset.value??""})}],parseMarkdown:{match:({type:e})=>"html"===e,runner:(e,r,a)=>{e.addNode(a,{value:r.value})}},toMarkdown:{match:e=>"html"===e.type.name,runner:(e,r)=>{e.addNode("html",void 0,r.attrs.value)}}})));n(Pe.node,{displayName:"NodeSchema<html>",group:"Html"}),n(Pe.ctx,{displayName:"NodeSchemaCtx<html>",group:"Html"});const qt=[mt,de,A,j,ce,H,Me,S,ye,q,fe,W,xe,F,Ce,v,Se,O,He,T,ve,M,Z,R,re,$,oe,x,ie,B,Ee,Pe,It].flat(),Wt=[ct,ft,Nt,ut,kt,pt].flat(),Ft=[nt,ot,lt,st],Vt=[me,ke,L,ue,Ne,be,ht,gt,yt,Be,we,Oe,Ke,Te,De,ee,se,ae,it,dt],Ut=[he,Ie,Le,ge,_e,Re,Ae,pe,te,le,ne].flat(),$e=ke$1("remarkAddOrderInList",(()=>()=>t=>{visit(t,"list",(e=>{if(e.ordered){const r=e.start??1;e.children.forEach(((a,o)=>{a.label=o+r}))}}))}));n($e.plugin,{displayName:"Remark<remarkAddOrderInListPlugin>",group:"Remark"}),n($e.options,{displayName:"RemarkConfig<remarkAddOrderInListPlugin>",group:"Remark"});const qe=ke$1("remarkLineBreak",(()=>()=>t=>{const e=/[\t ]*(?:\r?\n|\r)/g;visit(t,"text",((r,a,o)=>{if(!r.value||"string"!=typeof r.value)return;const s=[];let l=0;e.lastIndex=0;let i=e.exec(r.value);for(;i;){const m=i.index;l!==m&&s.push({type:"text",value:r.value.slice(l,m)}),s.push({type:"break",data:{isInline:!0}}),l=m+i[0].length,i=e.exec(r.value)}return s.length>0&&o&&"number"==typeof a?(l<r.value.length&&s.push({type:"text",value:r.value.slice(l)}),o.children.splice(a,1,...s),a+s.length):void 0}))}));n(qe.plugin,{displayName:"Remark<remarkLineBreak>",group:"Remark"}),n(qe.options,{displayName:"RemarkConfig<remarkLineBreak>",group:"Remark"});const We=ke$1("remarkInlineLink",(()=>remarkInlineLinks));n(We.plugin,{displayName:"Remark<remarkInlineLinkPlugin>",group:"Remark"}),n(We.options,{displayName:"RemarkConfig<remarkInlineLinkPlugin>",group:"Remark"});const Fe=ke$1("remarkHTMLTransformer",(()=>()=>t=>{!function(t,e){(function r(a,o,s){if((t=>!!t.children)(a)){const l=[];for(let i=0,d=a.children.length;i<d;i++){const m=a.children[i];if(m){const p=r(m,i,a);if(p)for(let k=0,g=p.length;k<g;k++){const C=p[k];C&&l.push(C)}}}a.children=l}return e(a,o,s)})(t,0,null)[0]}(t,((e,r,a)=>(t=>"html"===t.type)(e)?("root"===(null==a?void 0:a.type)&&(e.children=[{...e}],delete e.value,e.type="paragraph"),[e]):[e]))}));n(Fe.plugin,{displayName:"Remark<remarkHtmlTransformer>",group:"Remark"}),n(Fe.options,{displayName:"RemarkConfig<remarkHtmlTransformer>",group:"Remark"});const Ve=ke$1("remarkMarker",(()=>()=>(t,e)=>{visit(t,(a=>["strong","emphasis"].includes(a.type)),(a=>{a.marker=(a=>e.value.charAt(a.position.start.offset))(a)}))}));n(Ve.plugin,{displayName:"Remark<remarkMarker>",group:"Remark"}),n(Ve.options,{displayName:"RemarkConfig<remarkMarker>",group:"Remark"});const Ct=ue$1((()=>{let t=!1;const e=new PluginKey("MILKDOWN_INLINE_NODES_CURSOR"),r=new Plugin({key:e,state:{init:()=>!1,apply(a){if(!a.selection.empty)return!1;const o=a.selection.$from,s=o.nodeBefore,l=o.nodeAfter;return!(!(s&&l&&s.isInline&&!s.isText&&l.isInline)||l.isText)}},props:{handleDOMEvents:{compositionend:(a,o)=>!!t&&(t=!1,requestAnimationFrame((()=>{if(r.getState(a.state)){const l=a.state.selection.from;o.preventDefault(),a.dispatch(a.state.tr.insertText(o.data||"",l))}})),!0),compositionstart:a=>(r.getState(a.state)&&(t=!0),!1),beforeinput:(a,o)=>{if(r.getState(a.state)&&o instanceof InputEvent&&o.data&&!t){const l=a.state.selection.from;return o.preventDefault(),a.dispatch(a.state.tr.insertText(o.data||"",l)),!0}return!1}},decorations(a){if(r.getState(a)){const l=a.selection.$from.pos,i=document.createElement("span"),d=Decoration.widget(l,i,{side:-1}),m=document.createElement("span"),p=Decoration.widget(l,m);return setTimeout((()=>{i.contentEditable="true",m.contentEditable="true"})),DecorationSet.create(a.doc,[d,p])}return DecorationSet.empty}}});return r}));n(Ct,{displayName:"Prose<inlineNodesCursorPlugin>",group:"Prose"});const Mt=ue$1((t=>new Plugin({key:new PluginKey("MILKDOWN_HARDBREAK_MARKS"),appendTransaction:(e,r,a)=>{if(!e.length)return;const[o]=e;if(!o)return;const[s]=o.steps;if(o.getMeta("hardbreak")){if(!(s instanceof ReplaceStep))return;const{from:d}=s;return a.tr.setNodeMarkup(d,S.type(t),void 0,[])}if(s instanceof AddMarkStep){let d=a.tr;const{from:m,to:p}=s;return a.doc.nodesBetween(m,p,((k,g)=>{k.type===S.type(t)&&(d=d.setNodeMarkup(g,S.type(t),void 0,[]))})),d}}})));n(Mt,{displayName:"Prose<hardbreakClearMarkPlugin>",group:"Prose"});const Ue=h(["table","code_block"],"hardbreakFilterNodes");n(Ue,{displayName:"Ctx<hardbreakFilterNodes>",group:"Prose"});const bt=ue$1((t=>{const e=t.get(Ue.key);return new Plugin({key:new PluginKey("MILKDOWN_HARDBREAK_FILTER"),filterTransaction:(r,a)=>{const o=r.getMeta("hardbreak"),[s]=r.steps;if(o&&s){const{from:l}=s,i=a.doc.resolve(l);let d=i.depth,m=!0;for(;d>0;)e.includes(i.node(d).type.name)&&(m=!1),d--;return m}return!0}})}));n(bt,{displayName:"Prose<hardbreakFilterPlugin>",group:"Prose"});const Lt=ue$1((t=>{const e=new PluginKey("MILKDOWN_HEADING_ID"),r=a=>{if(a.composing||!a.editable)return;const o=t.get(j.key),s=a.state.tr.setMeta("addToHistory",!1);let l=!1;a.state.doc.descendants(((i,d)=>{if(i.type===H.type(t)){if(0===i.textContent.trim().length)return;const m=i.attrs,p=o(i);m.id!==p&&(l=!0,s.setMeta(e,!0).setNodeMarkup(d,void 0,{...m,id:p}))}})),l&&a.dispatch(s)};return new Plugin({key:e,view:a=>(r(a),{update:o=>{r(o)}})})}));n(Lt,{displayName:"Prose<syncHeadingIdPlugin>",group:"Prose"});const xt=ue$1((t=>{const e=r=>{if(r.composing||!r.editable)return;const a=T.type(t),o=O.type(t),s=M.type(t),l=r.state,i=(p,k)=>{let g=!1;const C=`${k+1}.`;return p.label!==C&&(p.label=C,g=!0),g};let d=l.tr,m=!1;l.doc.descendants(((p,k,g,C)=>{if(p.type===o){const y=p.maybeChild(0);(null==y?void 0:y.type)===s&&"ordered"===y.attrs.listType&&(m=!0,d.setNodeMarkup(k,a,{spread:"true"}),p.descendants(((b,Ge,Qt,St)=>{if(b.type===s){const je={...b.attrs};i(je,St)&&(d=d.setNodeMarkup(Ge,void 0,je))}return!1})))}else if(p.type===s&&(null==g?void 0:g.type)===a){const y={...p.attrs};let b=!1;"ordered"!==y.listType&&(y.listType="ordered",b=!0),(null==g?void 0:g.maybeChild(0))&&(b=i(y,C)),b&&(d=d.setNodeMarkup(k,void 0,y),m=!0)}})),m&&r.dispatch(d.setMeta("addToHistory",!1))};return new Plugin({key:new PluginKey("MILKDOWN_KEEP_LIST_ORDER"),view:r=>(e(r),{update:a=>{e(a)}})})}));n(xt,{displayName:"Prose<syncListOrderPlugin>",group:"Prose"});const cr=[qt,Wt,Ft,Vt,Ut,[Mt,Ue,bt,Ct,$e,We,qe,Fe,Ve,Lt,xt].flat()].flat();Oe$1.make().config((ctx=>{ctx.set(ce$1,"#markdown-example"),ctx.set(re$2,"# Milkdown Vanilla Commonmark\n\n> You're scared of a world where you're needed.\n\nThis is a demo for using Milkdown with **Vanilla Typescript**.")})).use(cr).create()}(node_crypto);