!function(){"use strict";function load$1(target,url,infinite){fetch(url,{method:"GET",headers:{"X-Requested-With":"fetch"}}).then((function(response){return response.text()})).then((function(body){target.innerHTML=body})).then((function(){infinite&&(pagingObserver.observe(target.querySelector(".paging-trigger")),function(current){let targets=document.querySelectorAll("[data-load-on-view]"),foundCurrent=!1,foundNext=!1,loaded=!1;targets.forEach((target=>{if(loaded=target.classList.contains("is-loaded"),foundCurrent&&!foundNext||loaded){let display=target.getAttribute("data-display-as");display=display||"block",target.style.display=display,loaded||(foundNext=!0)}else target.style.display="none";target==current&&(foundCurrent=!0)}))}(target),initDataAttributes())}))}!function(webstop,ahoy){let retailerID=document.body.getAttribute("data-retailer-id"),apiHost=document.body.getAttribute("data-api-host"),webHost=document.body.getAttribute("data-web-host");webstop.retailerID=retailerID,webstop.apiHost=apiHost,webstop.webHost=webHost,ahoy.visitParams={retailer_id:retailerID},ahoy.visitsUrl=apiHost+"/api/v1/retailers/"+retailerID+"/aye/visit.json",ahoy.eventsUrl=apiHost+"/api/v1/retailers/"+retailerID+"/aye/event.json"}(window.webstop=window.webstop||{},window.ahoy=window.ahoy||{}),(window.webstop=window.webstop||{}).live=function(perform,parent="body"){let parents;const config={childList:!0,subtree:!0};let callback=function(mutationsList,observer){let hasNodesAdded=!1;for(let mutation of mutationsList)"childList"===mutation.type&&(hasNodesAdded=!0);hasNodesAdded&&perform()};"string"==typeof parent&&parent.trim().length>0||(parent="body"),parents=document.querySelectorAll(parent),parents.length>0&&parents.forEach((container=>{new MutationObserver(callback).observe(container,config)}))},function(cs3){function getCookie(name){let nameEquals=name+"=",ca=document.cookie.split(";");for(let i=0;i<ca.length;i++){let c=ca[i];for(;" "==c.charAt(0);)c=c.substring(1,c.length);if(0==c.indexOf(nameEquals))return c.substring(nameEquals.length,c.length)}return null}cs3.setCookie=function(name,value,expireDays){const d=new Date;let expires="";expireDays&&(d.setTime(d.getTime()+24*expireDays*60*60*1e3),expires="expires="+d.toUTCString()+";"),document.cookie=name+"="+value+";"+expires+"path=/"},cs3.getCookie=getCookie,cs3.checkCookie=function(name){return!!getCookie(name)}}(window.cs3=window.cs3||{}),$((function(){$(document.body).on("submit","[data-ajax-form]",(function(event){event.preventDefault();let $this=$(this),url=$this.attr("action"),data=$this.serializeArray(),$target=$this,hasPowerBar=$this.is("[data-power-bar]"),hasOnComplete=$this.is("[data-on-complete-load]"),onCompleteUrl="",onCompleteTarget="";hasOnComplete&&(onCompleteUrl=$this.data("on-complete-load"),onCompleteTarget=$this.data("on-complete-target")),$this.is("[data-target]")?$target=$($this.data("target")):($this.parent().is(".ajax-form-container")||$this.wrap("<div class='ajax-form-container'></div>"),$target=$this.parent()),$target.load(url,data,(function(){hasOnComplete&&loadOnComplete(onCompleteUrl,onCompleteTarget),hasPowerBar&&loadShoppingListPowerBar()}))}))})),$((function(){$(document.body).on("click","[data-ajax-load]",(function(event){let $this=$(this),url=$this.data("load"),$target=$this,hasPowerBar=$this.is("[data-power-bar]"),hasOnComplete=$this.is("[data-on-complete-load]"),onCompleteUrl="",onCompleteTarget="";hasOnComplete&&(onCompleteUrl=$this.data("on-complete-load"),onCompleteTarget=$this.data("on-complete-target")),$this.is("[data-target]")?$target=$($this.data("target")):($this.parent().is(".ajax-form-container")||$this.wrap("<div class='ajax-form-container'></div>"),$target=$this.parent()),$this.is("[data-disable-loading-indicator]")||($this.is('input[type="submit"]')?$this.val("Loading..."):$this.text("Loading..."),($this.is("button")||$this.is('input[type="submit"]'))&&$this.prop("disabled",!0)),$target.load(url,(function(){hasOnComplete&&function(onCompleteUrl,onCompleteTarget){const targets=document.querySelectorAll(onCompleteTarget);fetch(onCompleteUrl).then((response=>response.text())).then((html=>{targets.forEach((target=>{target.innerHTML=html}))})).catch((error=>console.error("Error loading on-complete content:",error)))}(onCompleteUrl,onCompleteTarget),hasPowerBar&&loadShoppingListPowerBar()}))}))}));const pagingObserver=new IntersectionObserver((entries=>{if(0!==entries[0].intersectionRatio){!function(source){let maxPageNumber=source.getAttribute("data-max-page-number"),pageNumber=source.getAttribute("data-page-number"),selector="";source.hasAttribute("data-paging")&&(selector=source.getAttribute("data-paging"));selector||(selector=".paging");document.querySelectorAll(selector).forEach((target=>{let currentPage=target.querySelector(".paging-current-page"),pages=target.querySelectorAll(".paging-page"),html=`\n      <span class="d-none d-sm-inline">Page ${pageNumber} of ${maxPageNumber}</span>\n      <span class="d-inline d-sm-none">Pg. ${pageNumber}</span>\n    `;currentPage.innerHTML=html;let url=source.getAttribute("data-load-on-view");url||(url=source.getAttribute("data-url")),pages.forEach((page=>{page.getAttribute("href")==url?page.classList.add("active"):page.classList.contains("active")&&page.classList.remove("active")}))}))}(entries[0].target.closest("[data-page-number]"))}}));function initDataAttributes$1(){$('[data-toggle="popover"]').popover(),$('[data-toggle="tooltip"]').tooltip()}(()=>{let targets=document.querySelectorAll("[data-load-on-view]"),count=0;if(0!==targets.length){targets.forEach((target=>{let url=target.getAttribute("data-load-on-view"),infinite=target.hasAttribute("data-infinite-scroll"),display=target.getAttribute("data-display-as"),show=target.hasAttribute("data-show"),loaded=target.classList.contains("is-loaded");display=display||"block",0==count||loaded||show||(display="none"),target.style.display=display,function(target,url,infinite){new IntersectionObserver((entries=>{0===entries[0].intersectionRatio||entries[0].target.classList.contains("is-loaded")||(load$1(target,url,infinite),entries[0].target.hasAttribute("data-skip-history")||history.pushState(null,"",url),entries[0].target.classList.add("is-loaded"))})).observe(target)}(target,url,infinite),count++}));let pagingTrigger=document.querySelector(".paging-trigger");pagingTrigger&&pagingObserver.observe(pagingTrigger)}})(),(()=>{let targets=document.querySelectorAll("[data-load-now]");0!==targets.length&&targets.forEach((target=>{let url=target.getAttribute("data-load-now");load$1(target,url,!1)}))})(),$((function(){$(document.body).on("hidden.bs.modal","#site-modal",(function(){$("#site-modal-title").text(""),$("#site-modal-body").html('<div class="text-center"><div class="spinner-grow" style="width: 5rem; height: 5rem;" role="status"></div><H4>Loading...</H4></div>'),$("#site-modal-footer").removeClass("d-none")})),$(document.body).on("show.bs.modal","#site-modal",(function(event){let trigger=event.relatedTarget,$trigger=$(event.relatedTarget),title=$trigger.attr("data-title"),url=$trigger.attr("data-load"),content=$trigger.attr("data-content"),footer=$trigger.attr("data-footer"),storeFormPicker=$trigger.is("[data-store-form-picker]");"hide"==footer&&$("#site-modal-footer").addClass("d-none"),$("#site-modal-title").text(title),content&&$("#site-modal-body").html(content),url&&$("#site-modal-body").load(url,(function(){if(storeFormPicker){webstop.stores.formPicker(trigger);let storesListing=document.querySelector("#stores-search-results");new MutationObserver((function(){webstop.stores.formPicker(trigger)})).observe(storesListing,{attributes:!1,childList:!0,subtree:!1})}}))}))})),$((function(){initDataAttributes$1()}));document.querySelectorAll("[data-disable-on-click]").forEach((btn=>{btn.addEventListener("click",(function(event){event.target.disabled=!0,event.target.innerHTML="Loading...",event.target.value="Loading..."}))}));function loadShoppingListPowerBar$1(){console.log("loadShoppingListPowerBar triggered");let url="/shopping_list/power_bar?url="+window.location.href;$("#site-aside-slider").load(url)}document.querySelectorAll("[data-disable-on-submit]").forEach((btn=>{btn.addEventListener("submit",(function(event){event.target.disabled=!0,event.target.innerHTML="Loading...",event.target.value="Loading..."}))})),$((function(){function update_status(context){let group=$(context).attr("data-check-selector-group"),checked=0,unchecked=0;console.log("Checkbox Changed!"),$(`input[type="checkbox"][data-check-selector-group="${group}"]`).each((function(index){$(this).prop("checked")?checked+=1:unchecked+=1})),checked<=unchecked?select(group):unselect(group)}function select(group){console.log("Change button to select."),$(`[data-check-selector-for="${group}"]`).removeClass("is-unselect"),$(`[data-check-selector-for="${group}"]`).addClass("is-select"),$(`[data-check-selector-for="${group}"]`).attr("data-check-selector-state","select")}function unselect(group){console.log("Change button to unselect."),$(`[data-check-selector-for="${group}"]`).removeClass("is-select"),$(`[data-check-selector-for="${group}"]`).addClass("is-unselect"),$(`[data-check-selector-for="${group}"]`).attr("data-check-selector-state","unselect")}$('input[type="checkbox"][data-check-selector-group]').on("change",(function(){update_status(this)})),$('input[type="checkbox"][data-check-selector-group]').each((function(){update_status(this)})),$(document.body).on("click","[data-check-selector-for]",(function(event){event.preventDefault();let $button=$(this),group=$button.attr("data-check-selector-for");"select"==$button.attr("data-check-selector-state")?($(`input[type="checkbox"][data-check-selector-group="${group}"]`).prop("checked",!0),unselect(group)):($(`input[type="checkbox"][data-check-selector-group="${group}"]`).prop("checked",!1),select(group))}))})),function(){if(document.body.clientWidth<770){console.log("Setting circular cookie...");let name=window.webstop.retailerID+"_circular_format";cs3.setCookie(name,"online",7)}}(),window.addEventListener("load",(function(){let searchField=document.querySelector("input[data-filter-search]");searchField&&searchField.addEventListener("keyup",(function(){let search=this.value.toLowerCase(),selector=this.getAttribute("data-filter-selector"),items=document.querySelectorAll(selector);for(let i of items){-1==i.innerHTML.toLowerCase().indexOf(search)?i.classList.add("d-none"):i.classList.remove("d-none")}}))})),$((function(){$(document.body).on("change","[data-form-toggle-trigger]",(function(event){let $this=$(this),name=$this.attr("name"),tag=$this.prop("tagName"),control="";if("SELECT"==tag)control="select";else if("INPUT"==tag){let input_type=$this.attr("type");"CHECKBOX"==input_type||"checkbox"==input_type?control="checkbox":"RADIO"!=input_type&&"radio"!=input_type||(control="radio")}if("select"==control||"radio"==control){let value=this.value,show=!1;$(`[data-form-toggle*='${name}']`).each((function(){show="exact"==$(this).attr("data-form-toggle-match")?$(this).attr("data-form-toggle-show-for")==value:$(this).attr("data-form-toggle-show-for").includes(value),show?$(this).removeClass("d-none"):$(this).addClass("d-none")}))}else"checkbox"==control&&$(`[data-form-toggle='${name}']`).toggleClass("d-none")}))})),function(webstop){let message,trigger,target,hide_trigger=!0,locate_on_load=!1,action_url="",has_action_url=!1,filter="",has_filter=!1,main_action="",has_main_action=!1,redirect_url="",has_redirect_url=!1;webstop.locator={},webstop.locator.locate=function(display_messages){display_messages=!(!display_messages||!message),navigator.geolocation?(display_messages&&(message.textContent="Locating…"),navigator.geolocation.getCurrentPosition((function(position){const latitude=position.coords.latitude,longitude=position.coords.longitude,default_action_url=`${window.webstop.webHost}/retailers/${window.webstop.retailerID}/stores?display=results-only&latitude=${latitude}&longitude=${longitude}`;action_url=action_url||default_action_url,""==action_url&&(action_url=default_action_url),""!=filter&&(action_url+=`&filter=${filter}`),""!=main_action&&(action_url+=`&main_action=${main_action}`),""!=redirect_url&&(action_url+=`&url=${redirect_url}`),load(target,action_url),display_messages&&(message.textContent=""),hide_trigger&&trigger.classList.add("d-none")}),(function(error){display_messages&&(message.textContent="Unable to retrieve your location."),console.error(`Geolocation Error. Code: ${error.code}. Message: ${error.message}`)}))):display_messages&&(message.textContent="Geolocation is not supported by your browser.")},webstop.locator.watcher=function(){trigger=document.querySelector("[data-locate]"),trigger&&(target=document.querySelector(trigger.getAttribute("data-locate-target")),message=document.querySelector(trigger.getAttribute("data-locate-message")),hide_trigger=trigger.hasAttribute("data-locate-hide-me"),locate_on_load=trigger.hasAttribute("data-locate-on-load"),has_action_url=trigger.hasAttribute("data-locate-action-url"),has_action_url&&(action_url=trigger.getAttribute("data-locate-action-url")),has_filter=trigger.hasAttribute("data-locate-filter"),has_filter&&(filter=trigger.getAttribute("data-locate-filter")),has_main_action=trigger.hasAttribute("data-locate-main-action"),has_main_action&&(main_action=trigger.getAttribute("data-locate-main-action")),has_redirect_url=trigger.hasAttribute("data-locate-redirect-url"),has_redirect_url&&(redirect_url=trigger.getAttribute("data-locate-redirect-url")),trigger.addEventListener("click",(function(event){webstop.locator.locate(!0)})),locate_on_load&&webstop.locator.locate(!1))}}(window.webstop=window.webstop||{}),(()=>{const pxPerRow=24;function enableEditor(textarea,Editor){let config=function(textarea){let pixels=0,content=textarea.value,height="300px",mode="wysiwyg",previewStyle="tab",initialEditType="wysiwyg",toolbarAttr=textarea.getAttribute("data-editor-toolbar"),toolbarItems=[["heading","bold","italic"],["ul","ol"],["hr","table","image","link"]];"basic"===toolbarAttr?toolbarItems=[["heading","bold","italic","link"]]:"full"===toolbarAttr&&(toolbarItems=[["heading","bold","italic","strike"],["hr","quote"],["ul","ol"],["table","image","link"],["code","codeblock"]]),console.log("Textarea Value in getConfig:"),console.log(content),textarea.hasAttribute("data-editor-height")?pixels=Number(textarea.getAttribute("data-editor-height")):textarea.hasAttribute("rows")&&(pixels=Number(textarea.getAttribute("rows"))*pxPerRow);return pixels>=72&&(pixels+=75,height=pixels+"px"),textarea.hasAttribute("data-editor-mode")&&(mode=textarea.getAttribute("data-editor-mode"),"wysiwyg"===mode?(initialEditType="wysiwyg",previewStyle="tab"):"markdown"===mode?(initialEditType="markdown",previewStyle="tab"):"split-pane"===mode&&(initialEditType="markdown",previewStyle="vertical")),{height:height,content:content,toolbarItems:toolbarItems,previewStyle:previewStyle,initialEditType:initialEditType}}(textarea),div=function(textarea,config){let div=document.createElement("div");textarea.hasAttribute("class")&&textarea.getAttribute("class").split(" ").forEach((cssClass=>{div.classList.add(cssClass)}));if(textarea.hasAttribute("rows")){let pixels=textarea.getAttribute("rows")*pxPerRow;div.style.minHeight=pixels+"px"}return textarea.insertAdjacentElement("afterend",div),textarea.style.display="none",div}(textarea),form=textarea.closest("form");console.log("config.content:",config.content),console.log(config.content);let editor=new Editor({el:div,height:config.height,toolbarItems:config.toolbarItems,initialValue:textarea.value,initialEditType:config.initialEditType});form.addEventListener("submit",(function(event){event.preventDefault(),textarea.value=editor.getMarkdown(),console.log("Submit Textarea:"),console.log(textarea.value),form.submit(),console.log("Form submitted!")})),editor.getMarkdown()}let editors=document.querySelectorAll("[data-markdown-editor]");if(editors.length>0){const stylesheet=document.createElement("link");stylesheet.rel="stylesheet",stylesheet.href="https://uicdn.toast.com/editor/3.2.2/toastui-editor.min.css",document.body.appendChild(stylesheet);const script=document.createElement("script");script.src="https://uicdn.toast.com/editor/3.2.2/toastui-editor-all.min.js",script.onload=function(){const Editor=toastui.Editor;console.log("Toast UI Editor JS file has loaded."),editors.forEach((textarea=>{console.log("Found a Markdown Editor"),enableEditor(textarea,Editor)}))},document.body.appendChild(script)}})(),function(){const publicLayout=document.querySelector(".public"),sidenavToggles=document.querySelectorAll("[data-sidenav-toggle]"),sidebarToggles=document.querySelectorAll("[data-sidebar-toggle]");sidenavToggles.forEach((sidenavToggle=>{sidenavToggle.addEventListener("click",(event=>{event.preventDefault(),publicLayout.classList.toggle("public-hide-sidenav"),publicLayout.classList.contains("public-hide-sidenav")?cs3.setCookie("public_sidenav","hide",1):cs3.setCookie("public_sidenav","show",1)}))})),sidebarToggles.forEach((sidebarToggle=>{sidebarToggle.addEventListener("click",(event=>{event.preventDefault(),publicLayout.classList.toggle("public-hide-sidebar"),publicLayout.classList.contains("public-hide-sidebar")?cs3.setCookie("public_sidebar","hide",1):cs3.setCookie("public_sidebar","show",1)}))}))}(),$((function(){function exitSearch(target,reveal=null,$clear=null){null!=$clear&&$clear.val("");let $target=$(target);$target.html(""),$target.hide(),null!=reveal&&$(reveal).show()}!function(){let delay=null;$('[data-search="live"]').find(".search-from-search-text").on("keyup",(function(event){clearTimeout(delay);let $form=$(this).parents('[data-search="live"]'),target=$form.data("target"),hide=$form.data("hide"),url=$form.attr("action");if(event.target.value.length<=2)exitSearch(target);else{let data=$form.serializeArray();delay=setTimeout((function(){!function(data,target,hide,url){let $target=$(target);$(hide).hide(),$target.show("fast",(function(){$target.load(url,data)}))}(data,target,hide,url)}),500)}})),$('[data-search="live"]').find(".search-form-clear").on("click",(function(event){event.preventDefault();let $form=$(this).parents('[data-search="live"]');exitSearch($form.data("target"),$form.data("hide"),$form.find(".search-from-search-text"))}))}()})),$((function(){loadShoppingListPowerBar$1(),$(document.body).on("click",".site-aside-slider-toggle",(function(event){event.preventDefault();let $aside=$("#site-aside-slider");$aside.hasClass("site-aside-slider-open")?($aside.removeClass("site-aside-slider-open"),cs3.setCookie("site_aside","close",1)):($aside.addClass("site-aside-slider-open"),cs3.setCookie("site_aside","open",1))}));let $modal=$("#shopping-list-modal");$(document.body).on("show.bs.modal","#shopping-list-modal",(function(event){let $form=$modal.find(".shopping-list-form"),$errors=$form.find(".shopping-list-form-errors"),$button=$(event.relatedTarget),$title=$modal.find(".modal-title"),$nameGroup=$modal.find(".modal-body .shopping-list-form-name-group"),$name=$modal.find(".modal-body .shopping-list-form-name"),$submit=$form.find(".shopping-list-form-submit"),$description=$form.find(".shopping-list-form-description"),verb=$button.data("verb"),url=$button.data("url"),response={status:"",message:""};if($title.text(verb+" Shopping List"),$submit.text(verb),$errors.html(""),$form.attr("action",url),"Create"==verb){let today=new Date;today=today.toLocaleDateString("en-US",{year:"numeric",month:"numeric",day:"numeric"}),$nameGroup.removeClass("is-hidden"),$name.val("My "+today+" List"),$description.text(""),$description.addClass("is-hidden")}else"Rename"==verb?($nameGroup.removeClass("is-hidden"),$name.val($("#shopping-list-power-bar-list").text()),$description.text(""),$description.addClass("is-hidden")):"Delete"==verb&&($nameGroup.addClass("is-hidden"),$description.removeClass("is-hidden"),$description.text("Once deleted your most recent shopping list will become your current list. If you have no shopping lists a new one will be created. Are you sure you want to delete your current shopping list?"));$form.on("submit",(function(e){e.preventDefault();let request=$.ajax({url:url,method:"POST",contentType:"application/json",dataType:"json"});request.done((function(jqXHR,data){console.log("ajax response status: "+data.status),console.log("message: "+data.message),"success"==data.status?(response=data,$modal.modal("hide"),console.log("hide modal triggered")):response="failure"==data.status?data:{status:"failure",message:"Unable to process request. Please try again."},"failure"==response.status&&$errors.html('<p class="shopping-list-form-errors-message alert alert-danger">'+response.message+"</p>")})),request.fail((function(response){$errors.html('<p class="shopping-list-form-errors-message alert alert-danger">'+response.message+"</p>")}))}))})),$(document.body).on("hidden.bs.modal","#shopping-list-modal",(function(event){console.log("modal fully hidden"),loadShoppingListPowerBar$1()}))})),function(webstop){webstop.stores={},webstop.stores.formPicker=function(trigger){let inputSelector=trigger.getAttribute("data-store-picker-input"),addressSelector=trigger.getAttribute("data-store-picker-address"),inputTarget=document.querySelector(inputSelector),addressTarget=document.querySelector(addressSelector),buttons=document.querySelectorAll("[data-store-selection]");0!==buttons.length&&buttons.forEach((button=>{let id=button.getAttribute("data-store-id"),name=button.getAttribute("data-store-name"),address=button.getAttribute("data-store-address"),city=button.getAttribute("data-store-city"),state=button.getAttribute("data-store-state"),zip=button.getAttribute("data-store-zip"),hasAddress=!1;(name||address||city||state||zip)&&(hasAddress=!0);let addressHTML="";hasAddress&&(name&&(addressHTML+=`<strong>${name}</strong><br>`),addressHTML+=`${address}<br>${city}, ${state} ${zip}`),button.addEventListener("click",(function(event){hasAddress&&(addressTarget.innerHTML=addressHTML),inputTarget.value=id,trigger.textContent="Change Store"}))}))}}(window.webstop=window.webstop||{}),function(){function setTagging(searchThis,searchText){const $search=$(searchThis),searchId="#"+$search.attr("id"),targetId=$search.data("tag-search-target"),displayId=$search.data("tag-search-display"),resultsId=$search.data("tag-search-results"),tagging={searchText:searchText,searchId:searchId,targetId:targetId,displayId:displayId,resultsId:resultsId,$search:$search,$target:$(targetId),$display:$(displayId),$results:$(resultsId)};return console.log("Tagging Set"),console.log(`searchText: ${searchText}`),console.log(`searchId:   ${searchId}`),console.log(`targetId:   ${targetId}`),console.log(`displayId:  ${displayId}`),console.log(`resultsId:  ${resultsId}`),tagging}function displayTags(tagging){const tags=trimArray(tagging.$target.val().split(","));let items=[],html="";tags.forEach((function(tag){tag&&items.push(`<span class="tag bg-secondary"> ${tag} <span data-tag-search-remove-tag data-tag-text="${tag}"><i class="icon-cancel ml-1"></i></span></span>`)})),html=items.join(""),tagging.$display.html(html),function(tagging){tagging.$display.find("[data-tag-search-remove-tag]").on("click",(function(event){event.preventDefault();const tag=$(this).data("tag-text");let tags=uniqArraySort(trimArray(tagging.$target.val().split(",")));const index=tags.indexOf(tag);tags.splice(index,1),tagging.$target.val(removeLeadingComma(uniqArraySort(tags).join())),displayTags(tagging)}))}(tagging)}function exitTagSearch(tagging){tagging.$results.html("")}function trimArray(a){let trim_a=[];return a.forEach((function(i){trim_a.push(i.trim())})),trim_a}function uniqArraySort(a){return a.sort().filter((function(item,pos,ary){return!pos||item!=ary[pos-1]}))}function removeLeadingComma(text){return","==text[0]&&(text=text.substring(1)),text}$("[data-tag-search]").each((function(){displayTags(setTagging(this,""))})),function(){let delay=null;$(document.body).on("keyup","[data-tag-search]",(function(event){clearTimeout(delay);const searchText=event.target.value,tagging=setTagging(this,searchText);searchText.length<=2?exitTagSearch(tagging):delay=setTimeout((function(){!function(tagging){const url=window.webstop.apiHost+"/api/v1/tags/search";$.getJSON(`${url}?search=${tagging.searchText}`,(function(data){!function(data,tagging){let html,items=[];$.each(data,(function(position,record){$.each(record,(function(key,value){"name"==key&&items.push(`<button class="list-group-item list-group-item-action" data-tag-add data-tag-search-id="${tagging.searchId}" data-tag-search-value="${value}">${value}</button>`)}))})),items.push(`<button class="list-group-item list-group-item-secondary list-group-item-action" data-tag-add data-tag-add data-tag-search-id="${tagging.searchId}" data-tag-search-value="${tagging.searchText}"><em class="text-muted">Create New "</em>${tagging.searchText}<em class="text-muted">" Tag.</em></button>`),html='<div class="list-group">',html+=items.join(""),html+="</div>",tagging.$results.html(html),$(document.body).on("click","[data-tag-add]",(function(event){event.preventDefault();const tagging=setTagging($(this).data("tag-search-id"),"");let tags=trimArray(tagging.$target.val().split(","));const newTag=$(this).data("tag-search-value").trim();tags.push(newTag),tagging.$target.val(removeLeadingComma(uniqArraySort(tags).join())),displayTags(tagging),exitTagSearch(tagging)}))}(data,tagging)}))}(tagging)}),100)}))}()}()}();